<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlowTrainer // Multi-Theme // v2.6</title> <!-- Versión actualizada -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;700&family=Quantico:wght@400;700&family=Syne:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* --- ESTILOS CSS (Revisados, con Sistema de Temas) --- */

    /* --- 1. Variables CSS Globales y Tema Default (Cyberpunk) --- */
    :root, body.theme-cyberpunk {
      /* Colores Principales */
      --c-primary: var(--neon-cyan);
      --c-secondary: var(--neon-magenta);
      --c-tertiary: var(--neon-blue);
      --c-accent: var(--neon-green);
      /* Fondos y Superficies */
      --c-bg-dark: #0d0f1c;
      --c-bg-medium: #101220;
      --c-surface-dark: #1a1d2e;
      --c-surface-medium: #23263a;
      --c-surface-light: #2c2f4a;
      --c-surface-transparent: rgba(26, 29, 46, 0.8);
      --c-surface-transparent-medium: rgba(44, 47, 74, 0.5);
      --c-surface-transparent-dark: rgba(13, 15, 28, 0.8);
      /* Texto */
      --c-text-light: #e0e0e0;
      --c-text-medium: #a0a0a0;
      --c-text-dark: #1f1f1f; /* Usado en botones hover */
      /* Estados */
      --c-error: #ff4d4d;
      --c-success: var(--c-accent);
      --c-warning: #ffaa00;
      /* Brillos y Sombras */
      --glow-primary: rgba(0, 255, 255, 0.7);
      --glow-secondary: rgba(255, 0, 255, 0.7);
      --glow-tertiary: rgba(42, 127, 251, 0.7);
      --glow-accent: rgba(57, 255, 20, 0.7);
      --shadow-depth-1: 0 4px 15px rgba(0, 0, 0, 0.3);
      --shadow-depth-2: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-primary: 0 0 4px var(--c-primary), 0 0 8px var(--c-primary), 0 0 12px var(--glow-primary);
      --shadow-secondary: 0 0 4px var(--c-secondary), 0 0 8px var(--c-secondary), 0 0 12px var(--glow-secondary);
      --shadow-tertiary: 0 0 4px var(--c-tertiary), 0 0 8px var(--c-tertiary), 0 0 12px var(--glow-tertiary);
      --shadow-accent: 0 0 4px var(--c-accent), 0 0 8px var(--c-accent), 0 0 12px var(--glow-accent);
      /* Tipografía */
      --font-primary: 'Orbitron', sans-serif;
      --font-secondary: 'Rajdhani', sans-serif;
      --font-display: 'Orbitron', sans-serif; /* Para elementos grandes como el timer o word-display */
      /* Fondo Específico Tema */
      --bg-image-main: linear-gradient(rgba(42, 127, 251, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(42, 127, 251, 0.05) 1px, transparent 1px), radial-gradient(circle at top left, rgba(0, 255, 255, 0.08), transparent 40%), radial-gradient(circle at bottom right, rgba(255, 0, 255, 0.08), transparent 50%);
      --bg-size-main: 30px 30px, 30px 30px, 100% 100%, 100% 100%;
      --bg-animation: pulseBg 15s infinite alternate;
      /* Otros */
      --border-radius-small: 4px;
      --border-radius-medium: 8px;
      --border-radius-large: 10px;
      /* Constantes Neón (para no redefinir en cada tema) */
      --neon-cyan: #00ffff; --neon-magenta: #ff00ff; --neon-blue: #2a7ffb; --neon-green: #39ff14;
    }

    /* --- 2. Definiciones Tema: Glitch Art Harmonic --- */
    body.theme-glitch {
      --c-primary: #f0f; /* Magenta */
      --c-secondary: #0ff; /* Cyan */
      --c-tertiary: #ff0; /* Yellow */
      --c-accent: #0f0;  /* Green */
      --c-bg-dark: #050505;
      --c-bg-medium: #101010;
      --c-surface-dark: #181818;
      --c-surface-medium: #222;
      --c-surface-light: #303030;
      --c-surface-transparent: rgba(24, 24, 24, 0.85);
      --c-surface-transparent-medium: rgba(34, 34, 34, 0.6);
      --c-surface-transparent-dark: rgba(5, 5, 5, 0.9);
      --c-text-light: #f5f5f5;
      --c-text-medium: #b0b0b0;
      --c-text-dark: #000;
      --c-error: #ff1c1c;
      --c-success: var(--c-accent);
      --c-warning: #ffa500;
      --glow-primary: rgba(255, 0, 255, 0.8);
      --glow-secondary: rgba(0, 255, 255, 0.8);
      --glow-tertiary: rgba(255, 255, 0, 0.8);
      --glow-accent: rgba(0, 255, 0, 0.8);
      --shadow-primary: 0 0 5px var(--c-primary), 0 0 10px var(--c-primary), 0 0 15px var(--glow-primary);
      --shadow-secondary: 0 0 5px var(--c-secondary), 0 0 10px var(--c-secondary), 0 0 15px var(--glow-secondary);
      --shadow-tertiary: 0 0 5px var(--c-tertiary), 0 0 10px var(--c-tertiary), 0 0 15px var(--glow-tertiary);
      --shadow-accent: 0 0 5px var(--c-accent), 0 0 10px var(--c-accent), 0 0 15px var(--glow-accent);
      --font-primary: 'Quantico', sans-serif; /* Fuente más glitchy/digital */
      --font-secondary: 'Rajdhani', sans-serif;
      --font-display: 'Quantico', monospace;
      --bg-image-main:
        linear-gradient(0deg, rgba(0, 255, 0, 0.08) 1px, transparent 1px), /* Green lines */
        linear-gradient(90deg, rgba(255, 0, 255, 0.08) 1px, transparent 1px); /* Magenta lines */
      --bg-size-main: 20px 20px, 20px 20px;
      --bg-animation: glitchBg 0.1s linear infinite alternate; /* Animación rápida y cortada */
    }
    @keyframes glitchBg { /* Animación de fondo para Glitch */
      0% { background-position: 0 0; }
      20% { background-position: 5px -5px; }
      40% { background-position: -5px 5px; }
      60% { background-position: 10px 0; }
      80% { background-position: 0 -10px; }
      100% { background-position: -5px -5px; }
    }

    /* --- 3. Definiciones Tema: Cosmic Serenity --- */
    body.theme-cosmic {
      --c-primary: #a777ff; /* Lavender Indigo */
      --c-secondary: #ff8cc6; /* Cosmic Pink */
      --c-tertiary: #77dfff; /* Starlight Blue */
      --c-accent: #f9d71c;  /* Gold Dust */
      --c-bg-dark: #0a001a; /* Deep Space Purple */
      --c-bg-medium: #14052e;
      --c-surface-dark: #200f41;
      --c-surface-medium: #2c1955;
      --c-surface-light: #3c2670;
      --c-surface-transparent: rgba(32, 15, 65, 0.8);
      --c-surface-transparent-medium: rgba(44, 25, 85, 0.6);
      --c-surface-transparent-dark: rgba(10, 0, 26, 0.85);
      --c-text-light: #ede0ff;
      --c-text-medium: #bca0dc;
      --c-text-dark: #14052e;
      --c-error: #ff6685;
      --c-success: #77ffce;
      --c-warning: #ffd066;
      --glow-primary: rgba(167, 119, 255, 0.6);
      --glow-secondary: rgba(255, 140, 198, 0.6);
      --glow-tertiary: rgba(119, 223, 255, 0.6);
      --glow-accent: rgba(249, 215, 28, 0.7);
      --shadow-primary: 0 0 6px var(--c-primary), 0 0 12px var(--glow-primary);
      --shadow-secondary: 0 0 6px var(--c-secondary), 0 0 12px var(--glow-secondary);
      --shadow-tertiary: 0 0 6px var(--c-tertiary), 0 0 12px var(--glow-tertiary);
      --shadow-accent: 0 0 8px var(--c-accent), 0 0 15px var(--glow-accent);
      --font-primary: 'Syne', sans-serif; /* Fuente elegante y moderna */
      --font-secondary: 'Rajdhani', sans-serif;
      --font-display: 'Syne', sans-serif;
      /* Fondo animado simulando nebulosa */
      --bg-image-main: radial-gradient(ellipse at 70% 30%, var(--glow-primary) 0%, transparent 50%),
                       radial-gradient(ellipse at 30% 70%, var(--glow-secondary) 0%, transparent 40%),
                       linear-gradient(135deg, var(--c-bg-dark) 0%, var(--c-bg-medium) 100%);
      --bg-size-main: 150% 150%, 120% 120%, 100% 100%;
      --bg-animation: cosmicDrift 45s linear infinite alternate;
    }
    @keyframes cosmicDrift { /* Animación de fondo para Cosmic */
      0% { background-position: 0% 50%, 100% 50%, 0% 0%; }
      100% { background-position: 100% 50%, 0% 50%, 0% 0%; }
    }

    /* --- 4. Definiciones Tema: Aetherium --- */
    body.theme-aetherium {
      --c-primary: #ffffff; /* Pure White */
      --c-secondary: #ffd700; /* Gold */
      --c-tertiary: #afeeee; /* Pale Turquoise / Cyan */
      --c-accent: #ffb6c1;  /* Light Pink */
      --c-bg-dark: #f0f8ff; /* Alice Blue */
      --c-bg-medium: #f8faff;
      --c-surface-dark: #ffffff; /* Superficies blancas puras */
      --c-surface-medium: #fafcff;
      --c-surface-light: #f5f8fd;
      --c-surface-transparent: rgba(255, 255, 255, 0.85); /* Translúcido */
      --c-surface-transparent-medium: rgba(240, 248, 255, 0.7);
      --c-surface-transparent-dark: rgba(255, 255, 255, 0.9);
      --c-text-light: #333; /* Texto oscuro para contraste */
      --c-text-medium: #666;
      --c-text-dark: #000;
      --c-error: #d44;
      --c-success: var(--c-tertiary);
      --c-warning: #f0ad4e;
      --glow-primary: rgba(255, 255, 255, 0.9);
      --glow-secondary: rgba(255, 215, 0, 0.7);
      --glow-tertiary: rgba(175, 238, 238, 0.7);
      --glow-accent: rgba(255, 182, 193, 0.7);
      /* Sombras más sutiles o brillantes */
      --shadow-depth-1: 0 3px 10px rgba(0, 0, 0, 0.08);
      --shadow-depth-2: 0 6px 20px rgba(0, 0, 0, 0.1);
      --shadow-primary: 0 0 8px var(--glow-primary), 0 0 15px rgba(175, 238, 238, 0.5); /* Blanco con toque cian */
      --shadow-secondary: 0 0 6px var(--c-secondary), 0 0 12px var(--glow-secondary);
      --shadow-tertiary: 0 0 6px var(--c-tertiary), 0 0 12px var(--glow-tertiary);
      --shadow-accent: 0 0 6px var(--c-accent), 0 0 12px var(--glow-accent);
      --font-primary: 'Syne', sans-serif; /* Mantenemos Syne por elegancia */
      --font-secondary: 'Rajdhani', sans-serif;
      --font-display: 'Syne', serif; /* Podría ser serif para un toque celestial clásico */
      /* Fondo etéreo */
      --bg-image-main: linear-gradient(45deg, rgba(175, 238, 238, 0.2) 0%, rgba(255, 182, 193, 0.1) 50%, rgba(255, 215, 0, 0.15) 100%),
                       radial-gradient(circle at top left, rgba(255,255,255,0.5) 0%, transparent 30%),
                       radial-gradient(circle at bottom right, rgba(255,215,0,0.3) 0%, transparent 35%);
      --bg-size-main: 100% 100%, 200% 200%, 150% 150%;
      --bg-animation: aetherShimmer 30s ease-in-out infinite alternate;
    }
    @keyframes aetherShimmer { /* Animación de fondo para Aetherium */
        0% { background-position: 0% 0%, -50% -50%, 150% 150%; opacity: 0.8; }
        100% { background-position: 0% 0%, 150% 150%, -50% -50%; opacity: 1; }
    }


    /* --- 5. Estilos Base Comunes (Usan Variables CSS) --- */
    * { margin: 0; padding: 0; box-sizing: border-box; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease; }
    html { scroll-behavior: smooth; }
    body {
      background-color: var(--c-bg-dark);
      color: var(--c-text-light);
      min-height: 100vh;
      padding-bottom: 100px; /* Espacio para el reproductor */
      font-family: var(--font-secondary);
      font-size: 17px;
      line-height: 1.7;
      background-image: var(--bg-image-main);
      background-size: var(--bg-size-main);
      background-attachment: fixed; /* Para que no scrollee con el contenido */
      overflow-x: hidden;
      animation: var(--bg-animation);
    }

    /* Keyframes genéricos (usados por temas si no definen los suyos) */
    @keyframes pulseBg { 0% { background-color: var(--c-bg-dark); } 100% { background-color: var(--c-bg-medium); } }

    header {
      background-color: rgba(13, 15, 28, 0.6); /* Color base, ajustar si es necesario por tema */
      /* Aplicar variables a backdrop-filter si el navegador soporta variables ahí */
      backdrop-filter: blur(15px) saturate(120%);
      -webkit-backdrop-filter: blur(15px) saturate(120%);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 12px 0;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
      border-bottom: 1px solid rgba(0, 255, 255, 0.2); /* Color base, ajustar */
      animation: slideDown 0.5s ease-out;
      border-bottom-color: color-mix(in srgb, var(--c-primary) 30%, transparent); /* Usar mix para borde */
      background-color: var(--c-surface-transparent-dark); /* Usar variable */
    }
    /* ... (Resto de estilos base como .header-container, .logo, etc., usando variables) ... */
    .header-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
    .logo { display: flex; align-items: center; gap: 15px; }
    .logo img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--c-primary); box-shadow: var(--shadow-primary); animation: spinLogo 20s linear infinite; }
    @keyframes spinLogo { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .logo-text { font-family: var(--font-primary); font-size: 28px; font-weight: 700; color: var(--c-text-light); text-shadow: var(--shadow-secondary); /* Usar sombra secundaria */ letter-spacing: 2px; animation: neonFlicker 5s infinite alternate; margin-right: 15px; }
    /* Ajustar neonFlicker para usar variables */
    @keyframes neonFlicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% { text-shadow: 0 0 4px var(--c-text-light), 0 0 10px var(--c-secondary), 0 0 18px var(--c-secondary), 0 0 38px var(--c-secondary), 0 0 70px var(--glow-secondary); opacity: 1; }
      20%, 24%, 55% { text-shadow: none; opacity: 0.8; }
    }
    .user-aka { font-family: var(--font-secondary); font-size: 18px; font-weight: 500; color: var(--c-primary); text-shadow: var(--shadow-primary); letter-spacing: 1px; opacity: 0.8; cursor: pointer; transition: opacity 0.3s ease; }
    .user-aka:hover { opacity: 1; text-shadow: 0 0 6px var(--c-primary), 0 0 10px var(--glow-primary);}
    nav ul { display: flex; list-style: none; gap: 35px; }
    nav ul li a { color: var(--c-text-medium); text-decoration: none; font-size: 18px; font-weight: 500; padding: 8px 0; position: relative; letter-spacing: 1px; transition: color 0.3s ease, text-shadow 0.3s ease; font-family: var(--font-secondary); }
    nav ul li a::before { content: '['; position: absolute; left: -10px; opacity: 0; color: var(--c-primary); transition: opacity 0.3s ease, left 0.3s ease; }
    nav ul li a::after { content: ']'; position: absolute; right: -10px; opacity: 0; color: var(--c-primary); transition: opacity 0.3s ease, right 0.3s ease; }
    nav ul li a:hover, nav ul li a.active { color: var(--c-primary); text-shadow: 0 0 5px var(--c-primary), 0 0 10px var(--glow-primary); }
    nav ul li a:hover::before, nav ul li a.active::before { opacity: 1; left: -15px; }
    nav ul li a:hover::after, nav ul li a.active::after { opacity: 1; right: -15px; }
    main { padding: 3rem 2rem; max-width: 1400px; margin: 0 auto; }
    .container { max-width: 1400px; margin: 0 auto; padding: 0; width: 100%; }
    .section {
      background-color: var(--c-surface-transparent);
      border-radius: var(--border-radius-large);
      padding: 2.5rem;
      box-shadow: var(--shadow-depth-2), inset 0 0 20px rgba(0,0,0,0.3);
      border: 1px solid color-mix(in srgb, var(--c-tertiary) 20%, transparent); /* Usar color terciario para borde */
      margin-bottom: 2.5rem;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      position: relative; /* Para posibles pseudo-elementos de tema */
    }
    @keyframes fadeInSection { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideDown { from { transform: translateY(-100%); opacity: 0;} to { transform: translateY(0); opacity: 1;} }

    h2 {
      font-family: var(--font-primary);
      color: var(--c-tertiary); /* Usar color terciario */
      margin-bottom: 1.8rem;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 1px;
      border-bottom: 2px solid var(--c-tertiary);
      padding-bottom: 0.8rem;
      text-shadow: var(--shadow-tertiary);
      display: inline-block;
    }
    .modes { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; transition: opacity 0.3s ease; }
    .modes.disabled { opacity: 0.5; pointer-events: none; }
    .mode-card {
      background: linear-gradient(145deg, var(--c-surface-dark), var(--c-surface-medium));
      border-radius: var(--border-radius-medium);
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      text-align: center;
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-depth-1);
    }
    .mode-card::before { /* Efecto scanline/brillo general */
      content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: conic-gradient(transparent, color-mix(in srgb, var(--c-primary) 20%, transparent), transparent 30%);
      animation: rotateGradient 6s linear infinite;
      opacity: 0; transition: opacity 0.4s ease; pointer-events: none;
    }
    @keyframes rotateGradient { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .mode-card:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: var(--shadow-depth-2), 0 0 25px var(--glow-primary);
      border: 1px solid var(--c-primary);
      background: linear-gradient(145deg, var(--c-surface-light), var(--c-surface-medium)); /* Aclarar al hacer hover */
    }
    .mode-card:hover::before { opacity: 1; }
    .mode-card i { font-size: 2.8rem; margin-bottom: 1.5rem; color: var(--c-primary); text-shadow: var(--shadow-primary); transition: transform 0.3s ease; }
    .mode-card:hover i { transform: scale(1.1) rotate(-5deg); }
    .mode-card h3 { font-family: var(--font-primary); font-size: 1.6rem; margin-bottom: 1rem; color: var(--c-text-light); font-weight: 500; transition: color 0.3s ease; }
    .mode-card:hover h3 { color: var(--c-primary); }
    .mode-card p { font-size: 1rem; color: var(--c-text-medium); line-height: 1.6; flex-grow: 1; }
    .mode-card.selected-feedback { animation: pulseBorder 0.5s ease-out; border-color: var(--c-success); box-shadow: var(--shadow-depth-2), 0 0 35px var(--glow-accent); /* Usar accent/success */ }
    @keyframes pulseBorder { /* Ajustar para usar accent/success */
      0% { transform: scale(1.03); border-width: 1px; }
      50% { transform: scale(1.06); border-width: 2px; box-shadow: var(--shadow-depth-2), 0 0 45px var(--glow-accent); border-color: var(--c-success);}
      100% { transform: scale(1.03); border-width: 1px; }
    }

    .session-area {
      flex-direction: column; gap: 2rem;
      background-color: var(--c-surface-transparent); /* Usar variable */
      border-radius: var(--border-radius-medium);
      padding: 2rem;
      box-shadow: var(--shadow-depth-1), inset 0 0 15px rgba(0,0,0,0.2);
      border: 1px solid color-mix(in srgb, var(--c-secondary) 20%, transparent); /* Usar color secundario */
      margin-top: 2rem; display: flex; position: relative;
    }
    .control-panel {
      display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; justify-content: space-between;
      padding: 1.5rem;
      background-color: var(--c-surface-transparent-medium); /* Usar variable */
      border-radius: var(--border-radius-small);
      border: 1px solid color-mix(in srgb, var(--c-secondary) 10%, transparent);
    }
    .timer {
      font-family: var(--font-display); /* Usar fuente display */
      font-size: 2.8rem; font-weight: 700;
      color: var(--c-secondary); /* Usar color secundario */
      background-color: transparent; padding: 0.5rem 1rem; border-radius: var(--border-radius-small);
      min-width: 180px; text-align: center;
      text-shadow: var(--shadow-secondary);
      animation: pulseTimerBase 1.5s infinite alternate;
    }
    @keyframes pulseTimerBase { from { opacity: 0.9; transform: scale(1); } to { opacity: 1; transform: scale(1.01); } }

    .controls { display: flex; gap: 1rem; }

    /* Estilos Botones (usando variables) */
    button, .btn {
      font-family: var(--font-secondary); background: transparent; color: var(--c-text-light);
      border: 2px solid var(--c-tertiary); /* Borde con color terciario */
      padding: 12px 28px; border-radius: var(--border-radius-small); cursor: pointer;
      font-weight: 700; font-size: 1rem; letter-spacing: 1px; display: inline-flex; align-items: center; justify-content: center; text-transform: uppercase;
      box-shadow: inset 0 0 0 0 var(--c-tertiary);
      transition: all 0.3s ease-in-out, color 0.1s linear 0s, opacity 0.3s ease; position: relative; overflow: hidden;
    }
    button i, .btn i { margin-right: 10px; font-size: 1.1em; }
    button:hover:not(:disabled), .btn:hover:not(:disabled) {
      color: var(--c-text-dark); /* Texto oscuro en hover */
      box-shadow: inset 0 0 0 50px var(--c-tertiary);
      border-color: var(--c-tertiary); text-shadow: none;
    }
    /* Efecto glitch/gradient en hover del botón */
    button::before, .btn::before {
      content: ''; position: absolute; top: -2px; left: -2px;
      width: calc(100% + 4px); height: calc(100% + 4px);
      background: linear-gradient(45deg, var(--c-primary), var(--c-secondary)); /* Usar primario y secundario */
      z-index: -1; opacity: 0; transition: opacity 0.3s ease;
    }
    button:hover:not(:disabled)::before, .btn:hover:not(:disabled)::before { opacity: 0.1; animation: glitchBorder 0.5s infinite linear alternate-reverse; }
    @keyframes glitchBorder { /* Sin cambios */ }
    button:active:not(:disabled), .btn:active:not(:disabled) { transform: scale(0.97); box-shadow: inset 0 0 0 60px var(--c-tertiary); }
    button:disabled, .btn:disabled { /* Sin cambios funcionales, solo variables */
      border-color: color-mix(in srgb, var(--c-text-medium) 50%, transparent) !important;
      color: var(--c-text-medium) !important; cursor: not-allowed !important; box-shadow: none !important;
      background: color-mix(in srgb, var(--c-surface-light) 30%, transparent) !important;
      text-shadow: none !important; opacity: 0.6 !important;
    }
    button:disabled:hover, .btn:disabled:hover { color: var(--c-text-medium) !important; box-shadow: none !important; transform: none !important; }
    button:disabled::before, .btn:disabled::before { display: none !important; }

    /* Variantes de Botones */
    .btn-primary { border-color: var(--c-primary); box-shadow: inset 0 0 0 0 var(--c-primary); }
    .btn-primary:hover:not(:disabled) { box-shadow: inset 0 0 0 50px var(--c-primary); border-color: var(--c-primary); color: var(--c-text-dark); }
    .btn-primary:active:not(:disabled) { box-shadow: inset 0 0 0 60px var(--c-primary); }
    .btn-danger { border-color: var(--c-error); box-shadow: inset 0 0 0 0 var(--c-error); }
    .btn-danger:hover:not(:disabled) { box-shadow: inset 0 0 0 50px var(--c-error); border-color: var(--c-error); color: var(--c-text-light); } /* Mantener texto claro en error */
    .btn-danger:active:not(:disabled) { box-shadow: inset 0 0 0 60px var(--c-error); }
    .btn-secondary { border-color: var(--c-secondary); box-shadow: inset 0 0 0 0 var(--c-secondary); }
    .btn-secondary:hover:not(:disabled) { box-shadow: inset 0 0 0 50px var(--c-secondary); border-color: var(--c-secondary); color: var(--c-text-dark); }
    .btn-secondary:active:not(:disabled) { box-shadow: inset 0 0 0 60px var(--c-secondary); }

    .session-content { display: flex; flex-direction: column; align-items: center; gap: 2rem; margin-top: 1rem; }
    .word-display {
      font-family: var(--font-display); font-size: 3.5rem; line-height: 1.4; font-weight: 900;
      min-height: 10rem; display: flex; align-items: center; justify-content: center; text-align: center;
      padding: 2rem 3rem; width: 100%;
      background-color: var(--c-surface-transparent-dark); /* Usar variable */
      border-radius: var(--border-radius-small);
      box-shadow: var(--shadow-depth-1), inset 0 0 10px rgba(0,0,0,0.4);
      color: var(--c-accent); /* Color del texto principal de contenido */
      text-shadow: 0 0 6px var(--glow-accent);
      border: 1px solid color-mix(in srgb, var(--c-accent) 30%, transparent);
      position: relative; overflow: hidden;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out, color 0.3s ease, text-shadow 0.3s ease;
      z-index: 1;
    }
    /* Animaciones y estados del Word Display */
    .word-display.content-changing { opacity: 0; transform: translateY(15px) scale(0.95); }
    .word-display.content-entering { opacity: 1; transform: translateY(0) scale(1); animation: fadeInContent 0.4s ease-out; transition: opacity 0.4s ease-out, transform 0.4s ease-out; }
    @keyframes fadeInContent { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    /* Efecto de rejilla sutil (puede variar por tema) */
    .word-display::before {
      content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-image: linear-gradient(0deg, color-mix(in srgb, var(--c-primary) 3%, transparent) 1px, transparent 1px),
                        linear-gradient(90deg, color-mix(in srgb, var(--c-primary) 3%, transparent) 1px, transparent 1px);
      background-size: 20px 20px; opacity: 0.5;
      animation: subtleGridShift 20s linear infinite; z-index: 0; pointer-events: none;
    }
    @keyframes subtleGridShift { from { background-position: 0 0; } to { background-position: 40px 40px; } }
    /* Efecto scanline activo */
    .session-area.session-active .word-display::after {
      content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(transparent 50%, color-mix(in srgb, var(--c-bg-dark) 20%, transparent) 50%);
      background-size: 100% 4px; opacity: 0.3;
      animation: scanlineMove 8s linear infinite; z-index: 0; pointer-events: none;
    }
    @keyframes scanlineMove { from { background-position: 0 0; } to { background-position: 0 -100px; } }
    .word-display > *, .word-display .mixto-content-wrapper > * { position: relative; z-index: 1; }
    .word-display:not(:has(> *)) { position: relative; z-index: 1; }
    .mixto-content-wrapper { position: relative; z-index: 1; }

    /* Animación Glitch Específica para el tema Glitch */
    .theme-glitch .word-display.glitchy {
        animation: glitchEffect 0.3s cubic-bezier(.25,.46,.45,.94) both infinite;
    }
    @keyframes glitchEffect{
      0%{ transform: translate(0); text-shadow: var(--shadow-accent); color: var(--c-accent);}
      20%{ transform: translate(-4px, 4px); text-shadow: var(--shadow-primary); color: var(--c-primary); }
      40%{ transform: translate(-4px, -4px); text-shadow: var(--shadow-secondary); color: var(--c-secondary); }
      60%{ transform: translate(4px, 4px); text-shadow: var(--shadow-tertiary); color: var(--c-tertiary); }
      80%{ transform: translate(4px, -4px); text-shadow: var(--shadow-accent); color: var(--c-accent); }
      100%{ transform: translate(0); text-shadow: var(--shadow-accent); color: var(--c-accent);}
    }
    /* Placeholder para otras animaciones de tema en word-display */
    .theme-cosmic .word-display { animation: pulseGlowCosmic 5s infinite alternate; }
    @keyframes pulseGlowCosmic {
      from { box-shadow: var(--shadow-depth-1), inset 0 0 10px rgba(0,0,0,0.4), 0 0 15px var(--glow-tertiary); border-color: color-mix(in srgb, var(--c-tertiary) 30%, transparent); }
      to   { box-shadow: var(--shadow-depth-1), inset 0 0 15px rgba(0,0,0,0.5), 0 0 30px var(--glow-primary); border-color: color-mix(in srgb, var(--c-primary) 40%, transparent); }
    }
     .theme-aetherium .word-display { border-style: solid; border-image: linear-gradient(45deg, var(--c-secondary), var(--c-tertiary)) 1; animation: subtleShineAetherium 8s infinite alternate; }
    @keyframes subtleShineAetherium {
       from { text-shadow: 0 0 8px var(--glow-secondary); color: color-mix(in srgb, var(--c-text-light) 80%, var(--c-secondary)); }
       to   { text-shadow: 0 0 12px var(--glow-tertiary); color: color-mix(in srgb, var(--c-text-light) 80%, var(--c-tertiary)); }
    }


    /* Settings y Controles (Inputs, Selects) */
    .mode-settings, .dict-lang-panel {
      display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; justify-content: center;
      background-color: color-mix(in srgb, var(--c-surface-light) 30%, transparent);
      padding: 1.2rem; border-radius: var(--border-radius-small);
      border: 1px solid color-mix(in srgb, var(--c-primary) 10%, transparent);
      margin-top: 2rem;
    }
    .control-panel .mode-settings { margin-top: 0; padding: 0; background: none; border: none; justify-content: flex-start; }
    .mode-settings label, .dict-lang-panel label, .setting-group label { /* Combinado con Settings */
      margin-right: 0.5rem; font-weight: 500; color: var(--c-text-medium);
    }
    .mode-settings span, .dict-lang-panel span, .setting-group span { /* Combinado con Settings */
      color: var(--c-primary); font-weight: 700; margin-left: 5px;
    }
    input[type="number"], select {
      background-color: var(--c-surface-dark); color: var(--c-text-light);
      border: 1px solid var(--c-tertiary); border-radius: var(--border-radius-small);
      padding: 8px 12px; font-family: var(--font-secondary); font-size: 1rem;
      width: 80px; text-align: center;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input[type="number"]:focus, select:focus {
      outline: none; border-color: var(--c-primary);
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.3), var(--shadow-primary);
    }
    select {
        width: auto; min-width: 150px; cursor: pointer; appearance: none; -webkit-appearance: none; padding-right: 30px;
        /* Flecha SVG usando currentColor para que herede el color del borde */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.03a.75.75 0 0 1 1.06 0L8 8.74l2.72-2.71a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.09a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E%0A");
        background-repeat: no-repeat; background-position: right 10px center; background-size: 16px;
        color: var(--c-primary); /* Color del texto del select */
    }
    select:disabled {
      opacity: 0.5; cursor: not-allowed; border-color: var(--c-text-medium);
      color: var(--c-text-medium); /* Color del texto deshabilitado */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='grey'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.03a.75.75 0 0 1 1.06 0L8 8.74l2.72-2.71a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.09a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E%0A");
    }

     #loading-indicator {
       display: flex; align-items: center; justify-content: center; gap: 10px;
       font-weight: 700; color: var(--c-secondary); text-shadow: var(--shadow-secondary);
       font-family: var(--font-primary); letter-spacing: 1px; margin-left: 15px;
     }
     #loading-indicator::before {
       content: ''; width: 16px; height: 16px;
       border: 2px solid color-mix(in srgb, var(--c-secondary) 30%, transparent);
       border-top-color: var(--c-secondary); border-radius: 50%;
       animation: spinLoader 0.8s linear infinite;
     }
    @keyframes spinLoader { to { transform: rotate(360deg); } }

    /* Sección Ajustes */
    .settings-panel { display: flex; flex-direction: column; gap: 1.8rem; }
    .setting-group {
      display: flex; flex-wrap: wrap; align-items: center; gap: 1rem;
      padding: 1rem 0; border-bottom: 1px dashed color-mix(in srgb, var(--c-tertiary) 20%, transparent);
    }
    .setting-group:last-child { border-bottom: none; }
    /* label y span ya estilados arriba */
    .setting-group label { flex-basis: 250px; /* Para alinear mejor */ }

    /* Panel Info */
    #info-content {
      margin-top: 1.5rem; padding: 1.5rem;
      background-color: var(--c-surface-light); border-radius: var(--border-radius-small);
      border-left: 4px solid var(--c-secondary);
      color: var(--c-text-medium); font-size: 0.95rem; line-height: 1.8;
    }
    #info-content p { margin-bottom: 1rem; }
    #info-content strong { color: var(--c-primary); }

    /* Reproductor Audio */
    #audio-player {
      position: fixed; bottom: 0; left: 0; width: 100%; display: flex; flex-direction: column;
      background: linear-gradient(to top, color-mix(in srgb, var(--c-bg-dark) 95%, black), color-mix(in srgb, var(--c-surface-dark) 85%, black));
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.5); z-index: 1100;
      border-top: 2px solid var(--c-secondary); /* Usar secundario */
      padding: 5px 0 0 0; transition: transform 0.4s ease-in-out;
    }
    .player-core { display: flex; align-items: center; justify-content: space-between; padding: 8px 25px; width: 100%; }
    .player-info { display: flex; align-items: center; gap: 15px; }
    #time-indicator { font-size: 0.85rem; color: var(--c-text-medium); font-weight: 400; letter-spacing: 0.5px; min-width: 100px; text-align: right; }
    #audio-controls { display: flex; justify-content: center; align-items: center; gap: 12px; }
    #audio-controls button { /* Botones pequeños */
      background: transparent; border: 1px solid var(--c-tertiary); color: var(--c-tertiary);
      width: 40px; height: 40px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; box-shadow: none;
    }
    #audio-controls button:hover {
      background-color: color-mix(in srgb, var(--c-tertiary) 10%, transparent);
      color: var(--c-primary); border-color: var(--c-primary);
      transform: scale(1.08); box-shadow: var(--shadow-primary);
    }
    #audio-controls button:active { transform: scale(0.95); }
    #play-pause-btn { /* Botón grande Play/Pause */
      width: 55px; height: 55px; border-width: 2px; font-size: 1.3rem;
      border-color: var(--c-secondary); color: var(--c-secondary);
    }
    #play-pause-btn:hover {
      background-color: color-mix(in srgb, var(--c-secondary) 10%, transparent);
      color: var(--c-text-light); border-color: var(--c-secondary);
      box-shadow: var(--shadow-secondary);
    }
    /* Loading spinner en Play/Pause */
    #play-pause-btn #loading-indicator { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: color-mix(in srgb, var(--c-bg-dark) 80%, transparent); border-radius: 50%; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0.2s ease; pointer-events: none; }
    #play-pause-btn.loading #loading-indicator { opacity: 1; visibility: visible; }
    #play-pause-btn.loading i { opacity: 0.2; }
    #play-pause-btn #loading-indicator .spinner { width: 22px; height: 22px; border: 3px solid color-mix(in srgb, var(--c-secondary) 30%, transparent); border-top-color: var(--c-secondary); border-radius: 50%; animation: spinLoader 0.8s linear infinite; }
    #play-pause-btn #loading-indicator::before { content: none; } /* Ocultar pseudo-elemento del spinner general */
    .player-side-controls { }
    #repeat-toggle {
      font-size: 0.8rem; padding: 5px 10px; border-radius: var(--border-radius-small); width: auto; height: auto;
      border: 1px solid var(--c-text-medium); color: var(--c-text-medium); opacity: 0.7;
    }
    #repeat-toggle.active, #repeat-toggle:hover {
      opacity: 1; border-color: var(--c-success); color: var(--c-success);
      background-color: color-mix(in srgb, var(--c-success) 10%, transparent);
      box-shadow: 0 0 8px var(--glow-accent);
    }
    #progress-container {
      width: 100%; height: 5px; background-color: color-mix(in srgb, var(--c-surface-light) 50%, transparent);
      cursor: pointer; position: relative; overflow: hidden;
    }
    #progress-bar {
      height: 100%; background: linear-gradient(90deg, var(--c-secondary), var(--c-primary)); /* Gradiente Secundario a Primario */
      width: 0; border-radius: 0; position: relative;
      box-shadow: var(--shadow-secondary); transition: width 0.1s linear;
    }
    #progress-bar::after { /* Efecto brillo */
      content: ''; position: absolute; top: 0; right: -50px; width: 50px; height: 100%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: skewX(-30deg); animation: progressBarShine 2.5s linear infinite; opacity: 0.8;
    }
    @keyframes progressBarShine { from { right: -50px; } to { right: 120%; } }

    /* --- 6. Media Queries (Ajustes menores para variables si es necesario) --- */
    @media (max-width: 768px) { body { font-size: 16px; padding-bottom: 120px; } .header-container { padding: 0 15px; } .logo-text { font-size: 22px; margin-right: 10px; } .user-aka { font-size: 16px; } nav ul { gap: 25px; } nav ul li a { font-size: 16px; } main { padding: 2rem 1rem; } .section { padding: 1.5rem; } h2 { font-size: 1.8rem; } .modes { grid-template-columns: 1fr; gap: 1rem; } .mode-card { padding: 1.5rem; } .timer { font-size: 2.2rem; min-width: 130px;} .word-display { font-size: 2.5rem; min-height: 8rem; padding: 1.5rem;} #audio-player { padding: 5px 0 0 0; } .player-core { padding: 5px 15px 8px 15px; flex-wrap: wrap; justify-content: center; gap: 8px;} .player-info { order: 1; width: 100%; justify-content: space-between;} #audio-controls { order: 2; width: 100%; justify-content: center; gap: 10px;} #time-indicator { text-align: left; } .player-side-controls { order: 3; } .control-panel { flex-direction: column; align-items: stretch; gap: 1rem; } .control-panel .mode-settings { justify-content: center; } .control-panel .controls { justify-content: center; } }
    @media (max-width: 480px) { .logo img { width: 35px; height: 35px; } .logo-text { font-size: 18px; margin-right: 5px; } .user-aka { font-size: 14px; } nav ul { gap: 15px; } nav ul li a { font-size: 14px; } nav ul li a::before { left: -5px; } nav ul li a::after { right: -5px; } nav ul li a:hover::before { left: -10px; } nav ul li a:hover::after { right: -10px; } .timer { font-size: 1.8rem; } .word-display { font-size: 2rem; } #audio-controls button { width: 35px; height: 35px; font-size: 0.9rem; } #play-pause-btn { width: 50px; height: 50px; font-size: 1.1rem; } button, .btn { padding: 10px 20px; font-size: 0.9rem;} h2 { font-size: 1.6rem;} }

    /* --- 7. Utilidades y Estados --- */
    .hidden { display: none !important; }
    .word-display .spinner { /* Spinner dentro del word display */
      border: 4px solid color-mix(in srgb, var(--c-primary) 20%, transparent);
      border-left-color: var(--c-primary); border-radius: 50%;
      width: 40px; height: 40px; animation: spinLoader 1s linear infinite;
      z-index: 1; position: relative;
    }
    /* Modal AKA (Usando Variables) */
    #aka-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: color-mix(in srgb, var(--c-bg-dark) 80%, transparent); /* Fondo oscuro semitransparente */
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center; z-index: 2000;
      opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0s linear 0.4s;
    }
    #aka-modal-overlay.visible { opacity: 1; visibility: visible; transition: opacity 0.4s ease; }
    .aka-modal-content {
      background: linear-gradient(145deg, var(--c-surface-dark), var(--c-surface-medium));
      padding: 2.5rem 3rem; border-radius: var(--border-radius-medium);
      border: 1px solid var(--c-secondary); /* Borde secundario */
      box-shadow: var(--shadow-depth-2), 0 0 30px var(--glow-secondary); /* Sombra secundaria */
      text-align: center; max-width: 450px; width: 90%;
      transform: scale(0.9); opacity: 0; transition: transform 0.3s ease-out 0.1s, opacity 0.3s ease-out 0.1s;
    }
     #aka-modal-overlay.visible .aka-modal-content { transform: scale(1); opacity: 1; }
    .aka-modal-content h3 {
      font-family: var(--font-primary); color: var(--c-secondary); font-size: 1.8rem;
      margin-bottom: 1rem; text-shadow: var(--shadow-secondary);
    }
    .aka-modal-content p { color: var(--c-text-medium); margin-bottom: 1.8rem; font-size: 1rem; line-height: 1.6; }
    #aka-input {
      display: block; width: 100%; padding: 12px 15px; margin-bottom: 1.5rem;
      background-color: var(--c-surface-dark); color: var(--c-text-light);
      border: 1px solid var(--c-tertiary); border-radius: var(--border-radius-small);
      font-family: var(--font-secondary); font-size: 1.1rem; text-align: center;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    #aka-input:focus { outline: none; border-color: var(--c-primary); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3), var(--shadow-primary); }
    #aka-error-message { color: var(--c-error); font-size: 0.9rem; min-height: 1.2em; margin-bottom: 1rem; display: block; }
    #submit-aka-btn { border-color: var(--c-primary); color: var(--c-text-light); box-shadow: inset 0 0 0 0 var(--c-primary); }
    #submit-aka-btn:hover { color: var(--c-text-dark); box-shadow: inset 0 0 0 50px var(--c-primary); border-color: var(--c-primary); text-shadow: none; }

  </style>
</head>
<body>

  <!-- Modal AKA -->
  <div id="aka-modal-overlay"> <div class="aka-modal-content"> <h3><i class="fas fa-terminal" style="margin-right: 10px;"></i> Identidad Requerida</h3> <p>Conectando a la red... Se requiere un alias (AKA) para proceder.</p> <input type="text" id="aka-input" placeholder="Ingresa tu AKA" maxlength="20"> <span id="aka-error-message"></span> <button id="submit-aka-btn" class="btn"><i class="fas fa-check-double"></i> Confirmar Identidad</button> </div> </div>

  <header> <div class="header-container"> <div class="logo"> <img src="https://blogger.googleusercontent.com/img/a/AVvXsEiLlZXJKRUaKqGfbAM5AwvWb3BeTOA0Gxwpmy0L1AYDcB00-vzRLMA9GK9z0XY37_BOEUdE1H00aVQQhYnXnCgWWsC5FzLW0mfXpJ1qgwdWqRNcxxnwNWn8xL0bRKIML2v9gn9YgLYFDZbtb30SHV7FyNvjC_1HzPJbs2ThM5vEGS6g-oP3jZ2mi3wmaPc" alt="FlowTrainer Logo"> <span class="logo-text">FlowTrainer</span> <span id="user-aka" class="user-aka" title="Click para cambiar tu AKA"></span> </div> <nav> <ul> <li><a href="#" class="nav-item active" data-section="home">Inicio</a></li> <li><a href="#" class="nav-item" data-section="settings">Ajustes</a></li> </ul> </nav> </div> </header>

  <main>
    <div class="container">
      <!-- Sección de Inicio -->
      <section id="home" class="section">
        <h2 id="home-title"><i class="fas fa-atom fa-spin" style="--fa-animation-duration: 5s; margin-right: 10px;"></i> Modos de Entrenamiento</h2>
        <div id="initial-load-error" class="hidden" style="color: var(--c-error); text-align: center; margin-bottom: 1rem; font-size: 1.1rem; border: 1px dashed var(--c-error); padding: 1rem; border-radius: 5px;">
          <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>Error al cargar recursos iniciales. Funcionalidad limitada.
        </div>
        <div class="modes">
          <!-- Modos existentes -->
          <div class="mode-card" data-mode="palabras-aleatorias"> <i class="fas fa-dice-d20"></i> <h3>Palabras Aleatorias</h3> <p>Muestra una palabra aleatoria a intervalos ajustables.</p> </div>
          <div class="mode-card" data-mode="multi-palabras"> <i class="fas fa-cubes"></i> <h3>Multi Palabras</h3> <p>Muestra varias palabras simultáneamente.</p> </div>
          <div class="mode-card" data-mode="palabras-largas"> <i class="fas fa-ruler-combined"></i> <h3>Palabras Largas</h3> <p>Muestra solo palabras de 9 o más letras.</p> </div>
          <div class="mode-card" data-mode="libre"> <i class="fas fa-infinity"></i> <h3>Modo Libre</h3> <p>Avanza el cronómetro sin mostrar palabras.</p> </div>
          <div class="mode-card" data-mode="imagenes-aleatorias"> <i class="fas fa-camera-retro"></i> <h3>Imágenes Aleatorias</h3> <p>Elige la frecuencia, miles de imagenes a tu disposicion.</p> </div>
          <div class="mode-card" data-mode="kickback"> <i class="fas fa-question"></i> <h3>Kick Back</h3> <p>Muestra preguntas aleatorias (ES/EN).</p> </div>
          <div class="mode-card" data-mode="mixto"> <i class="fas fa-brain"></i> <h3>Mixto</h3> <p>Combina 1 imagen aleatoria y 3 palabras.</p> </div>
        </div>
        <div id="training-content" class="hidden">
          <div class="dict-lang-panel hidden" id="dict-lang-panel">
            <label for="language-select"><i class="fas fa-language" style="margin-right: 5px;"></i>Idioma:</label>
            <select id="language-select"> <option value="es" selected>Español</option> <option value="en">Inglés</option> </select>
            <div id="dictionary-group" style="display: inline-flex; align-items: center; gap: 1rem;">
              <label for="dictionary-select"><i class="fas fa-book" style="margin-right: 5px;"></i>Diccionario:</label>
              <select id="dictionary-select"> <option value="essential" selected>Básico</option> <option value="complete">Completo</option> </select>
            </div>
            <div id="loading-indicator" class="hidden">...</div>
          </div>
          <div class="session-area">
            <div class="control-panel">
              <div class="timer">00:00</div>
              <div class="mode-settings">
                <label for="mode-interval"><i class="fas fa-hourglass-half" style="margin-right: 5px;"></i>Intervalo:</label>
                <input type="number" id="mode-interval" value="3" min="0.5" step="0.1"> <span id="mode-interval-value">3s</span>
              </div>
              <div class="controls">
                <button class="btn btn-primary" id="start-btn" onclick="startSession()" disabled> <i class="fas fa-play"></i> Iniciar </button>
                <button class="btn btn-danger" id="stop-btn" disabled onclick="stopSession()"> <i class="fas fa-stop"></i> Detener </button>
              </div>
            </div>
            <div class="session-content"> <div class="word-display"> [ Selecciona Modo ] </div> </div>
          </div>
        </div>
      </section>

      <!-- Sección de Ajustes -->
      <section id="settings" class="section" style="display: none;">
        <h2><i class="fas fa-cogs" style="margin-right: 10px;"></i> Ajustes Generales</h2>
        <div class="settings-panel">
          <!-- Ajustes existentes -->
          <div class="setting-group">
            <label for="session-duration"><i class="fas fa-clock" style="margin-right: 5px;"></i>Duración Sesión (min):</label>
            <input type="number" id="session-duration" min="1" max="60" value="3" step="1"> <span id="duration-value">3m</span>
          </div>
          <div class="setting-group hidden" id="multi-word-group">
            <label for="multi-word-count"><i class="fas fa-cubes" style="margin-right: 5px;"></i>Nº Palabras (Multi):</label>
            <input type="number" id="multi-word-count" min="2" max="15" value="3" step="1"> <span id="multi-word-count-value">3</span>
          </div>
          <div class="setting-group hidden" id="mixto-word-group">
            <label for="mixto-word-count"><i class="fas fa-brain" style="margin-right: 5px;"></i>Nº Palabras (Mixto):</label>
            <input type="number" id="mixto-word-count" min="1" max="10" value="3" step="1"> <span id="mixto-word-count-value">3</span>
          </div>

          <!-- NUEVO: Selector de Tema -->
          <div class="setting-group">
              <label for="theme-select"><i class="fas fa-palette" style="margin-right: 5px;"></i>Tema Visual:</label>
              <select id="theme-select">
                  <option value="theme-cyberpunk">Cyberpunk (Default)</option>
                  <option value="theme-glitch">Glitch Art Harmonic</option>
                  <option value="theme-cosmic">Cosmic Serenity</option>
                  <option value="theme-aetherium">Aetherium</option>
              </select>
          </div>

          <!-- Ajustes existentes -->
          <div class="setting-group">
            <label for="change-aka-btn"><i class="fas fa-user-secret" style="margin-right: 5px;"></i> Cambiar AKA:</label>
            <button id="change-aka-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> Cambiar</button>
            <span id="current-aka-display" style="color: var(--c-text-medium); font-style: italic;"></span>
          </div>
          <div class="setting-group">
            <label><i class="fas fa-info-circle" style="margin-right: 5px;"></i> Información</label>
            <button id="info-btn" class="btn btn-secondary"><i class="fas fa-eye"></i> Mostrar/Ocultar Info</button>
          </div>
          <div id="info-content" style="display:none;">
            <p><strong>FlowTrainer [Multi-Theme] // v2.6</strong></p>
            <p>Entrena tu fluidez mental y verbal en entornos visuales inmersivos. Selecciona un modo, ajusta los parámetros, elige tu tema visual y deja que la música te guíe.</p>
            <p>Tu AKA actual es: <strong class="user-aka-placeholder">Ghost</strong>. Puedes cambiarlo aquí o clickando en él en la cabecera.</p>
            <p><strong>Modos:</strong> Palabras Aleatorias, Multi Palabras, Palabras Largas, Modo Libre, Imágenes Aleatorias, Kick Back (preguntas), Mixto (imagen + palabras).</p>
            <p><strong>Idiomas/Diccionarios:</strong> Español (Básico/Completo) e Inglés disponibles para palabras y Kick Back.</p>
             <p><strong>Temas Visuales:</strong> Cyberpunk, Glitch Art, Cosmic Serenity, Aetherium.</p>
            <p>¡Conéctate y fluye!</p>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Reproductor de audio Fijo -->
  <div id="audio-player">
    <div id="progress-container"> <div id="progress-bar"></div> </div>
    <div class="player-core">
      <div class="player-info"> <div id="time-indicator">00:00 / 00:00</div> </div>
      <div id="audio-controls">
        <button id="prev-track" title="Pista Anterior"> <i class="fas fa-step-backward"></i> </button>
        <button id="play-pause-btn" title="Reproducir/Pausa"> <i class="fas fa-play"></i> <div id="loading-indicator"> <div class="spinner"></div> </div> </button>
        <button id="next-track" title="Siguiente Pista"> <i class="fas fa-step-forward"></i> </button>
      </div>
      <div class="player-side-controls"> <button id="repeat-toggle" title="Repetir">Repeat Off</button> </div>
    </div>
    <audio id="player" preload="metadata"></audio>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // --- VARIABLES GLOBALES ---
    let wordList = []; let kickbackQuestions = [];
    let currentMode = null; let sessionActive = false;
    let wordInterval = 3000; let sessionDuration = 3 * 60 * 1000;
    let wordTimer = null; let sessionTimer = null; let sessionStartTime; let elapsedTime = 0;
    let firstImage = true; let userAKA = "Ghost";
    let isInitialLoadComplete = false; let dataLoadError = false;
    let currentTheme = 'theme-cyberpunk'; // Tema por defecto

    // --- Almacenamiento de Datos ---
    let wordListEsEssential = null; let wordListEsComplete = null;
    let wordListEn = null; let kickbackQuestionsEs = null; let kickbackQuestionsEn = null;
    const demoWords = ['NEON', 'CYBER', 'FLOW', 'FUTURO', 'CODIGO', 'MATRIX', 'CIRCUITO', 'GLITCH', 'DATA', 'RED', 'IMPLANTE', 'HACK', 'PULSO', 'LASER', 'VR', 'IA', 'DROIDE', 'NAVE', 'CIUDAD', 'NOCHE', 'LLUVIA', 'SOMBRA', 'ESCAPE', 'CONTROL', 'SISTEMA'];

    // --- URLs (Rutas Relativas) ---
    const essentialDictionaryUrl = './5milcastellano.xlsx';
    const completeDictionaryUrl = './palabrascastellano.xlsx';
    const englishDictionaryUrl = './60milingles.xlsx';
    const kickbackUrl = './kickback.xlsx';

    // --- DOM Element Caching ---
    let startBtn, stopBtn, wordDisplay, timerDisplay, sessionArea, multiWordGroup, multiWordCountInput,
        multiWordCountValue, mixtoWordGroup, mixtoWordCountInput, mixtoWordCountValue, modeIntervalInput,
        modeIntervalValue, sessionDurationInput, durationValue, infoBtn, infoContent, dictLangPanel,
        languageSelect, dictionarySelect, dictionaryGroup, loadingIndicatorEl, homeSection, settingsSection,
        modesGrid, homeTitle, trainingContent, userAkaElement, akaModalOverlay, akaInputElement,
        submitAkaBtn, akaErrorMessage, changeAkaBtn, currentAkaDisplay, initialLoadErrorElement,
        themeSelect; // Nuevo: Selector de tema

    // --- Funciones Carga Diccionarios (Sin cambios) ---
    async function loadData(url) { try { const response = await fetch(url, { cache: "no-cache" }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status} for ${url}`); return await response.arrayBuffer(); } catch (err) { console.error(`Failed to fetch data from ${url}:`, err); throw err; } }
    async function loadSpanishDictionary(fileUrl, colIndex = 0) { try { const data = await loadData(fileUrl); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 }); const extracted = rows.map(row => row[colIndex]).filter(w => typeof w === 'string' && w.trim() !== '').map(w => w.toUpperCase()); console.log(`Loaded ${extracted.length} words from ${fileUrl} (col ${colIndex})`); return (extracted.length > 0) ? extracted : null; } catch (err) { console.error(`Error processing Spanish dictionary: ${fileUrl}`, err); return null; } }
    async function loadEnglishDictionary() { try { const data = await loadData(englishDictionaryUrl); const workbook = XLSX.read(data, { type: 'array' }); let allWords = []; workbook.SheetNames.forEach(sheetName => { const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 }); const extracted = rows.map(row => row[2]).filter(w => typeof w === 'string' && w.trim() !== '').map(w => w.toUpperCase()); allWords.push(...extracted); }); console.log(`Loaded ${allWords.length} English words`); return (allWords.length > 0) ? allWords : null; } catch (err) { console.error("Error processing English dictionary:", err); return null; } }
    async function loadKickbackQuestions(lang) { try { const data = await loadData(kickbackUrl); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false }); let colIndex = (lang === 'es') ? 0 : 1; const extracted = rows.map(row => row[colIndex]).filter(q => typeof q === 'string' && q.trim() !== ''); console.log(`Loaded ${extracted.length} Kickback questions for ${lang}`); return extracted.length > 0 ? extracted : null; } catch (err) { console.error(`Error processing Kickback questions for ${lang}:`, err); return null; } }

    // --- Funciones AKA y Modal (Sin cambios) ---
    function showAkaModal(isChange = false) { akaErrorMessage.textContent = ''; akaInputElement.value = isChange ? userAKA : ''; akaInputElement.placeholder = isChange ? userAKA : 'Ingresa tu AKA'; akaModalOverlay.classList.add('visible'); akaInputElement.focus(); }
    function hideAkaModal() { akaModalOverlay.classList.remove('visible'); }
    function handleAKASubmit() { const newAka = akaInputElement.value.trim(); if (newAka && newAka.length > 0 && newAka.length <= 20) { const isFirstTime = !localStorage.getItem('flowTrainerUserAKA'); userAKA = newAka; localStorage.setItem('flowTrainerUserAKA', userAKA); updateAKADisplays(); hideAkaModal(); if (isFirstTime) { initializeEssentialData(); } } else if (newAka.length > 20) { akaErrorMessage.textContent = 'Error: AKA demasiado largo (máx 20).'; } else { akaErrorMessage.textContent = 'Error: Ingresa un AKA válido.'; } }
    function updateAKADisplays() { if (userAkaElement) { userAkaElement.textContent = `// ${userAKA}`; } document.querySelectorAll('.user-aka-placeholder').forEach(el => el.textContent = userAKA); if(currentAkaDisplay) { currentAkaDisplay.textContent = `(Actual: ${userAKA})`; } if (!sessionActive && wordDisplay && isInitialLoadComplete) { resetSessionVisuals(); } }

    // --- Carga Inicial Esencial (Sin cambios) ---
    async function initializeEssentialData() { /* ... (sin cambios) ... */ console.log("Initializing essential app data silently..."); isInitialLoadComplete = false; dataLoadError = false; modesGrid.classList.add('disabled'); try { wordListEsEssential = await loadSpanishDictionary(essentialDictionaryUrl, 0); if (!wordListEsEssential) { dataLoadError = true; console.error("Essential Spanish dictionary failed to load!"); initialLoadErrorElement.classList.remove('hidden'); wordListEsEssential = [...demoWords]; } else { initialLoadErrorElement.classList.add('hidden'); console.log("Essential Spanish dictionary loaded successfully."); } } catch (error) { console.error("FATAL: Unexpected error during essential data load:", error); dataLoadError = true; initialLoadErrorElement.classList.remove('hidden'); wordListEsEssential = [...demoWords]; } finally { isInitialLoadComplete = true; modesGrid.classList.remove('disabled'); resetSessionVisuals(); console.log("Essential data initialization attempt complete."); } }

    // --- Indicador de Panel Pequeño (Sin cambios) ---
    function showPanelLoadingIndicator(show, text = "Cargando...") { /* ... (sin cambios) ... */ if (!loadingIndicatorEl) return; const needsDictLangPanel = currentMode && ['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'kickback', 'mixto'].includes(currentMode); if (show && needsDictLangPanel && dictLangPanel.classList.contains('hidden')) { dictLangPanel.classList.remove('hidden'); } loadingIndicatorEl.textContent = text; loadingIndicatorEl.classList.toggle('hidden', !show); }

    // --- Gestión de Temas ---
    function applyTheme(themeName) {
      console.log("Applying theme:", themeName);
      const body = document.body;
      // Limpiar clases de tema anteriores
      body.classList.remove('theme-cyberpunk', 'theme-glitch', 'theme-cosmic', 'theme-aetherium');
      // Añadir la nueva clase de tema
      if (themeName) {
        body.classList.add(themeName);
        currentTheme = themeName;
        localStorage.setItem('flowTrainerTheme', themeName);
         // Actualizar el selector si existe
        if(themeSelect) {
            themeSelect.value = themeName;
        }
        // Forzar re-renderizado si hay problemas con transiciones/animaciones (opcional)
        // void body.offsetWidth;
      }
    }

    // --- Inicialización y DOMContentLoaded (MODIFICADO) ---
    document.addEventListener('DOMContentLoaded', function() {
        console.log("FlowTrainer Multi-Theme // DOM Ready - v2.6");

        // Cacheo DOM (Añadir themeSelect)
        homeSection = document.getElementById('home'); settingsSection = document.getElementById('settings'); modesGrid = homeSection.querySelector('.modes'); homeTitle = document.getElementById('home-title'); trainingContent = document.getElementById('training-content'); dictLangPanel = document.getElementById('dict-lang-panel'); sessionArea = trainingContent.querySelector('.session-area'); startBtn = document.getElementById('start-btn'); stopBtn = document.getElementById('stop-btn'); wordDisplay = sessionArea.querySelector('.word-display'); timerDisplay = sessionArea.querySelector('.timer'); multiWordGroup = document.getElementById('multi-word-group'); multiWordCountInput = document.getElementById('multi-word-count'); multiWordCountValue = document.getElementById('multi-word-count-value'); mixtoWordGroup = document.getElementById('mixto-word-group'); mixtoWordCountInput = document.getElementById('mixto-word-count'); mixtoWordCountValue = document.getElementById('mixto-word-count-value'); modeIntervalInput = sessionArea.querySelector('#mode-interval'); modeIntervalValue = sessionArea.querySelector('#mode-interval-value'); sessionDurationInput = document.getElementById('session-duration'); durationValue = document.getElementById('duration-value'); infoBtn = document.getElementById('info-btn'); infoContent = document.getElementById('info-content'); languageSelect = document.getElementById('language-select'); dictionarySelect = document.getElementById('dictionary-select'); dictionaryGroup = document.getElementById('dictionary-group'); loadingIndicatorEl = document.getElementById('loading-indicator'); userAkaElement = document.getElementById('user-aka'); akaModalOverlay = document.getElementById('aka-modal-overlay'); akaInputElement = document.getElementById('aka-input'); submitAkaBtn = document.getElementById('submit-aka-btn'); akaErrorMessage = document.getElementById('aka-error-message'); changeAkaBtn = document.getElementById('change-aka-btn'); currentAkaDisplay = document.getElementById('current-aka-display'); initialLoadErrorElement = document.getElementById('initial-load-error');
        themeSelect = document.getElementById('theme-select'); // Cachear selector de tema
        const navItems = document.querySelectorAll('.nav-item');
        const modeCards = document.querySelectorAll('.mode-card');
        const sections = document.querySelectorAll('main .section');

        // Cargar y Aplicar Tema Guardado
        const savedTheme = localStorage.getItem('flowTrainerTheme') || 'theme-cyberpunk';
        applyTheme(savedTheme);
        if (themeSelect) { themeSelect.value = savedTheme; } // Sincronizar dropdown


        // Lógica del AKA y Carga Inicial Esencial
        let storedAKA = localStorage.getItem('flowTrainerUserAKA');
        if (!storedAKA) { showAkaModal(); }
        else { userAKA = storedAKA; updateAKADisplays(); initializeEssentialData(); }

        // Listeners (Modal, Info, Ajustes, Tema, etc.)
        userAkaElement.addEventListener('click', () => showAkaModal(true));
        if(changeAkaBtn) { changeAkaBtn.addEventListener('click', () => showAkaModal(true)); }
        submitAkaBtn.addEventListener('click', handleAKASubmit);
        akaInputElement.addEventListener('keypress', function(event) { if (event.key === "Enter") { event.preventDefault(); handleAKASubmit(); } });
        akaModalOverlay.addEventListener('click', function(event) { if (event.target === akaModalOverlay && localStorage.getItem('flowTrainerUserAKA')) { hideAkaModal(); } });
        infoBtn.addEventListener('click', function() { const iH = infoContent.style.display === 'none' || infoContent.style.display === ''; infoContent.style.display = iH ? 'block' : 'none'; if (iH) { infoContent.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } });
        multiWordCountInput.addEventListener('input', () => { multiWordCountValue.textContent = multiWordCountInput.value; });
        mixtoWordCountInput.addEventListener('input', () => { mixtoWordCountValue.textContent = mixtoWordCountInput.value; });

        // Listener para cambio de Tema
        if (themeSelect) {
            themeSelect.addEventListener('change', function() {
                applyTheme(this.value);
            });
        }

        // Listener Navegación (Sin cambios funcionales)
        navItems.forEach(item => { item.addEventListener('click', function(e) { e.preventDefault(); const sectionId = this.getAttribute('data-section'); const isActive = this.classList.contains('active'); if (isActive && sectionId !== 'home') return; if (sessionActive) { stopSession(); } if (sectionId === 'home') { resetSessionVisuals(); modesGrid.classList.remove('hidden'); trainingContent.classList.add('hidden'); homeTitle.innerHTML = '<i class="fas fa-atom fa-spin" style="--fa-animation-duration: 5s; margin-right: 10px;"></i> Modos de Entrenamiento'; navItems.forEach(link => link.classList.remove('active')); document.querySelector('.nav-item[data-section="home"]').classList.add('active'); sections.forEach(s => { s.style.display = (s.id === 'home') ? 'block' : 'none'; }); return; } navItems.forEach(link => link.classList.remove('active')); this.classList.add('active'); sections.forEach(s => { const iT = s.id === sectionId; s.style.display = iT ? 'block' : 'none'; if (iT) { s.style.animation = 'none'; void s.offsetWidth; s.style.animation = 'fadeInSection 0.6s ease-out forwards'; } }); if (sectionId === 'settings') { if(currentAkaDisplay) currentAkaDisplay.textContent = `(Actual: ${userAKA})`; } }); });

        // Listener modeCards (Carga Bajo Demanda - Sin cambios funcionales)
        modeCards.forEach(card => {
            card.addEventListener('click', async function() {
                if (!isInitialLoadComplete) { console.warn("Essential data not loaded yet."); return; }
                const selectedCard = this; const selectedMode = selectedCard.getAttribute('data-mode');
                console.log("Mode selected:", selectedMode);
                clearInterval(sessionTimer); sessionTimer = null; clearInterval(wordTimer); wordTimer = null;
                if (sessionActive) { sessionActive = false; }
                startBtn.disabled = true; stopBtn.disabled = true; sessionArea.classList.remove('session-active'); timerDisplay.textContent = "00:00";
                wordDisplay.classList.remove('glitchy', 'content-changing', 'content-entering'); wordDisplay.style.animation = 'none'; void wordDisplay.offsetWidth; wordDisplay.style.opacity = '1'; wordDisplay.style.transform = 'translateY(0) scale(1)';
                modeCards.forEach(c => c.classList.remove('selected-feedback')); selectedCard.classList.add('selected-feedback'); setTimeout(() => selectedCard.classList.remove('selected-feedback'), 500);
                currentMode = selectedMode;
                modesGrid.classList.add('hidden'); configureTrainingUI(currentMode);
                await updateWordSource();
            });
        });

        // Listeners selects e inputs (Sin cambios funcionales)
         languageSelect.addEventListener('change', handleLanguageChange);
         dictionarySelect.addEventListener('change', handleDictionaryChange);
         modeIntervalInput.addEventListener('input', function() { let v = parseFloat(this.value); v = Math.max(0.5, v); this.value = v; modeIntervalValue.textContent = v.toFixed(1) + "s"; wordInterval = v * 1000; if (sessionActive && wordTimer && !['libre', 'imagenes-aleatorias', 'mixto'].includes(currentMode)) { clearInterval(wordTimer); wordTimer = setInterval(showNextContent, wordInterval); } });
         sessionDurationInput.addEventListener('input', function() { let v = parseInt(this.value, 10); v = Math.max(1, Math.min(v, 60)); this.value = v; sessionDuration = v * 60 * 1000; durationValue.textContent = `${v}m`; });

    }); // Fin DOMContentLoaded

    // --- Configuración UI (Sin cambios funcionales) ---
    function configureTrainingUI(mode) { /* ... (sin cambios respecto v2.5) ... */ console.log("Configuring UI for mode:", mode); let modeTitleText = "Entrenamiento"; const modeCard = document.querySelector(`.mode-card[data-mode="${mode}"]`); if (modeCard) { modeTitleText = modeCard.querySelector('h3').textContent; } homeTitle.innerHTML = `<i class="fas ${modeCard ? modeCard.querySelector('i').className.split(' ')[1] : 'fa-cogs'} fa-spin" style="--fa-animation-duration: 4s; margin-right: 10px;"></i> Modo: ${modeTitleText}`; const needsDictLangPanel = ['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'kickback', 'mixto'].includes(mode); dictLangPanel.classList.toggle('hidden', !needsDictLangPanel); if (needsDictLangPanel) { dictionaryGroup.style.display = (mode === 'kickback' || languageSelect.value === 'en') ? 'none' : 'inline-flex'; dictionarySelect.disabled = (languageSelect.value === 'en'); } multiWordGroup.classList.toggle('hidden', mode !== 'multi-palabras'); mixtoWordGroup.classList.toggle('hidden', mode !== 'mixto'); if (mode === "multi-palabras") modeIntervalInput.value = 10; else if (mode === "imagenes-aleatorias" || mode === "mixto") modeIntervalInput.value = 5; else modeIntervalInput.value = 3; modeIntervalInput.dispatchEvent(new Event('input')); trainingContent.classList.remove('hidden'); trainingContent.style.animation = 'none'; void trainingContent.offsetWidth; trainingContent.style.animation = 'fadeInSection 0.5s ease-out forwards'; wordDisplay.textContent = `[ ${userAKA} // Cargando... ]`; }

    // --- Reset Visual (Sin cambios funcionales) ---
    function resetSessionVisuals() { console.log("Resetting session visuals."); clearInterval(sessionTimer); sessionTimer = null; clearInterval(wordTimer); wordTimer = null; if (sessionActive) { sessionActive = false; } startBtn.disabled = true; stopBtn.disabled = true; sessionArea.classList.remove('session-active'); timerDisplay.textContent = "00:00"; wordDisplay.textContent = isInitialLoadComplete ? `[ ${userAKA} // Selecciona Modo ]` : "[ Cargando Datos Iniciales... ]"; wordDisplay.classList.remove('glitchy', 'content-changing', 'content-entering'); wordDisplay.style.animation = 'none'; void wordDisplay.offsetWidth; wordDisplay.style.opacity = '1'; wordDisplay.style.transform = 'translateY(0) scale(1)'; currentMode = null; if (!dictLangPanel.classList.contains('hidden')) { dictLangPanel.classList.add('hidden'); } }

    // --- Carga Bajo Demanda (updateWordSource) (Sin cambios funcionales) ---
    async function updateWordSource() { /* ... (sin cambios respecto v2.5) ... */ if (!currentMode) { console.warn("updateWordSource called without currentMode."); startBtn.disabled = true; return; } if (!isInitialLoadComplete) { console.warn("updateWordSource called before initial essential data loaded."); startBtn.disabled = true; return; } showPanelLoadingIndicator(true, "Cargando..."); startBtn.disabled = true; const lang = languageSelect.value; const dictType = dictionarySelect.value; let dataReady = false; let errorMsg = null; let dataSource = null; console.log(`Updating source for mode: ${currentMode}, lang: ${lang}, dict: ${dictType}`); wordList = []; kickbackQuestions = []; try { if (currentMode === 'kickback') { dataSource = (lang === 'es') ? kickbackQuestionsEs : kickbackQuestionsEn; if (!dataSource) { console.log(`Kickback ${lang.toUpperCase()} not cached. Loading...`); dataSource = await loadKickbackQuestions(lang); if(lang === 'es') kickbackQuestionsEs = dataSource; else kickbackQuestionsEn = dataSource; } if (dataSource) { kickbackQuestions = dataSource; dataReady = true; } else { errorMsg = `Kickback (${lang.toUpperCase()}) no disponible.`; } } else if (['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'mixto'].includes(currentMode)) { if (lang === 'en') { dataSource = wordListEn; if (!dataSource) { console.log("English words not cached. Loading..."); dataSource = await loadEnglishDictionary(); wordListEn = dataSource; } } else { if (dictType === 'complete') { dataSource = wordListEsComplete; if (!dataSource) { console.log("Spanish Complete not cached. Loading..."); dataSource = await loadSpanishDictionary(completeDictionaryUrl, 1); wordListEsComplete = dataSource; } } else { dataSource = wordListEsEssential; if (!dataSource) { console.log("Spanish Essential not cached (Error?). Loading again..."); dataSource = await loadSpanishDictionary(essentialDictionaryUrl, 0); wordListEsEssential = dataSource; } } } if (dataSource) { wordList = dataSource; dataReady = true; } else { errorMsg = `Palabras (${lang.toUpperCase()}/${dictType}) no disponibles.`; } if (!dataSource && dataLoadError) { console.warn("Using demo words due to previous loading error."); wordList = [...demoWords]; dataReady = true; errorMsg = null; } } else { dataReady = true; } } catch (error) { console.error("Error during data selection/loading:", error); errorMsg = "Error al obtener datos."; dataReady = false; } startBtn.disabled = !dataReady; if (errorMsg) { wordDisplay.textContent = `[ ${errorMsg} ]`; } else if (dataReady) { wordDisplay.textContent = `[ ${userAKA} // Listo ]`; } showPanelLoadingIndicator(false); console.log(`Source update complete. Data ready: ${dataReady}. Start button disabled: ${startBtn.disabled}`); }

    async function handleLanguageChange() { console.log("Language changed to:", languageSelect.value); if (currentMode) { await updateWordSource(); } }
    async function handleDictionaryChange() { console.log("Dictionary changed:", dictionarySelect.value); if (currentMode && languageSelect.value === 'es') { await updateWordSource(); } }

    // --- startSession (Revisado para añadir clase 'glitchy' si es tema glitch) ---
    function startSession() {
        console.log(`%cAttempting startSession... Mode: ${currentMode}, Active: ${sessionActive}, InitialLoad: ${isInitialLoadComplete}, BtnDisabled: ${startBtn.disabled}`, "color: yellow");
        if (sessionActive || !currentMode || !isInitialLoadComplete || startBtn.disabled) { console.warn("Start session prevented by checks."); return; }
        const needsWordList = ['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'mixto'].includes(currentMode);
        const needsKickback = currentMode === 'kickback';
        let isDataValid = false;
        if (needsWordList) { isDataValid = wordList && wordList.length > 0; }
        else if (needsKickback) { isDataValid = kickbackQuestions && kickbackQuestions.length > 0; }
        else { isDataValid = true; }
        if (!isDataValid) { console.error(`Cannot start session: Active data invalid/unavailable for mode ${currentMode}.`); wordDisplay.textContent = "[ Error: Datos Inválidos ]"; startBtn.disabled = true; return; }

        console.log(`%cStarting session: Mode=${currentMode}, Interval=${wordInterval}ms, Duration=${sessionDuration}ms`, "color: lightgreen");
        clearInterval(sessionTimer); sessionTimer = null; clearInterval(wordTimer); wordTimer = null;
        sessionActive = true; startBtn.disabled = true; stopBtn.disabled = false;
        sessionArea.classList.add('session-active'); wordHistory = []; elapsedTime = 0; sessionStartTime = Date.now();
        sessionTimer = setInterval(updateSessionTime, 1000); updateSessionTime();

        // Aplicar clase 'glitchy' si el tema es glitch y el modo lo soporta
        if (currentTheme === 'theme-glitch' && !['imagenes-aleatorias', 'mixto', 'libre'].includes(currentMode)) {
            wordDisplay.classList.add('glitchy');
        } else {
            wordDisplay.classList.remove('glitchy');
        }

        if (currentMode === "imagenes-aleatorias" || currentMode === "mixto") { firstImage = true; wordDisplay.innerHTML = '<div class="spinner" style="margin: auto;"></div>'; showNextContent(); }
        else if (currentMode === "libre") { wordDisplay.textContent = `[ ${userAKA} // MODO LIBRE ]`; animateWordDisplay(wordDisplay); }
        else { showNextContent(); if(wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } }
        console.log("Session successfully started.");
    }

    // --- stopSession (Revisado para quitar clase 'glitchy') ---
    function stopSession() {
        if (!sessionActive) return;
        console.log("Stopping session.");
        clearInterval(sessionTimer); sessionTimer = null; clearInterval(wordTimer); wordTimer = null;
        sessionActive = false; stopBtn.disabled = true;

        let enableStart = false;
        if (currentMode && isInitialLoadComplete) {
            const needsWordList = ['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'mixto'].includes(currentMode);
            const needsKickback = currentMode === 'kickback';
            if (needsWordList) { enableStart = wordList && wordList.length > 0; }
            else if (needsKickback) { enableStart = kickbackQuestions && kickbackQuestions.length > 0; }
            else { enableStart = true; }
        }
        startBtn.disabled = !enableStart;

        sessionArea.classList.remove('session-active');
        wordDisplay.textContent = `[ ${userAKA} // Sesión Finalizada ]`;
        wordDisplay.classList.remove('glitchy', 'content-changing', 'content-entering'); // Asegurarse de quitar glitchy
        animateWordDisplay(wordDisplay);
    }

    // --- showNextContent (MODIFICADO para quitar 'glitchy' antes de cambiar) ---
    function showNextContent() {
      if (!sessionActive) { clearInterval(wordTimer); wordTimer = null; return; }
      if (elapsedTime >= sessionDuration) { stopSession(); return; }
      wordDisplay.classList.add('content-changing');
      wordDisplay.classList.remove('content-entering', 'glitchy'); // Quitar glitchy al cambiar

      setTimeout(() => {
        if (!sessionActive) return;
        // No quitar glitchy aquí, ya se hizo antes
        wordDisplay.innerHTML = ''; // Limpiar contenido

        // --- Lógica de modos (sin cambios funcionales internos) ---
        if (currentMode === "libre") { wordDisplay.textContent = `[ ${userAKA} // MODO LIBRE ]`; }
        else if (currentMode === "imagenes-aleatorias") { 
          wordDisplay.innerHTML = '<div class="spinner" style="margin: auto;"></div>'; 
          const img = new Image(); 
          img.src = `https://image.pollinations.ai/feed?${Date.now()}`; 
          img.alt = "Imagen Aleatoria"; 
          img.style.cssText = 'max-width:100%; max-height:100%; border-radius:4px; box-shadow:var(--shadow-depth-1); opacity: 0; transition: opacity 0.4s ease 0.1s;'; 
          img.onload = () => { 
            if (!sessionActive) return; 
            wordDisplay.innerHTML = ''; 
            wordDisplay.appendChild(img); 
            void img.offsetWidth; 
            img.style.opacity = '1'; 
            if (firstImage) { 
              firstImage = false; 
              clearInterval(wordTimer); 
              if (wordInterval > 0) wordTimer = setInterval(showNextContent, wordInterval); 
            } 
          }; 
          img.onerror = () => { 
            if (!sessionActive) return; 
            wordDisplay.textContent = '[ Error Imagen ]'; 
            animateWordDisplay(wordDisplay); 
            if (firstImage) { 
              firstImage = false; 
              clearInterval(wordTimer); 
              if (wordInterval > 0) wordTimer = setInterval(showNextContent, wordInterval); 
            } 
          }; 
          return; 
        }
        else if (currentMode === "mixto") { /* ... lógica mixto ... */ wordDisplay.innerHTML = '<div class="spinner" style="margin: auto;"></div>'; const img = new Image(); const r = Date.now(); img.src = `https://image.pollinations.ai/feed?${r}`; img.alt = "Imagen Aleatoria"; img.style.cssText = 'max-width:80%; max-height:60%; border-radius:4px; box-shadow:var(--shadow-depth-1); margin-bottom:1.5rem; opacity: 0; transition: opacity 0.4s ease 0.1s;'; img.onload = () => { if (!sessionActive) return; let c = parseInt(mixtoWordCountInput.value,10)||3; c=Math.max(1,Math.min(c,10)); let l=wordList; let w=[]; if(l && l.length>0){let a=[...l];for(let i=0;i<c;i++){if(a.length===0)break; const x=Math.floor(Math.random()*a.length); w.push(a.splice(x,1)[0]);}}else{w=['[NO DATA]'];} const d=w.join(" / "); wordDisplay.innerHTML = `<div style="display:flex; flex-direction:column; align-items:center; width: 100%; height: 100%; justify-content: center; opacity: 0;" class="mixto-content-wrapper"> ${img.outerHTML} <div style="font-size:1.8rem; font-weight: 500; color: var(--c-primary); text-shadow: var(--shadow-primary);">${d}</div> </div>`; const wr=wordDisplay.querySelector('.mixto-content-wrapper'); const li=wordDisplay.querySelector('img'); if(li)li.style.opacity='1'; if(wr){void wr.offsetWidth; wr.style.opacity='1'; wr.style.transition='opacity 0.4s ease-out 0.2s';} if(firstImage){firstImage=false; clearInterval(wordTimer); if(wordInterval>0)wordTimer=setInterval(showNextContent,wordInterval);} }; img.onerror = () => { if (!sessionActive) return; wordDisplay.textContent = '[ Error Imagen Mixto ]'; animateWordDisplay(wordDisplay); if (firstImage) { firstImage = false; clearInterval(wordTimer); if (wordInterval > 0) wordTimer = setInterval(showNextContent, wordInterval); } }; return; }
        else if (currentMode === "kickback") { /* ... lógica kickback ... */ if (kickbackQuestions && kickbackQuestions.length > 0) { const x = Math.floor(Math.random() * kickbackQuestions.length); wordDisplay.textContent = kickbackQuestions[x]; } else { wordDisplay.textContent = "[ Kickback no disponible ]"; } }
        else { /* ... lógica palabras (aleatorias, multi, largas) ... */ let l = wordList; if (!l || l.length === 0) { wordDisplay.textContent = "[ Palabras no disponibles ]"; } else { if (currentMode === "palabras-largas") { let lg = l.filter(w => w.length >= 9); l = lg.length > 0 ? lg : l; if(l.length === 0) l = wordList; } if (currentMode === "multi-palabras") { const c = Math.min(Math.max(parseInt(multiWordCountInput.value,10)||2,2),15); let w=[]; let a=[...l]; for(let i=0;i<c;i++){if(a.length===0)break; const x=Math.floor(Math.random()*a.length); w.push(a.splice(x,1)[0]);} wordDisplay.textContent = w.join(" / "); } else { const x = Math.floor(Math.random()*l.length); wordDisplay.textContent = l[x]; } } }
        // --- Fin Lógica de modos ---

        // Re-aplicar glitchy si corresponde después de poner el contenido
        if (currentTheme === 'theme-glitch' && sessionActive && !['imagenes-aleatorias', 'mixto', 'libre'].includes(currentMode)) {
             // Pequeño delay para asegurar que el contenido está renderizado antes de aplicar animacion
             setTimeout(() => {
                 if(sessionActive) wordDisplay.classList.add('glitchy');
             }, 50);
        }

        animateWordDisplay(wordDisplay); // Animación de entrada

      }, 200); // Tiempo para que termine la animación 'content-changing'
    }


    // --- animateWordDisplay, updateSessionTime, updateTimerDisplay (Sin cambios funcionales) ---
    function animateWordDisplay(elem, useContainerAnimation = true) { elem.classList.remove('content-changing'); if (useContainerAnimation) { elem.classList.add('content-entering'); elem.addEventListener('animationend', () => { if (elem.classList.contains('content-entering')) { elem.classList.remove('content-entering'); } }, { once: true }); } else { elem.style.opacity = '1'; elem.style.transform = 'translateY(0) scale(1)'; } }
    function updateSessionTime() { if (!sessionActive || !sessionStartTime) return; elapsedTime = Date.now() - sessionStartTime; if (elapsedTime >= sessionDuration) { elapsedTime = sessionDuration; updateTimerDisplay(); stopSession(); return; } updateTimerDisplay(); }
    function updateTimerDisplay() { const tS = Math.floor(elapsedTime / 1000); const min = Math.floor(tS / 60); const sec = tS % 60; timerDisplay.textContent = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`; }

  </script>

  <!-- Código Reproductor Música (MODIFICADO: URLs eliminadas) -->
   <script>
     // DEBES AGREGAR TUS URLs AQUÍ DENTRO DE LAS COMILLAS
     const archivePlaylist = [
        "https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(1).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(10).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(100).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(101).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(102).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(103).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(104).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(105).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(106).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(107).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(108).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(109).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(11).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(110).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(111).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(112).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(113).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(114).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(115).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(116).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(12).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(13).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(14).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(15).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(16).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(17).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(18).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(19).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(2).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(20).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(21).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(22).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(23).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(24).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(25).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(26).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(27).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(28).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(29).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(3).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(30).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(31).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(32).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(33).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(34).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(35).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(36).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(37).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(38).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(39).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(4).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(40).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(41).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(42).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(43).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(44).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(45).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(46).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(47).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(48).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(49).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(5).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(50).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(51).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(52).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(53).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(54).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(55).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(56).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(57).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(58).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(59).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(6).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(60).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(61).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(62).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(63).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(64).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(65).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(66).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(67).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(68).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(69).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(7).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(70).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(71).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(72).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(73).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(74).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(75).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(76).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(77).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(78).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(79).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(8).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(80).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(81).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(82).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(83).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(84).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(85).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(86).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(87).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(88).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(89).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(9).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(90).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(91).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(92).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(93).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(94).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(95).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(96).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(97).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(98).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%20(99).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(1).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(10).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(100).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(101).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(102).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(103).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(104).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(105).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(106).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(107).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(108).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(109).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(11).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(110).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(111).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(112).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(113).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(114).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(115).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(116).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(117).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(118).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(119).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(12).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(120).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(121).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(122).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(123).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(124).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(125).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(126).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(127).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(128).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(129).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(13).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(130).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(131).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(132).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(133).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(134).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(135).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(136).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(137).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(138).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(139).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(14).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(140).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(141).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(142).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(143).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(144).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(145).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(147).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(148).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(149).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(15).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(150).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(151).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(153).mp3",
"https://github.com/nkkobb1/sitioweb/raw/refs/heads/main/02/Flowtrainer/beat%202%20(18).mp3"
    ].filter(url => url && url.trim() !== ""); // Filtrar entradas vacías

     // --- Resto del código del reproductor (sin cambios) ---
     function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
     if (archivePlaylist.length > 0) { shuffleArray(archivePlaylist); }
     let currentTrackIndex = 0; const player = document.getElementById('player'); const playPauseBtn = document.getElementById('play-pause-btn'); const prevTrackBtn = document.getElementById('prev-track'); const nextTrackBtn = document.getElementById('next-track'); const repeatToggle = document.getElementById('repeat-toggle'); const progressBar = document.getElementById('progress-bar'); const progressContainer = document.getElementById('progress-container'); const timeIndicator = document.getElementById('time-indicator'); const audioPlayer = document.getElementById('audio-player'); const playPauseIcon = playPauseBtn.querySelector('i'); const loadingIndicatorPlayer = playPauseBtn.querySelector('#loading-indicator'); let repeat = false; let isDragging = false; let playAfterLoad = false;
     function loadInitialTrack() { if (archivePlaylist.length > 0) { player.src = archivePlaylist[currentTrackIndex]; player.load(); console.log("Loading initial track:", archivePlaylist[currentTrackIndex]); } else { console.warn("Audio playlist empty or only contains empty strings."); [playPauseBtn, prevTrackBtn, nextTrackBtn, repeatToggle].forEach(btn => btn.disabled = true); timeIndicator.textContent = "00:00 / --:--"; } }
     function loadTrack(index, autoPlay = false) { if (archivePlaylist.length === 0) return; if (index < 0 || index >= archivePlaylist.length) { index = (index + archivePlaylist.length) % archivePlaylist.length; } currentTrackIndex = index; player.src = archivePlaylist[currentTrackIndex]; player.load(); playAfterLoad = autoPlay; playPauseBtn.classList.add('loading'); playPauseBtn.disabled = true; console.log("Loading track:", index, archivePlaylist[currentTrackIndex]); }
     function playTrack() { if (!player.src || archivePlaylist.length === 0) { console.log("No source or empty playlist, cannot play."); return; } const pP = player.play(); if (pP !== undefined) { pP.then(_ => { playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; }).catch(e => { console.error("Audio play failed:", e); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; playAfterLoad = false; }); } else { playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; } }
     function pauseTrack() { player.pause(); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; }
     function togglePlayPause() { if (archivePlaylist.length === 0) return; if (!player.src || player.src === window.location.href) { loadInitialTrack(); playAfterLoad = true; return; } if (player.paused) { playTrack(); } else { pauseTrack(); } }
     function nextTrack() { if (archivePlaylist.length === 0) return; const nI = (currentTrackIndex + 1) % archivePlaylist.length; loadTrack(nI, !player.paused); }
     function prevTrack() { if (archivePlaylist.length === 0) return; const nI = (currentTrackIndex - 1 + archivePlaylist.length) % archivePlaylist.length; loadTrack(nI, !player.paused); }
     function toggleRepeat() { repeat = !repeat; repeatToggle.classList.toggle('active', repeat); repeatToggle.textContent = repeat ? "Repeat On" : "Repeat Off"; player.loop = repeat; }
     playPauseBtn.addEventListener('click', togglePlayPause); nextTrackBtn.addEventListener('click', nextTrack); prevTrackBtn.addEventListener('click', prevTrack); repeatToggle.addEventListener('click', toggleRepeat);
     player.addEventListener('loadedmetadata', () => { updateProgress(); playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false;}); player.addEventListener('timeupdate', () => { if (!isDragging) { updateProgress(); } }); player.addEventListener('ended', () => { if (!repeat) { nextTrack(); } else { player.play(); } }); player.addEventListener('error', (e) => { console.error("Audio player error:", e); playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; timeIndicator.textContent = "Error / --:--"; setTimeout(nextTrack, 1500); }); player.addEventListener('waiting', () => { playPauseBtn.classList.add('loading'); playPauseBtn.disabled = true; }); player.addEventListener('canplay', () => { playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; if (playAfterLoad) { playTrack(); playAfterLoad = false; } else if (!player.paused) { playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; } }); player.addEventListener('playing', () => { playPauseBtn.classList.remove('loading'); playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; playPauseBtn.disabled = false; }); player.addEventListener('pause', () => { playPauseBtn.classList.remove('loading'); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; });
     progressContainer.addEventListener('click', seek); progressContainer.addEventListener('mousedown', (e) => { if (archivePlaylist.length === 0) return; isDragging = true; seek(e); document.addEventListener('mousemove', dragSeek); document.addEventListener('mouseup', stopDragSeek); });
     function seek(e) { if (!player.duration || isNaN(player.duration)) return; const r = progressContainer.getBoundingClientRect(); const oX = e.clientX - r.left; const w = r.width; const p = Math.max(0, Math.min(1, oX / w)); const sT = p * player.duration; player.currentTime = sT; updateProgress(); }
     function dragSeek(e) { if (!isDragging || !player.duration || isNaN(player.duration)) return; const r = progressContainer.getBoundingClientRect(); const oX = e.clientX - r.left; const w = r.width; const p = Math.max(0, Math.min(1, oX / w)); progressBar.style.width = `${p * 100}%`; const dTF = formatTime(p * player.duration); const tDF = formatTime(player.duration); timeIndicator.textContent = `${dTF} / ${tDF}`; }
     function stopDragSeek(e) { if (!isDragging) return; isDragging = false; seek(e); document.removeEventListener('mousemove', dragSeek); document.removeEventListener('mouseup', stopDragSeek); }
     function updateProgress() { if (!player.duration || isNaN(player.duration)) { progressBar.style.width = "0%"; timeIndicator.textContent = archivePlaylist.length > 0 ? "00:00 / --:--" : "00:00 / 00:00"; return; } const p = (player.currentTime / player.duration) * 100; progressBar.style.width = `${p}%`; const cTF = formatTime(player.currentTime); const tDF = formatTime(player.duration); timeIndicator.textContent = `${cTF} / ${tDF}`; }
     function formatTime(s) { if (isNaN(s) || s < 0) return '00:00'; const min = Math.floor(s / 60); const sec = Math.floor(s % 60); return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`; }
     document.addEventListener('DOMContentLoaded', loadInitialTrack);
   </script>

</body>
</html>