<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archivo Criptográfico: Guerra Fría [1947-1991]</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Condensed:wght@400;700&family=Special+Elite&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #2d2d2d; /* Gris oscuro casi negro */
      --container-bg: #4a4a4a; /* Gris medio metálico */
      --card-bg: #e8e8e0; /* Papel archivo/Beige muy claro */
      --preview-bg: #cccccc; /* Gris claro */
      --text-color-dark: #1a1a1a; /* Negro */
      --text-color-light: #e0e0e0; /* Gris muy claro/Blanco roto */
      --accent-red: #d93025; /* Rojo Alerta/Soviet */
      --accent-blue: #4285f4; /* Azul NATO/Tecnología */
      --accent-green: #34a853; /* Verde Radar/Consola */
      --accent-yellow: #fbbc05; /* Amarillo Precaución/Nuclear */
      --border-color: #707070; /* Gris borde */
      --font-body: 'Roboto Condensed', sans-serif;
      --font-display: 'Orbitron', sans-serif; /* Tecno/Futurista de época */
      --font-mono: 'Special Elite', monospace; /* Máquina de escribir */
      --shadow-dark: rgba(0, 0, 0, 0.6);
      --shadow-light: rgba(255, 255, 255, 0.1);
      --noise-opacity: 0.06; /* Sutil ruido/estática */
    }

    /* Efecto ruido/estática */
    body::before {
        content: "";
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        width: 100%; height: 100%;
        pointer-events: none;
        background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuOCIgbnVtT2N0YXZlcz0iMyIgc3RpdGNoVGlsZXM9InN0aXRjaCIvPjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxIDAiLz48L2ZpbHRlcj48cmVjdCB3aWR0aD0iMzAwiIGhlaWdodD0iMzAwIiBmaWx0ZXI9InVybCgjbm9pc2UpIi8+PC9zdmc+');
        opacity: var(--noise-opacity);
        z-index: 1000;
        animation: grain 8s steps(10) infinite;
    }
     @keyframes grain { 0%, 100% { transform:translate(0, 0) } 10% { transform:translate(-5%, -10%) } 20% { transform:translate(-15%, 5%) } 30% { transform:translate(7%, -25%) } 40% { transform:translate(-5%, 25%) } 50% { transform:translate(-15%, 10%) } 60% { transform:translate(15%, 0%) } 70% { transform:translate(0%, 15%) } 80% { transform:translate(3%, 35%) } 90% { transform:translate(-10%, 10%) } }


    body {
      font-family: var(--font-body);
      background-color: var(--bg-color);
      color: var(--text-color-light);
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      position: relative; /* Necesario para el z-index del ::before */
    }

    .timeline-container {
      background: linear-gradient(145deg, var(--container-bg), #3c3c3c);
      border-radius: 4px; /* Bordes más rectos */
      border: 2px solid var(--border-color);
      box-shadow: 0 0 0 1px #1a1a1a, 0 5px 20px var(--shadow-dark), inset 0 0 10px rgba(0, 0, 0, 0.4);
      padding: 25px;
      max-width: 90vw;
      width: 1400px;
      position: relative;
      overflow: hidden;
      z-index: 1; /* Detrás del ruido */
    }

    /* Decoración Esquinas - Minimalista */
    .timeline-container::before, .timeline-container::after { content: ''; position: absolute; width: 10px; height: 10px; background-color: var(--accent-red); border: 1px solid #000; }
    .timeline-container::before { top: 5px; left: 5px; }
    .timeline-container::after { bottom: 5px; right: 5px; background-color: var(--accent-blue); }


    h1 {
      font-family: var(--font-display);
      text-align: center;
      margin-top: 0;
      margin-bottom: 25px;
      color: var(--text-color-light);
      text-shadow: 0 0 5px var(--accent-red), 0 0 10px var(--accent-blue);
      font-size: 2.3em;
      font-weight: 700;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      letter-spacing: 1px;
    }

    /* Estructura Flex (sin cambios) */
    .main-content-area { display: flex; gap: 25px; align-items: stretch; margin-top: 20px; }
    .center-column { flex: 3; display: flex; flex-direction: column; min-width: 400px; }

    /* Vistas Previas (Adaptadas - Dossier/Ficha) */
    .event-preview {
        flex: 1; min-width: 200px; max-width: 280px;
        background-color: var(--preview-bg);
        border: 1px solid #555;
        border-top: 5px solid var(--accent-red); /* Pestaña roja */
        border-radius: 3px 3px 0 0;
        padding: 15px;
        color: var(--text-color-dark);
        box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        display: flex; flex-direction: column;
        transition: all 0.3s ease; cursor: pointer;
        position: relative;
    }
     .event-preview:nth-child(3) { /* Preview derecha */
         border-top-color: var(--accent-blue); /* Pestaña azul */
     }

    .event-preview:hover:not(.empty-preview) { box-shadow: 4px 4px 10px rgba(0,0,0,0.4); transform: translateY(-2px) translateX(-1px); }
    .event-preview.empty-preview { background-color: rgba(80,80,80,0.5); border: 1px dashed var(--border-color); border-top: 5px solid var(--border-color); opacity: 0.6; cursor: default; align-items: center; justify-content: center; text-align: center; color: var(--text-color-light); }

    .event-preview h3 { font-family: var(--font-body); font-weight: 700; font-size: 1.05em; margin: 0 0 8px 0; color: #222; border-bottom: 1px solid #888; padding-bottom: 5px; }
    .event-preview .preview-year { font-family: var(--font-display); font-weight: 400; color: var(--text-color-dark); background-color: var(--accent-yellow); padding: 2px 6px; border-radius: 2px; margin-bottom: 10px; font-size: 1em; text-align: center; display: inline-block; }
    .event-preview p { font-size: 0.9em; line-height: 1.5; margin: 0; flex-grow: 1; overflow: hidden; text-overflow: ellipsis; color: #333; }

    /* Slider Container (Adaptado - Consola) */
    .slider-container { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 10px; background: #333; border-radius: 3px; border: 1px solid #555; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); }

    /* Slider (Adaptado) */
    input[type="range"] { flex: 1; height: 8px; cursor: pointer; appearance: none; -webkit-appearance: none; background: linear-gradient(to right, var(--accent-red), var(--accent-blue)); border-radius: 4px; outline: none; border: 1px solid #111; box-shadow: inset 0 1px 2px rgba(0,0,0,0.6); }
    input[type="range"]::-webkit-slider-thumb { appearance: none; -webkit-appearance: none; width: 16px; height: 24px; background: #e0e0e0; border-radius: 2px; border: 1px solid #222; box-shadow: 0 0 3px rgba(0,0,0,0.5); transition: transform 0.2s ease; margin-top: -8px; } /* Rectangular */
    input[type="range"]::-moz-range-thumb { width: 14px; height: 22px; background: #e0e0e0; border-radius: 2px; border: 1px solid #222; box-shadow: 0 0 3px rgba(0,0,0,0.5); cursor: pointer; }
    input[type="range"]::-webkit-slider-thumb:active, input[type="range"]::-moz-range-thumb:active { background: var(--accent-yellow); }

    /* Year Display (Adaptado - Display Digital) */
    #yearDisplay {
      min-width: 70px;
      text-align: center;
      font-weight: 700;
      font-family: var(--font-display);
      background: #1a1a1a;
      color: var(--accent-green); /* Texto verde consola */
      padding: 8px 12px;
      border-radius: 2px;
      border: 1px solid #000;
      box-shadow: inset 0 0 8px rgba(52, 168, 83, 0.4), 0 0 2px #000;
      font-size: 1.1em;
      text-shadow: 0 0 3px var(--accent-green);
    }

    /* Event Card (Adaptado - Documento Clasificado) */
    #eventCard {
      background-color: var(--card-bg);
      color: var(--text-color-dark);
      padding: 25px;
      border-radius: 2px;
      border: 1px solid #888;
      min-height: 550px;
      display: flex; flex-direction: column; justify-content: flex-start;
      box-shadow: 3px 3px 8px var(--shadow-dark);
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      opacity: 1; flex-grow: 1;
      overflow: hidden; /* Ocultar overflow general, el scroll va dentro */
      position: relative; /* Para el sello */
    }
     /* Sello "CLASSIFIED" */
    #eventCard::after {
        content: "CLASSIFIED";
        position: absolute;
        top: 30px; right: -30px;
        transform: rotate(-35deg);
        font-family: var(--font-display);
        font-size: 1.8em;
        color: var(--accent-red);
        border: 3px double var(--accent-red);
        padding: 5px 15px;
        opacity: 0.15; /* Muy sutil */
        pointer-events: none;
        z-index: 0;
    }

    #eventCard.loading, #eventCard.error, #eventCard.suggestions { justify-content: center; align-items: center; text-align: center; background-color: var(--container-bg); color: var(--text-color-light); border-color: #555;}
    #eventCard.loading { opacity: 0.8; }
    #eventCard.error { border: 2px solid var(--accent-red); color: var(--accent-yellow); }
    #eventCard.error p { font-weight: 700; font-size: 1.1em; }
    #eventCard.suggestions ul { list-style: none; padding: 0; margin-top: 15px; }
    #eventCard.suggestions li { margin-bottom: 10px; }
    #eventCard.suggestions a.suggestion-link { /* Botón consola/archivo */
        display: inline-block; padding: 6px 12px;
        background-color: #5a5a5a;
        color: var(--text-color-light);
        border: 1px solid #222; border-radius: 2px;
        text-decoration: none; transition: all 0.3s; cursor: pointer;
        font-family: var(--font-body); font-size: 0.95em;
        box-shadow: 1px 1px 2px rgba(0,0,0,0.4);
    }
    #eventCard.suggestions a.suggestion-link:hover { background-color: var(--accent-blue); color: #fff; }

    /* Estilos Tarjeta Principal (Adaptados) */
    #eventCard h2 {
        margin-top: 0; margin-bottom: 15px; text-align: center;
        color: #333; font-family: var(--font-mono); /* Máquina de escribir */
        font-size: 1.6em; font-weight: 700;
        border-bottom: 2px solid #aaa; padding-bottom: 10px;
        letter-spacing: 1px; position: relative; z-index: 1;
    }
    #eventCard img {
        max-width: 40%; height: auto; max-height: 200px;
        object-fit: contain; border-radius: 0px; /* Sin borde redondeado */
        margin: 0 auto 20px auto; display: block;
        border: 1px solid #555; background-color: #ddd; padding: 4px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        filter: grayscale(0.7) contrast(1.1) brightness(1.05); /* Look de foto antigua */
        position: relative; z-index: 1;
    }
    #eventCard .content-extract {
        line-height: 1.7; margin-bottom: 15px; font-size: 1em;
        text-align: justify; height: 320px; /* Altura fija para contenido */
        overflow-y: auto; /* Scroll interno */
        padding: 10px; margin-right: -10px; /* Compensar scrollbar visualmente */
        border: 1px dashed #aaa; background-color: rgba(255,255,255,0.3);
        font-family: var(--font-body); position: relative; z-index: 1;
    }
     /* Estilo scrollbar */
     #eventCard .content-extract::-webkit-scrollbar { width: 8px; }
     #eventCard .content-extract::-webkit-scrollbar-track { background: #ccc; border-radius: 0; }
     #eventCard .content-extract::-webkit-scrollbar-thumb { background: #666; border-radius: 0; }
     #eventCard .content-extract::-webkit-scrollbar-thumb:hover { background: #444; }

     /* Link externo - Botón metálico */
    #eventCard a.external-link {
        display: block; margin: 15px auto 0 auto; padding: 10px 20px;
        background: linear-gradient(to bottom, #888, #555);
        color: var(--text-color-light); text-decoration: none; font-weight: 700;
        font-family: var(--font-display); font-size: 0.9em; letter-spacing: 1px;
        border-radius: 2px; text-align: center;
        transition: all 0.3s ease; border: 1px solid #222;
        box-shadow: 0 1px 3px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        width: fit-content; text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
        position: relative; z-index: 1;
    }
    #eventCard a.external-link:hover { background: linear-gradient(to bottom, var(--accent-blue), #3275d4); color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.3); transform: translateY(-1px); }

    /* Spinner (Adaptado) */
    .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.2); border-top: 4px solid var(--accent-blue); border-right: 4px solid var(--accent-red); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 30px auto; position: relative; }
    .spinner::after { content: ''; position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; margin-top: -4px; margin-left: -4px; background: var(--accent-yellow); border-radius: 50%; box-shadow: 0 0 5px var(--accent-yellow); }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Ajustes responsivos (revisar si son necesarios cambios específicos) */
     @media (max-width: 1200px) { /* ... */ }
     @media (max-width: 900px) { .main-content-area { flex-direction: column; } /* ... */ }
     @media (max-width: 600px) {
         h1 { font-size: 1.8em; }
         #eventCard h2 { font-size: 1.4em;}
         #eventCard img { max-width: 60%; max-height: 160px;}
         #eventCard .content-extract { height: 280px; font-size: 0.95em;}
         #eventCard::after { font-size: 1.5em; top: 20px; right: -25px;}
      }

  </style>
</head>
<body>
  <div class="timeline-container" id="timelineContainer">
    <h1>Archivo Criptográfico: Guerra Fría [1947-1991]</h1>

    <div class="main-content-area">
      <!-- Preview Izquierda (Bloque Este) -->
      <div id="prevEventPreview" class="event-preview empty-preview" data-index="-1">
          <p>// INICIO TRANSMISIÓN //</p>
      </div>

      <!-- Columna Central -->
      <div class="center-column">
        <div class="slider-container">
          <input type="range" id="timelineSlider" min="0" step="1" value="0">
          <div id="yearDisplay">----</div>
        </div>
        <div id="eventCard">
          <p>// INSERTE CLAVE DE ACCESO TEMPORAL //</p>
        </div>
      </div>

      <!-- Preview Derecha (Bloque Oeste) -->
      <div id="nextEventPreview" class="event-preview empty-preview" data-index="-1">
         <p>// FIN TRANSMISIÓN //</p>
      </div>
    </div>
  </div>

  <script>
    // --- Hitos de la Guerra Fría ---
    const events = [
      { year: 1947, title: "Doctrina Truman", wikiTitle: "Doctrina Truman" },
      { year: 1948, title: "Plan Marshall", wikiTitle: "Plan Marshall" },
      { year: 1948, title: "Bloqueo de Berlín", wikiTitle: "Bloqueo de Berlín" },
      { year: 1949, title: "Creación de la OTAN", wikiTitle: "OTAN" },
      { year: 1949, title: "Bomba Atómica Soviética", wikiTitle: "RDS-1" },
      { year: 1950, title: "Inicio Guerra de Corea", wikiTitle: "Guerra de Corea" },
      { year: 1953, title: "Muerte de Stalin / Fin Guerra Corea", wikiTitle: "Guerra de Corea" }, // Combinado por cercanía
      { year: 1955, title: "Pacto de Varsovia", wikiTitle: "Pacto de Varsovia" },
      { year: 1956, title: "Revolución Húngara", wikiTitle: "Revolución húngara de 1956" },
      { year: 1957, title: "Lanzamiento del Sputnik 1", wikiTitle: "Sputnik 1" },
      { year: 1958, title: "Creación de la NASA", wikiTitle: "NASA" },
      { year: 1959, title: "Revolución Cubana", wikiTitle: "Revolución cubana" },
      { year: 1961, title: "Yuri Gagarin, primer hombre en el espacio", wikiTitle: "Yuri Gagarin" },
      { year: 1961, title: "Construcción del Muro de Berlín", wikiTitle: "Muro de Berlín" },
      { year: 1962, title: "Crisis de los misiles de Cuba", wikiTitle: "Crisis de los misiles de Cuba" },
      { year: 1963, title: "Asesinato de John F. Kennedy", wikiTitle: "Asesinato de John F. Kennedy" },
      { year: 1964, title: "Incidente del Golfo de Tonkín / Escalada en Vietnam", wikiTitle: "Incidente del Golfo de Tonkín"},
      { year: 1968, title: "Primavera de Praga", wikiTitle: "Primavera de Praga" },
      { year: 1969, title: "Llegada del Hombre a la Luna (Apolo 11)", wikiTitle: "Apolo 11" },
      { year: 1972, title: "Acuerdos SALT I", wikiTitle: "Acuerdos SALT" },
      { year: 1973, title: "Fin de la participación de EEUU en Vietnam", wikiTitle: "Acuerdos de paz de París"},
      { year: 1975, title: "Caída de Saigón", wikiTitle: "Caída de Saigón" },
      { year: 1979, title: "Revolución Iraní", wikiTitle: "Revolución iraní" },
      { year: 1979, title: "Invasión Soviética de Afganistán", wikiTitle: "Guerra de Afganistán (1978-1992)" },
      { year: 1980, title: "Nacimiento del sindicato Solidaridad (Polonia)", wikiTitle: "Solidaridad (sindicato polaco)" },
      { year: 1983, title: "Iniciativa de Defensa Estratégica (SDI - 'Star Wars')", wikiTitle: "Iniciativa de Defensa Estratégica" },
      { year: 1985, title: "Mijaíl Gorbachov líder de la URSS (Inicio Glasnost/Perestroika)", wikiTitle: "Mijaíl Gorbachov" },
      { year: 1986, title: "Accidente de Chernóbil", wikiTitle: "Accidente de Chernóbil" },
      { year: 1987, title: "Tratado INF (Eliminación misiles nucleares corto/medio alcance)", wikiTitle: "Tratado INF" },
      { year: 1989, title: "Caída del Muro de Berlín", wikiTitle: "Caída del Muro de Berlín" },
      { year: 1990, title: "Reunificación Alemana", wikiTitle: "Reunificación alemana" },
      { year: 1991, title: "Disolución del Pacto de Varsovia", wikiTitle: "Pacto de Varsovia"},
      { year: 1991, title: "Intento de Golpe de Estado en la URSS", wikiTitle: "Intento de golpe de Estado en la Unión Soviética"},
      { year: 1991, title: "Disolución de la Unión Soviética", wikiTitle: "Disolución de la Unión Soviética" }
    ];


    // --- Elementos del DOM (igual) ---
    const slider = document.getElementById('timelineSlider');
    const yearDisplay = document.getElementById('yearDisplay');
    const eventCard = document.getElementById('eventCard');
    const prevPreview = document.getElementById('prevEventPreview');
    const nextPreview = document.getElementById('nextEventPreview');
    const timelineContainer = document.getElementById('timelineContainer');

    // --- Estado y Caché (igual) ---
    const summaryCache = {};

    // --- Función Fetch Detallada (igual, usa action=query) ---
    const MAX_RETRIES = 3;
    const RETRY_DELAY_MS = 1000;
    async function fetchDetailedData(title, retries = MAX_RETRIES) { /* ... (código igual que la versión Egipto) ... */
       const baseUrl = "https://es.wikipedia.org/w/api.php";
        const params = new URLSearchParams({
            action: "query", prop: "extracts|pageimages|info", titles: title,
            format: "json", origin: "*", explaintext: "true", exchars: "2000", // Un poco más de texto
            exintro: "false", piprop: "thumbnail", pithumbsize: "400", // Tamaño imagen
            inprop: "url"
        });
        const url = `${baseUrl}?${params.toString()}`;
        // console.log("Fetching URL:", url); // Descomentar para debug

        let lastKnownError = null;
        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    lastKnownError = { status: response.status, statusText: response.statusText };
                     if (response.status >= 500 || response.status === 429) { throw new Error(`HTTP error ${response.status}`); }
                     else { throw new Error(`Client error ${response.status}: ${response.statusText || 'Error del cliente'}`); }
                }
                const data = await response.json();
                if (!data.query || !data.query.pages) { throw new Error("Respuesta inesperada de la API: falta query.pages"); }
                const pages = data.query.pages; const pageId = Object.keys(pages)[0];
                if (pageId === "-1" || pages[pageId].missing !== undefined) { throw new Error(`Not Found: API reportó que "${title}" no existe.`); }
                const pageData = pages[pageId];
                if (!pageData.title || !pageData.extract) { throw new Error(`Respuesta incompleta para "${title}"`); }
                 // console.log("Datos recibidos de API:", pageData); // Descomentar para debug
                 return pageData;
            } catch (error) {
                 lastKnownError = error;
                 // console.warn(`Intento ${i + 1} fallido por catch (${title}): ${error.message}`); // Debug
                 if (error.message.startsWith('Not Found:')) { throw error; }
                 if (i < retries - 1 && error.message.startsWith('HTTP error')) { // Solo reintentar errores de servidor
                     await new Promise(resolve => setTimeout(resolve, RETRY_DELAY_MS * (i + 1)));
                 } else {
                     // console.error(`No se pudo obtener datos para ${title} después de ${retries} intentos o error de cliente.`); // Debug
                     throw lastKnownError || new Error(`Imposible recuperar datos tras ${retries} intentos.`);
                 }
            }
        }
        throw lastKnownError || new Error(`Fallo inesperado en la recuperación de datos para ${title}.`);
    }

    // --- Funciones de Renderizado (Adaptadas con textos temáticos) ---

    function renderEventCardLoading(message = "ACCEDIENDO ARCHIVOS CLASIFICADOS...") {
        eventCard.innerHTML = `<div class="spinner"></div><p style="font-family: var(--font-mono); color: var(--accent-green);">${message}</p>`;
        eventCard.className = 'loading';
        eventCard.style.opacity = '0.7';
    }

    function renderEventCardError(errorMessage) {
        let cleanMessage = errorMessage.toString().toUpperCase();
        // Mensajes temáticos
        if (cleanMessage.includes('IMPOSIBLE RECUPERAR DATOS') || cleanMessage.includes('HTTP ERROR')) { cleanMessage = 'ERROR DE TRANSMISIÓN // LÍNEA INESTABLE // INTENTE MÁS TARDE'; }
        else if (cleanMessage.includes('CLIENT ERROR 404') || cleanMessage.includes('NOT FOUND:') || cleanMessage.includes('NO EXISTE')) { cleanMessage = 'ARCHIVO NO ENCONTRADO // VERIFICAR REFERENCIA CRUZADA'; }
        else if (cleanMessage.includes('CLIENT ERROR')) { cleanMessage = 'ERROR DE AUTENTICACIÓN // SOLICITUD RECHAZADA';}
        else if (cleanMessage.includes('RESPUESTA INCOMPLETA')) { cleanMessage = 'DATOS CORRUPTOS // IMPOSIBLE DECODIFICAR';}
        else { cleanMessage = 'FALLO CRÍTICO // PROTOCOLO DESCONOCIDO';} // Fallback genérico

        eventCard.innerHTML = `<p style="font-family: var(--font-mono);"><strong style="color: var(--accent-red);">ALERTA:</strong><br>${cleanMessage}</p>`;
        eventCard.className = 'error';
        eventCard.style.opacity = '1';
    }

    // Renderizar Tarjeta Principal (igual en lógica, usa datos de pageData)
    function renderEventCard(pageData, originalEventTitle) {
        const title = pageData.title || originalEventTitle;
        const extract = pageData.extract || "// DATOS NO DISPONIBLES //";
        const imageUrl = pageData.thumbnail?.source;
        const wikiUrl = pageData.fullurl;
        const imgHtml = imageUrl ? `<img src="${imageUrl}" alt="[IMAGEN CLASIFICADA: ${title}]">` : '';

        eventCard.innerHTML = `
            <h2>${title}</h2>
            ${imgHtml}
            <div class="content-extract"><p>${extract.replace(/\n/g, '<br><br>')}</p></div>
            ${wikiUrl ? `<a href="${wikiUrl}" target="_blank" rel="noopener noreferrer" class="external-link">VER DOSSIER COMPLETO</a>` : ''}
        `;
        eventCard.className = '';
        eventCard.style.opacity = '1';
        const extractDiv = eventCard.querySelector('.content-extract');
        if (extractDiv) extractDiv.scrollTop = 0;
    }

    // Renderizar Vistas Previas (adaptar textos)
    function renderPreview(eventData, targetElement) {
        if (eventData && targetElement) {
            targetElement.innerHTML = `
                <div class="preview-year">${eventData.year}</div>
                <h3>${eventData.title}</h3>
                <p>Acceder a este informe...</p>
            `;
            targetElement.className = 'event-preview';
            targetElement.dataset.index = events.indexOf(eventData);
        } else if (targetElement) {
            const message = targetElement.id === 'prevEventPreview' ? '// INICIO TRANSMISIÓN //' : '// FIN TRANSMISIÓN //';
            targetElement.innerHTML = `<p style="font-family: var(--font-mono); font-size:0.9em;">${message}</p>`;
            targetElement.className = 'event-preview empty-preview';
            targetElement.dataset.index = -1;
        }
    }

    // Buscar y Mostrar Sugerencias (adaptar textos)
    async function findAndDisplaySuggestions(failedTitle) {
        console.log(`"${failedTitle}" no encontrado, buscando referencias alternativas...`);
        renderEventCardLoading("ARCHIVO PERDIDO // BUSCANDO REFERENCIAS CRUZADAS...");
        const searchTerm = failedTitle;
        const searchUrl = `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(searchTerm)}&format=json&origin=*`;

         try {
            const response = await fetch(searchUrl);
            if (!response.ok) throw new Error(`Error ${response.status} al consultar índice.`);
            const searchData = await response.json();

            if (searchData.query?.search?.length > 0) {
                const suggestions = searchData.query.search.slice(0, 5);
                let suggestionsHtml = `<p style="font-family: var(--font-mono);">Referencia "<strong>${failedTitle}</strong>" no localizada.</p>
                                       <p>Posibles archivos relacionados:</p>
                                       <ul class="suggestions-list">`;
                suggestions.forEach(item => {
                    const snippet = item.snippet.replace(/<[^>]*>/g, ''); // Limpiar snippet HTML
                    suggestionsHtml += `<li><a href="#" class="suggestion-link" data-wiki-title="${item.title}" title="Extracto: ${snippet}">${item.title}</a></li>`;
                });
                suggestionsHtml += `</ul><p><small>(Seleccione un archivo para intentar acceso)</small></p>`;
                eventCard.innerHTML = suggestionsHtml;
                eventCard.className = 'suggestions';
                eventCard.style.opacity = '1';
            } else {
                console.log(`No se encontraron referencias alternativas para "${searchTerm}".`);
                renderEventCardError(`Archivo "${failedTitle}" no hallado. No hay referencias alternativas en el índice.`);
            }
        } catch (searchErr) {
            console.error("Error buscando referencias alternativas:", searchErr);
            renderEventCardError(`Archivo "${failedTitle}" no hallado. Fallo al consultar índice de referencias.`);
        }
    }


    // --- Función Principal de Actualización (igual en lógica) ---
    async function updateEvent(options) { /* ... (código igual que la versión Egipto) ... */
        const index = options.index;
        if (isNaN(index) || index < 0 || index >= events.length) { /* ... error handling ... */ return; }
        const currentEvent = events[index];
        yearDisplay.textContent = currentEvent.year.toString();
        if (slider.value !== index.toString()) { slider.value = index; }
        const titleToFetch = options.wikiTitleOverride || currentEvent.wikiTitle || currentEvent.title;
        const cacheKey = titleToFetch.toLowerCase();
        renderPreview(events[index - 1], prevPreview);
        renderPreview(events[index + 1], nextPreview);
        if (summaryCache[cacheKey] && summaryCache[cacheKey] !== 'NOT_FOUND') {
            renderEventCard(summaryCache[cacheKey], currentEvent.title);
        } else if (summaryCache[cacheKey] === 'NOT_FOUND') {
             findAndDisplaySuggestions(titleToFetch);
        } else {
            renderEventCardLoading();
            try {
                const pageData = await fetchDetailedData(titleToFetch);
                summaryCache[cacheKey] = pageData;
                renderEventCard(pageData, currentEvent.title);
            } catch (err) {
                if (err.message.startsWith('Not Found:')) {
                    summaryCache[cacheKey] = 'NOT_FOUND';
                    findAndDisplaySuggestions(titleToFetch);
                } else {
                    renderEventCardError(err.toString());
                }
            }
        }
    }

    // --- Manejador de Clics (igual en lógica) ---
    function handleClick(event) { /* ... (código igual que la versión Egipto) ... */
         if (event.target.matches('a.suggestion-link')) {
            event.preventDefault();
            const suggestedTitle = event.target.dataset.wikiTitle;
            if (suggestedTitle) { updateEvent({ index: parseInt(slider.value, 10), wikiTitleOverride: suggestedTitle }); }
        }
        else if (event.target.closest('.event-preview:not(.empty-preview)')) {
            const previewElement = event.target.closest('.event-preview');
            const targetIndex = parseInt(previewElement.dataset.index, 10);
            if (targetIndex >= 0 && targetIndex < events.length) { updateEvent({ index: targetIndex }); }
        }
    }

    // --- Inicialización (adaptar textos) ---
    function initializeTimeline() {
        if (!events || events.length === 0) {
            document.querySelector('h1').textContent = "ERROR: ÍNDICE DAÑADO";
            eventCard.innerHTML = "<p>// NO HAY DATOS DISPONIBLES EN ESTE SECTOR DEL ARCHIVO //</p>";
            eventCard.className = 'error';
            slider.disabled = true; yearDisplay.textContent = 'ERR';
            renderPreview(null, prevPreview); renderPreview(null, nextPreview);
            return;
        }
        slider.max = events.length - 1; slider.value = 0; slider.disabled = events.length <= 1;
        updateEvent({ index: 0 });
        slider.addEventListener('input', () => updateEvent({ index: parseInt(slider.value, 10) }));
        timelineContainer.addEventListener('click', handleClick);
        console.log("Sistema Criptográfico Temporal Activado. Sector: Guerra Fría.");
    }

    document.addEventListener('DOMContentLoaded', initializeTimeline);

  </script>
</body>
</html>