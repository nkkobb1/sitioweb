<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorando Colombia: Ciudades y Maravillas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Colombia --- */
        :root {
            --color-primary: #0077b6; /* Azul medio (cielo, agua) */
            --color-secondary: #fca311; /* Amarillo/Naranja (sol, calidez) */
            --color-background: #f8f9fa; /* Blanco roto/Gris muy claro */
            --color-text: #343a40; /* Gris oscuro casi negro */
            --color-text-muted: #6c757d; /* Gris medio */
            --color-modal-bg: #ffffff; /* Blanco puro para modal */
            --color-border: #dee2e6; /* Gris claro para bordes */
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 6px; /* Bordes ligeramente m√°s redondeados */
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Merriweather', serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-secondary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: var(--color-modal-bg); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem; /* Padding left for icon */
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
        }
        #search-container .fa-search {
            position: absolute;
            left: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none; /* Prevent icon from blocking input click */
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.25rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.25rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 600; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 75px; font-family: 'Lato', sans-serif; }
        .title-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: var(--color-primary); color: var(--color-primary); background-color: #e9f5ff; /* Light blue hover */ }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-primary); color: white; padding: 0.7rem 1.4rem; border: none; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: bold; cursor: pointer; transition: var(--transition-normal); margin-top: 1.5rem; }
        #generate-more-btn:hover:not(:disabled) { background-color: #005f8d; box-shadow: var(--shadow-sm); }
        #generate-more-btn:disabled { background-color: #adb5bd; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(52, 58, 64, 0.85); /* Darker overlay */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 950px;
            width: 95%;
            max-height: 90vh;
            min-height: 350px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--color-border);
        }
        .modal-close-btn { position: absolute; top: 12px; right: 12px; background: #e9ecef; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.5rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: #ced4da; color: #000; }
        #modal-title { font-size: 1.8rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1.5rem; line-height: 1.3; }
        #modal-content { /* Scrollable content area */
            line-height: 1.75;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px; /* Padding bottom for image space */
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-secondary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 9px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: 4px;}
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-secondary); border-radius: 4px; border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.3em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { color: #e76f51; font-style: italic; } /* Use secondary color for emphasis */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Merriweather', serif; margin-top: 2em; margin-bottom: 1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.4em; font-weight: bold; }
        #modal-content h1 { font-size: 1.5em; }
        #modal-content h2 { font-size: 1.4em; }
        #modal-content h3 { font-size: 1.25em; color: #005f8d; } /* Darker primary */
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none;}
        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 85%; height: auto; margin: 2rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-sm); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2rem auto 1rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #ced4da; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.2rem; font-family: 'Lato'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #fff0f3; color: #d90429; padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid #ffccd5; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2rem; grid-column: 1 / -1; font-style: italic; } /* Message for no search results */
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-8">
         <div class="container mx-auto px-4 py-4 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fas fa-map-marked-alt mr-3 text-yellow-500"></i> <!-- Icono mapa -->
                     Explorando Colombia
                     <i class="fas fa-city ml-3 text-green-600"></i> <!-- Icono ciudad -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Descubre la Riqueza de Colombia</h1>
             <p class="text-xl text-gray-700 mb-6 max-w-3xl mx-auto">Desde vibrantes ciudades hasta paisajes naturales impresionantes. Busca un destino o selecciona uno de la lista para comenzar tu viaje virtual.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-2xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar ciudad, pueblo o lugar...">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-6 text-center mx-auto">
                 <i class="fas fa-route text-blue-600 mr-2"></i> <!-- Icono ruta -->
                 Destinos Populares y Ocultos
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Cargando destinos...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Cargar M√°s Destinos
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Descubriendo informaci√≥n...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-100 text-gray-600 py-6 mt-12 border-t border-gray-300">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Descripciones generadas por IA con fines informativos y de inspiraci√≥n para viajar por Colombia.</p>
              <p class="mt-1">Verifica siempre la informaci√≥n pr√°ctica (horarios, precios, seguridad) antes de viajar.</p>
              <p class="mt-2">¬© 2025 Explorando Colombia</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // Capitales Departamentales (32)
            "Bogot√° D.C. (Cundinamarca)", "Medell√≠n (Antioquia)", "Cali (Valle del Cauca)", "Barranquilla (Atl√°ntico)", "Cartagena de Indias (Bol√≠var)", "Bucaramanga (Santander)", "C√∫cuta (Norte de Santander)", "Pereira (Risaralda)", "Manizales (Caldas)", "Armenia (Quind√≠o)", "Ibagu√© (Tolima)", "Villavicencio (Meta)", "Santa Marta (Magdalena)", "Pasto (Nari√±o)", "Monter√≠a (C√≥rdoba)", "Neiva (Huila)", "Popay√°n (Cauca)", "Tunja (Boyac√°)", "Sincelejo (Sucre)", "Valledupar (Cesar)", "Riohacha (La Guajira)", "Quibd√≥ (Choc√≥)", "Florencia (Caquet√°)", "Yopal (Casanare)", "Arauca (Arauca)", "San Jos√© del Guaviare (Guaviare)", "Mocoa (Putumayo)", "Leticia (Amazonas)", "In√≠rida (Guain√≠a)", "Mit√∫ (Vaup√©s)", "Puerto Carre√±o (Vichada)", "San Andr√©s Isla (San Andr√©s y Providencia)",
            // Ciudades Principales y Municipios Relevantes
            "Soacha (Cundinamarca)", "Bello (Antioquia)", "Soledad (Atl√°ntico)", "Itag√º√≠ (Antioquia)", "Envigado (Antioquia)", "Palmira (Valle del Cauca)", "Buenaventura (Valle del Cauca)", "Floridablanca (Santander)", "Gir√≥n (Santander)", "Dosquebradas (Risaralda)", "Tulu√° (Valle del Cauca)", "Cartago (Valle del Cauca)", "Magangu√© (Bol√≠var)", "Maicao (La Guajira)", "Pitalito (Huila)", "Fusagasug√° (Cundinamarca)", "Zipaquir√° (Cundinamarca)", "Facatativ√° (Cundinamarca)", "Ch√≠a (Cundinamarca)", "Sogamoso (Boyac√°)", "Duitama (Boyac√°)", "Oca√±a (Norte de Santander)", "Pamplona (Norte de Santander)", "Espinal (Tolima)", "Honda (Tolima)", "La Dorada (Caldas)", "Rionegro (Antioquia)", "Apartad√≥ (Antioquia)", "Turbo (Antioquia)", "Caucasia (Antioquia)", "Sabanalarga (Atl√°ntico)", "Malambo (Atl√°ntico)", "Lorica (C√≥rdoba)", "Sahag√∫n (C√≥rdoba)", "Montel√≠bano (C√≥rdoba)", "Aguachica (Cesar)", "Tumaco (Nari√±o)", "Ipiales (Nari√±o)", "Samaniego (Nari√±o)", "Garz√≥n (Huila)", "Santander de Quilichao (Cauca)", "Puerto Tejada (Cauca)", "Yumbo (Valle del Cauca)", "Jamund√≠ (Valle del Cauca)", "Guadalajara de Buga (Valle del Cauca)", "Ci√©naga (Magdalena)", "Fundaci√≥n (Magdalena)", "El Banco (Magdalena)", "Plato (Magdalena)", "San Gil (Santander)", "Socorro (Santander)", "Barbosa (Santander)", "V√©lez (Santander)", "Chiquinquir√° (Boyac√°)", "Villa de Leyva (Boyac√°)", "Paipa (Boyac√°)", "Moniquir√° (Boyac√°)", "Garagoa (Boyac√°)", "Santa Rosa de Cabal (Risaralda)", "La Virginia (Risaralda)", "Calarc√° (Quind√≠o)", "Montenegro (Quind√≠o)", "Quimbaya (Quind√≠o)", "Circasia (Quind√≠o)", "Anserma (Caldas)", "Riosucio (Caldas)", "Sup√≠a (Caldas)", "Salamina (Caldas)", "Aguadas (Caldas)", "Melgar (Tolima)", "Girardot (Cundinamarca)", "Villeta (Cundinamarca)", "Guaduas (Cundinamarca)", "Acac√≠as (Meta)", "Granada (Meta)", "San Mart√≠n (Meta)", "Puerto L√≥pez (Meta)", "Saravena (Arauca)", "Tame (Arauca)", "Fortul (Arauca)", "San Vicente del Cagu√°n (Caquet√°)", "Puerto As√≠s (Putumayo)", "Orito (Putumayo)", "Sibundoy (Putumayo)", "Puerto Legu√≠zamo (Putumayo)", "El Doncello (Caquet√°)", "Cartagena del Chair√° (Caquet√°)", "Calamar (Guaviare)", "Miraflores (Guaviare)", "El Retorno (Guaviare)", "Barranco Minas (Guain√≠a)", "Mapiripana (Guain√≠a)", "Carur√∫ (Vaup√©s)", "Taraira (Vaup√©s)", "Pacoa (Vaup√©s)", "La Primavera (Vichada)", "Santa Rosal√≠a (Vichada)", "Cumaribo (Vichada)", "Providencia Isla (San Andr√©s y Providencia)",
            // Pueblos Patrimonio y Destinos Tur√≠sticos Notables
            "Barichara (Santander)", "Salento (Quind√≠o)", "Filandia (Quind√≠o)", "Guatap√© (Antioquia)", "Jard√≠n (Antioquia)", "Santa Fe de Antioquia (Antioquia)", "Jeric√≥ (Antioquia)", "Mompox (Bol√≠var)", "Honda (Tolima)", "Villa de Leyva (Boyac√°)", "Mongu√≠ (Boyac√°)", "R√°quira (Boyac√°)", "Ci√©naga (Magdalena)", "Salamina (Caldas)", "Aguadas (Caldas)", "Guaduas (Cundinamarca)", "La Playa de Bel√©n (Norte de Santander)", "Lorica (C√≥rdoba)", "Socorro (Santander)", "Gir√≥n (Santander)", "Pore (Casanare)", "Buga (Valle del Cauca)", "Jambal√≥ (Cauca)", "Silvia (Cauca)", "Capurgan√° (Choc√≥)", "Nuqu√≠ (Choc√≥)", "Bah√≠a Solano (Choc√≥)", "Taganga (Magdalena)", "Palomino (La Guajira)", "Cabo de la Vela (La Guajira)", "Punta Gallinas (La Guajira)", "San Agust√≠n (Huila) - Parque Arqueol√≥gico", "Tierradentro (Cauca) - Parque Arqueol√≥gico", "Ca√±o Cristales (Meta) - 'R√≠o de los 5 Colores'", "Desierto de la Tatacoa (Huila)", "Santuario de Las Lajas (Nari√±o)", "Catedral de Sal de Zipaquir√° (Cundinamarca)", "Mina de Sal de Nemoc√≥n (Cundinamarca)", "Eje Cafetero / Paisaje Cultural Cafetero (PCC)", "Valle de Cocora (Quind√≠o)", "Parque Nacional Natural Tayrona (Magdalena)", "Ciudad Perdida (Teyuna) (Magdalena)", "Parque Nacional Natural El Cocuy (Boyac√°/Arauca)", "Parque Nacional Natural Los Nevados (Risaralda/Caldas/Tolima/Quind√≠o)", "Santuario de Fauna y Flora Ot√∫n Quimbaya (Risaralda)", "Santuario de Fauna y Flora Iguaque (Boyac√°)", "Parque Nacional Natural Chingaza (Cundinamarca/Meta)", "Parque Nacional Natural Amacayacu (Amazonas)", "Isla Gorgona (Cauca)", "Isla de Malpelo (Valle del Cauca)", "Archipi√©lago de San Bernardo (Sucre/Bol√≠var)", "Islas del Rosario (Bol√≠var)", "Volc√°n del Totumo (Bol√≠var)", "Termales de Santa Rosa de Cabal (Risaralda)", "Termales de Paipa (Boyac√°)", "Nevado del Ruiz", "Nevado del Tolima", "Nevado de Santa Isabel", "P√°ramo de Santurb√°n (Santander/Norte de Santander)", "P√°ramo de Sumapaz (Bogot√°/Cundinamarca/Meta/Huila)", "P√°ramo de Ocet√° (Boyac√°)",
            // Conceptos Culturales/Geogr√°ficos/Regionales
            "La Regi√≥n Caribe Colombiana", "La Regi√≥n Andina Colombiana", "La Regi√≥n Pac√≠fica Colombiana", "La Regi√≥n Orinoqu√≠a (Llanos Orientales)", "La Regi√≥n Amazon√≠a Colombiana", "La Regi√≥n Insular Colombiana", "El Paisaje Cultural Cafetero (PCC)", "¬øQu√© es un Pueblo Patrimonio de Colombia?", "La Candelaria (Centro Hist√≥rico de Bogot√°)", "Comuna 13 (Transformaci√≥n de Medell√≠n)", "Getseman√≠ (Barrio de Cartagena)", "El Choc√≥ Biogeogr√°fico", "La Sierra Nevada de Santa Marta", "La Serran√≠a de la Macarena", "Los Cerros Orientales de Bogot√°", "El R√≠o Magdalena", "El R√≠o Cauca", "El R√≠o Orinoco (en Colombia)", "El R√≠o Amazonas (en Colombia)", "El Golfo de Urab√°", "El Carnaval de Barranquilla", "La Feria de las Flores (Medell√≠n)", "El Carnaval de Negros y Blancos (Pasto)", "La Feria de Cali", "El Festival de la Leyenda Vallenata (Valledupar)", "Las Fiestas de San Pacho (Quibd√≥)", "El Festival del Bambuco (Neiva)", "El Festival Mono N√∫√±ez (Ginebra, Valle)", "La Semana Santa en Popay√°n", "El Festival de Teatro de Manizales", "El Festival Internacional de Cine de Cartagena (FICCI)", "La Ciclov√≠a de Bogot√°", "TransMilenio (Sistema de Transporte de Bogot√°)", "El Metro de Medell√≠n", "El Realismo M√°gico y Colombia", "La gastronom√≠a de la Regi√≥n Caribe", "La gastronom√≠a de la Regi√≥n Andina", "La gastronom√≠a de la Regi√≥n Pac√≠fica", "La gastronom√≠a de la Orinoqu√≠a", "La gastronom√≠a de la Amazon√≠a", "El caf√© colombiano: Proceso y cultura", "Las esmeraldas colombianas", "Artesan√≠as de R√°quira (Boyac√°)", "El Sombrero Vueltiao (Zen√∫ - C√≥rdoba/Sucre)", "La Ruana Boyacense", "Las Molas (Cultura Guna)", "El Vallenato (M√∫sica Tradicional)", "La Cumbia (M√∫sica y Danza)", "El Joropo (M√∫sica y Danza Llanera)", "La Salsa Cale√±a", "El Bambuco y el Pasillo Andino", "M√∫sica del Pac√≠fico Colombiano (Currulao, etc.)", "Comunidades Ind√≠genas de Colombia (Generalidades)", "Comunidades Afrocolombianas (Generalidades)", "El conflicto armado y su impacto (Contexto general)", "El proceso de paz en Colombia (Contexto general)", "La biodiversidad de Colombia", "Retos del turismo sostenible en Colombia",
            // Aeropuertos Principales (para contexto)
            "Aeropuerto El Dorado (Bogot√°)", "Aeropuerto Jos√© Mar√≠a C√≥rdova (Rionegro/Medell√≠n)", "Aeropuerto Alfonso Bonilla Arag√≥n (Palmira/Cali)", "Aeropuerto Ernesto Cortissoz (Soledad/Barranquilla)", "Aeropuerto Rafael N√∫√±ez (Cartagena)", "Aeropuerto Palonegro (Lebrija/Bucaramanga)", "Aeropuerto Mateca√±a (Pereira)", "Aeropuerto La Nubia (Manizales)", "Aeropuerto El Ed√©n (Armenia/La Tebaida)", "Aeropuerto Sim√≥n Bol√≠var (Santa Marta)", "Aeropuerto Camilo Daza (C√∫cuta)", "Aeropuerto Gustavo Rojas Pinilla (San Andr√©s Isla)", "Aeropuerto Alfredo V√°squez Cobo (Leticia)",
            // Estadios Principales (para contexto)
            "Estadio Metropolitano Roberto Mel√©ndez (Barranquilla)", "Estadio El Camp√≠n (Bogot√°)", "Estadio Atanasio Girardot (Medell√≠n)", "Estadio Pascual Guerrero (Cali)", "Estadio Palogrande (Manizales)", "Estadio Hern√°n Ram√≠rez Villegas (Pereira)"
        ];
        const colombiaThemes = [ // Temas para generar m√°s t√≠tulos
            "ciudades capitales de Colombia", "pueblos patrimonio de Colombia", "parques nacionales naturales de Colombia",
            "destinos tur√≠sticos del Eje Cafetero", "playas y costas de Colombia (Caribe)", "playas y selvas de Colombia (Pac√≠fico)",
            "destinos en la regi√≥n Andina", "los Llanos Orientales", "la Amazon√≠a colombiana", "la Guajira",
            "sitios arqueol√≥gicos de Colombia", "arquitectura colonial colombiana", "destinos de aventura en Colombia",
            "ecoturismo en Colombia", "festivales y carnavales de Colombia", "gastronom√≠a regional colombiana",
            "islas de Colombia", "r√≠os importantes de Colombia", "monta√±as y nevados de Colombia",
            "ciudades intermedias importantes", "pueblos cerca de Bogot√°", "pueblos cerca de Medell√≠n",
            "cultura cafetera", "historia precolombina de Colombia", "biodiversidad colombiana"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un apasionado escritor de viajes y ge√≥grafo especializado en Colombia. Tu tarea es describir y analizar ciudades, pueblos, regiones o sitios de inter√©s de Colombia de forma detallada, atractiva y objetiva para potenciales turistas, estudiantes o curiosos. Describe su ubicaci√≥n, breve historia, clima, principales atractivos tur√≠sticos (naturales y culturales), gastronom√≠a t√≠pica, consejos pr√°cticos (mejor √©poca para visitar, c√≥mo llegar, seguridad b√°sica), econom√≠a local y alguna curiosidad o caracter√≠stica √∫nica. Usa un lenguaje descriptivo y evocador, pero informativo. El objetivo es un art√≠culo de aproximadamente 1200-1300 palabras. Basa tu descripci√≥n √∫nicamente en el siguiente lugar o concepto colombiano:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Act√∫a como un generador de ideas conciso para una gu√≠a de viajes de Colombia. Genera exactamente 15 nombres de ciudades, pueblos, parques naturales, regiones o conceptos culturales/geogr√°ficos espec√≠ficos de Colombia, adecuados para ser descritos en detalle. Devuelve *solo* la lista de nombres, uno por l√≠nea. No incluyas n√∫meros, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ==========
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        // generateMoreSpinner is now within the button handled in JS
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content'); // Container for text AND image
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null; // Will be created if needed

        // ========== API FUNCTIONS ==========
        async function fetchTextFromApi(prompt, config) { /* ... Sin cambios ... */
            const encodedPrompt = encodeURIComponent(prompt);
            const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                const text = await response.text();
                if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vac√≠a.");
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') throw new Error(`La solicitud a la API tard√≥ demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                throw new Error(`Error de comunicaci√≥n con la API: ${error.message}`);
            }
        }
        async function fetchExplanationText(conceptTitle) { /* ... Sin cambios ... */
             const text = await fetchTextFromApi(conceptTitle, textApiConfig);
              if (text.trim().length < 800 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                   throw new Error("La IA no pudo generar una descripci√≥n adecuada o suficientemente detallada para este destino.");
               }
             return text;
        }
        async function fetchGeneratedTitles() { /* ... Sin cambios ... */
            const randomTheme = getRandomElement(colombiaThemes) || "destinos imperdibles de Colombia";
            const specificPrompt = `Genera 15 nombres de lugares o conceptos clave sobre ${randomTheme}`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 3 && line.length < 100); // Adjust length limits
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de destinos.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a COLOMBIA
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText.split('(')[0].trim() : "paisaje colombiano diverso"; // Remove dept/country for cleaner prompt
            // Prompt ENFOCADO en atm√≥sfera, paisaje, cultura
            const enhancedPrompt = `Vibrant, atmospheric digital painting capturing the essence of '${safePromptText}', Colombia. Focus on unique landmarks, natural landscapes (mountains, coast, jungle, desert), colorful architecture, or cultural elements. Warm, inviting light. Avoid text or map elements.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, map, diagram, chart, UI, interface, signature, watermark, multiple panels, collage, screenshot, photograph, dull colors, simple illustration";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... */
             if (!rawText) return '';
             let formatted = rawText.trim();
             // Basic Markdown-like formatting (keep it simple unless more is needed)
             formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
             formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
             formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
             formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
             formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
             formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
             // Paragraph handling: Split by double newlines, wrap non-header blocks in <p>
             const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
             formatted = blocks.map(block => {
                 if (block.startsWith('<h')) return block; // Keep existing headers
                 let content = block.replace(/\n/g, '<br>'); // Convert single newlines within block to <br>
                 return `<p>${content}</p>`;
             }).join('');
             return formatted;
        }

        // ========== MODAL FUNCTIONS ========== (Igual que versi√≥n anterior)
        function showModal() { if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() {
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0; // Reset scroll
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() {
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = ''; // Clears text and appended image/placeholder
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ==========
        function getRandomElement(arr) { if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }

        function displayTitles(titles) {
            if (!titleListContainer || !titlesLoading) return;
            const shuffledTitles = shuffleArray([...titles]);
            titleListContainer.innerHTML = ''; // Clear previous, including "no results"
            titlesLoading.style.display = 'none';
            if (shuffledTitles.length === 0) {
                showNoResultsMessage("No hay destinos iniciales disponibles.");
                return;
            }
            shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
            filterTitles(); // Apply current search filter immediately
         }

        function appendTitles(newTitles) {
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
            // Append new items respecting the current filter
            const searchTerm = searchInput.value.toLowerCase().trim();
            newTitles.forEach(title => {
                const item = createTitleItem(title);
                if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) {
                    item.style.display = 'flex'; // Show if matches filter or filter is empty
                } else {
                    item.style.display = 'none'; // Hide if doesn't match filter
                }
                titleListContainer.appendChild(item);
            });
            checkIfAnyResultsVisible(); // Update no results message if needed
        }

        // --- NEW: Search Filter Functionality ---
        function filterTitles() {
            if (!searchInput || !titleListContainer) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            const titleItems = titleListContainer.querySelectorAll('.title-item');
            let visibleCount = 0;

            titleItems.forEach(item => {
                const title = item.textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    item.style.display = 'flex'; // Or 'grid' if it was originally grid
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            updateNoResultsMessage(visibleCount);
        }

        function updateNoResultsMessage(visibleCount) {
             if (!titleListContainer) return;
             // Remove existing message first
             if (noResultsMessageElement) {
                 noResultsMessageElement.remove();
                 noResultsMessageElement = null;
             }
             // Add message if no items are visible AND the list isn't empty
             if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') {
                 showNoResultsMessage(`No se encontraron destinos para "${searchInput.value}"`);
             }
        }

        function showNoResultsMessage(message) {
             if (noResultsMessageElement || !titleListContainer) return; // Don't add if already exists
             noResultsMessageElement = document.createElement('p');
             noResultsMessageElement.id = 'no-results-message';
             noResultsMessageElement.textContent = message;
             titleListContainer.appendChild(noResultsMessageElement);
        }

        function checkIfAnyResultsVisible() {
             const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])');
             updateNoResultsMessage(visibleItems.length);
         }


        // *** MODIFIED: handleTitleClick (Image logic same as previous) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                // 1. Fetch and format text
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                // 2. Stop loading indicator, display text FIRST
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                 // 3. RESET SCROLL after text content is in and visible
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                // 4. Prepare and append image placeholder WITHIN #modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-camera-retro placeholder-icon"></i> <!-- Themed icon -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Generando postal visual...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // 5. Create and append the actual image element
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Imagen conceptual de ${title.split('(')[0].trim()}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-image-slash placeholder-icon"></i> <!-- Error icon -->
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la imagen.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement);
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = ''; // Clear partial content
            }
        }

        async function handleGenerateMoreTitles() {
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i'); // Get spinner inside button
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden'); // Show spinner
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Cargando..."; // Change text

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     // Temporarily hide button container while adding, then show again
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles); // Appends respecting filter
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer); // Ensure it's after the list
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se pudieron cargar m√°s destinos en este momento.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al cargar destinos: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden'); // Hide spinner
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Cargar M√°s Destinos"; // Restore text
                 checkIfAnyResultsVisible(); // Re-check visibility after adding
             }
         }


        // ========== INITIALIZATION ==========
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Cr√≠tico: No se pudo inicializar el mapa de Colombia.</p>'; return; }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            // --- Add Search Listener ---
            searchInput.addEventListener('input', filterTitles);
            // Display initial titles
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>