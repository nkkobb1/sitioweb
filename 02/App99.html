<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador de Ciudades del Mundo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Ciudades del Mundo --- */
        :root {
            --color-primary: #2a9d8f; /* Verde azulado (global, naturaleza) */
            --color-secondary: #e9c46a; /* Amarillo dorado (cultura, riqueza) */
            --color-background: #f4f4f4; /* Gris muy claro, limpio */
            --color-text: #264653; /* Azul oscuro/verde petr√≥leo (texto principal) */
            --color-text-muted: #6c757d; /* Gris medio */
            --color-modal-bg: #ffffff; /* Blanco */
            --color-border: #ced4da; /* Gris claro */
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.08), 0 1px 2px -1px rgb(0 0 0 / 0.08);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.08);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.08);
            --border-radius: 5px;
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Merriweather', serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-secondary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: var(--color-modal-bg); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.7rem; /* More padding for icon */
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
            color: var(--color-text);
        }
        #search-input::placeholder { color: var(--color-text-muted); opacity: 0.8; }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
        }
        #search-container .fa-search {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); gap: 1.3rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.3rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 600; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 75px; font-family: 'Lato', sans-serif; }
        .title-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: var(--color-primary); color: var(--color-primary); background-color: #e0f2f1; /* Light teal hover */ }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-primary); color: white; padding: 0.8rem 1.6rem; border: none; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: bold; cursor: pointer; transition: var(--transition-normal); margin-top: 1.8rem; }
        #generate-more-btn:hover:not(:disabled) { background-color: #248a7f; box-shadow: var(--shadow-sm); }
        #generate-more-btn:disabled { background-color: #90a4ae; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(38, 70, 83, 0.88); /* Darker overlay */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 980px; /* Slightly wider for global content */
            width: 95%;
            max-height: 90vh;
            min-height: 350px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--color-border);
        }
        .modal-close-btn { position: absolute; top: 12px; right: 12px; background: #e9ecef; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.5rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: #ced4da; color: #000; }
        #modal-title { font-size: 1.9rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1.5rem; line-height: 1.3; }
        #modal-content { /* Scrollable content area */
            line-height: 1.75;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px; /* Padding bottom for image space */
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-secondary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 9px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: 4px;}
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-secondary); border-radius: 4px; border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.3em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { color: #d97706; font-style: italic; } /* Darker yellow/orange emphasis */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Merriweather', serif; margin-top: 2em; margin-bottom: 1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.4em; font-weight: bold; }
        #modal-content h1 { font-size: 1.5em; }
        #modal-content h2 { font-size: 1.4em; }
        #modal-content h3 { font-size: 1.25em; color: #227c70; } /* Slightly darker primary */
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none;}
        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 85%; height: auto; margin: 2rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-sm); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2rem auto 1rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #ced4da; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.2rem; font-family: 'Lato'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { rotate: 360deg; } }
        .error-msg { background-color: #fff0f3; color: #d90429; padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid #ffccd5; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2rem; grid-column: 1 / -1; font-style: italic; } /* Message for no search results */
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-8">
         <div class="container mx-auto px-4 py-4 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fas fa-globe-americas mr-3 text-blue-500"></i> <!-- Icono globo -->
                     Explorador de Ciudades del Mundo
                     <i class="fas fa-building ml-3 text-yellow-600"></i> <!-- Icono edificio -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Descubre Metr√≥polis y Joyas Ocultas</h1>
             <p class="text-xl text-gray-700 mb-6 max-w-3xl mx-auto">Viaja virtualmente a trav√©s de continentes y culturas. Busca una ciudad o selecciona de la lista para iniciar tu exploraci√≥n.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-2xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar ciudad (ej: Par√≠s, Tokio, S√≠dney...)">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-6 text-center mx-auto">
                 <i class="fas fa-map-signs text-green-700 mr-2"></i> <!-- Icono se√±ales -->
                 Destinos Globales
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Cargando mapamundi...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Descubrir M√°s Destinos
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Explorando informaci√≥n...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-100 text-gray-600 py-6 mt-12 border-t border-gray-300">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Descripciones generadas por IA para inspirar la curiosidad y el conocimiento sobre ciudades del mundo.</p>
              <p class="mt-1">La informaci√≥n pr√°ctica puede variar; verifica siempre fuentes oficiales antes de viajar.</p>
              <p class="mt-2">¬© 2025 Explorador de Ciudades del Mundo</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // North America
            "Nueva York (EE. UU.)", "Los √Ångeles (EE. UU.)", "Chicago (EE. UU.)", "Toronto (Canad√°)", "Ciudad de M√©xico (M√©xico)", "Vancouver (Canad√°)", "Montreal (Canad√°)", "Washington D.C. (EE. UU.)", "San Francisco (EE. UU.)", "Miami (EE. UU.)", "Boston (EE. UU.)", "Seattle (EE. UU.)", "La Habana (Cuba)", "Canc√∫n (M√©xico)", "Las Vegas (EE. UU.)", "Filadelfia (EE. UU.)", "Houston (EE. UU.)", "Dallas (EE. UU.)", "Atlanta (EE. UU.)", "Denver (EE. UU.)", "San Diego (EE. UU.)", "Calgary (Canad√°)", "Ottawa (Canad√°)", "Quebec City (Canad√°)", "Guadalajara (M√©xico)", "Monterrey (M√©xico)", "Tijuana (M√©xico)", "Santo Domingo (Rep. Dominicana)", "San Juan (Puerto Rico)", "Kingston (Jamaica)", "Panama City (Panam√°)", "San Jos√© (Costa Rica)", "Guatemala City (Guatemala)", "Tegucigalpa (Honduras)", "San Salvador (El Salvador)", "Managua (Nicaragua)", "Belmop√°n (Belice)",
            // South America
            "Buenos Aires (Argentina)", "R√≠o de Janeiro (Brasil)", "S√£o Paulo (Brasil)", "Santiago (Chile)", "Lima (Per√∫)", "Bogot√° (Colombia)", "Caracas (Venezuela)", "Quito (Ecuador)", "Montevideo (Uruguay)", "La Paz (Bolivia)", "Asunci√≥n (Paraguay)", "Medell√≠n (Colombia)", "Cali (Colombia)", "Salvador (Brasil)", "Brasilia (Brasil)", "Recife (Brasil)", "Porto Alegre (Brasil)", "Belo Horizonte (Brasil)", "Curitiba (Brasil)", "Fortaleza (Brasil)", "Manaos (Brasil)", "Valpara√≠so (Chile)", "Cusco (Per√∫)", "Arequipa (Per√∫)", "Guayaquil (Ecuador)", "Maracaibo (Venezuela)", "Barranquilla (Colombia)", "C√≥rdoba (Argentina)", "Rosario (Argentina)", "Mendoza (Argentina)", "Punta del Este (Uruguay)", "Santa Cruz de la Sierra (Bolivia)", "Georgetown (Guyana)", "Paramaribo (Surinam)", "Cayena (Guayana Francesa)",
            // Europe
            "Londres (Reino Unido)", "Par√≠s (Francia)", "Roma (Italia)", "Berl√≠n (Alemania)", "Madrid (Espa√±a)", "Mosc√∫ (Rusia)", "Estambul (Turqu√≠a)", "√Åmsterdam (Pa√≠ses Bajos)", "Praga (Rep. Checa)", "Viena (Austria)", "Atenas (Grecia)", "Lisboa (Portugal)", "Dubl√≠n (Irlanda)", "Estocolmo (Suecia)", "Barcelona (Espa√±a)", "Mil√°n (Italia)", "M√∫nich (Alemania)", "San Petersburgo (Rusia)", "Bruselas (B√©lgica)", "Budapest (Hungr√≠a)", "Varsovia (Polonia)", "Copenhague (Dinamarca)", "Oslo (Noruega)", "Helsinki (Finlandia)", "Z√∫rich (Suiza)", "Ginebra (Suiza)", "Florencia (Italia)", "Venecia (Italia)", "N√°poles (Italia)", "Sevilla (Espa√±a)", "Valencia (Espa√±a)", "Oporto (Portugal)", "Manchester (Reino Unido)", "Liverpool (Reino Unido)", "Edimburgo (Reino Unido)", "Hamburgo (Alemania)", "Fr√°ncfort (Alemania)", "Colonia (Alemania)", "Marsella (Francia)", "Lyon (Francia)", "Niza (Francia)", "Cracovia (Polonia)", "Kiev (Ucrania)", // Note: Context sensitive
            "San Marino (San Marino)", "Ciudad del Vaticano", "M√≥naco", "Luxemburgo (Luxemburgo)", "Reykjavik (Islandia)", "Riga (Letonia)", "Tallin (Estonia)", "Vilna (Lituania)", "Bratislava (Eslovaquia)", "Liubliana (Eslovenia)", "Zagreb (Croacia)", "Belgrado (Serbia)", "Sarajevo (Bosnia y Herz.)", "Sof√≠a (Bulgaria)", "Bucarest (Ruman√≠a)", "Nicosia (Chipre)", "La Valeta (Malta)", "Andorra la Vieja (Andorra)", "Tirana (Albania)", "Skopie (Macedonia del Norte)", "Podgorica (Montenegro)", "Chisinau (Moldavia)", "Minsk (Bielorrusia)",
            // Asia
            "Tokio (Jap√≥n)", "Pek√≠n (China)", "Shangh√°i (China)", "Se√∫l (Corea del Sur)", "Bangkok (Tailandia)", "Singapur", "Hong Kong (China)", "Mumbai (India)", "Delhi (India)", "Dub√°i (EAU)", "Jerusal√©n (Israel/Palestina)", // Note: Complex status
            "Kioto (Jap√≥n)", "Osaka (Jap√≥n)", "Busan (Corea del Sur)", "Taip√©i (Taiw√°n)", "Ho Chi Minh City (Vietnam)", "Hanoi (Vietnam)", "Kuala Lumpur (Malasia)", "Yakarta (Indonesia)", "Manila (Filipinas)", "Calcuta (India)", "Bangalore (India)", "Chennai (India)", "Karachi (Pakist√°n)", "Lahore (Pakist√°n)", "Islamabad (Pakist√°n)", "Daca (Bangladesh)", "Teher√°n (Ir√°n)", "Bagdad (Irak)", "Riad (Arabia Saudita)", "La Meca (Arabia Saudita)", "Medina (Arabia Saudita)", "Doha (Qatar)", "Abu Dhabi (EAU)", "Mascate (Om√°n)", "San√° (Yemen)", "Am√°n (Jordania)", "Damasco (Siria)", "Beirut (L√≠bano)", "Ankara (Turqu√≠a)", "Taskent (Uzbekist√°n)", "Almaty (Kazajist√°n)", "Nur-Sult√°n (Astana) (Kazajist√°n)", "Biskek (Kirguist√°n)", "Dusamb√© (Tayikist√°n)", "Asjabad (Turkmenist√°n)", "Kabul (Afganist√°n)", "Katmand√∫ (Nepal)", "Timbu (But√°n)", "Colombo (Sri Lanka)", "Mal√© (Maldivas)", "Phnom Penh (Camboya)", "Vienti√°n (Laos)", "Naipyid√≥ (Myanmar)", "Yang√≥n (Myanmar)", "Ul√°n Bator (Mongolia)", "Pyongyang (Corea del Norte)",
            "Siem Reap (Camboya)", "Luang Prabang (Laos)", "Chiang Mai (Tailandia)", "Phuket (Tailandia)", "Bali (Denpasar) (Indonesia)", "Ceb√∫ (Filipinas)", "Goa (India)", "Petra (Jordania - sitio)", "Lhasa (China)", "Samarcanda (Uzbekist√°n)", "Bujar√° (Uzbekist√°n)",
            // Africa
            "El Cairo (Egipto)", "Lagos (Nigeria)", "Johannesburgo (Sud√°frica)", "Ciudad del Cabo (Sud√°frica)", "Nairobi (Kenia)", "Ad√≠s Abeba (Etiop√≠a)", "Casablanca (Marruecos)", "Accra (Ghana)", "Dakar (Senegal)", "Kinsasa (RD Congo)", "Luanda (Angola)", "Argel (Argelia)", "T√∫nez (T√∫nez)", "Tr√≠poli (Libia)", "Jartum (Sud√°n)", "Kampala (Uganda)", "Dar es Salaam (Tanzania)", "Dodoma (Tanzania)", "Maputo (Mozambique)", "Harare (Zimbabue)", "Lusaka (Zambia)", "Windhoek (Namibia)", "Gaborone (Botsuana)", "Antananarivo (Madagascar)", "Port Louis (Mauricio)", "Abuja (Nigeria)", "Abiy√°n (Costa de Marfil)", "Yaund√© (Camer√∫n)", "Duala (Camer√∫n)", "Uagadug√∫ (Burkina Faso)", "Bamako (Mal√≠)", "Niamey (N√≠ger)", "N'Djamena (Chad)", "Bangui (Rep. Centroafricana)", "Brazzaville (Rep. del Congo)", "Libreville (Gab√≥n)", "Malabo (Guinea Ecuatorial)", "Lom√© (Togo)", "Porto Novo (Ben√≠n)", "Coton√∫ (Ben√≠n)", "Freetown (Sierra Leona)", "Monrovia (Liberia)", "Conakry (Guinea)", "Bissau (Guinea-Bissau)", "Praia (Cabo Verde)", "Nuakchot (Mauritania)", "Rabat (Marruecos)", "Marrakech (Marruecos)", "Fez (Marruecos)", "Luxor (Egipto)", "Alejandr√≠a (Egipto)", "Asu√°n (Egipto)", "Mombasa (Kenia)", "Zanz√≠bar (Tanzania)", "Timbuct√∫ (Mal√≠)", "Djenn√© (Mal√≠)", "Victoria (Seychelles)",
            // Oceania
            "S√≠dney (Australia)", "Melbourne (Australia)", "Auckland (Nueva Zelanda)", "Wellington (Nueva Zelanda)", "Brisbane (Australia)", "Perth (Australia)", "Adelaida (Australia)", "Canberra (Australia)", "Hobart (Australia)", "Christchurch (Nueva Zelanda)", "Queenstown (Nueva Zelanda)", "Suva (Fiyi)", "Nadi (Fiyi)", "Port Moresby (Pap√∫a Nueva Guinea)", "Honolulu (EE. UU. - Haw√°i)", "Apia (Samoa)", "Nukualofa (Tonga)", "Port Vila (Vanuatu)", "Honiara (Islas Salom√≥n)", "Papeete (Polinesia Francesa)", "Numea (Nueva Caledonia)",
            // Conceptos / Regiones
            "Las Megaciudades del Mundo", "Capitales Europeas Cl√°sicas", "Ciudades Antiguas del Mediterr√°neo", "Centros Financieros Globales", "Ciudades Patrimonio de la Humanidad (UNESCO)", "Destinos de Viaje Emblem√°ticos", "Ciudades con Mejor Calidad de Vida", "Ciudades m√°s Visitadas del Mundo", "Rutas Comerciales Hist√≥ricas (Ej: Ruta de la Seda)", "Ciudades Fluviales Importantes", "Ciudades Costeras Paradis√≠acas", "Ciudades en Regiones Monta√±osas", "La Rivalidad entre Ciudades (Ej: S√≠dney vs Melbourne)", "Ciudades Conocidas por su Arquitectura", "Ciudades Famosas por su Gastronom√≠a", "Centros de Arte y Cultura Mundiales", "Ciudades Tecnol√≥gicas (Silicon Valley, etc.)", "Ciudades Universitarias Reconocidas", "Ciudades Sagradas para Diferentes Religiones", "Ciudades Resilientes al Cambio Clim√°tico", "El concepto de 'Ciudad Global'", "Urbanizaci√≥n y Crecimiento Poblacional", "Ciudades Inteligentes (Smart Cities)", "Transporte P√∫blico en Grandes Metr√≥polis", "Desaf√≠os de las Grandes Ciudades (Contaminaci√≥n, Tr√°fico)", "La vida nocturna en diferentes ciudades", "Parques Urbanos Ic√≥nicos", "Mercados Famosos del Mundo"
        ];
        const worldThemes = [ // Temas para generar m√°s t√≠tulos
            "capitales de Europa", "capitales de Asia", "capitales de √Åfrica", "capitales de Am√©rica", "megaciudades asi√°ticas",
            "ciudades importantes de EE. UU.", "ciudades hist√≥ricas de Italia", "ciudades costeras del Mediterr√°neo",
            "destinos tur√≠sticos del sudeste asi√°tico", "centros culturales de Sudam√©rica", "ciudades imperiales chinas",
            "principales ciudades de Alemania", "ciudades patrimonio de la Humanidad en Am√©rica Latina", "ciudades portuarias del mundo",
            "destinos ex√≥ticos poco conocidos", "ciudades conocidas por su arquitectura moderna", "centros financieros internacionales",
            "ciudades antiguas de Oriente Medio", "islas-ciudad del mundo", "ciudades en rutas comerciales famosas",
            "destinos de lujo en el mundo", "ciudades universitarias de renombre", "oasis urbanos y parques famosos"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un experto escritor de viajes y ge√≥grafo cultural con conocimiento enciclop√©dico del mundo. Tu tarea es describir y analizar ciudades globales de forma detallada, cautivadora y objetiva para viajeros, estudiantes y entusiastas de la geograf√≠a. Describe su ubicaci√≥n (pa√≠s, continente), breve historia relevante, clima general, principales hitos y atracciones (culturales, hist√≥ricos, naturales), gastronom√≠a destacada, consejos pr√°cticos (moneda, idioma principal, mejor √©poca para visitar, transporte), ambiente general, econom√≠a y un aspecto cultural √∫nico o curiosidad. El objetivo es un art√≠culo completo de aproximadamente 1200-1300 palabras. Basa tu descripci√≥n √∫nicamente en la siguiente ciudad o concepto global:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Act√∫a como un generador de ideas conciso para una enciclopedia global de viajes. Genera exactamente 15 nombres de ciudades importantes, capitales, centros culturales o regiones urbanas significativas de *diferentes partes del mundo*. Devuelve *solo* la lista de nombres (preferiblemente con el pa√≠s entre par√©ntesis), uno por l√≠nea. No incluyas n√∫meros, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ========== (Igual que versi√≥n anterior)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null;

        // ========== API FUNCTIONS ========== (Igual que versi√≥n anterior)
        async function fetchTextFromApi(prompt, config) { /* ... */
            const encodedPrompt = encodeURIComponent(prompt);
            const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                const text = await response.text();
                if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vac√≠a.");
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') throw new Error(`La solicitud a la API tard√≥ demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                throw new Error(`Error de comunicaci√≥n con la API: ${error.message}`);
            }
        }
        async function fetchExplanationText(conceptTitle) { /* ... */
            const text = await fetchTextFromApi(conceptTitle, textApiConfig);
            if (text.trim().length < 800 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                throw new Error("La IA no pudo generar una descripci√≥n adecuada o suficientemente detallada para esta ciudad/concepto.");
            }
            return text;
        }
        async function fetchGeneratedTitles() { /* ... */
            const randomTheme = getRandomElement(worldThemes) || "ciudades fascinantes del mundo";
            const specificPrompt = `Genera 15 nombres de ciudades o conceptos urbanos globales sobre ${randomTheme}`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 3 && line.length < 100);
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de destinos.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a CIUDADES DEL MUNDO
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText.split('(')[0].trim() : "global cityscape diverse"; // Extract city name
            const enhancedPrompt = `Impressionistic digital painting capturing the unique atmosphere of ${safePromptText}. Focus on iconic landmarks, skyline, street scene, or cultural element characteristic of the city. Evocative lighting (day, night, sunset). Avoid text, logos, or map elements.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, map, diagram, chart, UI, interface, signature, watermark, multiple panels, collage, generic illustration, photograph, poor quality";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... */
             if (!rawText) return '';
             let formatted = rawText.trim();
             formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
             formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
             formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
             formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
             formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
             formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
             const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
             formatted = blocks.map(block => {
                 if (block.startsWith('<h')) return block;
                 let content = block.replace(/\n/g, '<br>');
                 return `<p>${content}</p>`;
             }).join('');
             return formatted;
        }

        // ========== MODAL FUNCTIONS ========== (Igual que versi√≥n anterior)
        function showModal() { /* ... */ if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { /* ... */
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() { /* ... */
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = '';
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ========== (Igual que versi√≥n anterior, con search)
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... */
            if (!titleListContainer || !titlesLoading) return;
            const shuffledTitles = shuffleArray([...titles]);
            titleListContainer.innerHTML = '';
            titlesLoading.style.display = 'none';
            if (shuffledTitles.length === 0) {
                showNoResultsMessage("No hay destinos iniciales disponibles.");
                return;
            }
            shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
            filterTitles();
         }
        function appendTitles(newTitles) { /* ... */
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            newTitles.forEach(title => {
                const item = createTitleItem(title);
                if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
                titleListContainer.appendChild(item);
            });
            checkIfAnyResultsVisible();
        }
        function filterTitles() { /* ... */
            if (!searchInput || !titleListContainer) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            const titleItems = titleListContainer.querySelectorAll('.title-item');
            let visibleCount = 0;
            titleItems.forEach(item => {
                const title = item.textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    item.style.display = 'flex';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            updateNoResultsMessage(visibleCount);
        }
        function updateNoResultsMessage(visibleCount) { /* ... */
             if (!titleListContainer) return;
             if (noResultsMessageElement) {
                 noResultsMessageElement.remove();
                 noResultsMessageElement = null;
             }
             if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') {
                 showNoResultsMessage(`No se encontraron ciudades para "${searchInput.value}"`);
             }
        }
        function showNoResultsMessage(message) { /* ... */
             if (noResultsMessageElement || !titleListContainer) return;
             noResultsMessageElement = document.createElement('p');
             noResultsMessageElement.id = 'no-results-message';
             noResultsMessageElement.textContent = message;
             titleListContainer.appendChild(noResultsMessageElement);
        }
        function checkIfAnyResultsVisible() { /* ... */
             const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])');
             updateNoResultsMessage(visibleItems.length);
         }
        async function handleTitleClick(title) { /* ... (L√≥gica de imagen igual a la anterior) */
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-landmark placeholder-icon"></i> <!-- Themed icon -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Creando vista panor√°mica...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Imagen conceptual de ${title.split('(')[0].trim()}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-image-slash placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la imagen.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement);
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }
            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
            }
        }
        async function handleGenerateMoreTitles() { /* ... (L√≥gica igual a la anterior) */
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i');
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden');
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Descubriendo...";

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer);
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se pudieron descubrir m√°s destinos en este momento.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al descubrir destinos: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden');
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Descubrir M√°s Destinos";
                 checkIfAnyResultsVisible();
             }
         }

        // ========== INITIALIZATION ========== (Igual que versi√≥n anterior)
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Cr√≠tico: No se pudo inicializar el explorador global.</p>'; return; }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            searchInput.addEventListener('input', filterTitles);
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>