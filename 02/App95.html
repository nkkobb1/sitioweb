<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetas para Cenas Familiares</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fuentes cálidas y legibles -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Recetas Familiares --- */
        :root {
            --color-primary: #f97316; /* Naranja Cálido (Apetito, Hogar) */
            --color-secondary: #854d0e; /* Marrón Tostado (Tierra, Ingredientes) */
            --color-tertiary: #4d7c0f; /* Verde Oliva (Fresco, Saludable) */
            --color-background: #fffbeb; /* Crema muy pálido (Limpieza, Calidez) */
            --color-text: #3f3f46; /* Gris Oscuro Neutro */
            --color-text-muted: #71717a;
            --color-modal-bg: #ffffff; /* Blanco limpio para modal */
            --color-border: #f3f4f6; /* Borde gris muy claro */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 8px; /* Bordes más suaves */
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Quicksand', sans-serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-secondary); font-weight: 700; }
        h2.section-title { color: var(--color-primary); border-bottom: 3px solid var(--color-secondary); padding-bottom: 0.6rem; display: inline-block; font-weight: 700;}
        #modal-title { color: var(--color-secondary); font-weight: 700; }
        .navbar { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }
        /* Estilos Buscador */
        #search-container { margin-bottom: 2rem; position: relative; }
        #search-input { width: 100%; padding: 0.9rem 1rem 0.9rem 2.8rem; border: 1px solid #e5e7eb; border-radius: var(--border-radius); font-size: 1rem; box-shadow: var(--shadow-sm); transition: var(--transition-normal); background-color: white; }
        #search-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2); outline: none; }
        #search-container .fa-search { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--color-text-muted); font-size: 1.1rem; }

        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1.25rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.3rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-md); cursor: pointer; transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; text-align: center; font-weight: 500; color: var(--color-text); border: 1px solid var(--color-border); display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 75px; font-family: 'Quicksand', sans-serif; font-size: 1rem; }
        .title-item i { font-size: 1.3rem; margin-bottom: 0.5rem; color: var(--color-primary); transition: color 0.2s; }
        .title-item:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); /* Sombra más pronunciada */ }
        .title-item:hover i { color: var(--color-secondary); }
        #generate-more-btn { grid-column: 1 / -1; background: linear-gradient(to right, var(--color-primary), #fb923c); color: white; padding: 0.8rem 1.6rem; border: none; border-radius: 30px; /* Botón más redondeado */ font-family: 'Quicksand', sans-serif; font-weight: 700; cursor: pointer; transition: var(--transition-normal); margin-top: 2rem; box-shadow: var(--shadow-md); }
        #generate-more-btn:hover:not(:disabled) { background: linear-gradient(to right, #ea580c, var(--color-primary)); box-shadow: var(--shadow-lg); transform: scale(1.03); }
        #generate-more-btn:disabled { background: #d1d5db; color: #9ca3af; cursor: not-allowed; opacity: 0.8; box-shadow: none; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(50, 50, 50, 0.88); /* Overlay gris más oscuro */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            min-height: 350px; /* Altura mínima para carga */
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #f3f4f6; border: none; border-radius: 50%; width: 38px; height: 38px; font-size: 1.6rem; color: var(--color-text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: var(--color-primary); color: #ffffff; transform: rotate(180deg); }
        #modal-title { font-size: 2rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }
        #modal-content {
            line-height: 1.8;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px;
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 9px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.4em; }
        #modal-content strong { color: var(--color-secondary); font-weight: bold; }
        #modal-content em { color: var(--color-tertiary); font-style: italic; }
        #modal-content ul, #modal-content ol { margin-left: 1.5em; margin-bottom: 1.4em; }
        #modal-content li { margin-bottom: 0.6em; }
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Quicksand', sans-serif; margin-top: 2.2em; margin-bottom: 1.1em; color: var(--color-primary); border-bottom: 2px solid #fed7aa; /* Borde naranja claro */ padding-bottom: 0.5em; font-weight: bold; }
        #modal-content h1 { font-size: 1.5em; }
        #modal-content h2 { font-size: 1.35em; }
        #modal-content h3 { font-size: 1.2em; color: var(--color-secondary); }
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none;}
        /* Estilos para imagen y placeholder dentro del contenido */
        #modal-content .final-image { display: block; max-width: 90%; height: auto; margin: 2.5rem auto 1rem auto; border: 1px solid #fde68a; /* Borde amarillo pálido */ border-radius: var(--border-radius); box-shadow: var(--shadow-md); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 180px; margin: 2.5rem auto 1rem auto; color: var(--color-text-muted); }
        #modal-content .image-placeholder .spinner { border: 5px solid rgba(200, 200, 200, 0.2); width: 45px; height: 45px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 1rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 251, 235, 0.98); /* Fondo crema casi opaco */ display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #fed7aa; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-secondary); font-size: 1.3rem; font-family: 'Quicksand'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #fff1f2; color: #be123c; padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid #fecdd3; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: 500; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        .title-item.hidden { display: none; } /* Para ocultar con buscador */
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-8">
         <div class="container mx-auto px-4 py-3 flex flex-col sm:flex-row justify-between items-center">
             <div class="flex items-center text-center mb-2 sm:mb-0">
                 <h1 class="logo text-3xl sm:text-4xl">
                     <i class="fas fa-utensils mr-2 text-orange-500"></i> <!-- Icono utensilios -->
                     Cenas Familiares
                 </h1>
             </div>
             <span class="text-sm text-gray-600 font-family-quicksand">🍽️ Inspiración para tu mesa</span>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">¡Ideas Deliciosas para Cada Noche!</h1>
             <p class="text-lg text-gray-700 mb-8 max-w-3xl mx-auto">Encuentra la receta perfecta para compartir en familia. Desde clásicos reconfortantes hasta nuevas aventuras culinarias. ¡Busca o explora!</p>
         </section>

         <!-- Search Bar -->
         <section id="search-container" class="mb-8 max-w-2xl mx-auto">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Buscar receta (pollo, pasta, vegetariana...)">
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-6 text-center mx-auto">
                 <i class="fas fa-book-sparkles text-green-700 mr-2"></i> <!-- Icono libro mágico -->
                 Nuestro Recetario
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Cargando recetas...</p>
                  <!-- Los .title-item (recetas) se añadirán aquí -->
             </div>
             <p id="no-results" class="text-gray-500 col-span-full text-center text-lg mt-4 hidden">¡Ups! No encontramos recetas con ese nombre.</p>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     ¡Quiero Más Ideas!
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Cocinando la receta...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-xl md:text-2xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - La imagen se añadirá aquí al final -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Recipe text (HTML) goes here -->
                     <!-- La imagen y su placeholder/spinner se añadirán aquí vía JS -->
                 </div>
                  <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-orange-50 text-orange-900 py-6 mt-12 border-t border-orange-200">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Recetas generadas por IA para inspiración culinaria. ¡Ajusta a tu gusto y disfruta!</p>
              <p class="mt-1">Cocina con amor ❤️</p>
              <p class="mt-2">© 2025 Recetas Familiares AI</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // --- POLLO ---
            "Pollo Asado Clásico con Patatas Panaderas", "Pechugas de Pollo al Limón y Romero", "Pollo al Ajillo Tradicional", "Pollo Teriyaki Casero con Arroz Blanco", "Pollo al Curry Suave con Leche de Coco", "Fajitas de Pollo con Pimientos y Cebolla", "Muslos de Pollo al Horno con Hierbas Provenzales", "Pollo a la Naranja Estilo Oriental", "Pollo Tikka Masala Simplificado", "Pollo Marsala con Champiñones", "Pollo Cordon Bleu Fácil al Horno", "Alitas de Pollo BBQ Caseras", "Brochetas de Pollo y Verduras a la Parrilla", "Sopa de Pollo Reconfortante con Fideos", "Ensalada César con Pollo a la Plancha", "Pollo Guisado con Verduras de Temporada", "Pastel de Pollo Cremoso (Chicken Pot Pie)", "Pollo Frito Estilo Sureño (Versión Horno)", "Arroz con Pollo Casero", "Pollo a la Mostaza y Miel", "Tacos de Pollo Desmechado", "Pollo Kung Pao Fácil", "Pechugas Rellenas de Espinacas y Queso Feta", "Pollo a la Cerveza", "Pollo Empanado Crujiente al Horno", "Satay de Pollo con Salsa de Cacahuete", "Cazuela de Pollo y Brócoli con Queso", "Pollo a la Parmesana Clásico", "Salteado de Pollo con Anacardos", "Caldo Tlalpeño Sencillo", "Muslitos de Pollo Agridulces", "Pinchos Morunos de Pollo", "Pollo al Chilindrón", "Escalopes de Pollo a la Milanesa", "Pollo Yakitori Casero", "Sándwiches de Pollo Desmechado BBQ (Pulled Chicken)", "Pollo en Pepitoria Tradicional", "Ensalada de Pollo Cremosa para Rellenar", "Pollo con Almendras Chino", "Lasaña de Pollo y Espinacas", "Croquetas Caseras de Pollo", "Quiche de Pollo y Champiñones", "Canelones de Pollo Gratinados", "Albóndigas de Pollo en Salsa de Tomate", "Tinga de Pollo Mexicana", "Pollo General Tso's (Versión más ligera)", "Wraps de Pollo y Aguacate", "Pollo Relleno Asado para Ocasiones", "Fricasé de Pollo Cubano", "Pollo Kiev Clásico",
            // --- CARNE DE RES / TERNERA ---
            "Estofado de Ternera con Patatas y Zanahorias", "Carne Guisada Tradicional", "Albóndigas en Salsa Española", "Ropa Vieja Cubana", "Lomo de Ternera Strogonoff", "Pastel de Carne Clásico (Meatloaf)", "Hamburguesas Caseras Jugosas", "Chili con Carne Tex-Mex", "Salteado de Ternera con Brócoli", "Bistecs a la Plancha con Salsa de Champiñones", "Lomo Alto al Horno con Hierbas", "Ragú de Ternera para Pasta (Boloñesa)", "Tacos de Carne Asada", "Ternera a la Jardinera", "Filetes Rusos Caseros", "Brochetas de Ternera Marinadas", "Carne Mechada Venezolana", "Ossobuco a la Milanesa", "Goulash Húngaro Simplificado", "Shepherd's Pie (Pastel de Pastor con Cordero o Ternera)", "Fricandó de Ternera con Setas", "Rollitos de Ternera Rellenos en Salsa", "Ternera con Pimientos Estilo Chino", "Asado Negro Venezolano", "Solomillo de Ternera Wellington (Versión Simplificada)", "Carne Fiesta Canaria", "Empanadas de Carne Argentinas (Relleno)", "Picadillo Cubano", "Mongolian Beef Fácil", "Bistec Encebollado", "Round Steak a la Cacerola", "Salisbury Steak con Salsa Gravy", "Sloppy Joes Caseros", "Estofado Irlandés de Cordero (o Ternera)", "Ternera Bourguignon Clásica", "Kefta Marroquí (Albóndigas Especiadas)", "Lomo Saltado Peruano", "Carne Asada al Horno Lenta", "Fajitas de Ternera", "Brochetas de Albóndigas con Verduras", "Caldereta de Cordero (o Ternera)", "Steak Tartar (Preparación Segura)", "Vitel Toné (Versión Cena)", "Pastel de Patata y Carne Molida", "Pimientos Rellenos de Carne y Arroz", "Lasaña Boloñesa Clásica", "Moussaka Griega (con Ternera o Cordero)", "Empanada Gallega de Carne", "Carne con Tomate Andaluza",
            // --- CERDO ---
            "Lomo de Cerdo Asado con Manzanas", "Chuletas de Cerdo a la Plancha con Ajo y Perejil", "Solomillo de Cerdo a la Mostaza Antigua", "Costillas de Cerdo BBQ al Horno", "Cerdo Agridulce Estilo Chino", "Pulled Pork (Cerdo Desmechado) en Olla Lenta", "Chuletas de Cerdo en Salsa de Champiñones", "Codillo de Cerdo Asado Estilo Alemán", "Lomo de Cerdo Relleno de Ciruelas y Bacon", "Secreto Ibérico a la Plancha", "Carrilleras de Cerdo al Vino Tinto", "Fricandó de Cerdo", "Escalopes de Cerdo (Schnitzel)", "Magro con Tomate", "Cinta de Lomo Adobada Casera", "Solomillo de Cerdo a la Pimienta Verde", "Pinchos Morunos de Cerdo", "Chuletas a la Villaroy", "Tacos al Pastor Caseros", "Char Siu (Cerdo Asado Chino) Simplificado", "Manitas de Cerdo en Salsa", "Cassoulet Francés (Versión Simplificada con Cerdo)", "Feijoada Brasileña (Versión Rápida)", "Coctel de Camarones (Entrante)", // (Oops, cerdo) "Cerdo Tonkatsu Japonés", "Lomo de Cerdo a la Sal", "Pernil Asado Navideño (o cualquier día)", "Chicharrones Caseros (Corteza Crujiente)", "Sopa de Lentejas con Chorizo", "Potaje de Garbanzos con Cerdo", "Fabada Asturiana (con Compango)", "Cocido Madrileño (Parte de Cerdo)", "Arroz al Horno Valenciano (con Costillas/Morcilla)", "Salchichas Frescas con Puré de Patatas y Gravy", "Pastel de Carne con Puré (usando cerdo molido)", "Albóndigas de Cerdo Suecas (Köttbullar)", "Lomo de Cerdo a la Naranja", "Chuletas de Cerdo con Piña a la Plancha", "Gyros de Cerdo Caseros", "Salteado de Cerdo y Verduras con Salsa Hoisin", "Cerdo Estofado con Cerveza Negra", "Picadillo de Cerdo para Empanadas", "Lasaña con Ragú de Cerdo", "Canelones Rellenos de Carne de Cerdo", "Pozole Rojo o Blanco (con Cerdo)", "Cochinita Pibil Yucateca", "Chuletas de Cerdo a la Riojana", "Solomillo de Cerdo con Salsa Roquefort", "Estofado de Cerdo con Patatas",
            // --- PESCADO Y MARISCO ---
            "Salmón al Horno con Verduras", "Merluza en Salsa Verde con Almejas", "Bacalao a la Vizcaína", "Dorada a la Sal", "Lubina al Horno con Patatas Panaderas", "Atún Encebollado", "Sardinas a la Plancha con Ajo y Perejil", "Boquerones Fritos a la Andaluza", "Gambas al Ajillo", "Mejillones a la Marinera", "Calamares en su Tinta", "Arroz a Banda", "Paella de Marisco Simplificada", "Fideuá de Marisco", "Zarzuela de Pescado y Marisco", "Sopa de Pescado y Marisco", "Pastel de Cabracho (Pudding)", "Pulpo a la Gallega (Polbo á Feira)", "Salpicón de Marisco", "Langostinos a la Plancha", "Vieiras Gratinadas", "Ceviche Peruano Clásico", "Tacos de Pescado Estilo Baja California", "Salmón a la Plancha con Salsa de Eneldo", "Merluza a la Romana", "Tortilla de Camarones", "Fish and Chips Casero (Versión Horno)", "Bacalao con Tomate", "Rodaballo al Horno", "Marmitako de Bonito", "Ensalada de Pasta con Atún y Huevo", "Croquetas de Bacalao", "Empanada de Atún Gallega", "Pastel de Pescado Blanco con Puré", "Cazuela de Mariscos Colombiana", "Pescado Frito Entero", "Salmón Teriyaki", "Brochetas de Gambas y Piña", "Almejas a la Marinera", "Navajas a la Plancha", "Sopa de Almejas (Clam Chowder)", "Curry de Gambas Tailandés", "Ensaladilla Rusa (con Atún/Gambas)", "Guiso Marinero de Patatas con Choco", "Pescado al Limón y Alcaparras (Piccata)", "Bacalao Dorado (Bacalhau à Brás)", "Calamares a la Romana", "Cangrejos de Río en Salsa Americana", "Arroz Negro con Sepia", "Salmón en Costra de Hojaldre", "Tarta de Atún y Pimientos", "Aguacates Rellenos de Atún o Gambas", "Brandada de Bacalao",
            // --- VEGETARIANO / VEGANO ---
            "Lentejas Estofadas con Verduras (Vegetariano/Vegano)", "Curry de Garbanzos y Espinacas", "Chili Vegetariano de Frijoles Negros y Maíz", "Lasaña de Verduras con Bechamel (o Vegana)", "Pimientos Rellenos de Arroz y Verduras (Vegano)", "Hamburguesas Vegetarianas Caseras (Lentejas, Garbanzos, Quinoa)", "Albóndigas Vegetarianas en Salsa de Tomate", "Pasta Primavera con Verduras de Temporada", "Salteado de Tofu y Verduras con Salsa de Soja", "Quiche de Verduras y Queso (Vegetariano)", "Berenjenas Rellenas de Soja Texturizada (Vegano)", "Pastel de Patata Vegetariano (con Lentejas)", "Tacos Vegetarianos de Lentejas o Champiñones", "Curry Rojo Tailandés Vegetal con Tofu", "Sopa Minestrone Italiana", "Crema de Calabaza Asada", "Ensalada de Quinoa Completa", "Risotto de Champiñones (Vegetariano/Vegano con caldo vegetal)", "Moussaka Vegetariana (con Lentejas o Berenjena)", "Empanada Gallega de Verduras", "Falafel Casero con Ensalada y Pan Pita", "Hummus Casero con Crudités", "Wrap de Falafel y Verduras", "Guiso de Patatas a la Importancia (Vegetariano)", "Potaje de Vigilia (Garbanzos, Espinacas, Bacalao - Omitir bacalao para Veg)", "Coliflor Asada Entera con Especias", "Brócoli Gratinado con Bechamel (o Vegana)", "Tarta Pascualina de Espinacas y Ricotta (Vegetariano)", "Pasta al Pesto con Tomates Cherry", "Ratatouille Francés", "Curry Verde Vegetal", "Sopa de Tomate Casera con Picatostes", "Hojaldre Relleno de Verduras", "Fideos Chinos Salteados con Verduras y Tofu", "Canelones de Espinacas y Ricotta (o Tofu)", "Croquetas de Champiñones o Espinacas", "Tortilla de Patatas Española", "Pisto Manchego", "Pizza Vegetariana Casera", "Tofu Revuelto (Scrambled Tofu)", "Dal Makhani (Lentejas Indias Cremosas - Vegano posible)", "Chana Masala (Curry de Garbanzos Indio)", "Pad Thai Vegetariano/Vegano", "Arepas Rellenas Vegetarianas (Queso, Aguacate, Frijoles)", "Berenjenas a la Parmesana (Vegetariano)", "Calabacines Rellenos de Quinoa",
            // --- PASTA Y ARROCES (Como plato principal) ---
            "Lasaña Clásica Boloñesa", "Espaguetis a la Carbonara (Receta Original o con Nata)", "Pasta al Pesto Genovese", "Macarrones con Queso Gratinados (Mac and Cheese)", "Fettuccine Alfredo Casero", "Pasta con Albóndigas en Salsa de Tomate", "Canelones de Carne Gratinados", "Pasta Puttanesca", "Espaguetis con Gambas al Ajillo", "Arroz al Horno Valenciano", "Risotto de Setas Cremoso", "Paella Valenciana (Tradicional)", "Arroz Negro con Alioli", "Arroz a la Cubana", "Arroz Frito Tres Delicias", "Arroz Caldoso con Bogavante (Ocasión Especial)", "Pasta con Salmón y Nata", "Tallarines con Salsa de Champiñones", "Pasta e Fagioli (Sopa Italiana)", "Orzo Cremoso con Verduras", "Arroz con Leche (Postre, pero podría ser cena ligera)", "Arroz con Bogavante (Meloso)", "Nasi Goreng (Arroz Frito Indonesio)", "Pasta con Brócoli y Anchoas", "Gnocchi Caseros con Salsa de Salvia y Mantequilla", "Raviolis Rellenos con Salsa de Nuez", "Espaguetis Vongole (con Almejas)", "Pasta alla Norma (Berenjena y Ricotta Salata)", "Timbal de Arroz y Verduras", "Arroz Pilaf", "Pasta al Limone", "Macarrones con Chorizo", "Fideuá Negra", "Arroz con Verduras de Temporada", "Pasta Gratinada con Atún", "Ensalada de Pasta Mediterránea", "Lasaña Vegetariana", "Risotto Primavera", "Arroz con Costra (Elche)", "Pasta con Sardinas (Pasta con le Sarde)",
            // --- GUISOS, SOPAS Y CAZUELAS ---
            "Lentejas Caseras de la Abuela", "Potaje de Garbanzos con Espinacas", "Fabada Asturiana", "Cocido Madrileño Completo", "Sopa de Cebolla Francesa Gratinada", "Crema de Verduras Variadas", "Porrusalda (Sopa de Puerros y Patatas)", "Guiso de Patatas con Carne", "Caldereta de Pescado", "Sopa Castellana (Sopa de Ajo)", "Marmitako", "Estofado de Lentejas Rojas (Dal)", "Sopa de Tortilla Mexicana", "Pozole", "Caldo Gallego", "Cazuela de Fideos con Costillas", "Guiso de Chocos con Patatas", "Sopa de Marisco", "Crema de Champiñones Casera", "Locro Argentino", "Sancocho Colombiano (o de otros países)", "Ajiaco Santafereño", "Bisque de Langosta (Ocasión)", "Gumbo de Luisiana", "Cazuela de Pollo al Curry", "Guiso Gitano", "Patatas a la Riojana", "Sopa Juliana", "Crema de Calabacín", "Sopa Fría (Gazpacho, Salmorejo, Ajoblanco - Verano)",
            // --- RÁPIDAS Y FÁCILES (Menos de 30-40 min) ---
            "Pasta Aglio e Olio con Gambas", "Salteado Rápido de Pollo y Verduras", "Tortilla Francesa Rellena", "Huevos Rotos con Jamón o Chorizo", "Salmón a la Plancha con Ensalada", "Quesadillas Rellenas (Pollo, Carne, Frijoles)", "Wraps Rápidos de Atún o Pollo", "Pizza Casera Rápida (Base Precocida o Pan Pita)", "Ensalada Completa con Legumbres y Proteína", "Sopa Instantánea Mejorada (Añadir Huevo, Verduras)", "Tostas Variadas (Aguacate, Tomate, Huevo)", "Revuelto de Champiñones y Espárragos", "Pechuga de Pollo a la Plancha con Puré Instantáneo", "Salchichas Frescas con Tomate Frito y Arroz Blanco", "Pasta Rápida con Tomate Cherry y Albahaca", "Bocadillos Calientes (Bikinis, Pepitos)", "Guisantes con Jamón", "Cuscús con Verduras Salteadas", "Salteado de Arroz Sobrante", "Nachos con Queso y Guacamole Rápido",
            // --- CONCEPTOS Y CATEGORÍAS ---
            "Ideas de Cenas Económicas para Toda la Familia", "Recetas 'One Pot' (Todo en una Olla)", "Cenas en 'Sheet Pan' (Bandeja de Horno)", "Comidas para Congelar y Tener Listas", "Recetas Clásicas Españolas para la Cena", "Cenas Ligeras y Saludables", "Recetas con Sobras de Pollo Asado", "Ideas para Usar Legumbres en Conserva", "Cenas Vegetarianas Fáciles y Rápidas", "Recetas para Niños (Que los Adultos También Disfrutarán)", "Cenas de Inspiración Mexicana", "Sabores de Italia para la Cena Familiar", "Toques Asiáticos para Cenas Diferentes", "Guisos Reconfortantes para Días Fríos", "Ensaladas Completas que Sirven como Cena", "Recetas con Arroz para Variar", "Ideas con Pasta para Todos los Gustos", "Cenas con Pescado para Niños", "Cómo Hacer que los Niños Coman Verduras (Recetas)", "Cenas Festivas pero Sencillas", "Recetas de la Abuela para Reuniones Familiares", "Platos Únicos Completos", "Aprovechamiento: Cenas con lo que Hay en la Nevera", "Cenas sin Gluten Fáciles", "Opciones sin Lactosa para la Cena Familiar", "Cocina Lenta (Slow Cooker) para Cenas sin Estrés", "Recetas de Olla Express para Ahorrar Tiempo"
        ];
        const recipeThemes = [
            "recetas con pollo", "recetas con carne de res", "recetas con cerdo", "recetas con pescado", "recetas vegetarianas", "recetas veganas", "platos de pasta", "arroces", "guisos y estofados", "sopas y cremas", "cazuelas", "recetas rápidas", "cenas económicas", "one pot meals", "sheet pan dinners", "recetas para niños", "comida española", "comida italiana", "comida mexicana", "comida asiática", "cenas ligeras", "comfort food", "recetas para congelar"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un chef experimentado y amigable, especializado en cocina casera para familias. Tu tarea es proporcionar una receta detallada, clara y apetitosa basada en el título proporcionado. Incluye: una breve introducción evocadora, lista de ingredientes completa (con cantidades para aprox. 4 personas), instrucciones paso a paso fáciles de seguir, tiempo estimado de preparación y cocción, sugerencias de presentación o acompañamiento, y si es posible, consejos adicionales (variaciones, trucos, cómo involucrar a los niños, opciones sin alérgenos si aplica). El objetivo es una descripción útil y completa de aproximadamente 1200-1300 palabras. Escribe en un tono cálido y alentador. Basa tu receta únicamente en el siguiente título:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para un recetario familiar. Genera exactamente 15 títulos de recetas o ideas de cenas adecuadas para familias (variadas en ingredientes y tipo de plato). Devuelve *solo* la lista de títulos/ideas, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ==========
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const noResultsMsg = document.getElementById('no-results');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const generateMoreSpinner = generateMoreBtn.querySelector('i');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content'); // Contenedor del texto e imagen
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');

        // ========== API FUNCTIONS ========== (Sin cambios funcionales)
        async function fetchTextFromApi(prompt, config) { /* ... */
            const encodedPrompt = encodeURIComponent(prompt);
             const encodedSystem = encodeURIComponent(config.systemPrompt);
             const params = new URLSearchParams({ model: config.model, system: encodedSystem });
             if (config.seed) params.append('seed', config.seed);
             const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
             console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
             const controller = new AbortController();
             const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
             try {
                 const response = await fetch(url, { signal: controller.signal });
                 clearTimeout(timeoutId);
                 if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                 const text = await response.text();
                 if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                 console.log(`API Response received (${text.length} chars)`);
                 return text;
             } catch (error) {
                 clearTimeout(timeoutId);
                 console.error("API Fetch Error:", error);
                 if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intenta de nuevo.`);
                 throw new Error(`Error de comunicación con la API: ${error.message}`);
             }
        }
        async function fetchExplanationText(conceptTitle) { /* ... */
             const text = await fetchTextFromApi(conceptTitle, textApiConfig);
               if (text.trim().length < 500 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de") || !text.toLowerCase().includes("ingredientes") || !text.toLowerCase().includes("instrucciones")) { // Checks mínimos para una receta
                    throw new Error("La IA no pudo generar una receta adecuada o suficientemente detallada para este título.");
                }
              return text;
        }
        async function fetchGeneratedTitles() { /* ... */
            const randomTheme = getRandomElement(recipeThemes) || "cenas familiares fáciles";
            const specificPrompt = `Genera 15 títulos de recetas o ideas para cenas familiares sobre ${randomTheme}`;
             console.log("Generating titles with prompt:", specificPrompt);
             const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
             const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
             const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 5 && line.length < 150);
             if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de recetas.");
             return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a COMIDA
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText : "delicious family dinner meal";
            // Prompt ENFOCADO en foto de comida, apetitosa, bien iluminada.
            const enhancedPrompt = `High-quality food photography of a finished plate of '${safePromptText}'. Appetizing, well-lit, delicious looking, family style serving or plated meal. Focus on the food texture and colors. Natural light if possible. Shallow depth of field.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, letters, brand name, logo, recipe text, instructions, person, people, hands, eating, messy, dirty plate, illustration, drawing, cartoon, diagram, ugly food, blurry, low quality, watermark, signature";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (adaptada para listas y énfasis)
        function formatExplanationText(rawText) {
             if (!rawText) return '';
             let formatted = rawText.trim();

             // Markdown básico para énfasis y encabezados
             formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
             formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
             formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
             formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
             formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
             formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');

             // Convertir listas de ingredientes/pasos (líneas que empiezan con -, *, o número.)
             formatted = formatted.replace(/^(?:[-*]|\d+\.)\s+(.*)$/gm, '<li>$1</li>');

             // Agrupar LIs consecutivos en ULs u OLs
             formatted = formatted.replace(/^(<li>.*<\/li>\s*)+/gm, (match) => {
                const listItems = match.trim();
                 // Detectar si es ordenada (empieza con número) - simplificación
                 if (/^<li>\d/.test(listItems.substring(4))) { // Check inside first li content
                     return `<ol>${listItems}</ol>`;
                 } else {
                     return `<ul>${listItems}</ul>`;
                 }
             });

             // Párrafos (bloques separados por doble salto de línea)
             const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
             formatted = blocks.map(block => {
                 // Si ya es encabezado o lista, dejarlo
                 if (block.startsWith('<h') || block.startsWith('<ul') || block.startsWith('<ol')) {
                     return block;
                 }
                 // Si contiene <li> pero no empieza con lista (caso raro), envolver en <p>
                 if (block.includes('<li>')) {
                     return `<p>${block.replace(/\n/g, '<br>')}</p>`;
                 }
                 // Párrafo normal
                 let content = block.replace(/\n/g, ' '); // Reemplazar saltos internos con espacio
                 return `<p>${content}</p>`;
             }).join('');


             return formatted;
         }

        // ========== MODAL FUNCTIONS ========== (Sin cambios funcionales)
        function showModal() { /* ... */ if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { /* ... */
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() { /* ... */
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = ''; // Limpia texto e imagen anterior
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ==========
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { // Añadir icono basado en palabras clave
            const div = document.createElement('div');
            div.className = 'title-item';
            const icon = document.createElement('i');
            icon.className = 'fas'; // Clase base FontAwesome
            // Lógica simple para icono temático
            const lowerTitle = title.toLowerCase();
            if (lowerTitle.includes('pollo') || lowerTitle.includes('chicken')) icon.classList.add('fa-drumstick-bite');
            else if (lowerTitle.includes('ternera') || lowerTitle.includes('res') || lowerTitle.includes('beef') || lowerTitle.includes('carne')) icon.classList.add('fa-steak'); // fa-cow es muy literal
            else if (lowerTitle.includes('cerdo') || lowerTitle.includes('pork')) icon.classList.add('fa-bacon');
            else if (lowerTitle.includes('pescado') || lowerTitle.includes('fish') || lowerTitle.includes('salmón') || lowerTitle.includes('merluza') || lowerTitle.includes('bacalao')) icon.classList.add('fa-fish-fins');
            else if (lowerTitle.includes('pasta') || lowerTitle.includes('fideos') || lowerTitle.includes('spaghetti') || lowerTitle.includes('macarrones')) icon.classList.add('fa-spaghetti-monster-flying'); // divertido!
            else if (lowerTitle.includes('arroz') || lowerTitle.includes('rice')) icon.classList.add('fa-bowl-rice');
            else if (lowerTitle.includes('vegetariana') || lowerTitle.includes('vegano') || lowerTitle.includes('verduras') || lowerTitle.includes('vegetable') || lowerTitle.includes('lentejas') || lowerTitle.includes('garbanzos')) icon.classList.add('fa-carrot');
            else if (lowerTitle.includes('sopa') || lowerTitle.includes('crema') || lowerTitle.includes('guiso') || lowerTitle.includes('potaje') || lowerTitle.includes('caldo') || lowerTitle.includes('stew')) icon.classList.add('fa-pot-food');
            else if (lowerTitle.includes('ensalada') || lowerTitle.includes('salad')) icon.classList.add('fa-leaf');
            else icon.classList.add('fa-utensils'); // Icono por defecto

            const titleText = document.createElement('span');
            titleText.textContent = title;
            div.appendChild(icon);
            div.appendChild(titleText);
            div.setAttribute('data-title', title);
            div.addEventListener('click', () => handleTitleClick(title));
            return div;
        }
        function displayTitles(titles) { /* ... */
             if (!titleListContainer || !titlesLoading) return;
             // Ordenar alfabéticamente las recetas
             const sortedTitles = titles.sort((a, b) => a.localeCompare(b, 'es', { sensitivity: 'base' }));
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if (sortedTitles.length === 0) { titleListContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">No hay recetas disponibles.</p>'; return; }
             sortedTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
             // Ocultar mensaje de no resultados inicialmente
             noResultsMsg.classList.add('hidden');
         }
        function appendTitles(newTitles) { /* ... */
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
             const existingTitles = new Set(Array.from(titleListContainer.querySelectorAll('.title-item')).map(item => item.dataset.title));
             newTitles.forEach(title => {
                 if (!existingTitles.has(title)) {
                     titleListContainer.appendChild(createTitleItem(title));
                 }
             });
             filterTitles(searchInput.value); // Re-aplicar filtro
        }

        // *** MODIFIED: handleTitleClick (sin cambios funcionales mayores, solo texto/iconos) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                modalContent.scrollTop = 0; // Reset scroll DESPUÉS de que el contenido es visible
                console.log("Scroll set to 0 after content visible");

                // Preparar y añadir placeholder DENTRO de modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-camera placeholder-icon"></i> <!-- Icono cámara -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Preparando foto del plato...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // Crear y añadir elemento imagen
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Foto de ${title}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-image-slash placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la foto.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement);
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error al cargar la receta: ${error.message}`; // Mensaje de error específico
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
            }
        }

        async function handleGenerateMoreTitles() { /* ... */
             if (!generateMoreBtn || !generateMoreSpinner || !generateMoreContainer) return;
             generateMoreBtn.disabled = true;
             generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Buscando más delicias...'; // Texto temático
             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     appendTitles(newTitles);
                 } else {
                     alert("¡Parece que el horno necesita un descanso! No hay más ideas por ahora."); // Texto temático
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`¡Algo se quemó! Error al buscar ideas: ${error.message}`); // Texto temático
             } finally {
                 generateMoreBtn.disabled = false;
                 generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin hidden"></i> ¡Quiero Más Ideas!';
             }
         }

         // *** Search Filter Function (Sin cambios) ***
         function filterTitles(searchTerm) {
             const term = searchTerm.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, ""); // Normalizar para quitar acentos en búsqueda
             const titleItems = titleListContainer.querySelectorAll('.title-item');
             let visibleCount = 0;

             titleItems.forEach(item => {
                 const titleText = item.dataset.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                 const isVisible = titleText.includes(term);
                 item.classList.toggle('hidden', !isVisible);
                 if (isVisible) {
                     visibleCount++;
                 }
             });
             noResultsMsg.classList.toggle('hidden', visibleCount > 0);
         }

        // ========== INITIALIZATION ==========
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput || !noResultsMsg) {
                console.error("Initialization failed: Missing essential elements.");
                document.body.innerHTML = '<p style="color: #c00; font-size: 1.5em; text-align: center; padding-top: 3em;">¡Error en la cocina! No se cargaron los ingredientes de la página.</p>'; // Error temático
                return;
             }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            searchInput.addEventListener('input', (event) => { filterTitles(event.target.value); });
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>