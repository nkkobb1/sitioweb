<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlowTrainer // CYBERPUNK //</title> <!-- Título sin Edition -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    /* --- ESTILOS CSS --- */
    /* (Se mantienen los estilos de la versión anterior, excepto los cambios indicados abajo) */
    :root {
      --neon-cyan: #00ffff;
      --neon-magenta: #ff00ff;
      --neon-blue: #2a7ffb;
      --neon-green: #39ff14;
      --dark-bg: #0d0f1c; /* Un negro azulado profundo */
      --dark-surface: #1a1d2e; /* Superficie ligeramente más clara */
      --dark-surface-light: #2c2f4a;
      --text-light: #e0e0e0;
      --text-medium: #a0a0a0;
      --text-dark: #1f1f1f; /* Para elementos sobre fondos claros si los hubiera */
      --glow-cyan: rgba(0, 255, 255, 0.7); /* Reducido ligeramente */
      --glow-magenta: rgba(255, 0, 255, 0.7); /* Reducido ligeramente */
      --glow-blue: rgba(42, 127, 251, 0.7); /* Reducido ligeramente */
      --error: #ff4d4d;
      --success: var(--neon-green);
      --warning: #ffaa00;

      --font-primary: 'Orbitron', sans-serif; /* Títulos, logo */
      --font-secondary: 'Rajdhani', sans-serif; /* Cuerpo, texto general */

      --shadow-depth-1: 0 4px 15px rgba(0, 0, 0, 0.3);
      --shadow-depth-2: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-neon-cyan: 0 0 4px var(--neon-cyan), 0 0 8px var(--neon-cyan), 0 0 12px var(--glow-cyan); /* Sombra más contenida */
      --shadow-neon-magenta: 0 0 4px var(--neon-magenta), 0 0 8px var(--neon-magenta), 0 0 12px var(--glow-magenta); /* Sombra más contenida */
      --shadow-neon-blue: 0 0 4px var(--neon-blue), 0 0 8px var(--neon-blue), 0 0 12px var(--glow-blue); /* Sombra más contenida */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.3s ease, transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    html { scroll-behavior: smooth; }

    body {
      background-color: var(--dark-bg);
      color: var(--text-light);
      min-height: 100vh;
      padding-bottom: 100px;
      font-family: var(--font-secondary);
      font-size: 17px;
      line-height: 1.7;
      background-image:
        linear-gradient(rgba(42, 127, 251, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(42, 127, 251, 0.05) 1px, transparent 1px),
        radial-gradient(circle at top left, rgba(0, 255, 255, 0.08), transparent 40%),
        radial-gradient(circle at bottom right, rgba(255, 0, 255, 0.08), transparent 50%);
      background-size: 30px 30px, 30px 30px, 100% 100%, 100% 100%;
      overflow-x: hidden;
      animation: pulseBg 15s infinite alternate;
    }

    @keyframes pulseBg {
        0% { background-color: var(--dark-bg); }
        100% { background-color: #101220; }
    }

    header {
      background-color: rgba(13, 15, 28, 0.6);
      backdrop-filter: blur(15px) saturate(120%);
      -webkit-backdrop-filter: blur(15px) saturate(120%);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 12px 0;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
      animation: slideDown 0.5s ease-out;
    }

    @keyframes slideDown {
        from { transform: translateY(-100%); opacity: 0;}
        to { transform: translateY(0); opacity: 1;}
    }

    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 30px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo img {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 2px solid var(--neon-cyan);
      box-shadow: var(--shadow-neon-cyan);
      animation: spinLogo 20s linear infinite;
    }

    @keyframes spinLogo {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .logo-text {
      font-family: var(--font-primary);
      font-size: 28px;
      font-weight: 700;
      color: var(--text-light);
      text-shadow: var(--shadow-neon-magenta);
      letter-spacing: 2px;
      animation: neonFlicker 5s infinite alternate;
    }

    @keyframes neonFlicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% {
        text-shadow:
          0 0 4px #fff,
          0 0 10px var(--neon-magenta),
          0 0 18px var(--neon-magenta),
          0 0 38px var(--neon-magenta),
          0 0 70px var(--glow-magenta);
        opacity: 1;
      }
      20%, 24%, 55% {
        text-shadow: none;
        opacity: 0.8;
      }
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 35px;
    }

    nav ul li a {
      color: var(--text-medium);
      text-decoration: none;
      font-size: 18px;
      font-weight: 500;
      padding: 8px 0;
      position: relative;
      letter-spacing: 1px;
      transition: color 0.3s ease, text-shadow 0.3s ease;
      font-family: var(--font-secondary);
    }

    nav ul li a::before {
        content: '[';
        position: absolute;
        left: -10px;
        opacity: 0;
        color: var(--neon-cyan);
        transition: opacity 0.3s ease, left 0.3s ease;
    }
    nav ul li a::after {
        content: ']';
        position: absolute;
        right: -10px;
        opacity: 0;
        color: var(--neon-cyan);
        transition: opacity 0.3s ease, right 0.3s ease;
    }

    nav ul li a:hover,
    nav ul li a.active {
      color: var(--neon-cyan);
      text-shadow: 0 0 8px var(--glow-cyan);
    }

    nav ul li a:hover::before,
    nav ul li a.active::before {
        opacity: 1;
        left: -15px;
    }
     nav ul li a:hover::after,
     nav ul li a.active::after {
        opacity: 1;
        right: -15px;
     }

    main {
      padding: 3rem 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0;
      width: 100%;
    }

    .section {
      background-color: rgba(26, 29, 46, 0.8);
      border-radius: 10px;
      padding: 2.5rem;
      box-shadow: var(--shadow-depth-2), inset 0 0 20px rgba(0,0,0,0.3);
      border: 1px solid rgba(42, 127, 251, 0.2);
      margin-bottom: 2.5rem;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      /* No aplicar animación aquí directamente, se aplica en JS al mostrar */
      /* animation: fadeInSection 0.6s ease-out forwards; */
      /* opacity: 0; */
    }

    @keyframes fadeInSection {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      font-family: var(--font-primary);
      color: var(--neon-blue);
      margin-bottom: 1.8rem;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 1px;
      border-bottom: 2px solid var(--neon-blue);
      padding-bottom: 0.8rem;
      text-shadow: var(--shadow-neon-blue);
      display: inline-block;
    }

    /* Grid de modos */
    .modes {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
    }

    .mode-card {
      background: linear-gradient(145deg, var(--dark-surface), #23263a);
      border-radius: 8px;
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      text-align: center;
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-depth-1);
    }

    .mode-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(transparent, rgba(0, 255, 255, 0.05), transparent);
      animation: scanline 3s linear infinite;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
      background-size: 100% 5px;
    }

    @keyframes scanline {
      0% { background-position: 0 -100px; }
      100% { background-position: 0 100%; }
    }

    .mode-card:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: var(--shadow-depth-2), 0 0 25px var(--glow-cyan);
      border: 1px solid var(--neon-cyan);
      background: linear-gradient(145deg, var(--dark-surface-light), #2a2e45);
    }
    .mode-card:hover::before { opacity: 1; }

    .mode-card i {
      font-size: 2.8rem;
      margin-bottom: 1.5rem;
      color: var(--neon-cyan);
      text-shadow: var(--shadow-neon-cyan);
      transition: transform 0.3s ease;
    }
    .mode-card:hover i { transform: scale(1.1) rotate(-5deg); }

    .mode-card h3 {
      font-family: var(--font-primary);
      font-size: 1.6rem;
      margin-bottom: 1rem;
      color: var(--text-light);
      font-weight: 500;
      transition: color 0.3s ease;
    }
     .mode-card:hover h3 { color: var(--neon-cyan); }

    .mode-card p {
      font-size: 1rem;
      color: var(--text-medium);
      line-height: 1.6;
      flex-grow: 1;
    }

    /* Área de Sesión (Ahora dentro de #home) */
    /* El contenedor principal .session-area debe ocultarse/mostrarse con JS */
    .session-area {
      /* display: none; /* Oculto inicialmente por JS */
      flex-direction: column;
      gap: 2rem;
      background-color: rgba(26, 29, 46, 0.7);
      border-radius: 8px;
      padding: 2rem;
      box-shadow: var(--shadow-depth-1), inset 0 0 15px rgba(0,0,0,0.2);
      border: 1px solid rgba(255, 0, 255, 0.2);
      margin-top: 2rem; /* Espacio respecto al título/controles de idioma */
    }

    .control-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem;
      background-color: rgba(44, 47, 74, 0.5);
      border-radius: 6px;
      border: 1px solid rgba(255, 0, 255, 0.1);
    }

    .timer {
      font-family: var(--font-primary);
      font-size: 2.8rem;
      font-weight: 700;
      color: var(--neon-magenta);
      background-color: transparent;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      min-width: 180px;
      text-align: center;
      text-shadow: var(--shadow-neon-magenta);
      animation: pulseTimer 2s infinite alternate;
    }
    @keyframes pulseTimer {
        from { opacity: 0.8; transform: scale(1); }
        to { opacity: 1; transform: scale(1.02);}
    }

    .controls { display: flex; gap: 1rem; }

    /* Botones (Sin cambios) */
    button, .btn {
      font-family: var(--font-secondary);
      background: transparent;
      color: var(--text-light);
      border: 2px solid var(--neon-blue);
      padding: 12px 28px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 1px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      box-shadow: inset 0 0 0 0 var(--neon-blue);
      transition: all 0.3s ease-in-out, color 0.1s linear 0s;
      position: relative;
      overflow: hidden;
    }
    button i, .btn i { margin-right: 10px; font-size: 1.1em; }
    button:hover, .btn:hover { color: var(--dark-bg); box-shadow: inset 0 0 0 50px var(--neon-blue); border-color: var(--neon-blue); text-shadow: none; }
    button::before, .btn::before { content: ''; position: absolute; top: -2px; left: -2px; width: calc(100% + 4px); height: calc(100% + 4px); background: linear-gradient(45deg, var(--neon-cyan), var(--neon-magenta)); z-index: -1; opacity: 0; transition: opacity 0.3s ease; }
    button:hover::before, .btn:hover::before { opacity: 0.1; animation: glitchBorder 0.5s infinite linear alternate-reverse; }
    @keyframes glitchBorder { 0% { clip-path: inset(80% -6px -6px -6px); } 20% { clip-path: inset(-6px 80% -6px -6px); } 40% { clip-path: inset(80% -6px -6px -6px); } 60% { clip-path: inset(-6px -6px 30% 80%); } 80% { clip-path: inset(50% -6px -6px 50%); } 100% { clip-path: inset(-6px 40% 70% -6px); } }
    button:active, .btn:active { transform: scale(0.97); box-shadow: inset 0 0 0 60px var(--neon-blue); }
    button:disabled, .btn:disabled { border-color: #555; color: #777; cursor: not-allowed; box-shadow: none; }
    button:disabled:hover, .btn:disabled:hover { color: #777; box-shadow: none; }
    button:disabled::before, .btn:disabled::before { display: none; }
    .btn-primary { border-color: var(--neon-cyan); box-shadow: inset 0 0 0 0 var(--neon-cyan); }
    .btn-primary:hover { box-shadow: inset 0 0 0 50px var(--neon-cyan); border-color: var(--neon-cyan); }
    .btn-primary:active { box-shadow: inset 0 0 0 60px var(--neon-cyan); }
    .btn-danger { border-color: var(--error); box-shadow: inset 0 0 0 0 var(--error); }
    .btn-danger:hover { box-shadow: inset 0 0 0 50px var(--error); border-color: var(--error); color: var(--text-light); }
    .btn-danger:active { box-shadow: inset 0 0 0 60px var(--error); }
    .btn-secondary { border-color: var(--neon-magenta); box-shadow: inset 0 0 0 0 var(--neon-magenta); }
    .btn-secondary:hover { box-shadow: inset 0 0 0 50px var(--neon-magenta); border-color: var(--neon-magenta); }
    .btn-secondary:active { box-shadow: inset 0 0 0 60px var(--neon-magenta); }


    /* Session Content & Word Display */
    .session-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      margin-top: 1rem;
    }

    .word-display {
      font-family: var(--font-primary);
      font-size: 3.5rem;
      line-height: 1.4;
      font-weight: 900;
      min-height: 10rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem 3rem;
      width: 100%;
      background-color: rgba(13, 15, 28, 0.8);
      border-radius: 6px;
      box-shadow: var(--shadow-depth-1), inset 0 0 10px rgba(0,0,0,0.4);
      animation: fadeIn 0.5s ease;
      color: var(--neon-green);
      /* --- CAMBIO 2: Reducir text-shadow --- */
      text-shadow: 0 0 6px rgba(57, 255, 20, 0.6); /* Glow más sutil */
      /* text-shadow: 0 0 5px var(--neon-green), 0 0 10px var(--neon-green), 0 0 20px var(--neon-green); */ /* <-- Original */
      border: 1px solid rgba(57, 255, 20, 0.3);
      position: relative;
      overflow: hidden;
    }
    .word-display.glitchy { animation: glitchEffect 0.3s cubic-bezier(.25,.46,.45,.94) both infinite; }
    @keyframes glitchEffect{ 0%{ transform: translate(0); } 20%{ transform: translate(-3px, 3px); text-shadow: 0 0 8px var(--neon-magenta); color: var(--neon-magenta); } 40%{ transform: translate(-3px, -3px); text-shadow: 0 0 8px var(--neon-blue); color: var(--neon-blue); } 60%{ transform: translate(3px, 3px); text-shadow: 0 0 8px var(--neon-green); color: var(--neon-green); } 80%{ transform: translate(3px, -3px); text-shadow: 0 0 8px var(--neon-cyan); color: var(--neon-cyan); } 100%{ transform: translate(0); text-shadow: 0 0 6px rgba(57, 255, 20, 0.6); color: var(--neon-green); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } } /* Ajuste ligero a fadeIn */

     /* Ajustes de Modo e Inputs (Panel Idioma/Diccionario y panel Intervalo) */
     .mode-settings, .dict-lang-panel {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: center;
        justify-content: center;
        background-color: rgba(44, 47, 74, 0.3);
        padding: 1.2rem;
        border-radius: 6px;
        border: 1px solid rgba(0, 255, 255, 0.1);
        margin-top: 2rem; /* Añadido para separar del título */
        /* Oculto inicialmente por JS */
     }
     /* Separar el panel de intervalo que está DENTRO del control-panel */
    .control-panel .mode-settings {
        margin-top: 0;
        padding: 0;
        background: none;
        border: none;
        justify-content: flex-start; /* Alinear a la izquierda */
    }

     .mode-settings label, .dict-lang-panel label { margin-right: 0.5rem; font-weight: 500; color: var(--text-medium); }
     .mode-settings span, .dict-lang-panel span { color: var(--neon-cyan); font-weight: 700; margin-left: 5px; }

     input[type="number"], select {
        background-color: var(--dark-surface);
        color: var(--text-light);
        border: 1px solid var(--neon-blue);
        border-radius: 4px;
        padding: 8px 12px;
        font-family: var(--font-secondary);
        font-size: 1rem;
        width: 80px;
        text-align: center;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
     }
     input[type="number"]:focus, select:focus { outline: none; border-color: var(--neon-cyan); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3), var(--shadow-neon-cyan); }
     select { width: auto; min-width: 150px; cursor: pointer; appearance: none; -webkit-appearance: none; padding-right: 30px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%2300ffff'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.03a.75.75 0 0 1 1.06 0L8 8.74l2.72-2.71a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.09a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E%0A"); background-repeat: no-repeat; background-position: right 10px center; background-size: 16px; }
     select:disabled { opacity: 0.5; cursor: not-allowed; border-color: #555; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23555555'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.03a.75.75 0 0 1 1.06 0L8 8.74l2.72-2.71a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.09a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E%0A"); }


    /* Indicador de Carga */
    #loading-indicator { display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 700; color: var(--neon-magenta); text-shadow: var(--shadow-neon-magenta); /* Oculto por JS inicialmente */ }
    #loading-indicator::before { content: ''; width: 18px; height: 18px; border: 3px solid rgba(255, 0, 255, 0.3); border-top-color: var(--neon-magenta); border-radius: 50%; animation: spinLoader 0.8s linear infinite; }
    @keyframes spinLoader { to { transform: rotate(360deg); } }

    /* Sección de Ajustes */
     .settings-panel { display: flex; flex-direction: column; gap: 1.8rem; }
    .setting-group { display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px dashed rgba(42, 127, 251, 0.2); }
    .setting-group:last-child { border-bottom: none; } /* Quitar borde del último */
    .setting-group label { font-weight: 500; color: var(--text-medium); flex-basis: 250px; }
    .setting-group span { color: var(--neon-cyan); font-weight: 700; margin-left: 5px; }

    #info-content { margin-top: 1.5rem; padding: 1.5rem; background-color: var(--dark-surface-light); border-radius: 6px; border-left: 4px solid var(--neon-magenta); color: var(--text-medium); font-size: 0.95rem; line-height: 1.8; }
     #info-content p { margin-bottom: 1rem; }
     #info-content strong { color: var(--neon-cyan); }

    /* --- AUDIO PLAYER (Sin cambios) --- */
    #audio-player { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; flex-direction: column; background: linear-gradient(to top, rgba(13, 15, 28, 0.95), rgba(26, 29, 46, 0.85)); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.5); z-index: 1100; border-top: 2px solid var(--neon-magenta); padding: 5px 0 0 0; transition: transform 0.4s ease-in-out; }
    .player-core { display: flex; align-items: center; justify-content: space-between; padding: 8px 25px; width: 100%; }
    .player-info { display: flex; align-items: center; gap: 15px; }
    #time-indicator { font-size: 0.85rem; color: var(--text-medium); font-weight: 400; letter-spacing: 0.5px; min-width: 100px; text-align: right; }
    #audio-controls { display: flex; justify-content: center; align-items: center; gap: 12px; }
    #audio-controls button { background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue); width: 40px; height: 40px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; box-shadow: none; }
    #audio-controls button:hover { background-color: rgba(42, 127, 251, 0.1); color: var(--neon-cyan); border-color: var(--neon-cyan); transform: scale(1.08); box-shadow: var(--shadow-neon-cyan); }
    #audio-controls button:active { transform: scale(0.95); }
    #play-pause-btn { width: 55px; height: 55px; border-width: 2px; font-size: 1.3rem; border-color: var(--neon-magenta); color: var(--neon-magenta); }
    #play-pause-btn:hover { background-color: rgba(255, 0, 255, 0.1); color: var(--text-light); border-color: var(--neon-magenta); box-shadow: var(--shadow-neon-magenta); }
    #play-pause-btn #loading-indicator { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: rgba(13, 15, 28, 0.8); border-radius: 50%; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0.2s ease; pointer-events: none; }
    #play-pause-btn.loading #loading-indicator { opacity: 1; visibility: visible; }
    #play-pause-btn.loading i { opacity: 0.2; }
    #play-pause-btn #loading-indicator .spinner { width: 22px; height: 22px; border: 3px solid rgba(255, 0, 255, 0.3); border-top-color: var(--neon-magenta); border-radius: 50%; animation: spinLoader 0.8s linear infinite; }
    #play-pause-btn #loading-indicator::before { content: none; }
    .player-side-controls { /* Contenedor añadido por si acaso */ }
    #repeat-toggle { font-size: 0.8rem; padding: 5px 10px; border-radius: 4px; width: auto; height: auto; border: 1px solid var(--text-medium); color: var(--text-medium); opacity: 0.7; }
    #repeat-toggle.active, #repeat-toggle:hover { opacity: 1; border-color: var(--neon-green); color: var(--neon-green); background-color: rgba(57, 255, 20, 0.1); box-shadow: 0 0 8px var(--neon-green); }
    #progress-container { width: 100%; height: 5px; background-color: rgba(44, 47, 74, 0.5); cursor: pointer; position: relative; overflow: hidden; }
    #progress-bar { height: 100%; background: linear-gradient(90deg, var(--neon-magenta), var(--neon-cyan)); width: 0; border-radius: 0; position: relative; box-shadow: var(--shadow-neon-magenta); transition: width 0.1s linear; }
    #progress-bar::after { content: ''; position: absolute; top: 0; right: -50px; width: 50px; height: 100%; background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent); transform: skewX(-30deg); animation: progressBarShine 2.5s linear infinite; opacity: 0.8; }
    @keyframes progressBarShine { from { right: -50px; } to { right: 120%; } }


    /* --- Responsive (Ajustes menores) --- */
    @media (max-width: 768px) {
        body { font-size: 16px; padding-bottom: 120px; }
        .header-container { padding: 0 15px; }
        .logo-text { font-size: 22px; }
        nav ul { gap: 25px; /* Reducir un poco */ }
        nav ul li a { font-size: 16px; }
        main { padding: 2rem 1rem; }
        .section { padding: 1.5rem; }
        h2 { font-size: 1.8rem; }
        .modes { grid-template-columns: 1fr; gap: 1rem; }
        .mode-card { padding: 1.5rem; }
        .timer { font-size: 2.2rem; min-width: 130px;}
        .word-display { font-size: 2.5rem; min-height: 8rem; padding: 1.5rem;} /* Ligeramente más grande */
        #audio-player { padding: 5px 0 0 0; }
        .player-core { padding: 5px 15px 8px 15px; flex-wrap: wrap; justify-content: center; gap: 8px;}
        .player-info { order: 1; width: 100%; justify-content: space-between;}
        #audio-controls { order: 2; width: 100%; justify-content: center; gap: 10px;}
        #time-indicator { text-align: left; }
        .player-side-controls { order: 3; }
         .control-panel { flex-direction: column; align-items: stretch; gap: 1rem; } /* Apilar controles en móvil */
         .control-panel .mode-settings { justify-content: center; }
         .control-panel .controls { justify-content: center; }
    }

    @media (max-width: 480px) {
        .logo img { width: 35px; height: 35px; }
        .logo-text { font-size: 18px; }
        nav ul { gap: 15px; }
        nav ul li a { font-size: 14px; }
        nav ul li a::before { left: -5px; } nav ul li a::after { right: -5px; } /* Acercar corchetes */
        nav ul li a:hover::before { left: -10px; } nav ul li a:hover::after { right: -10px; }
        .timer { font-size: 1.8rem; }
        .word-display { font-size: 2rem; }
        #audio-controls button { width: 35px; height: 35px; font-size: 0.9rem; }
        #play-pause-btn { width: 50px; height: 50px; font-size: 1.1rem; }
        button, .btn { padding: 10px 20px; font-size: 0.9rem;}
        h2 { font-size: 1.6rem;}
    }

    /* Utilidades */
    .hidden { display: none !important; } /* Importante para sobreescribir display: flex/grid */

  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo">
        <img src="https://blogger.googleusercontent.com/img/a/AVvXsEiLlZXJKRUaKqGfbAM5AwvWb3BeTOA0Gxwpmy0L1AYDcB00-vzRLMA9GK9z0XY37_BOEUdE1H00aVQQhYnXnCgWWsC5FzLW0mfXpJ1qgwdWqRNcxxnwNWn8xL0bRKIML2v9gn9YgLYFDZbtb30SHV7FyNvjC_1HzPJbs2ThM5vEGS6g-oP3jZ2mi3wmaPc" alt="FlowTrainer Logo">
        <span class="logo-text">FlowTrainer</span>
      </div>
      <nav>
        <ul>
          <!-- --- CAMBIO 1: Eliminar Entrenar e Historial --- -->
          <li><a href="#" class="nav-item active" data-section="home">Inicio</a></li>
          <li><a href="#" class="nav-item" data-section="settings">Ajustes</a></li>
          <!-- <li><a href="#" class="nav-item" data-section="training">Entrenar</a></li> -->
          <!-- <li><a href="#" class="nav-item" data-section="history">Historial</a></li> -->
        </ul>
      </nav>
    </div>
  </header>
  <main>
    <div class="container">
      <!-- Sección de Inicio (Ahora contiene también el área de entrenamiento) -->
      <section id="home" class="section">
        <h2 id="home-title"><i class="fas fa-atom fa-spin" style="--fa-animation-duration: 5s; margin-right: 10px;"></i> Modos de Entrenamiento</h2>

        <!-- Grid de Modos (se ocultará al seleccionar uno) -->
        <div class="modes">
           <div class="mode-card" data-mode="palabras-aleatorias"> <i class="fas fa-dice-d20"></i> <h3>Palabras Aleatorias</h3> <p>Muestra una palabra aleatoria a intervalos ajustables.</p> </div>
           <div class="mode-card" data-mode="multi-palabras"> <i class="fas fa-cubes"></i> <h3>Multi Palabras</h3> <p>Muestra varias palabras simultáneamente.</p> </div>
           <div class="mode-card" data-mode="palabras-largas"> <i class="fas fa-ruler-combined"></i> <h3>Palabras Largas</h3> <p>Muestra solo palabras de 9 o más letras.</p> </div>
           <div class="mode-card" data-mode="libre"> <i class="fas fa-infinity"></i> <h3>Modo Libre</h3> <p>Avanza el cronómetro sin mostrar palabras.</p> </div>
           <div class="mode-card" data-mode="imagenes-aleatorias"> <i class="fas fa-camera-retro"></i> <h3>Imágenes Aleatorias</h3> <p>Elige la frecuencia, miles de imagenes a tu disposicion.</p> </div>
           <div class="mode-card" data-mode="kickback"> <i class="fas fa-question"></i> <h3>Kick Back</h3> <p>Muestra preguntas aleatorias (ES/EN).</p> </div>
           <div class="mode-card" data-mode="mixto"> <i class="fas fa-brain"></i> <h3>Mixto</h3> <p>Combina 1 imagen aleatoria y 3 palabras.</p> </div>
        </div>

        <!-- Área de Entrenamiento (Oculta inicialmente) -->
        <div id="training-content" class="hidden"> <!-- Contenedor para agrupar elementos de entrenamiento -->
            <!-- Panel de idioma/diccionario -->
            <div class="dict-lang-panel hidden" id="dict-lang-panel">
                <label for="language-select"><i class="fas fa-language" style="margin-right: 5px;"></i>Idioma:</label>
                <select id="language-select"> <option value="es" selected>Español</option> <option value="en">Inglés</option> </select>
                <div id="dictionary-group" style="display: inline-flex; align-items: center; gap: 1rem;">
                    <label for="dictionary-select"><i class="fas fa-book" style="margin-right: 5px;"></i>Diccionario:</label>
                    <select id="dictionary-select"> <option value="essential" selected>Básico (5k)</option> <option value="complete">Completo (70k)</option> </select>
                </div>
                <div id="loading-indicator" class="hidden">Cargando recursos...</div> <!-- Clase hidden -->
            </div>

            <!-- Área de Sesión -->
            <div class="session-area">
                <div class="control-panel">
                    <div class="timer">00:00</div>
                    <div class="mode-settings">
                        <label for="mode-interval"><i class="fas fa-hourglass-half" style="margin-right: 5px;"></i>Intervalo:</label>
                        <input type="number" id="mode-interval" value="3" min="0.5" step="0.1">
                        <span id="mode-interval-value">3s</span>
                    </div>
                    <div class="controls">
                        <button class="btn btn-primary" id="start-btn" onclick="startSession()"> <i class="fas fa-play"></i> Iniciar </button>
                        <button class="btn btn-danger" id="stop-btn" disabled onclick="stopSession()"> <i class="fas fa-stop"></i> Detener </button>
                    </div>
                </div>
                <div class="session-content">
                    <div class="word-display"> [ Esperando Selección ] </div>
                </div>
            </div>
        </div> <!-- Fin #training-content -->

      </section>

      <!-- Sección de Entrenamiento (ELIMINADA) -->
      <!-- <section id="training" class="section" style="display: none;"> ... </section> -->

      <!-- Sección de Historial (ELIMINADA) -->
      <!-- <section id="history" class="section" style="display: none;"> ... </section> -->

      <!-- Sección de Ajustes -->
      <section id="settings" class="section" style="display: none;">
        <h2><i class="fas fa-cogs" style="margin-right: 10px;"></i> Ajustes Generales</h2>
        <div class="settings-panel">

          <div class="setting-group">
            <label for="session-duration"><i class="fas fa-clock" style="margin-right: 5px;"></i>Duración Sesión (min):</label>
            <input type="number" id="session-duration" min="1" max="60" value="3" step="1">
            <span id="duration-value">3m</span>
          </div>

          <!-- Ajustes de modo (ahora ocultos/visibles por JS) -->
          <div class="setting-group hidden" id="multi-word-group">
            <label for="multi-word-count"><i class="fas fa-cubes" style="margin-right: 5px;"></i>Nº Palabras (Multi):</label>
            <input type="number" id="multi-word-count" min="2" max="15" value="3" step="1">
            <span id="multi-word-count-value">3</span>
          </div>
          <div class="setting-group hidden" id="mixto-word-group">
            <label for="mixto-word-count"><i class="fas fa-brain" style="margin-right: 5px;"></i>Nº Palabras (Mixto):</label>
            <input type="number" id="mixto-word-count" min="1" max="10" value="3" step="1">
            <span id="mixto-word-count-value">3</span>
          </div>

          <!-- --- CAMBIO 3: Eliminar Selector de Tema --- -->
          <!--
          <div class="setting-group">
            <label for="theme"><i class="fas fa-palette" style="margin-right: 5px;"></i>Tema Visual:</label>
            <select id="theme">
              <option value="cyberpunk" selected>Cyberpunk (Actual)</option>
              <option value="dark">Oscuro Original</option>
              <option value="light">Claro</option>
              <option value="purple">Púrpura</option>
              <option value="blue">Azul</option>
            </select>
          </div>
          -->

          <div class="setting-group">
             <label><i class="fas fa-info-circle" style="margin-right: 5px;"></i> Información</label>
             <button id="info-btn" class="btn btn-secondary"><i class="fas fa-eye"></i> Mostrar/Ocultar Info</button>
          </div>

          <div id="info-content" style="display:none;">
             <p><strong>FlowTrainer [CYBERPUNK] es la plataforma definitiva...</strong></p>
             <!-- Resto del contenido informativo -->
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Reproductor de audio Fijo (Sin cambios HTML) -->
  <div id="audio-player">
     <div id="progress-container"> <div id="progress-bar"></div> </div>
     <div class="player-core">
         <div class="player-info"> <div id="time-indicator">00:00 / 00:00</div> </div>
         <div id="audio-controls">
           <button id="prev-track" title="Pista Anterior"> <i class="fas fa-step-backward"></i> </button>
           <button id="play-pause-btn" title="Reproducir/Pausa"> <i class="fas fa-play"></i> <div id="loading-indicator"> <div class="spinner"></div> </div> </button>
           <button id="next-track" title="Siguiente Pista"> <i class="fas fa-step-forward"></i> </button>
         </div>
         <div class="player-side-controls"> <button id="repeat-toggle" title="Repetir">Repeat Off</button> </div>
     </div>
     <audio id="player" preload="metadata"></audio>
   </div>


  <!-- Lib XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // --- VARIABLES GLOBALES (Sin cambios) ---
    let wordList = [];
    let wordHistory = [];
    let currentMode = null;
    let sessionActive = false;
    let wordInterval = 3000;
    let sessionDuration = 3 * 60 * 1000;
    let wordTimer;
    let sessionTimer;
    let sessionStartTime;
    let elapsedTime = 0;
    let firstImage = true;
    const essentialDictionaryUrl = 'https://papitasfritas.com/5milcastellano.xlsx';
    const completeDictionaryUrl = 'https://papitasfritas.com/palabrascastellano.xlsx';
    const englishDictionaryUrl = 'https://papitasfritas.com/60milingles.xlsx';
    const kickbackUrl = 'https://papitasfritas.com/kickback.xlsx';
    let kickbackQuestions = [];
    const demoWords = ['NEON', 'CYBER', 'FLOW', 'FUTURO', 'CODIGO', 'MATRIX', 'CIRCUITO', 'GLITCH', 'DATA', 'RED', 'IMPLANTE', 'HACK', 'PULSO', 'LASER', 'VR', 'IA', 'DROIDE', 'NAVE', 'CIUDAD', 'NOCHE', 'LLUVIA', 'SOMBRA', 'ESCAPE', 'CONTROL', 'SISTEMA'];
    let originalWords = demoWords;

    // --- DOM Element Caching (Actualizado) ---
    let startBtn, stopBtn, wordDisplay, timerDisplay, sessionArea, // sessionArea es el contenedor DENTRO de #training-content
        multiWordGroup, multiWordCountInput, multiWordCountValue, mixtoWordGroup,
        mixtoWordCountInput, mixtoWordCountValue, modeIntervalInput, modeIntervalValue,
        sessionDurationInput, durationValue, infoBtn, infoContent,
        dictLangPanel, languageSelect, dictionarySelect, dictionaryGroup, loadingIndicatorEl,
        homeSection, settingsSection, modesGrid, homeTitle, trainingContent; // Elementos de las secciones principales y sub-contenedores

    // --- Funciones Carga Diccionarios (Sin cambios) ---
    async function loadSpanishDictionary(fileUrl, colIndex = 0) { try { const response = await fetch(fileUrl, { cache: "force-cache" }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.arrayBuffer(); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 }); const extracted = rows.map(row => row[colIndex]).filter(w => typeof w === 'string' && w.trim() !== '').map(w => w.toUpperCase()); return (extracted.length > 0) ? extracted : demoWords; } catch (err) { console.error("Error loading Spanish dictionary:", fileUrl, err); return demoWords; } }
    async function loadEnglishDictionary() { try { const response = await fetch(englishDictionaryUrl, { cache: "force-cache" }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.arrayBuffer(); const workbook = XLSX.read(data, { type: 'array' }); let allWords = []; workbook.SheetNames.forEach(sheetName => { const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 }); const extracted = rows.map(row => row[2]).filter(w => typeof w === 'string' && w.trim() !== '').map(w => w.toUpperCase()); allWords.push(...extracted); }); return (allWords.length > 0) ? allWords : demoWords; } catch (err) { console.error("Error loading English dictionary:", err); return demoWords; } }
    async function loadKickbackQuestions(lang) { try { const response = await fetch(kickbackUrl, { cache: "force-cache" }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.arrayBuffer(); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false }); let colIndex = (lang === 'es') ? 0 : 1; const extracted = rows.map(row => row[colIndex]).filter(q => typeof q === 'string' && q.trim() !== ''); return extracted; } catch (err) { console.error("Error loading Kickback questions:", err); return ["¿Error al cargar?", "¿Intentar de nuevo?"]; } }


    // --- Inicialización y DOMContentLoaded ---
    document.addEventListener('DOMContentLoaded', function() {
        console.log("FlowTrainer CYBERPUNK // DOM Ready - Simplified UI");

        // --- Cachear elementos DOM ---
        homeSection = document.getElementById('home');
        settingsSection = document.getElementById('settings');
        modesGrid = homeSection.querySelector('.modes');
        homeTitle = document.getElementById('home-title');
        trainingContent = document.getElementById('training-content'); // Contenedor del área de entreno
        dictLangPanel = document.getElementById('dict-lang-panel'); // Dentro de trainingContent
        sessionArea = trainingContent.querySelector('.session-area'); // Dentro de trainingContent
        startBtn = document.getElementById('start-btn');
        stopBtn = document.getElementById('stop-btn');
        wordDisplay = sessionArea.querySelector('.word-display');
        timerDisplay = sessionArea.querySelector('.timer');
        multiWordGroup = document.getElementById('multi-word-group'); // En Ajustes
        multiWordCountInput = document.getElementById('multi-word-count');
        multiWordCountValue = document.getElementById('multi-word-count-value');
        mixtoWordGroup = document.getElementById('mixto-word-group'); // En Ajustes
        mixtoWordCountInput = document.getElementById('mixto-word-count');
        mixtoWordCountValue = document.getElementById('mixto-word-count-value');
        modeIntervalInput = sessionArea.querySelector('#mode-interval');
        modeIntervalValue = sessionArea.querySelector('#mode-interval-value');
        sessionDurationInput = document.getElementById('session-duration'); // En Ajustes
        durationValue = document.getElementById('duration-value');
        infoBtn = document.getElementById('info-btn');
        infoContent = document.getElementById('info-content');
        languageSelect = document.getElementById('language-select');
        dictionarySelect = document.getElementById('dictionary-select');
        dictionaryGroup = document.getElementById('dictionary-group');
        loadingIndicatorEl = document.getElementById('loading-indicator'); // El de idioma/dict

        const navItems = document.querySelectorAll('.nav-item');
        const modeCards = document.querySelectorAll('.mode-card');
        const sections = document.querySelectorAll('main .section'); // Requerido para nav

        // --- Event Listeners ---

        infoBtn.addEventListener('click', function() {
            const isHidden = infoContent.style.display === 'none' || infoContent.style.display === '';
            infoContent.style.display = isHidden ? 'block' : 'none';
            if (isHidden) { infoContent.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
        });

        multiWordCountInput.addEventListener('input', () => { multiWordCountValue.textContent = multiWordCountInput.value; });
        mixtoWordCountInput.addEventListener('input', () => { mixtoWordCountValue.textContent = mixtoWordCountInput.value; });

        // --- CAMBIO JS: Lógica de Navegación Simplificada ---
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                if (this.classList.contains('active')) return;

                const sectionId = this.getAttribute('data-section');

                // Detener sesión si se navega fuera de 'home' Y hay una sesión activa
                if (sessionActive && sectionId !== 'home') {
                    stopSession();
                }

                // Estado Activo Nav
                navItems.forEach(link => link.classList.remove('active'));
                this.classList.add('active');

                // Mostrar/Ocultar Secciones
                sections.forEach(s => {
                     const isTarget = s.id === sectionId;
                     s.style.display = isTarget ? 'block' : 'none';
                     if (isTarget) {
                         // Re-trigger animación fade in (opcional)
                         s.style.opacity = '0'; // Reset para animar
                         s.style.animation = 'none';
                         void s.offsetWidth; // Trigger reflow
                         s.style.animation = 'fadeInSection 0.6s ease-out forwards';
                         s.style.opacity = '1'; // Asegurar visibilidad si no hay JS anim
                     }
                });

                 // --- Lógica Específica al ir a INICIO ---
                if (sectionId === 'home') {
                     // Siempre mostrar el grid de modos y ocultar el entrenamiento
                     modesGrid.classList.remove('hidden');
                     trainingContent.classList.add('hidden');
                     homeTitle.innerHTML = '<i class="fas fa-atom fa-spin" style="--fa-animation-duration: 5s; margin-right: 10px;"></i> Modos de Entrenamiento'; // Resetear título
                }

                 // Scroll suave (opcional)
                 // document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // --- CAMBIO JS: Lógica de Selección de Modo ---
        modeCards.forEach(card => {
            card.addEventListener('click', function() {
                const selectedMode = this.getAttribute('data-mode');
                console.log("Mode selected:", selectedMode);
                currentMode = selectedMode; // Actualizar modo actual

                // 1. Ocultar el grid de modos
                modesGrid.classList.add('hidden');

                // 2. Configurar UI para el modo (título, panel idioma/dict, inputs específicos)
                configureTrainingUI(currentMode); // Esta función AHORA muestra trainingContent

                // 3. Cargar recursos necesarios
                if (currentMode === 'kickback') {
                    showLoadingIndicator(true, "Cargando Kickback...");
                    loadKickbackQuestions(languageSelect.value).then(questions => {
                        kickbackQuestions = questions; showLoadingIndicator(false);
                        resetSessionVisuals(); // Resetear AHORA, después de cargar
                    }).catch(err => { console.error(err); showLoadingIndicator(false); resetSessionVisuals(); wordDisplay.textContent = '[Error Kickback]'});
                } else if (['palabras-aleatorias','multi-palabras','palabras-largas','mixto'].includes(currentMode)) {
                    // updateWordSource maneja su propio indicador y resetea visuales al terminar
                    updateWordSource();
                } else {
                    // Modos sin carga de datos (libre, imagenes)
                    resetSessionVisuals(); // Resetear inmediatamente
                }
            });
        });

        languageSelect.addEventListener('change', handleLanguageChange);
        dictionarySelect.addEventListener('change', handleDictionaryChange);

        modeIntervalInput.addEventListener('input', function() {
            let val = parseFloat(this.value); const minVal = 0.5;
            if (isNaN(val) || val < minVal) { val = minVal; this.value = minVal; }
            modeIntervalValue.textContent = val.toFixed(1) + "s";
            wordInterval = val * 1000; console.log("Interval updated:", wordInterval);
            if (sessionActive && wordTimer && !['libre', 'imagenes-aleatorias', 'mixto'].includes(currentMode)) {
                clearInterval(wordTimer); wordTimer = setInterval(showNextContent, wordInterval);
            }
        });

        sessionDurationInput.addEventListener('input', function() {
            const value = parseInt(this.value, 10); const minDuration = 1, maxDuration = 60;
            let finalValue = value;
            if (isNaN(value) || value < minDuration) finalValue = minDuration;
            else if (value > maxDuration) finalValue = maxDuration;
            this.value = finalValue;
            sessionDuration = finalValue * 60 * 1000;
            durationValue.textContent = `${finalValue}m`;
        });

        // --- CAMBIO JS: Eliminar Listener de Tema ---
        // themeSelect.addEventListener('change', ...); // Eliminado

        // --- Carga Inicial (ligeramente ajustada) ---
        showLoadingIndicator(true, "Inicializando..."); // Usar indicador de idioma/dict
        dictLangPanel.classList.remove('hidden'); // Mostrar panel temporalmente para el indicador
        Promise.all([
            loadKickbackQuestions('es'),
            loadSpanishDictionary(essentialDictionaryUrl, 0) // Cargar diccionario básico por defecto
        ]).then(([kickbackEs, essentialEs]) => {
            kickbackQuestions = kickbackEs;
            wordList = essentialEs; // Establecer lista inicial
            originalWords = essentialEs;
            console.log("Initial resources loaded.");
            showLoadingIndicator(false);
            dictLangPanel.classList.add('hidden'); // Ocultar panel de nuevo
        }).catch(err => {
             console.error("Error during initial resource load:", err);
             showLoadingIndicator(false);
             dictLangPanel.classList.add('hidden');
        });

    }); // Fin DOMContentLoaded

    // --- Funciones Configuración UI y Carga (Actualizadas) ---

    function configureTrainingUI(mode) {
         console.log("Configuring UI for mode:", mode);

        // 1. Actualizar título en #home
         let modeTitleText = "Entrenamiento";
         const modeCard = document.querySelector(`.mode-card[data-mode="${mode}"]`);
         if (modeCard) { modeTitleText = modeCard.querySelector('h3').textContent; }
         homeTitle.innerHTML = `<i class="fas fa-cogs fa-spin" style="--fa-animation-duration: 4s; margin-right: 10px;"></i> Modo: ${modeTitleText}`;

         // 2. Mostrar/Ocultar panel Idioma/Diccionario (y su contenido)
         const needsDictLangPanel = ['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'kickback', 'mixto'].includes(mode);
         dictLangPanel.classList.toggle('hidden', !needsDictLangPanel);
         if (needsDictLangPanel) {
             dictionaryGroup.style.display = (mode === 'kickback' || languageSelect.value === 'en') ? 'none' : 'inline-flex';
             dictionarySelect.disabled = languageSelect.value === 'en';
         }

         // 3. Mostrar/Ocultar ajustes específicos en sección 'Ajustes'
         multiWordGroup.classList.toggle('hidden', mode !== 'multi-palabras');
         mixtoWordGroup.classList.toggle('hidden', mode !== 'mixto');

         // 4. Ajustar intervalo por defecto
         if (mode === "multi-palabras") modeIntervalInput.value = 10;
         else if (mode === "imagenes-aleatorias" || mode === "mixto") modeIntervalInput.value = 5;
         else modeIntervalInput.value = 3;
         modeIntervalInput.dispatchEvent(new Event('input')); // Actualizar span y variable

         // 5. Mostrar el contenedor del área de entrenamiento
         trainingContent.classList.remove('hidden');
         // Añadir animación fade-in al mostrar trainingContent
         trainingContent.style.animation = 'none';
         void trainingContent.offsetWidth; // Trigger reflow
         trainingContent.style.animation = 'fadeInSection 0.5s ease-out forwards';

    }

    function resetSessionVisuals() {
        console.log("Resetting session visuals.");
        wordDisplay.textContent = '[ Listo para Iniciar ]';
        wordDisplay.classList.remove('glitchy');
        wordDisplay.style.animation = 'none';
        void wordDisplay.offsetWidth;
        wordDisplay.style.animation = 'fadeIn 0.5s ease';
        startBtn.disabled = false;
        stopBtn.disabled = true;
        timerDisplay.textContent = "00:00";
        if(sessionActive) stopSession(); // Detener lógica de sesión si estaba activa
    }

    function showLoadingIndicator(show, text = "Cargando...") {
        if (!loadingIndicatorEl) return;
        // Asegurarse que el panel padre está visible para mostrar el indicador
        if (show && dictLangPanel.classList.contains('hidden')) {
             dictLangPanel.classList.remove('hidden'); // Mostrar temporalmente
        }
        loadingIndicatorEl.textContent = text;
        loadingIndicatorEl.classList.toggle('hidden', !show); // Usar hidden
        languageSelect.disabled = show;
        const disableDict = show || languageSelect.value === 'en' || currentMode === 'kickback';
        dictionarySelect.disabled = disableDict;
        // startBtn se habilita/deshabilita en resetSessionVisuals o al finalizar carga
    }

    async function handleLanguageChange() {
         const lang = languageSelect.value; console.log("Language changed to:", lang);
         if (['palabras-aleatorias','multi-palabras','palabras-largas','mixto', 'kickback'].includes(currentMode)) {
             await updateWordSource(); // Actualizar diccionario/kickback
         }
         dictionaryGroup.style.display = (lang === 'es' && currentMode !== 'kickback') ? 'inline-flex' : 'none';
         dictionarySelect.disabled = (lang === 'en');
    }
    async function handleDictionaryChange() {
        console.log("Dictionary changed:", dictionarySelect.value);
        if (languageSelect.value === 'es' && ['palabras-aleatorias','multi-palabras','palabras-largas','mixto'].includes(currentMode)) {
             await updateWordSource();
        }
    }

    async function updateWordSource() {
        if (!currentMode) return;
        const lang = languageSelect.value;
        const dictType = dictionarySelect.value;
        showLoadingIndicator(true, `Cargando ${currentMode === 'kickback' ? 'preguntas' : 'palabras'} (${lang})...`);
        try {
            if (currentMode === 'kickback') {
                kickbackQuestions = await loadKickbackQuestions(lang); console.log(`Kickback loaded (${lang}):`, kickbackQuestions.length); wordList = []; originalWords = [];
            } else if (['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'mixto'].includes(currentMode)) {
                if (lang === 'en') {
                    const englishWords = await loadEnglishDictionary(); wordList = englishWords; originalWords = englishWords; console.log("English dictionary loaded:", originalWords.length);
                } else {
                    let fileUrl, colIndex;
                    if (dictType === 'complete') { fileUrl = completeDictionaryUrl; colIndex = 1; } else { fileUrl = essentialDictionaryUrl; colIndex = 0; }
                    const spanishWords = await loadSpanishDictionary(fileUrl, colIndex); wordList = spanishWords; originalWords = spanishWords; console.log(`Spanish dictionary loaded (${dictType}):`, originalWords.length);
                }
                kickbackQuestions = [];
            } else { wordList = []; originalWords = []; kickbackQuestions = []; }
            resetSessionVisuals(); // <-- Resetear visuales DESPUÉS de cargar exitosamente
        } catch (error) {
            console.error("Error updating word source:", error); wordDisplay.textContent = "[ Error de Carga ]";
            if (['palabras-aleatorias', 'multi-palabras', 'palabras-largas', 'mixto'].includes(currentMode)) { wordList = demoWords; originalWords = demoWords; } else { wordList = []; originalWords = []; }
            if (currentMode === 'kickback') { kickbackQuestions = ["Error cargando."]; }
             resetSessionVisuals(); // Resetear visuales también en caso de error
        } finally {
            showLoadingIndicator(false);
        }
    }

    // --- Funciones Control Sesión (Sin cambios lógicos internos) ---
    function startSession() { if (sessionActive || !currentMode) { console.warn("Session already active or no mode selected."); return; } sessionActive = true; startBtn.disabled = true; stopBtn.disabled = false; wordHistory = []; elapsedTime = 0; sessionStartTime = Date.now(); console.log(`Starting session: Mode=${currentMode}, Interval=${wordInterval}ms, Duration=${sessionDuration}ms`); clearInterval(sessionTimer); clearInterval(wordTimer); sessionTimer = setInterval(updateSessionTime, 1000); updateSessionTime(); if (currentMode === "imagenes-aleatorias" || currentMode === "mixto") { firstImage = true; wordDisplay.textContent = "[ Cargando Imagen... ]"; wordDisplay.classList.add('glitchy'); showNextContent(); } else if (currentMode === "libre") { wordDisplay.textContent = "[ MODO LIBRE ]"; } else { showNextContent(); if(wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } } }
    function stopSession() { if (!sessionActive) return; console.log("Stopping session."); sessionActive = false; startBtn.disabled = false; stopBtn.disabled = true; clearInterval(wordTimer); clearInterval(sessionTimer); wordDisplay.textContent = '[ Sesión Finalizada ]'; wordDisplay.classList.remove('glitchy'); }
    function showNextContent() { if (!sessionActive) return; if (elapsedTime >= sessionDuration) { stopSession(); return; } console.log("Generating content for mode:", currentMode); wordDisplay.classList.remove('glitchy'); if (currentMode === "libre") return; if (currentMode === "imagenes-aleatorias") { wordDisplay.innerHTML = '<div class="spinner" style="margin: auto;"></div>'; const img = new Image(); const randomCacheBuster = Date.now(); img.src = `https://picsum.photos/720/480?random=${randomCacheBuster}`; img.alt = "Imagen Aleatoria"; img.style.cssText = 'max-width:100%; max-height:100%; border-radius:4px; box-shadow:var(--shadow-depth-1);'; img.onload = () => { if (!sessionActive) return; wordDisplay.innerHTML = ''; wordDisplay.appendChild(img); animateWordDisplay(wordDisplay); if (firstImage) { firstImage = false; clearInterval(wordTimer); if (wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } } }; img.onerror = () => { if (!sessionActive) return; wordDisplay.textContent = '[ Error Imagen ]'; if (firstImage) { firstImage = false; clearInterval(wordTimer); if (wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } } }; return; } if (currentMode === "mixto") { wordDisplay.innerHTML = '<div class="spinner" style="margin: auto;"></div>'; const img = new Image(); const randomCacheBuster = Date.now(); img.src = `https://picsum.photos/720/480?random=${randomCacheBuster}`; img.alt = "Imagen Aleatoria"; img.style.cssText = 'max-width:80%; max-height:60%; border-radius:4px; box-shadow:var(--shadow-depth-1); margin-bottom:1.5rem;'; img.onload = () => { if (!sessionActive) return; let count = parseInt(mixtoWordCountInput.value, 10) || 3; count = Math.max(1, Math.min(count, 10)); let currentList = (originalWords && originalWords.length > 0) ? originalWords : demoWords; let words = []; if (currentList.length > 0) { for (let i = 0; i < count; i++) { if(currentList.length <= i) break; const randomIndex = Math.floor(Math.random() * currentList.length); words.push(currentList[randomIndex]); } } else { words = ['[NO DATA]']; } const multiWordDisplay = words.join(" / "); wordDisplay.innerHTML = `<div style="display:flex; flex-direction:column; align-items:center; width: 100%; height: 100%; justify-content: center;"> ${img.outerHTML} <div style="font-size:1.8rem; font-weight: 500; color: var(--neon-cyan); text-shadow: var(--shadow-neon-cyan);">${multiWordDisplay}</div> </div>`; animateWordDisplay(wordDisplay); if (firstImage) { firstImage = false; clearInterval(wordTimer); if (wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } } }; img.onerror = () => { if (!sessionActive) return; wordDisplay.textContent = '[ Error Imagen Mixto ]'; if (firstImage) { firstImage = false; clearInterval(wordTimer); if (wordInterval > 0) { wordTimer = setInterval(showNextContent, wordInterval); } } }; return; } if (currentMode === "kickback") { if (kickbackQuestions && kickbackQuestions.length > 0) { const randomIndex = Math.floor(Math.random() * kickbackQuestions.length); wordDisplay.textContent = kickbackQuestions[randomIndex]; } else { wordDisplay.textContent = "[ No hay preguntas ]"; } animateWordDisplay(wordDisplay); return; } let currentList = (originalWords && originalWords.length > 0) ? originalWords : demoWords; if (currentMode === "palabras-largas") { let longWords = currentList.filter(w => w.length >= 9); currentList = longWords.length > 0 ? longWords : currentList; } if (currentList.length === 0) { wordDisplay.textContent = "[ Diccionario Vacío ]"; animateWordDisplay(wordDisplay); return; } if (currentMode === "multi-palabras") { const count = Math.min(Math.max(parseInt(multiWordCountInput.value, 10) || 2, 2), 15); let words = []; for (let i = 0; i < count; i++) { if(currentList.length <= i) break; const randomIndex = Math.floor(Math.random() * currentList.length); words.push(currentList[randomIndex]); } wordDisplay.textContent = words.join(" / "); } else { const randomIndex = Math.floor(Math.random() * currentList.length); wordDisplay.textContent = currentList[randomIndex]; } animateWordDisplay(wordDisplay); }
    function animateWordDisplay(elem) { elem.style.animation = 'none'; void elem.offsetWidth; elem.style.animation = 'fadeIn 0.4s ease-out'; }
    function updateSessionTime() { if (!sessionActive || !sessionStartTime) return; elapsedTime = Date.now() - sessionStartTime; if (elapsedTime >= sessionDuration) { elapsedTime = sessionDuration; stopSession(); } const totalSeconds = Math.floor(elapsedTime / 1000); const minutes = Math.floor(totalSeconds / 60); const seconds = totalSeconds % 60; timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; }

    // --- CAMBIO JS: Eliminar Funciones de Tema ---
    // function changeThemeOriginal(theme) { ... } // Eliminada
    // function applyCyberpunkTheme(){ ... } // Eliminada

  </script>

  <!-- Código Reproductor Música (JS sin cambios) -->
   <script>
     const archivePlaylist = [ "https://archive.org/download/beat-61/beat%20%281%29.mp3", "https://archive.org/download/beat-61/beat%20%2810%29.mp3", "https://archive.org/download/beat-61/beat%20%28100%29.mp3", "https://archive.org/download/beat-61/beat%20%28101%29.mp3", "https://archive.org/download/beat-61/beat%20%28102%29.mp3", "https://archive.org/download/beat-61/beat%20%28103%29.mp3", "https://archive.org/download/beat-61/beat%20%28104%29.mp3", "https://archive.org/download/beat-61/beat%20%28105%29.mp3", "https://archive.org/download/beat-61/beat%20%28106%29.mp3", "https://archive.org/download/Free_Beats_1/WipEout_XL_OST_Future_Sound_Of_London_We_Have_Explosive.mp3", "https://archive.org/download/Free_Beats_1/WipEout_XL_OST_The_Prodigy_Firestarter_Instrumental.mp3", "https://archive.org/download/hardtrapbeat/Hard%20Trap%20Beat%20-%20%27MASAYUKI%27%20_%20Dark%20Japanese%20Type%20Beat%20_%20Trap%20Instrumental%202021.mp3", "https://archive.org/download/royalty-free-music-ASSIGNMENT/ASSIGNMENT%20-%20Atmospheric%20Cyberpunk%20Music%20_%20Royalty%20Free%20Music.mp3" ];
     function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
     shuffleArray(archivePlaylist);
     let currentTrackIndex = 0;
     const player = document.getElementById('player');
     const playPauseBtn = document.getElementById('play-pause-btn');
     const prevTrackBtn = document.getElementById('prev-track');
     const nextTrackBtn = document.getElementById('next-track');
     const repeatToggle = document.getElementById('repeat-toggle');
     const progressBar = document.getElementById('progress-bar');
     const progressContainer = document.getElementById('progress-container');
     const timeIndicator = document.getElementById('time-indicator');
     const audioPlayer = document.getElementById('audio-player');
     const playPauseIcon = playPauseBtn.querySelector('i');
     const loadingIndicatorPlayer = playPauseBtn.querySelector('#loading-indicator');
     let repeat = false; let isDragging = false;
     function loadInitialTrack() { if (archivePlaylist.length > 0) { player.src = archivePlaylist[currentTrackIndex]; } else { console.warn("Audio playlist empty."); [playPauseBtn, prevTrackBtn, nextTrackBtn, repeatToggle].forEach(btn => btn.disabled = true); } }
     function loadTrack(index) { if (index < 0 || index >= archivePlaylist.length) { console.error("Invalid track index:", index); return; } currentTrackIndex = index; player.src = archivePlaylist[currentTrackIndex]; player.load(); console.log("Loading track:", currentTrackIndex, player.src); }
     function playTrack() { if (!player.src || player.readyState < 2) { console.log("Player not ready, delaying..."); player.load(); setTimeout(playTrack, 500); return; } playPauseBtn.classList.add('loading'); playPauseBtn.disabled = true; const playPromise = player.play(); if (playPromise !== undefined) { playPromise.then(_ => { playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; }).catch(error => { console.error("Audio play failed:", error); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; }); } else { playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; } }
     function pauseTrack() { player.pause(); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; playPauseBtn.classList.remove('loading'); playPauseBtn.disabled = false; }
     function togglePlayPause() { if (player.paused) { playTrack(); } else { pauseTrack(); } }
     function nextTrack() { const newIndex = (currentTrackIndex + 1) % archivePlaylist.length; loadTrack(newIndex); playTrack(); }
     function prevTrack() { const newIndex = (currentTrackIndex - 1 + archivePlaylist.length) % archivePlaylist.length; loadTrack(newIndex); playTrack(); }
     function toggleRepeat() { repeat = !repeat; repeatToggle.classList.toggle('active', repeat); repeatToggle.textContent = repeat ? "Repeat On" : "Repeat Off"; player.loop = repeat; console.log("Repeat mode:", repeat); }
     playPauseBtn.addEventListener('click', togglePlayPause); nextTrackBtn.addEventListener('click', nextTrack); prevTrackBtn.addEventListener('click', prevTrack); repeatToggle.addEventListener('click', toggleRepeat);
     player.addEventListener('loadedmetadata', () => { console.log("Metadata loaded. Duration:", player.duration); updateProgress(); });
     player.addEventListener('timeupdate', () => { if (!isDragging) { updateProgress(); } });
     player.addEventListener('ended', () => { console.log("Track ended."); if (!repeat) { nextTrack(); } });
     player.addEventListener('error', (e) => { console.error("Audio error:", e); setTimeout(nextTrack, 1000); });
     player.addEventListener('waiting', () => { console.log("Audio waiting..."); playPauseBtn.classList.add('loading'); });
     player.addEventListener('playing', () => { console.log("Audio playing..."); playPauseBtn.classList.remove('loading'); playPauseIcon.className = 'fas fa-pause'; playPauseBtn.title = "Pausa"; playPauseBtn.disabled = false; });
     player.addEventListener('pause', () => { console.log("Audio paused..."); playPauseBtn.classList.remove('loading'); playPauseIcon.className = 'fas fa-play'; playPauseBtn.title = "Reproducir"; });
     progressContainer.addEventListener('click', seek); progressContainer.addEventListener('mousedown', (e) => { isDragging = true; seek(e); document.addEventListener('mousemove', dragSeek); document.addEventListener('mouseup', stopDragSeek); });
     function seek(e) { if (!player.duration) return; const rect = progressContainer.getBoundingClientRect(); const offsetX = e.clientX - rect.left; const width = rect.width; const percentage = Math.max(0, Math.min(1, offsetX / width)); const seekTime = percentage * player.duration; player.currentTime = seekTime; updateProgress(); console.log(`Seek to: ${seekTime.toFixed(2)}s (${(percentage * 100).toFixed(1)}%)`); }
     function dragSeek(e) { if (!isDragging || !player.duration) return; const rect = progressContainer.getBoundingClientRect(); const offsetX = e.clientX - rect.left; const width = rect.width; const percentage = Math.max(0, Math.min(1, offsetX / width)); progressBar.style.width = `${percentage * 100}%`; }
     function stopDragSeek(e) { if (!isDragging || !player.duration) return; isDragging = false; seek(e); document.removeEventListener('mousemove', dragSeek); document.removeEventListener('mouseup', stopDragSeek); }
     function updateProgress() { if (!player.duration || isNaN(player.duration)) { progressBar.style.width = "0%"; timeIndicator.textContent = "00:00 / --:--"; return; } const percentage = (player.currentTime / player.duration) * 100; progressBar.style.width = `${percentage}%`; const currentTimeFormatted = formatTime(player.currentTime); const totalDurationFormatted = formatTime(player.duration); timeIndicator.textContent = `${currentTimeFormatted} / ${totalDurationFormatted}`; }
     function formatTime(seconds) { if (isNaN(seconds)) return '00:00'; const minutes = Math.floor(seconds / 60); const secs = Math.floor(seconds % 60); return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`; }
     document.addEventListener('DOMContentLoaded', loadInitialTrack);
   </script>

</body>
</html>