<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía Rápida de Primeros Auxilios Básicos</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Primeros Auxilios --- */
        :root {
            --color-primary: #007bff; /* Azul claro/medio (Confianza) */
            --color-secondary: #28a745; /* Verde (Seguridad, Salud) */
            --color-danger: #dc3545; /* Rojo (Alerta) */
            --color-background: #ffffff; /* Blanco (Limpieza) */
            --color-text: #212529; /* Negro suave */
            --color-text-muted: #6c757d; /* Gris medio */
            --color-modal-bg: #f8f9fa; /* Gris muy claro para modal */
            --color-border: #dee2e6; /* Gris claro para bordes */
            --shadow-sm: 0 .125rem .25rem rgba(0,0,0,.075);
            --shadow-md: 0 .5rem 1rem rgba(0,0,0,.15);
            --shadow-lg: 0 1rem 3rem rgba(0,0,0,.175);
            --border-radius: 5px;
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Open Sans', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.65; }
        /* Usar Lato para títulos para un toque diferente pero legible */
        h1, h2, h3, h4, .logo { font-family: 'Lato', sans-serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: var(--color-background); box-shadow: var(--shadow-sm); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25); /* Azul foco */
        }
        #search-container .fa-search {
            position: absolute;
            left: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
        .title-item {
            background-color: var(--color-background);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition-normal);
            text-align: center;
            font-weight: 600; /* Open Sans semi-bold */
            color: var(--color-text);
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            font-family: 'Open Sans', sans-serif;
        }
        .title-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 .25rem .5rem rgba(0,0,0,.1);
            border-color: var(--color-primary);
            color: var(--color-primary);
            background-color: #e7f3ff; /* Azul muy pálido */
        }
        #generate-more-btn {
            grid-column: 1 / -1;
            background-color: var(--color-secondary); /* Botón verde */
            color: white;
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Lato', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition-normal);
            margin-top: 1.5rem;
        }
        #generate-more-btn:hover:not(:disabled) {
            background-color: #218838; /* Verde más oscuro */
            box-shadow: var(--shadow-sm);
        }
        #generate-more-btn:disabled { background-color: #adb5bd; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }

        /* --- Modal Styling --- */
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(33, 37, 41, 0.8); display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 850px; /* Un poco más estrecho para texto */
            width: 95%;
            max-height: 90vh;
            min-height: 300px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            border: 1px solid #ccc; /* Borde sutil */
        }
        .modal-close-btn { position: absolute; top: 10px; right: 10px; background: #e9ecef; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 1.4rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: #ced4da; }
        #modal-title { font-size: 1.6rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }
        #modal-content { /* Scrollable text area */
            line-height: 1.7;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 10px 1.5rem 10px; /* Padding inferior */
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
            font-family: 'Open Sans', sans-serif; /* Fuente principal para el cuerpo */
        }
        #modal-content::-webkit-scrollbar { width: 8px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: 4px;}
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: 4px; border: 1px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.2em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { color: var(--color-danger); font-style: normal; font-weight: bold; } /* Énfasis en rojo/negrita para advertencias */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Lato', sans-serif; margin-top: 1.8em; margin-bottom: 0.8em; color: var(--color-primary); border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; font-weight: 700; }
        #modal-content h1 { font-size: 1.4em; }
        #modal-content h2 { font-size: 1.3em; }
        #modal-content h3 { font-size: 1.15em; color: #0056b3; } /* Azul más oscuro */
        #modal-content h4 { font-size: 1.05em; color: var(--color-text-muted); border-bottom: none; }
        /* --- Styling for WARNINGS/IMPORTANT NOTES --- */
        #modal-content .warning, #modal-content .important {
            background-color: #fff3cd; /* Amarillo pálido */
            border-left: 5px solid #ffc107; /* Amarillo */
            padding: 1em;
            margin: 1.5em 0;
            border-radius: var(--border-radius);
        }
        #modal-content .danger-warning {
            background-color: #f8d7da; /* Rojo pálido */
            border-left: 5px solid var(--color-danger); /* Rojo */
            padding: 1em;
            margin: 1.5em 0;
            border-radius: var(--border-radius);
            font-weight: bold;
            color: #721c24;
        }
        #modal-content .warning i, #modal-content .danger-warning i { margin-right: 0.7em; }

        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 75%; height: auto; margin: 2rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: #e9ecef; }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px; margin: 2rem auto 1rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 30px; height: 30px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 2.5rem; }

        /* --- Loading and Error Styling --- */
        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(248, 249, 250, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 50px; height: 50px; border: 5px solid #ced4da; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1rem auto; }
        #modal-loading p { font-weight: 600; color: var(--color-text); font-size: 1.1rem; font-family: 'Lato'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: var(--border-radius); border: 1px solid #f5c6cb; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2rem; grid-column: 1 / -1; font-style: italic; }
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-8">
         <div class="container mx-auto px-4 py-3 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fas fa-first-aid mr-3 text-red-600"></i> <!-- Icono Primeros Auxilios -->
                     Guía Rápida de Primeros Auxilios
                     <i class="fas fa-heartbeat ml-3 text-blue-500"></i> <!-- Icono Pulso -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Prepárate para Ayudar</h1>
             <p class="text-lg text-gray-700 mb-6 max-w-3xl mx-auto">Encuentra información clara y concisa sobre cómo actuar en situaciones comunes de emergencia. Busca una técnica o selecciona un tema.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-2xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar técnica o situación (ej: quemadura, asfixia)...">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-6 text-center mx-auto">
                 <i class="fas fa-medkit text-green-600 mr-2"></i> <!-- Icono Botiquín -->
                 Temas Comunes
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Cargando procedimientos...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Cargar Más Temas
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Consultando información vital...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-100 text-gray-700 py-6 mt-12 border-t border-gray-200">
          <div class="container mx-auto px-4 text-center text-sm">
              <p class="font-bold text-red-700"><i class="fas fa-exclamation-triangle mr-2"></i>IMPORTANTE: Esta guía es solo informativa y NO reemplaza la formación profesional en primeros auxilios.</p>
              <p class="mt-1">En caso de emergencia real, llama siempre a los servicios médicos profesionales (ej: 123 en Colombia, 911 en muchos países).</p>
              <p class="mt-2">Busca cursos certificados en tu localidad para aprender correctamente las técnicas.</p>
              <p class="mt-2">© 2025 Guía Rápida de Primeros Auxilios</p>
          </div>
      </footer>

    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // Principios Básicos y Evaluación
            "¿Qué son los Primeros Auxilios?", "Importancia de la Seguridad en la Escena", "Evaluación Primaria de la Víctima (Consciencia, Respiración, Pulso - Básico)", "Evaluación Secundaria (Buscar otras lesiones - Básico)", "Cómo Pedir Ayuda (Llamar a Emergencias)", "Información Clave al Llamar a Emergencias", "Consentimiento para Prestar Ayuda (Adultos Conscientes)", "Consentimiento Implícito (Inconscientes, Niños solos)", "Precauciones Universales (Higiene, Guantes)", "Mantener la Calma en una Emergencia", "Proteger a la Víctima del Frío/Calor", "Posición Lateral de Seguridad (Recuperación)", "¿Cuándo mover a una víctima?", "Botiquín Básico de Primeros Auxilios: Contenido Esencial", "Revisión Periódica del Botiquín", "Aspectos Legales Básicos (Ley del Buen Samaritano - Concepto)", "Manejo del Estrés Post-Incidente (Para el auxiliador)",
            // Heridas y Hemorragias
            "Limpieza de Heridas Menores (Rasguños, Cortes superficiales)", "Control de Sangrado Menor (Presión directa)", "Aplicación de Apósitos y Vendas (Básico)", "Signos de Infección en una Herida", "¿Qué hacer ante una Ampolla?", "Cómo tratar una Ampolla Rota", "Extracción Segura de Astillas Pequeñas", "Hemorragia Nasal (Epistaxis): Pasos a seguir", "Qué NO hacer en una Hemorragia Nasal", "Contusión (Moratón): Tratamiento inicial (Hielo)", "Reconocimiento de Hemorragia Severa", "Control de Hemorragia Severa (Presión Directa Fuerte)", "Elevación de la Extremidad (Si aplica y no hay fractura)", "Puntos de Presión Arterial (Concepto básico, precaución)", "Uso de Vendaje Compresivo (Básico)", "Torniquete: ¿Cuándo y Cómo? (¡ADVERTENCIA: SOLO ÚLTIMO RECURSO Y CON FORMACIÓN!)", "Reconocimiento de Hemorragia Interna (Signos y Síntomas)", "Primeros auxilios para sospecha de Hemorragia Interna", "Heridas Penetrantes (Objetos Clavados): Qué hacer", "Amputación Traumática: Primeros Pasos", "Cuidado del Muñón y de la Parte Amputada", "Heridas en el Cuero Cabelludo", "Heridas en la Cara", "Heridas en el Ojo (Superficiales, Químicos)", "Heridas en la Boca o Labios",
            // Quemaduras
            "Clasificación de Quemaduras (Primer, Segundo, Tercer Grado - Básico)", "Quemaduras de Primer Grado (Solares, Leves): Tratamiento", "Quemaduras de Segundo Grado (Superficiales, Pequeñas): Tratamiento", "Qué NO hacer con las Ampollas de Quemaduras", "Enfriamiento de Quemaduras (Agua fría)", "Cubrir la Quemadura (Apósito estéril, no adherente)", "Quemaduras Extensas o Profundas: Llamar a Emergencias", "Quemaduras Químicas: Lavado Abundante", "Quemaduras Eléctricas: Seguridad y Primeros Pasos", "Quemaduras por Inhalación de Humo (Signos)", "Quemaduras Solares Graves: Cuidados", "Prevención de Quemaduras en el Hogar",
            // Lesiones Musculoesqueléticas
            "Esguince: Reconocimiento Básico (Dolor, Hinchazón)", "Tratamiento Inicial de Esguinces (RICE/PRICE: Reposo, Hielo, Compresión, Elevación)", "Distensión Muscular (Tirón): Reconocimiento", "Tratamiento Inicial de Distensiones", "Fractura Cerrada: Reconocimiento (Deformidad, Dolor Intenso)", "Fractura Abierta: Reconocimiento y Peligros", "Inmovilización Básica de Sospecha de Fractura (Cabestrillo improvisado, Férula improvisada)", "Qué NO hacer si sospechas una Fractura", "Luxación (Dislocación): Reconocimiento Básico", "Primeros auxilios para Luxación (NO intentar reducir)", "Lesiones en Dedos (Mano y Pie)", "Lesiones de Rodilla (Esguinces comunes)", "Lesiones de Tobillo (Esguinces comunes)", "Calambres Musculares: Qué hacer", "Dolor de Espalda Agudo (No traumático): Primeros cuidados",
            // Asfixia y Problemas Respiratorios
            "Reconocimiento de Asfixia (Señal universal, No poder hablar/toser)", "Maniobra de Heimlich en Adultos Conscientes", "Maniobra de Heimlich en Niños Conscientes (>1 año)", "Qué hacer si estás Solo y te Asfixias", "Asfixia en Bebés (<1 año): Golpes en la Espalda y Compresiones Torácicas", "Asfixia en Persona Inconsciente (Iniciar RCP si no respira)", "Ataque de Asma: Reconocimiento", "Ayudar a usar un Inhalador de Rescate", "Cuándo llamar a Emergencias por Asma", "Hiperventilación: Causas y Manejo (Calmar, respiración lenta)", "Dificultad Respiratoria Súbita: Causas posibles y acción", "Reconocimiento de Paro Respiratorio",
            // Problemas Médicos Súbitos
            "Desmayo (Síncope): Causas comunes y Primeros Auxilios", "Posición de Recuperación tras Desmayo", "Convulsiones: Qué hacer Durante la Crisis (Proteger de lesiones)", "Qué hacer Después de una Convulsión", "Qué NO hacer durante una Convulsión", "Reconocimiento de Reacción Alérgica Leve (Picazón, Urticaria)", "Reconocimiento de Anafilaxia (Reacción Alérgica Severa)", "Signos de Anafilaxia (Dificultad respiratoria, Hinchazón, Mareo)", "Uso de Autoinyector de Epinefrina (Adrenalina) - Concepto y Ayuda", "Llamar a Emergencias INMEDIATAMENTE en Anafilaxia", "Dolor Torácico (Posible Ataque Cardíaco): Reconocimiento", "Primeros Auxilios para Dolor Torácico (Reposo, Llamar Emergencias, Aspirina si indicado)", "Accidente Cerebrovascular (ACV/Stroke): Reconocimiento (FAST/RÁPIDO)", "Actuación ante sospecha de ACV (Llamar Emergencias Urgente)", "Hipoglucemia (Baja Azúcar en Sangre) en Diabéticos: Reconocimiento", "Primeros Auxilios para Hipoglucemia Consciente (Dar azúcar)", "Hiperglucemia (Alta Azúcar en Sangre): Reconocimiento básico", "Crisis Epiléptica (Ver Convulsiones)", "Golpe de Calor: Reconocimiento (Piel caliente y seca, Confusión)", "Primeros Auxilios para Golpe de Calor (Enfriamiento rápido, Emergencia)", "Agotamiento por Calor: Reconocimiento (Sudoración, Debilidad)", "Primeros Auxilios para Agotamiento por Calor (Reposo, Hidratación, Enfriar)", "Hipotermia: Reconocimiento (Temblores, Confusión, Somnolencia)", "Primeros Auxilios para Hipotermia (Calentamiento gradual, Refugio)", "Congelación (Frostbite): Reconocimiento (Piel pálida/dura)", "Primeros Auxilios para Congelación (Calentamiento suave, NO frotar)", "Shock (Choque): Reconocimiento (Piel fría/pálida, Pulso rápido/débil, Confusión)", "Causas Comunes de Shock", "Primeros Auxilios para Shock (Posición, Mantener calor, Emergencia)",
            // Intoxicaciones y Envenenamientos
            "Intoxicación por Ingestión: Qué hacer (Llamar a Toxicología/Emergencias)", "Qué información dar al centro de toxicología", "NO provocar el vómito (Salvo indicación expresa)", "Intoxicación por Inhalación (Gases, Humo): Sacar a aire fresco, Emergencia", "Intoxicación por Contacto (Piel, Ojos): Lavado abundante", "Sobredosis de Medicamentos (Sospecha): Emergencia", "Intoxicación Alimentaria: Síntomas y Cuidados básicos",
            // Picaduras y Mordeduras
            "Picaduras de Insectos Comunes (Mosquitos, Hormigas): Limpieza, Frío local", "Picadura de Abeja/Avispa: Retirar aguijón (si visible), Frío local", "Reacción Alérgica a Picadura (Ver Anafilaxia)", "Picadura de Araña (Común, no peligrosa): Limpieza, Frío", "Cuándo preocuparse por una picadura de araña", "Picadura de Garrapata: Extracción segura", "Prevención de picaduras de garrapatas", "Mordedura de Animal (Perro, Gato): Limpieza, Riesgo de infección, Consulta médica", "Mordedura Humana: Limpieza, Riesgo de infección, Consulta médica", "Mordedura de Serpiente: Qué hacer (Calma, Inmovilizar, Emergencia)", "Qué NO hacer en Mordedura de Serpiente (NO torniquetes, NO succionar)", "Picadura de Medusa: Lavado con agua de mar/vinagre (según tipo), Calor/Frío",
            // Lesiones Específicas
            "Lesión en la Cabeza (Golpe Leve): Vigilancia de síntomas", "Signos de Alarma tras Golpe en la Cabeza (Pérdida consciencia, Vómitos, Confusión)", "Conmoción Cerebral: Reconocimiento básico", "Lesión Ocular (Cuerpo extraño superficial): Lavado suave", "Lesión Ocular (Golpe, Contusión): Frío local suave, Consulta", "Lesión Ocular (Objeto penetrante): NO retirar, Cubrir AMBOS ojos, Emergencia", "Lesión Dental (Diente roto/avulsionado): Cómo conservar el diente, Dentista urgente", "Obstrucción del Oído por Cuerpo Extraño (Insecto, objeto pequeño)", "Obstrucción Nasal por Cuerpo Extraño", "Sospecha de Lesión de Cuello o Espalda (Tras caída/accidente)", "Inmovilización de Cuello y Espalda (NO mover, esperar ayuda profesional)",
            // RCP y DEA (Conceptos introductorios - Énfasis en la necesidad de formación)
            "Importancia de la Reanimación Cardiopulmonar (RCP)", "Cadena de Supervivencia", "Compresiones Torácicas: Concepto básico (Ritmo y Profundidad)", "Ventilaciones de Rescate: Concepto básico", "RCP Solo con Compresiones (Hands-Only CPR)", "Cuándo Iniciar y Cuándo Detener la RCP (Básico)", "Desfibrilador Externo Automático (DEA): ¿Qué es?", "Importancia del DEA", "Pasos Generales para Usar un DEA (Seguir instrucciones)", "RCP en Niños (Diferencias básicas)", "RCP en Bebés (Diferencias básicas)", "*Recordatorio: La RCP y el uso del DEA requieren formación práctica certificada.*",
            // Prevención
            "Prevención de Caídas en el Hogar", "Seguridad en la Cocina (Prevención de cortes y quemaduras)", "Seguridad Eléctrica Básica", "Prevención de Ahogamientos (Piscinas, Bañeras)", "Seguridad Vial (Peatones, Ciclistas)", "Uso Correcto de Equipos de Protección Personal (Trabajo, Deporte)", "Importancia de las Vacunas para Prevenir Enfermedades"
            // ... (Continuar detallando y variando hasta ~400)
        ];
        const firstAidThemes = [ // Temas para generar más títulos
            "manejo de heridas", "control de hemorragias", "tratamiento de quemaduras", "lesiones deportivas comunes",
            "primeros auxilios pediátricos", "actuación ante asfixia", "manejo de desmayos y convulsiones",
            "reacciones alérgicas", "emergencias diabéticas", "golpe de calor e hipotermia", "intoxicaciones comunes",
            "picaduras y mordeduras", "lesiones en cabeza y ojos", "inmovilizaciones básicas", "contenido del botiquín",
            "seguridad en la escena", "cómo llamar a emergencias", "prevención de accidentes comunes",
            "RCP y DEA (conceptos)", "shock hipovolémico", "primeros auxilios en el hogar", "primeros auxilios en exteriores"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: `Eres un instructor certificado de primeros auxilios escribiendo una guía básica para principiantes (público general sin experiencia médica). Tu objetivo es explicar de forma CLARA, CONCISA y PRECISA qué hacer (y qué NO hacer) ante una situación específica. Usa lenguaje sencillo y directo. Si aplica, detalla pasos numerados. Incluye signos clave de reconocimiento. **ENFATIZA SIEMPRE CUÁNDO ES CRUCIAL LLAMAR A LOS SERVICIOS DE EMERGENCIA PROFESIONALES (ej: 123, 911) o buscar atención médica urgente.** Añade advertencias importantes (usando frases como '¡IMPORTANTE!', '¡NUNCA HAGAS ESTO!') cuando sea necesario. Incluye un breve recordatorio final de que esta información NO reemplaza un curso de formación práctica certificado. La extensión debe ser de aproximadamente 1200-1300 palabras. Basa tu explicación únicamente en el siguiente tema de primeros auxilios:`,
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: `Actúa como un generador de ideas conciso para una guía de primeros auxilios para principiantes. Genera exactamente 15 títulos de temas, técnicas o situaciones comunes de primeros auxilios básicos. Deben ser preguntas ('¿Qué hacer si...?') o frases claras ('Manejo de...', 'Reconocimiento de...'). Devuelve *solo* la lista de títulos, uno por línea. No incluyas números, guiones, introducciones ni despedidas.`,
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ========== (Igual que versión Colombia)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null;

        // ========== API FUNCTIONS ==========
        async function fetchTextFromApi(prompt, config) { /* ... Sin cambios ... */
            const encodedPrompt = encodeURIComponent(prompt);
            const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                const text = await response.text();
                if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                throw new Error(`Error de comunicación con la API: ${error.message}`);
            }
        }
        async function fetchExplanationText(conceptTitle) { /* ... Sin cambios ... */
             const text = await fetchTextFromApi(conceptTitle, textApiConfig);
              // Ajustar verificación mínima, primeros auxilios puede ser más corto pero denso
              if (text.trim().length < 500 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                   throw new Error("La IA no pudo generar una explicación adecuada o suficientemente detallada para este tema.");
               }
             return text;
        }
        async function fetchGeneratedTitles() { /* ... Sin cambios ... */
            const randomTheme = getRandomElement(firstAidThemes) || "situaciones comunes de primeros auxilios";
            const specificPrompt = `Genera 15 temas o preguntas clave sobre ${randomTheme} para principiantes`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 10 && line.length < 150);
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de temas.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a PRIMEROS AUXILIOS
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 600, height: 400, nologo: true }; // Imagen más pequeña
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText.split(':')[0].trim() : "concepto de primeros auxilios"; // Simplificar prompt
            // Prompt ENFOCADO en concepto, seguridad, ayuda. NO gráfico.
            const enhancedPrompt = `Clean, minimalist, symbolic illustration representing the first aid concept of '${safePromptText}'. Focus on safety, care, helping hands, or basic tools (bandage, water). Use a clean color palette (blue, white, green). Avoid realistic depictions of injury.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            // ** NEGATIVE PROMPT CRUCIAL **
            const negativePrompt = "blood, gore, graphic injury, open wound, suffering, pain, surgery, needles, detailed medical procedure, realistic human figures, text, labels, words, diagram, chart, complex scene";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ==========
        function formatExplanationText(rawText) {
             if (!rawText) return '';
             let formatted = rawText.trim();

             // --- Enfatizar Advertencias y Notas Clave ---
             // Buscar patrones como "¡IMPORTANTE!", "¡ADVERTENCIA!", "NUNCA...", "NO...", "LLAMAR A EMERGENCIAS", "BUSCAR AYUDA MÉDICA"
             // y envolverlos o el párrafo que los contiene en clases CSS.

             // Convertir markdown básico
             formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
             formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
             formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
             formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
             formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
             // Usar <em> para advertencias o puntos clave en rojo/negrita (definido en CSS)
             formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');

             // Envolver párrafos que contengan frases clave en divs con clases
             const blocks = formatted.split(/\n\s*\n/);
             formatted = blocks.map(block => {
                 let trimmedBlock = block.trim();
                 if (trimmedBlock.length === 0) return '';

                 // Mantener encabezados existentes
                 if (trimmedBlock.startsWith('<h')) return trimmedBlock;

                 // Buscar palabras/frases clave para aplicar estilos de advertencia
                 const lowerBlock = trimmedBlock.toLowerCase();
                 let blockClass = '';
                 if (lowerBlock.includes('¡nunca') || lowerBlock.includes(' no ') || lowerBlock.includes('¡no ') || lowerBlock.includes('peligro') || lowerBlock.includes('riesgo grave') || lowerBlock.includes('¡advertencia!')) {
                      // Podríamos ser más específicos, pero esto captura muchas negaciones/advertencias.
                      // Si contiene "emergencias" o "médica urgente", priorizar 'danger-warning'
                      if (lowerBlock.includes('emergencias') || lowerBlock.includes('médica urgente') || lowerBlock.includes('llamar al 123') || lowerBlock.includes('llamar al 911')) {
                          blockClass = 'danger-warning';
                      } else {
                          // Podría ser una advertencia menos crítica, usar 'warning' o simplemente <em>
                          // Por ahora, dejaremos que <em> maneje la mayoría de '*'
                      }
                 } else if (lowerBlock.includes('¡importante!') || lowerBlock.includes('recuerda') || lowerBlock.includes('clave:')) {
                     blockClass = 'warning'; // Nota importante pero no necesariamente peligrosa
                 }


                 // Convertir saltos de línea internos a <br> y envolver en <p> o <div.warning/danger>
                 let content = trimmedBlock.replace(/\n/g, '<br>');
                 if (blockClass) {
                     // Añadir icono si es advertencia
                     let icon = '';
                     if (blockClass === 'danger-warning') icon = '<i class="fas fa-exclamation-triangle"></i> ';
                     if (blockClass === 'warning') icon = '<i class="fas fa-info-circle"></i> ';
                     return `<div class="${blockClass}">${icon}${content}</div>`;
                 } else {
                     return `<p>${content}</p>`;
                 }
             }).join('');

             return formatted;
        }


        // ========== MODAL FUNCTIONS ========== (Igual que versiones anteriores)
        function showModal() { /* ... */ if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { /* ... */ if(!storyModal || !modalContent) return; storyModal.classList.remove('active'); document.body.style.overflow = ''; modalContent.scrollTop = 0; console.log("Scroll set to 0 on hideModal"); resetModalState(); }
        function resetModalState() { /* ... */ if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return; modalLoadingIndicator.style.display = 'flex'; modalStoryContentArea.classList.add('content-hidden'); modalError.classList.add('content-hidden'); modalTitle.textContent = ''; modalContent.innerHTML = ''; modalErrorMessage.textContent = ''; }

        // ========== UI & EVENT HANDLERS ========== (Incluyendo Search y Load More, igual que Colombia)
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... */ if (!titleListContainer || !titlesLoading) return; const shuffledTitles = shuffleArray([...titles]); titleListContainer.innerHTML = ''; titlesLoading.style.display = 'none'; if (shuffledTitles.length === 0) { showNoResultsMessage("No hay temas iniciales disponibles."); return; } shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title))); filterTitles(); }
        function appendTitles(newTitles) { /* ... */ if (!titleListContainer || !newTitles || newTitles.length === 0) return; const searchTerm = searchInput.value.toLowerCase().trim(); newTitles.forEach(title => { const item = createTitleItem(title); if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) { item.style.display = 'flex'; } else { item.style.display = 'none'; } titleListContainer.appendChild(item); }); checkIfAnyResultsVisible(); }
        function filterTitles() { /* ... */ if (!searchInput || !titleListContainer) return; const searchTerm = searchInput.value.toLowerCase().trim(); const titleItems = titleListContainer.querySelectorAll('.title-item'); let visibleCount = 0; titleItems.forEach(item => { const title = item.textContent.toLowerCase(); if (title.includes(searchTerm)) { item.style.display = 'flex'; visibleCount++; } else { item.style.display = 'none'; } }); updateNoResultsMessage(visibleCount); }
        function updateNoResultsMessage(visibleCount) { /* ... */ if (!titleListContainer) return; if (noResultsMessageElement) { noResultsMessageElement.remove(); noResultsMessageElement = null; } if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') { showNoResultsMessage(`No se encontraron temas para "${searchInput.value}"`); } }
        function showNoResultsMessage(message) { /* ... */ if (noResultsMessageElement || !titleListContainer) return; noResultsMessageElement = document.createElement('p'); noResultsMessageElement.id = 'no-results-message'; noResultsMessageElement.textContent = message; titleListContainer.appendChild(noResultsMessageElement); }
        function checkIfAnyResultsVisible() { /* ... */ const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])'); updateNoResultsMessage(visibleItems.length); }

        // *** handleTitleClick MODIFIED SLIGHTLY for placeholder icon ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                // 1. Fetch and format text
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                // 2. Stop loading indicator, display text FIRST
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                 // 3. RESET SCROLL after text content is in and visible
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                // 4. Prepare and append image placeholder WITHIN #modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-image placeholder-icon"></i> <!-- Generic image icon -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Cargando ilustración...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // 5. Create and append the actual image element
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Ilustración conceptual sobre ${title}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-image-slash placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la ilustración.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement); // Append after placeholder is added
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error al cargar la información: ${error.message}`; // User-friendly error
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
            }
        }

        // *** handleGenerateMoreTitles MODIFIED for button text ***
        async function handleGenerateMoreTitles() {
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i');
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden');
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Cargando..."; // Update text

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer);
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se pudieron cargar más temas en este momento.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al cargar temas: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden');
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Cargar Más Temas"; // Restore text
                 checkIfAnyResultsVisible();
             }
         }


        // ========== INITIALIZATION ========== (Igual que Colombia)
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Crítico: No se pudo cargar la guía de primeros auxilios.</p>'; return; }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            searchInput.addEventListener('input', filterTitles);
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>