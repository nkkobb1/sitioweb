<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsenal del Futuro: Armas Avanzadas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Using standard fonts, Lato/Merriweather, styled for tech theme -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Armas Avanzadas --- */
        :root {
            --color-primary: #00ffff; /* Cyan Eléctrico */
            --color-secondary: #ff3131; /* Rojo Alerta */
            --color-background: #0a192f; /* Azul Muy Oscuro (Navy) */
            --color-text: #ccd6f6; /* Azul Grisáceo Claro (Texto principal) */
            --color-text-muted: #8892b0; /* Azul Grisáceo Medio */
            --color-modal-bg: #112240; /* Azul Oscuro ligeramente más claro */
            --color-border: #233554; /* Azul Grisáceo Oscuro para bordes */
            --shadow-sm: 0 1px 2px 0 rgba(0, 255, 255, 0.1); /* Sombra Cyan sutil */
            --shadow-md: 0 4px 6px -1px rgba(0, 255, 255, 0.15), 0 2px 4px -2px rgba(0, 255, 255, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.2); /* Sombra oscura más genérica */
            --border-radius: 4px; /* Bordes afilados */
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Merriweather', serif; font-weight: 700; }
        .logo { color: var(--color-primary); text-shadow: 0 0 5px rgba(0, 255, 255, 0.5); }
        h1.page-title { color: var(--color-primary); text-shadow: 0 0 8px rgba(0, 255, 255, 0.4); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); text-shadow: 0 0 3px rgba(0, 255, 255, 0.3); }
        .navbar { background-color: rgba(10, 25, 47, 0.85); backdrop-filter: blur(5px); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2.5rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.9rem 1.2rem 0.9rem 3rem; /* Padding left for icon */
            background-color: var(--color-modal-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            color: var(--color-text);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: var(--transition-normal);
        }
        #search-input::placeholder { color: var(--color-text-muted); opacity: 0.7; }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(0, 255, 255, 0.2);
        }
        #search-container .fa-search {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .title-item {
            background-color: var(--color-modal-bg);
            padding: 1.5rem 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition-normal);
            text-align: center;
            font-weight: 600;
            color: var(--color-text);
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            font-family: 'Lato', sans-serif;
            position: relative;
            overflow: hidden;
        }
         /* Subtle hover effect */
        .title-item:before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(0, 255, 255, 0.1), transparent); transition: left 0.4s ease; }
        .title-item:hover:before { left: 100%; }
        .title-item:hover { transform: translateY(-3px); border-color: var(--color-primary); color: var(--color-primary); box-shadow: 0 4px 10px rgba(0, 255, 255, 0.15); }

        #generate-more-btn { grid-column: 1 / -1; background-color: transparent; color: var(--color-primary); border: 1px solid var(--color-primary); padding: 0.8rem 1.6rem; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: bold; cursor: pointer; transition: var(--transition-normal); margin-top: 2rem; text-transform: uppercase; letter-spacing: 1px; }
        #generate-more-btn:hover:not(:disabled) { background-color: rgba(0, 255, 255, 0.1); box-shadow: 0 0 8px rgba(0, 255, 255, 0.3); }
        #generate-more-btn:disabled { border-color: var(--color-text-muted); color: var(--color-text-muted); cursor: not-allowed; opacity: 0.6; }
        #generate-more-btn .fa-sync-alt { color: var(--color-primary); transition: color 0.2s ease; }
        #generate-more-btn:disabled .fa-sync-alt { color: var(--color-text-muted); }

        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 950px;
            width: 95%;
            max-height: 90vh;
            min-height: 350px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--color-border);
        }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #233554; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.6rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: var(--color-primary); color: var(--color-background); transform: rotate(90deg); }
        #modal-title { font-size: 1.9rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1.5rem; line-height: 1.3; }
        #modal-content { /* Scrollable content area */
            line-height: 1.75;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px;
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 10px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.3em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { color: #a8b2d1; font-style: italic; } /* Lighter text color for emphasis */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Merriweather', serif; margin-top: 2.1em; margin-bottom: 1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.4em; font-weight: bold; }
        #modal-content h1 { font-size: 1.55em; }
        #modal-content h2 { font-size: 1.4em; }
        #modal-content h3 { font-size: 1.25em; color: #a8b2d1; } /* Lighter heading color */
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none; }
        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 80%; height: auto; margin: 2.5rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: 0 0 10px rgba(0, 255, 255, 0.1); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2.5rem auto 1rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(204, 214, 246, 0.1); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(17, 34, 64, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #233554; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.2rem; font-family: 'Lato'; text-shadow: 0 0 3px rgba(0, 255, 255, 0.2); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: rgba(255, 49, 49, 0.1); color: var(--color-secondary); padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid var(--color-secondary); margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2rem; grid-column: 1 / -1; font-style: italic; }
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-4 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-3xl sm:text-4xl">
                     <i class="fas fa-atom mr-3 transform rotate-[-15deg]"></i> <!-- Icono átomo/tecnología -->
                     Arsenal del Futuro
                     <i class="fas fa-crosshairs ml-3 transform rotate-[15deg]"></i> <!-- Icono mira -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-5xl sm:text-6xl mb-5">Tecnologías de Defensa y Ataque Avanzadas</h1>
             <p class="text-xl text-gray-400 mb-8 max-w-3xl mx-auto">Explora el arsenal del mañana: desde energía dirigida hasta enjambres autónomos. Busca un sistema o selecciona uno para analizar sus capacidades.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-2xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar arma, tecnología o concepto...">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-3xl sm:text-4xl mb-8 text-center mx-auto">
                 <i class="fas fa-cogs text-cyan-400 mr-2"></i> <!-- Icono engranajes/tecnología -->
                 Sistemas y Conceptos
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Accediendo a la base de datos...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Solicitar Más Datos
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Analizando esquemáticos...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-950 text-gray-600 py-6 mt-12 border-t border-gray-800">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Análisis generados por IA con fines informativos y especulativos sobre tecnologías armamentísticas avanzadas.</p>
              <p class="mt-1">La información sobre sistemas reales puede ser limitada o simplificada. Contenido con fines educativos y de exploración conceptual.</p>
              <p class="mt-2">© 2025 Archivos Tecnológicos Avanzados</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // --- Energía Dirigida (DEW) ---
            "Armas Láser de Alta Energía (HEL)", "Sistema de Armas Láser (LaWS) de la US Navy", "Proyecto THEL (Tactical High Energy Laser)", "Láseres de Estado Sólido (SSL)", "Láseres de Fibra Óptica", "Láseres Químicos (DF, COIL)", "Láseres de Electrones Libres (FEL)", "Armas de Microondas de Alta Potencia (HPM)", "Sistema Active Denial System (ADS)", "Proyecto CHAMP (Counter-electronics High Power Microwave Advanced Missile Project)", "Armas de Rayos de Partículas (Neutras y Cargadas)", "Cañones de Plasma", "Proyectores de Plasma (Concepto Sci-Fi)", "Armas Sónicas / Acústicas (LRAD, etc.)", "Armas de Infrasonido (Concepto/Controversia)", "Armas de Pulso Electromagnético (EMP)", "Generadores de EMP No Nucleares (NNEMP)", "Bombas de EMP (e-bombs)", "Contramedidas contra Energía Dirigida", "Deslumbramiento Láser (Laser Dazzlers)", "Potencia y Enfriamiento para DEW", "Efectos Atmosféricos en DEW", "Aplicaciones Anti-Dron de DEW", "Aplicaciones Anti-Misil de DEW", "Aplicaciones Anti-Personal de DEW (Controversia)", "Armas de Radiofrecuencia (RF)", "Armas de Rayos Gamma (Concepto)", "Láseres de Rayos X (Concepto)", "Cañones de Iones (Propulsión y Arma Sci-Fi)", "Disruptores sónicos (Sci-Fi)",
            // --- Armas Cinéticas Avanzadas ---
            "Cañones de Riel (Railgun)", "Programa Railgun de la US Navy", "Proyectiles Hipervelocidad (HVP)", "Cañones de Bobina (Coilgun / Gauss Gun)", "Munición Sin Vaina (Caseless Ammunition)", "Programa ACR (Advanced Combat Rifle)", "Fusil Heckler & Koch G11", "Munición Telescópica Encapsulada (Cased Telescoped Ammunition)", "Programa LSAT (Lightweight Small Arms Technologies)", "Balas Inteligentes (Guiadas / Autocorregibles)", "Proyecto EXACTO (Extreme Accuracy Tasked Ordnance)", "Munición Airburst (Explosión Aérea Programable)", "XM25 CDTE (Counter Defilade Target Engagement)", "Fusiles Anti-Material Avanzados (Calibres Grandes)", "Escopetas de Combate Avanzadas (AA-12, etc.)", "Lanzagranadas Automáticos Avanzados (Mk 19, Mk 47)", "Cañones Automáticos Avanzados (Bushmaster, etc.)", "Proyectiles de Energía Cinética Penetrante (KEP / APFSDS)", "Munición de Uranio Empobrecido (DU)", "Munición de Tungsteno", "Proyectiles Asistidos por Cohete (RAP)", "Proyectiles de Base Bleed", "Proyectiles Subcalibrados", "Flechettes", "Misiles Hipersónicos", "Vehículos de Planeo Hipersónico (HGV)", "Misiles de Crucero Hipersónicos (HCM)", "Avangard (Sistema Ruso HGV)", "DF-ZF (Sistema Chino HGV)", "AGM-183 ARRW (US Air Force)", "Programa HAWC (Hypersonic Air-breathing Weapon Concept)", "Kinzhal (Misil Ruso Aerobalístico)", "BrahMos II (Misil Indo-Ruso)", "Scramjets y Motores Hipersónicos", "Materiales para Vehículos Hipersónicos", "Defensa contra Amenazas Hipersónicas", "Sistema 'Rods from God' / Bombardeo Cinético Orbital", "Proyectiles de Plasma Encapsulado (Concepto)", "Cañones de Masa (Mass Drivers) (Concepto Espacial)", "Cañones Electrotérmicos-Químicos (ETC)", "Armas de Aire Comprimido de Alta Potencia", "Lanzadores de Proyectiles Neumáticos Avanzados", "Proyectiles con Guía GPS/INS Avanzada", "Munición con Sensor de Proximidad", "Munición Penetrante de Búnkeres Avanzada", "Cañones de Agua a Alta Presión (Control de Disturbios)",
            // --- Explosivos y Guerra Química/Biológica Avanzada ---
            "Explosivos Plásticos Avanzados (PBX, etc.)", "Explosivos Insensibles (IMX)", "Explosivos Termobáricos / Fuel-Air Explosives (FAE)", "Granadas Termobáricas (RPG-7 Thermobaric, RPO-A Shmel)", "MOAB (Massive Ordnance Air Blast)", "FOAB (Father of All Bombs - Rusia)", "Tecnología de Carga Hueca Avanzada (Shaped Charge)", "Penetradores Formados por Explosión (EFP)", "Minas Inteligentes / Conectadas en Red", "Minas Anti-Helicóptero", "Sistemas de Denegación de Área Activa (AADS)", "Agentes Nerviosos de Nueva Generación (Novichok, etc.)", "Agentes Sanguíneos Avanzados", "Agentes Incapacitantes / Psicótropos (BZ, etc. - Histórico/Avanzado)", "Toxinas Biológicas Avanzadas (Ricina modificada, etc.)", "Armas Biológicas de Diseño / Ingeniería Genética", "Virus Sintéticos / Armados", "Agentes Biológicos Específicos de Genotipo (Concepto)", "Guerra Entomológica (Uso de Insectos)", "Agentes Químicos Binarios", "Microencapsulación de Agentes Químicos/Biológicos", "Sistemas de Dispersión Avanzados (Aerosoles, etc.)", "Defensa NBQ (Nuclear, Biológica, Química) Avanzada", "Trajes de Protección NBQ Ligeros", "Sistemas de Detección NBQ Remota / Standoff", "Descontaminación NBQ Rápida", "Nanotecnología en Explosivos (Nano-thermite, etc.)", "Nanobots Explosivos (Concepto)", "Armas de Pulso de Vacío (Concepto Sci-Fi)", "Explosivos con Forma de Onda Adaptable", "Detonadores Remotos Seguros / Avanzados", "Guerra Herbicida Avanzada (Concepto)", "Feromonas Sintéticas como Arma (Concepto)",
            // --- Robótica, Drones y Sistemas Autónomos ---
            "Vehículos Aéreos de Combate No Tripulados (UCAV)", "MQ-9 Reaper", "MQ-1C Gray Eagle", "Bayraktar TB2", "Wing Loong II", "General Atomics Avenger", "Northrop Grumman X-47B (Demostrador)", "Boeing MQ-25 Stingray (Reabastecimiento)", "Dassault nEUROn (Demostrador Europeo)", "BAE Systems Taranis (Demostrador UK)", "Sukhoi S-70 Okhotnik-B (Rusia)", "Enjambres de Drones (Drone Swarms)", "Programa Gremlins (DARPA)", "Programa LOCUST (Low-Cost UAV Swarming Technology - ONR)", "Microdrones / Nanodrones", "Black Hornet Nano", "Drones Kamikaze / Municiones Merodeadoras (Loitering Munitions)", "Switchblade (AeroVironment)", "Harop (IAI)", "Lancet (ZALA Aero)", "Vehículos Terrestres No Tripulados (UGV)", "TALON (Foster-Miller)", "PackBot (iRobot)", "Gladiator TUGV", "Vehículos Terrestres de Combate Robótico (RCV - US Army)", "URAN-9 (Rusia)", "Type-X RCV (Milrem Robotics)", "Vehículos de Superficie No Tripulados (USV)", "Sea Hunter (DARPA/Leidos)", "Common Unmanned Surface Vehicle (CUSV)", "Vehículos Submarinos No Tripulados (UUV / AUV)", "Boeing Echo Voyager", "Poseidon (Status-6) (Torpedo Nuclear Autónomo Ruso)", "Orca XLUUV (Boeing)", "Robots de Combate Humanoides (Concepto/Sci-Fi)", "Exoesqueletos Militares / Powered Armor", "HULC (Human Universal Load Carrier)", "TALOS (Tactical Assault Light Operator Suit - Concepto)", "SARCOS Guardian XO", "ONYX (Lockheed Martin)", "Inteligencia Artificial (IA) para Selección de Objetivos", "Sistemas Letales Autónomos (LAWS) - Debate Ético", "Navegación Autónoma en Entornos Denegados (GPS-denied)", "Fusión de Sensores en Plataformas Robóticas", "Comunicación Segura para Sistemas Robóticos", "Colaboración Humano-Robot en Combate (MUM-T)", "Robots para Desactivación de Explosivos (EOD)", "Robots de Reconocimiento y Vigilancia", "Plataformas Modulares Robóticas", "Bio-robots / Cyborgs Militares (Concepto)", "Guerra de Enjambres (Swarm Warfare)", "Perros Robot (Boston Dynamics Spot - Uso Militar)", "Robots de Logística Autónoma",
            // --- Guerra Electrónica, Cibernética y Espacial ---
            "Guerra Electrónica (EW) Cognitiva / Adaptativa", "Sistemas de Contramedidas Electrónicas (ECM) Avanzados", "Sistemas de Apoyo Electrónico (ESM) Pasivos", "Sistemas de Ataque Electrónico (EA) Standoff", "EA-18G Growler (Avión EW)", "Next Generation Jammer (NGJ)", "Guerra de Redes (Network Warfare)", "Ataques de Denegación de Servicio (DDoS) a Nivel Militar", "Malware Militar Específico (Stuxnet, etc.)", "Implantes Cibernéticos / Troyanos de Hardware", "Ciberataques a Infraestructuras Críticas", "Guerra de Información / Desinformación Digital", "Deepfakes como Arma Psicológica", "Inteligencia Artificial para Ciberdefensa y Ciberataque", "Computación Cuántica y Criptografía (Amenazas y Defensas)", "Armas Anti-Satélite (ASAT)", "Misiles ASAT de Ascenso Directo (DA-ASAT)", "Sistemas Co-orbitales ASAT", "Armas ASAT de Energía Dirigida", "Guerra Electrónica Espacial (Contra Comunicaciones Satelitales)", "Armas Espaciales Ofensivas (Orbital Bombardment - Concepto)", "Sistemas de Defensa Espacial", "Vigilancia y Seguimiento Espacial (SSA)", "Constelaciones de Satélites Militares (ISR, Comunicación, PNT)", "Satélites Sigilosos (Stealth Satellites)", "Satélites de Inspección / Reparación (Potencial Dual)", "Armas de Interferencia GPS/GNSS", "Spoofing de Señales GPS", "Guerra Psicológica Asistida por IA", "Manipulación de Mercados Financieros como Arma", "Ataques a Sistemas de Mando y Control (C2)", "Guerra Centrada en Redes (Network-Centric Warfare)", "Tecnología Blockchain para Seguridad Militar",
            // --- Defensas Avanzadas y Materiales ---
            "Sistemas de Protección Activa (APS) para Vehículos", "Trophy (Rafael)", "Iron Fist (IMI)", "Arena (Rusia)", "Shtora (Contramedidas IR)", "Sistemas Hard-Kill vs Soft-Kill", "Blindaje Reactivo Avanzado (ERA)", "Relikt (ERA Rusa)", "Blindaje Compuesto (Chobham, etc.)", "Materiales Cerámicos Avanzados para Blindaje", "Blindaje Espaciado / Modular", "Blindaje Transparente Avanzado (ALON, Espinela)", "Metamateriales para Blindaje / Camuflaje", "Camuflaje Activo / Adaptativo", "Tecnología Stealth (Furtividad)", "Materiales Absorbentes de Radar (RAM)", "Diseño de Baja Observabilidad (LO)", "F-22 Raptor", "F-35 Lightning II", "B-2 Spirit", "Sukhoi Su-57", "Chengdu J-20", "Contramedidas Infrarrojas Dirigidas (DIRCM)", "AN/AAQ-24 Nemesis", "Señuelos (Flares, Chaff) Avanzados", "Camuflaje Térmico", "Camuflaje Óptico (Concepto Sci-Fi)", "Escudos de Energía / Campos de Fuerza (Concepto Sci-Fi)", "Materiales Autorreparables", "Nanomateriales para Blindaje (Grafeno, Nanotubos)", "Aerogeles para Aislamiento/Protección", "Sistemas de Defensa Antiaérea Integrados (IADS)", "S-400 Triumf (Rusia)", "S-500 Prometey (Rusia)", "Patriot Advanced Capability-3 (PAC-3)", "Terminal High Altitude Area Defense (THAAD)", "Iron Dome (Israel)", "David's Sling (Israel)", "Arrow 3 (Israel)", "AEGIS Combat System / SM-3 / SM-6", "Sistemas CIWS (Close-In Weapon System) Avanzados", "Phalanx CIWS", "Goalkeeper CIWS", "Kashtan/Kortik (Rusia)", "Pantsir-S1 (Rusia)", "Defensa contra Enjambres de Drones", "Redes de Sensores Distribuidos", "Fusión de Datos Multi-Sensor",
            // --- Conceptos y Tecnologías Subyacentes ---
            "Inteligencia Artificial en el Campo de Batalla", "Aprendizaje Automático para ISR (Inteligencia, Vigilancia, Reconocimiento)", "Mantenimiento Predictivo Basado en IA", "Logística Autónoma", "Realidad Aumentada (AR) para Soldados", "Integrated Visual Augmentation System (IVAS - US Army)", "Interfaz Cerebro-Computadora (BCI) Militar (Concepto)", "Soldado del Futuro (Programas: FELIN, IdZ, Nett Warrior)", "Computación Neuromórfica para Procesamiento en el Borde", "Redes 5G/6G Militares Seguras", "Comunicaciones Cuánticas Seguras (Concepto)", "Radar Cuántico (Concepto)", "Sensores Cuánticos para Navegación/Detección", "Fuentes de Energía Compactas Avanzadas", "Baterías de Estado Sólido", "Micro-Reactores Nucleares Portátiles", "Generadores Termoeléctricos Avanzados", "Cosecha de Energía (Energy Harvesting) Militar", "Impresión 3D / Manufactura Aditiva Militar (Piezas, Drones, etc.)", "Biomimética en Diseño de Armas/Robots", "Materiales Inteligentes / Adaptativos", "Guerra Asimétrica y Tecnología Avanzada", "Ética de las Armas Autónomas", "Control de Armas y Tratados sobre Nuevas Tecnologías", "Proliferación de Tecnologías de Doble Uso", "El Futuro de la Guerra Naval", "El Futuro del Combate Aéreo", "El Futuro de la Guerra Terrestre", "Singularidad Tecnológica y Guerra", "Transhumanismo Militar (Concepto)", "Guerra Climática / Modificación Ambiental (Concepto/Controversia)"
        ];
        const advancedWeaponsThemes = [ // Temas para generar más títulos
            "armas de energía dirigida", "cañones de riel y gauss", "munición inteligente", "misiles hipersónicos",
            "drones de combate (UCAV)", "enjambres de drones", "robots militares terrestres (UGV)", "exoesqueletos militares",
            "armas cibernéticas", "guerra electrónica avanzada", "armas anti-satélite (ASAT)", "tecnología stealth (furtividad)",
            "sistemas de protección activa (APS)", "blindajes avanzados", "láseres de alta energía", "armas sónicas",
            "inteligencia artificial en armas", "armas autónomas letales (LAWS)", "guerra biológica de diseño", "nanotecnología militar",
            "armas espaciales", "defensa contra misiles balísticos", "explosivos avanzados", "armas no letales avanzadas",
            "computación cuántica y defensa", "armas conceptuales de ciencia ficción", "soldado del futuro", "materiales avanzados"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un analista de tecnología militar y defensa con perspectiva futurista. Tu tarea es describir y analizar armas, tecnologías o conceptos militares avanzados de forma detallada, objetiva y técnica, pero accesible para un público interesado. Explica el principio de funcionamiento, estado de desarrollo (conceptual, prototipo, desplegado), capacidades teóricas o demostradas, ventajas y desventajas, posibles contramedidas, y consideraciones estratégicas o éticas. Usa un lenguaje preciso y técnico cuando sea necesario, pero evita la jerga excesiva. El objetivo es un informe conciso de aproximadamente 1200-1300 palabras. Basa tu análisis únicamente en el siguiente sistema o concepto:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para un compendio de tecnología militar avanzada. Genera exactamente 15 nombres de armas avanzadas (reales, prototipos, conceptuales), tecnologías de defensa o conceptos estratégicos futuristas. Devuelve *solo* la lista de nombres, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ========== (Igual que Colombia)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null;

        // ========== API FUNCTIONS ========== (Sin cambios funcionales)
        async function fetchTextFromApi(prompt, config) { /* ... */
             const encodedPrompt = encodeURIComponent(prompt);
             const encodedSystem = encodeURIComponent(config.systemPrompt);
             const params = new URLSearchParams({ model: config.model, system: encodedSystem });
             if (config.seed) params.append('seed', config.seed);
             const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
             console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
             const controller = new AbortController();
             const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
             try {
                 const response = await fetch(url, { signal: controller.signal });
                 clearTimeout(timeoutId);
                 if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                 const text = await response.text();
                 if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                 console.log(`API Response received (${text.length} chars)`);
                 return text;
             } catch (error) {
                 clearTimeout(timeoutId);
                 console.error("API Fetch Error:", error);
                 if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                 throw new Error(`Error de comunicación con la API: ${error.message}`);
             }
         }
        async function fetchExplanationText(conceptTitle) { /* ... */
             const text = await fetchTextFromApi(conceptTitle, textApiConfig);
              if (text.trim().length < 800 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                   throw new Error("La IA no pudo generar un análisis adecuado o suficientemente detallado para este sistema.");
               }
             return text;
         }
        async function fetchGeneratedTitles() { /* ... */
             const randomTheme = getRandomElement(advancedWeaponsThemes) || "tecnologías militares emergentes";
             const specificPrompt = `Genera 15 nombres de armas, tecnologías o conceptos sobre ${randomTheme}`;
             console.log("Generating titles with prompt:", specificPrompt);
             const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
             const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
             const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 4 && line.length < 120);
             if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas.");
             return titles.slice(0, 15);
         }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a ARMAS AVANZADAS
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText.split('(')[0].trim() : "futuristic weapon concept";
            // Prompt ENFOCADO en concepto tecnológico, evitar violencia explícita
            const enhancedPrompt = `Futuristic concept art illustration of '${safePromptText}'. High-tech, detailed schematic or operational view. Metallic textures, glowing energy effects (like blue or cyan), sleek design. Focus on the technology itself. Cinematic lighting, dark background.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, writing, diagrams, charts, blood, gore, violence, injury, death, realistic people, soldiers, simple drawing, cartoon, photograph, multiple weapons, cluttered scene";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... */
             if (!rawText) return '';
             let formatted = rawText.trim();
             formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
             formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
             formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
             formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
             formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
             formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
             const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
             formatted = blocks.map(block => {
                 if (block.startsWith('<h')) return block;
                 let content = block.replace(/\n/g, '<br>');
                 return `<p>${content}</p>`;
             }).join('');
             return formatted;
         }

        // ========== MODAL FUNCTIONS ========== (Igual que Colombia)
        function showModal() { if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() {
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() {
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = '';
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ========== (Igual que Colombia)
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... */
             if (!titleListContainer || !titlesLoading) return;
             const shuffledTitles = shuffleArray([...titles]);
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if (shuffledTitles.length === 0) {
                 showNoResultsMessage("No hay sistemas iniciales en la base de datos.");
                 return;
             }
             shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
             filterTitles();
         }
        function appendTitles(newTitles) { /* ... */
             if (!titleListContainer || !newTitles || newTitles.length === 0) return;
             const searchTerm = searchInput.value.toLowerCase().trim();
             newTitles.forEach(title => {
                 const item = createTitleItem(title);
                 if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) {
                     item.style.display = 'flex';
                 } else {
                     item.style.display = 'none';
                 }
                 titleListContainer.appendChild(item);
             });
             checkIfAnyResultsVisible();
         }
        function filterTitles() { /* ... */
             if (!searchInput || !titleListContainer) return;
             const searchTerm = searchInput.value.toLowerCase().trim();
             const titleItems = titleListContainer.querySelectorAll('.title-item');
             let visibleCount = 0;
             titleItems.forEach(item => {
                 const title = item.textContent.toLowerCase();
                 if (title.includes(searchTerm)) {
                     item.style.display = 'flex';
                     visibleCount++;
                 } else {
                     item.style.display = 'none';
                 }
             });
             updateNoResultsMessage(visibleCount);
         }
        function updateNoResultsMessage(visibleCount) { /* ... */
              if (!titleListContainer) return;
              if (noResultsMessageElement) {
                  noResultsMessageElement.remove();
                  noResultsMessageElement = null;
              }
              if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') {
                  showNoResultsMessage(`No se encontraron sistemas para "${searchInput.value}"`);
              }
         }
        function showNoResultsMessage(message) { /* ... */
              if (noResultsMessageElement || !titleListContainer) return;
              noResultsMessageElement = document.createElement('p');
              noResultsMessageElement.id = 'no-results-message';
              noResultsMessageElement.textContent = message;
              titleListContainer.appendChild(noResultsMessageElement);
         }
        function checkIfAnyResultsVisible() { /* ... */
              const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])');
              updateNoResultsMessage(visibleItems.length);
          }

        // *** MODIFIED: handleTitleClick (Image logic same, icons themed) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                // 1. Fetch and format text
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                // 2. Stop loading indicator, display text FIRST
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                 // 3. RESET SCROLL after text content is in and visible
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                // 4. Prepare and append image placeholder WITHIN #modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-project-diagram placeholder-icon"></i> <!-- Themed icon -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Generando visualización conceptual...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // 5. Create and append the actual image element
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Visualización conceptual de ${title.split('(')[0].trim()}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-times-circle placeholder-icon" style="color: var(--color-secondary);"></i> <!-- Error icon -->
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al cargar visualización.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement);
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon" style="color: var(--color-secondary);"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
            }
        }

        async function handleGenerateMoreTitles() { // Themed text
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i');
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden');
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Solicitando...";

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer);
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se pudieron obtener más datos en este momento.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al solicitar datos: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden');
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Solicitar Más Datos";
                 checkIfAnyResultsVisible();
             }
         }


        // ========== INITIALIZATION ========== (Igual que Colombia)
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Crítico: Fallo al cargar la interfaz del Arsenal.</p>'; return; }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            searchInput.addEventListener('input', filterTitles);
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>