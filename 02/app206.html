<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mente Positiva - Cultivando Patrones Mentales</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fuentes Amigables -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Mente Positiva --- */
        :root {
            --color-primary: #3b82f6; /* Azul Suave */
            --color-secondary: #10b981; /* Verde Menta */
            --color-tertiary: #f59e0b; /* Amarillo Cálido */
            --color-background: #f9fafb; /* Gris Muy Claro / Blanco Hueso */
            --color-text: #374151; /* Gris Oscuro */
            --color-text-muted: #6b7280; /* Gris Medio */
            --color-modal-bg: #ffffff; /* Blanco */
            --color-border: #e5e7eb; /* Borde Gris Claro */
            --color-error-bg: #fff1f2; /* Fondo error rosa muy claro */
            --color-error-text: #be123c; /* Texto error rojo oscuro */
            --color-error-border: #fecdd3; /* Borde error rosa claro */

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 8px; /* Bordes más redondeados */
            --transition-normal: all 0.25s ease-in-out;
        }
        body { font-family: 'Nunito', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; font-weight: 400; }
        h1, h2, h3, h4, .logo { font-family: 'Lato', sans-serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); font-weight: 700; }
        h2.section-title { color: var(--color-text); border-bottom: 3px solid var(--color-primary); padding-bottom: 0.6rem; display: inline-block; font-weight: 700; }
        #modal-title { color: var(--color-primary); font-weight: 700; }
        .navbar { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }
        /* Estilos Buscador */
        #search-container { margin-bottom: 2.5rem; position: relative; }
        #search-input { width: 100%; padding: 0.9rem 1.2rem 0.9rem 3rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1rem; background-color: #fff; color: var(--color-text); box-shadow: var(--shadow-sm); transition: var(--transition-normal); font-family: 'Nunito'; }
        #search-input::placeholder { color: var(--color-text-muted); }
        #search-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); outline: none; }
        #search-container .fa-search { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--color-text-muted); font-size: 1.1rem; transition: color 0.2s ease; }
        #search-input:focus + .fa-search { color: var(--color-primary); }

        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1.2rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.3rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 600; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 70px; font-family: 'Nunito'; font-size: 0.95rem; }
        .title-item:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); border-color: var(--color-primary); color: var(--color-primary); background-color: #eff6ff; /* Azul muy claro hover */ }
        #generate-more-btn { grid-column: 1 / -1; /* Ocupa todo el ancho */ background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: 700; cursor: pointer; transition: var(--transition-normal); margin-top: 2rem; letter-spacing: 0.5px; text-shadow: none; }
        #generate-more-btn:hover:not(:disabled) { background: linear-gradient(45deg, var(--color-secondary), var(--color-primary)); box-shadow: var(--shadow-md); transform: scale(1.02); }
        #generate-more-btn:disabled { background: var(--color-border); color: var(--color-text-muted); cursor: not-allowed; opacity: 0.7; transform: none; box-shadow: none; }
        #generate-more-btn .fa-sync-alt { color: white; }

        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(107, 114, 128, 0.8); /* Overlay gris */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem 2rem;
            max-width: 950px;
            width: 95%;
            max-height: 90vh;
            min-height: 400px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }
        .modal-close-btn { position: absolute; top: 12px; right: 12px; background: #f3f4f6; border: none; border-radius: 50%; width: 38px; height: 38px; font-size: 1.7rem; color: var(--color-text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 60; }
        .modal-close-btn:hover { background-color: var(--color-primary); color: #ffffff; transform: rotate(90deg); }
        #modal-title { font-size: 1.8rem; text-align: center; margin-bottom: 1.2rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }

        /* Área de Contenido Principal (Texto + Imagen al final) */
        #modal-content-area { flex-grow: 1; min-height: 0; display: flex; flex-direction: column; overflow-y: auto; padding-right: 10px; margin-bottom: 1rem;
            scrollbar-width: thin; scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content-area::-webkit-scrollbar { width: 8px; }
        #modal-content-area::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #modal-content-area::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 1px solid var(--color-border); }

        #modal-content { padding: 0 5px; }
        #modal-content p:not(:last-child) { margin-bottom: 1.4em; }
        #modal-content strong { color: var(--color-primary); font-weight: 600; }
        #modal-content em { color: var(--color-secondary); font-style: italic; font-weight: 400;}
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Lato', sans-serif; margin-top: 2.2em; margin-bottom: 1.1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.5em; font-weight: 700; letter-spacing: 0px;}
        #modal-content h1 { font-size: 1.4em; }
        #modal-content h2 { font-size: 1.3em; }
        #modal-content h3 { font-size: 1.15em; color: var(--color-secondary); }
        #modal-content h4 { font-size: 1.05em; color: var(--color-text-muted); border-bottom: none;}
        /* Estilos imagen final y placeholder */
        #modal-content .final-image { display: block; max-width: 80%; height: auto; margin: 2.5rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-md); cursor: pointer; transition: transform 0.2s ease; }
        #modal-content .final-image:hover { transform: scale(1.03); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2.5rem auto 1rem auto; color: var(--color-text-muted); }
        #modal-content .image-placeholder .spinner { border: 4px solid var(--color-border); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 2.5rem; color: var(--color-secondary); }

        /* Chat Section Styles */
        #chat-section { border-top: 1px solid var(--color-border); padding-top: 1rem; margin-top: 1rem; flex-shrink: 0; display: flex; flex-direction: column; max-height: 250px; }
        #chat-history { flex-grow: 1; overflow-y: auto; margin-bottom: 0.8rem; padding: 0.5rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: #f9fafb; scroll-behavior: smooth;
            scrollbar-width: thin; scrollbar-color: var(--color-secondary) var(--color-border);
        }
        #chat-history::-webkit-scrollbar { width: 6px; }
        #chat-history::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #chat-history::-webkit-scrollbar-thumb { background-color: var(--color-secondary); border-radius: var(--border-radius); }
        .chat-message { margin-bottom: 0.6rem; padding: 0.6rem 0.9rem; border-radius: var(--border-radius); max-width: 85%; word-wrap: break-word; line-height: 1.5; font-size: 0.95rem; }
        .user-message { background-color: var(--color-primary); color: white; margin-left: auto; text-align: left; font-weight: 400;} /* Align left for readability */
        .ai-message { background-color: #e5e7eb; color: var(--color-text); margin-right: auto; text-align: left; font-weight: 400; }
        .chat-error { color: var(--color-error-text); font-style: italic; text-align: center; font-size: 0.9em; padding: 0.3rem; }
        #chat-input-area { display: flex; gap: 0.5rem; }
        #chat-input { flex-grow: 1; padding: 0.7rem 0.9rem; border: 1px solid var(--color-border); background-color: white; color: var(--color-text); border-radius: var(--border-radius); font-family: 'Nunito'; font-size: 0.95rem; }
        #chat-input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15); }
        #chat-send-btn { padding: 0.7rem 1.1rem; background-color: var(--color-secondary); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.2s ease; font-size: 0.9rem; }
        #chat-send-btn:hover:not(:disabled) { background-color: #059669; }
        #chat-send-btn:disabled { background-color: var(--color-text-muted); cursor: not-allowed; opacity: 0.8; }
        #chat-loading { text-align: center; padding: 0.5rem; font-size: 0.9em; color: var(--color-text-muted); display: none; }
        #chat-loading .fa-spinner { margin-right: 0.5rem; color: var(--color-secondary); }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(249, 250, 251, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 55; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid var(--color-border); border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 600; color: var(--color-text); font-size: 1.3rem; font-family: 'Lato'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: var(--color-error-bg); color: var(--color-error-text); padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid var(--color-error-border); margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: 600; font-family: 'Nunito'; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none !important; }
        .title-item.hidden { display: none; }

        /* Fullscreen Image Overlay */
        #image-fullscreen-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(249, 250, 251, 0.95); display: none; align-items: center; justify-content: center; z-index: 100; padding: 2rem; cursor: zoom-out; }
        #image-fullscreen-overlay.active { display: flex; }
        #fullscreen-image { max-width: 95%; max-height: 95%; object-fit: contain; border: 2px solid var(--color-border); box-shadow: var(--shadow-lg); border-radius: var(--border-radius); }
        #fullscreen-close-btn { position: absolute; top: 20px; right: 25px; background: var(--color-modal-bg); border: 1px solid var(--color-border); border-radius: 50%; width: 40px; height: 40px; font-size: 1.8rem; color: var(--color-text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); }
        #fullscreen-close-btn:hover { background-color: var(--color-primary); color: white; transform: scale(1.1); }
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center">
             <div class="flex items-center text-center mb-3 sm:mb-0">
                 <h1 class="logo text-3xl sm:text-4xl">
                     <i class="fas fa-brain mr-3 text-blue-500"></i> <!-- Icono cerebro -->
                     Mente Positiva
                 </h1>
             </div>
             <span class="text-sm text-gray-600 font-sans tracking-wider">» Cultivando tu Bienestar «</span>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-12 text-center">
             <h1 class="page-title text-5xl sm:text-6xl mb-5">Explora Patrones Mentales Positivos</h1>
             <p class="text-xl text-gray-700 mb-8 max-w-3xl mx-auto font-light">Descubre y cultiva hábitos mentales que fomentan la resiliencia, la gratitud, el optimismo y el bienestar general.</p>
         </section>

         <!-- Search Bar -->
         <section id="search-container" class="mb-10 max-w-2xl mx-auto">
             <input type="text" id="search-input" placeholder="Buscar patrón o concepto (ej: gratitud, resiliencia...)">
             <i class="fas fa-search search-icon"></i>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-3xl sm:text-4xl mb-8 text-center mx-auto">
                 <i class="fas fa-seedling text-green-500 mr-2"></i> <!-- Icono planta creciendo -->
                 Catálogo de Patrones Mentales
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg font-sans">Cargando patrones y conceptos...</p>
                  <!-- Los .title-item se añadirán aquí -->
             </div>
             <p id="no-results" class="text-gray-500 col-span-full text-center text-lg mt-4 hidden font-sans">No encontramos patrones que coincidan con tu búsqueda.</p>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Explorar Más Patrones (40)
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Cargando información...</p>
             </div>

             <!-- Content Area Wrapper (Scrollable Text + Fixed Chat below) -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">

                 <!-- Scrollable Text Area -->
                 <div id="modal-content-area">
                     <h2 id="modal-title" class="text-xl md:text-2xl font-bold mb-4 text-center flex-shrink-0"></h2>
                     <div id="modal-content">
                         <!-- Explanation text (HTML) goes here -->
                         <!-- La imagen y su placeholder/spinner se añadirán aquí vía JS -->
                     </div>
                 </div>

                 <!-- Chat Section (Fixed at bottom of content area) -->
                 <div id="chat-section">
                      <p class="text-sm text-center text-gray-500 mb-2 font-semibold">¿Preguntas sobre "<span id="chat-context-title">este patrón</span>"?</p>
                     <div id="chat-history">
                         <!-- Chat messages will appear here -->
                     </div>
                     <div id="chat-loading">
                         <i class="fas fa-spinner fa-spin"></i> Pensando...
                     </div>
                     <div id="chat-input-area">
                         <input type="text" id="chat-input" placeholder="Escribe tu pregunta aquí...">
                         <button id="chat-send-btn" aria-label="Enviar Mensaje">
                             <i class="fas fa-paper-plane"></i>
                         </button>
                     </div>
                 </div>

                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden mt-4 flex-shrink-0">
                      <i class="fas fa-exclamation-circle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Fullscreen Image Overlay -->
      <div id="image-fullscreen-overlay">
          <button id="fullscreen-close-btn" aria-label="Cerrar Imagen">&times;</button>
          <img id="fullscreen-image" src="" alt="Imagen Ampliada">
      </div>

      <!-- Footer -->
      <footer class="bg-gray-100 text-gray-600 py-6 mt-12 border-t border-gray-200 font-sans">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Información generada por IA con fines educativos y de inspiración para el bienestar mental.</p>
              <p class="mt-1">Consulta siempre a un profesional de la salud mental para asesoramiento personalizado.</p>
              <p class="mt-2">© 2025 Mente Positiva Interactiva</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // Gratitud
            "Practicar la Gratitud Diaria", "Diario de Gratitud", "Expresar Agradecimiento a Otros", "Saborear Momentos Positivos", "Carta de Agradecimiento (Ejercicio)", "Meditación de Gratitud", "Enfocarse en lo que 'Sí' Tienes", "Apreciar las Pequeñas Cosas", "Gratitud ante la Adversidad", "Convertir Quejas en Gratitud", "Recordatorios de Gratitud Visuales", "Agradecimiento Corporal", "Reflexión Semanal de Gratitud", "Compartir Gratitud en Grupo", "El Poder de un Simple 'Gracias'",
            // Optimismo
            "Cultivar el Optimismo Aprendido", "Reencuadre Cognitivo Positivo", "Identificar y Desafiar Pensamientos Pesimistas", "Visualización del Mejor Yo Posible", "Enfocarse en Soluciones, no Problemas", "Buscar el Lado Bueno (Silver Lining)", "Anticipación Positiva de Eventos", "Estilo Explicativo Optimista", "Rodearse de Personas Optimistas", "Limitar Exposición a Noticias Negativas", "Optimismo Realista vs. Ingenuo", "Celebrar el Progreso, no solo el Éxito Final", "Esperanza Activa", "Confianza en la Propia Capacidad (Autoeficacia)", "Humor como Herramienta Optimista",
            // Resiliencia
            "Desarrollar la Resiliencia Emocional", "Aceptar la Impermanencia", "Mentalidad de Crecimiento ante Desafíos", "Fortalecer Redes de Apoyo Social", "Cuidado Personal como Base de la Resiliencia", "Flexibilidad Cognitiva", "Afrontamiento Centrado en el Problema", "Afrontamiento Centrado en la Emoción", "Aprender de los Errores y Fracasos", "Establecer Límites Saludables", "Manejo del Estrés Proactivo", "Técnicas de Regulación Emocional", "Buscar Significado en la Adversidad (Logoterapia)", "Fortaleza Interior (Grit)", "Narrativa Personal Resiliente",
            // Mindfulness y Presencia
            "Practicar Mindfulness (Atención Plena)", "Meditación de Escaneo Corporal", "Atención Plena en la Respiración", "Comer Consciente (Mindful Eating)", "Caminar Consciente", "Escucha Activa y Consciente", "Observar Pensamientos Sin Juzgar", "Anclaje en los Sentidos", "Pausa Consciente Durante el Día", "Mindfulness Informal (en tareas cotidianas)", "Reducir la Rumiación Mental", "Conciencia del Momento Presente", "Aceptación de Sensaciones (Agradables y Desagradables)", "Mindfulness para Manejar la Ansiedad", "Cultivar la Calma Interior",
            // Autocompasión
            "Practicar la Autocompasión", "Hablarse a Uno Mismo con Amabilidad", "Reconocer el Sufrimiento Común (Humanidad Compartida)", "Mindfulness Aplicado a la Autocompasión", "Identificar al Crítico Interno", "Satisfacer Necesidades Propias Sin Culpa", "Perdonarse a Uno Mismo por Errores", "Carta de Autocompasión", "Tratarse como Tratarías a un Buen Amigo", "Validación de las Propias Emociones", "Autocompasión ante el Fracaso", "Establecer Límites por Autocuidado", "Reconocer Fortalezas Propias con Humildad", "Autocompasión Física (Cuidado del cuerpo)", "Balancear Autocrítica con Autoaceptación",
            // Mentalidad de Crecimiento (Growth Mindset)
            "Adoptar una Mentalidad de Crecimiento", "Ver Desafíos como Oportunidades", "Valorar el Esfuerzo y el Proceso", "Aprender de la Crítica Constructiva", "Inspirarse en el Éxito Ajeno (Sin Envidia)", "Entender la Neuroplasticidad", "Buscar Nuevos Aprendizajes Constantemente", "Salir de la Zona de Confort Gradualmente", "La Palabra 'Todavía' (Aún no lo logro)", "Foco en el Aprendizaje, no solo en el Resultado", "Persistencia ante Obstáculos", "Experimentación y Aceptación del Error", "Establecer Metas de Aprendizaje", "Mentalidad de Crecimiento en Relaciones", "Enseñar a Otros como Forma de Aprender",
            // Aceptación
            "Practicar la Aceptación Radical", "Diferenciar Aceptación de Resignación", "Aceptar Emociones Difíciles", "Dejar Ir la Necesidad de Control Absoluto", "Aceptar la Realidad Presente", "Aceptación de Pensamientos (Sin fusión)", "Aceptación del Cuerpo", "Aceptar a los Demás Como Son", "Rendirse a lo que No Se Puede Cambiar", "Aceptación y Compromiso (ACT)", "Soltar Expectativas Rígidas", "Vivir con la Incertidumbre", "Aceptación de la Imperfección", "El Dolor es Inevitable, el Sufrimiento Opcional", "Fluir con la Vida (Wu Wei conceptual)",
            // Proactividad y Agencia Personal
            "Desarrollar la Proactividad", "Tomar Responsabilidad Personal (Círculo de Influencia)", "Enfoque en lo que Puedes Controlar", "Establecer Metas Claras y Accionables", "Anticipar Problemas y Prepararse", "Tomar Iniciativa", "Ser Agente de Cambio en Tu Vida", "Lenguaje Proactivo vs. Reactivo", "Convertir Intenciones en Acciones", "Planificación y Organización Personal", "Autonomía y Toma de Decisiones", "Romper la Inercia", "Buscar Oportunidades Activamente", "Crear Tu Propio Camino", "Empoderamiento Personal",
            // Empatía y Conexión Social
            "Cultivar la Empatía Cognitiva", "Desarrollar la Empatía Emocional", "Practicar la Escucha Activa Empática", "Comunicación No Violenta (CNV)", "Ponerse en el Lugar del Otro", "Comprender Diferentes Perspectivas", "Interés Genuino por los Demás", "Ofrecer Apoyo Emocional", "Reconocer y Validar Emociones Ajenas", "Construir Relaciones Positivas", "Compasión hacia los Demás", "Perdón Interpersonal", "Amabilidad Aleatoria (Random Acts of Kindness)", "Sentido de Comunidad y Pertenencia", "Reducir Prejuicios y Estereotipos",
            // Abundancia y Prosperidad
            "Mentalidad de Abundancia vs. Escasez", "Reconocer Recursos Disponibles (Internos/Externos)", "Apertura a Nuevas Oportunidades", "Generosidad y Compartir", "Creer en la Posibilidad de Crecimiento", "Celebrar la Abundancia Ajena", "Enfocarse en Oportunidades, no Limitaciones", "Gratitud por la Abundancia Actual", "Confianza en el Flujo de la Vida", "Desapego del Resultado Específico", "Visualización de la Prosperidad (Integral)", "Inversión en Crecimiento Personal", "Redefinir el Éxito Personal", "Abundancia de Tiempo, Amor, Conocimiento", "Mentalidad de 'Suficiente'",
            // Perdón (Propio y Ajeno)
            "Comprender el Proceso del Perdón", "Perdonarse a Uno Mismo", "Perdonar a Otros (Como liberación personal)", "Soltar Resentimientos y Rencores", "Carta de Perdón (No necesariamente enviada)", "Empatía hacia Quien Ofendió", "Establecer Límites Después del Perdón", "Diferenciar Perdón de Olvido o Reconciliación", "Aceptar la Imperfección Humana", "Meditación sobre el Perdón (Metta)", "El Perdón como Acto de Autocuidado", "Liberarse del Papel de Víctima", "Reconocer el Impacto del No Perdonar", "Cultivar la Compasión Universal", "Decisión Consciente de Perdonar",
            // Fortaleza y Virtudes
            "Identificar y Usar Fortalezas Personales (VIA)", "Cultivar la Valentía", "Fomentar la Curiosidad", "Desarrollar la Persistencia (Grit)", "Practicar la Honestidad e Integridad", "Cultivar la Amabilidad", "Fomentar el Amor por el Aprendizaje", "Desarrollar el Juicio y Pensamiento Crítico", "Practicar la Humildad", "Cultivar la Inteligencia Social", "Fomentar el Trabajo en Equipo", "Desarrollar el Liderazgo Positivo", "Practicar la Prudencia", "Cultivar la Espiritualidad (Sentido trascendente)", "Apreciación de la Belleza y la Excelencia",
            // Regulación Emocional
            "Identificar y Nombrar Emociones (Etiquetado)", "Comprender la Función de las Emociones", "Técnicas de Respiración para la Calma", "Distanciamiento Cognitivo", "Reevaluación Cognitiva (Reappraisal)", "Tolerancia al Malestar", "Expresión Emocional Saludable", "Manejo de la Ira Constructivo", "Reducción de la Ansiedad Fisiológica", "Mindfulness para la Regulación Emocional", "Autoconciencia Emocional", "Retrasar la Reacción Impulsiva", "Crear un 'Plan de Emergencia' Emocional", "Aceptación Emocional", "Balance Emocional",
            // Otros Conceptos Positivos
            "Fluir (Flow State)", "Saboreo (Savoring)", "Capitalización de Eventos Positivos", "Establecimiento de Metas SMART", "Automotivación", "Inteligencia Emocional", "Psicología Positiva (Introducción)", "Bienestar Subjetivo (Felicidad)", "Propósito de Vida (Ikigai conceptual)", "Altruismo y Voluntariado", "Humor Positivo", "Creatividad como Bienestar", "Conexión con la Naturaleza", "Importancia del Sueño Reparador", "Actividad Física y Salud Mental", "Nutrición y Estado de Ánimo", "Relaciones Saludables", "Comunicación Asertiva", "Resolución Constructiva de Conflictos", "Establecer y Mantener Límites", "Decir 'No' Sin Culpa", "Celebración de Logros (Pequeños y Grandes)", "Visualización Creativa", "Afirmaciones Positivas Efectivas", "Journaling Terapéutico", "Técnica Pomodoro para Enfocarse", "Minimizar Comparaciones Sociales", "Desarrollo de la Intuición", "Confianza Básica en la Vida", "Vivir Según Valores Personales", "Autenticidad", "Vulnerabilidad como Fortaleza", "Desapego Saludable", "Silencio Interior y Contemplación", "Juego y Diversión Adulta", "Optimismo Cauto", "Esperanza Realista", "Sentido de Coherencia (Antonovsky)", "Autoeficacia Generalizada", "Locus de Control Interno", "Teoría de la Autodeterminación (Necesidades básicas)"
            // Continuar expandiendo...
        ];
        const positiveMindsetThemes = [
            "gratitud", "optimismo", "resiliencia", "mindfulness", "autocompasión", "mentalidad de crecimiento", "aceptación", "proactividad", "empatía", "conexión social", "mentalidad de abundancia", "perdón", "fortalezas personales", "regulación emocional", "bienestar subjetivo", "propósito de vida", "relaciones positivas", "comunicación asertiva", "límites saludables", "autoeficacia", "inteligencia emocional"
        ];
        const textApiConfig = { // Para descripción principal
            model: "mistral",
            systemPrompt: "Eres un psicólogo experto y coach de bienestar, especializado en psicología positiva y patrones mentales constructivos. Tu tarea es explicar de forma clara, profunda y alentadora el patrón mental, concepto o técnica indicada. Describe qué es, por qué es beneficioso para el bienestar mental y emocional, cómo se puede cultivar o practicar en la vida diaria (con ejemplos concretos), posibles desafíos al implementarlo y quizás alguna base científica o teórica relevante (de forma accesible). Usa un lenguaje positivo, empático y práctico. El objetivo es una explicación detallada de aproximadamente 1200-1300 palabras. Basa tu explicación únicamente en el siguiente patrón o concepto:",
            timeoutSeconds: 150
        };
        const chatApiConfig = { // Config base para chat
            model: "mistral-tiny", // Modelo más rápido
            systemPrompt: "Actúa como un asistente IA de apoyo, enfocado únicamente en el patrón mental que se está viendo. Responde preguntas de seguimiento sobre cómo aplicar este patrón, superar obstáculos comunes o aclarar dudas específicas sobre él. Sé breve, claro y mantén un tono motivador y positivo.",
            timeoutSeconds: 45
        };
        const titleGenerationConfig = { // Pide 40 títulos
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para una guía de bienestar mental. Genera exactamente 40 nombres de patrones mentales positivos, técnicas de psicología positiva o conceptos relacionados con el bienestar emocional, adecuados para una explicación detallada. Devuelve *solo* la lista de ítems, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 60 // Aumentar ligeramente por si pide más tiempo para 40
        };

        // ========== DOM ELEMENTS ========== (Sin cambios estructurales)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const noResultsMsg = document.getElementById('no-results');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const generateMoreSpinner = generateMoreBtn.querySelector('i');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTextArea = document.getElementById('modal-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        const chatSection = document.getElementById('chat-section');
        const chatHistory = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const chatLoadingIndicator = document.getElementById('chat-loading');
        const chatContextTitleSpan = document.getElementById('chat-context-title'); // Span para el título en el chat
        const imageFullscreenOverlay = document.getElementById('image-fullscreen-overlay');
        const fullscreenImage = document.getElementById('fullscreen-image');
        const fullscreenCloseBtn = document.getElementById('fullscreen-close-btn');

        // ========== State Variables ==========
        let currentContextTitle = null; // Título del patrón actual para el chat

        // ========== API FUNCTIONS ==========
        async function fetchTextFromApi(prompt, config, isChat = false) {
            const encodedPrompt = encodeURIComponent(prompt);
            const systemPromptToUse = isChat && currentContextTitle
                ? `Eres un asistente IA de apoyo, enfocado únicamente en el patrón mental llamado '${currentContextTitle}'. Responde preguntas de seguimiento sobre cómo aplicar este patrón, superar obstáculos comunes o aclarar dudas específicas sobre él. Sé breve, claro y mantén un tono motivador y positivo.`
                : config.systemPrompt;
            const encodedSystem = encodeURIComponent(systemPromptToUse);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed && !isChat) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}, Chat: ${isChat}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);

            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) {
                    throw new Error(`(Error ${response.status}) Nuestros servidores están algo ocupados ahora. Quizás un respiro profundo y vuelve a intentarlo en unos segundos.`);
                }
                const text = await response.text();
                if (!text || text.trim().length === 0) {
                    throw new Error("La respuesta de la IA llegó vacía. ¿Podrías reformular tu pregunta o intentarlo de nuevo?");
                }
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') {
                    throw new Error(`La conexión tardó un poco más de lo esperado (>${config.timeoutSeconds}s). Revisa tu conexión o inténtalo más tarde con calma.`);
                }
                throw new Error(error.message || "Ups, algo inesperado ocurrió al conectar con la IA. ¡Intenta de nuevo!");
            }
        }
        async function fetchExplanationText(conceptTitle) { return fetchTextFromApi(conceptTitle, textApiConfig, false); }
        async function fetchChatResponse(userQuery) { if (!currentContextTitle) throw new Error("Error interno: No se estableció el contexto del patrón para el chat."); return fetchTextFromApi(userQuery, chatApiConfig, true); }
        async function fetchGeneratedTitles() {
            const randomTheme = getRandomElement(positiveMindsetThemes) || "bienestar mental general";
            // ** Pide 40 títulos **
            const specificPrompt = `Genera 40 nombres/conceptos de patrones mentales positivos o técnicas sobre ${randomTheme}`;
            return fetchTextFromApi(specificPrompt, titleGenerationConfig, false)
                .then(text => {
                    const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 5 && line.length < 150);
                    if (titles.length < 10) { // Esperar al menos 10 aunque pida 40
                       throw new Error("La IA no generó suficientes ideas de patrones esta vez.");
                    }
                    return titles.slice(0, 40); // ** Devuelve hasta 40 **
                });
        }
        function createPollinationsImageUrl(promptText, options = {}) {
             const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
             const settings = { ...defaults, ...options };
             const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText : "positive mental state abstract concept";
             // Prompt para imagen más abstracta y positiva
             const enhancedPrompt = `Abstract artwork representing the positive mental concept of '${safePromptText}'. Focus on light, growth, calm, clarity, connection. Use soft, uplifting colors (blues, greens, yellows, light). Avoid text, diagrams, literal brain images. Peaceful and inspiring mood.`;
             const escapedPrompt = encodeURIComponent(enhancedPrompt);
             if (!escapedPrompt) return '';
             const negativePrompt = "text, words, labels, letters, title, caption, diagram, chart, graph, dark, sad, depressing, chaotic, complex machinery, realistic human face, specific object unless requested, watermark, signature, blurry";
             const escapedNegative = encodeURIComponent(negativePrompt);
             let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
             if (settings.nologo) url += '&nologo=true';
             console.log("Image URL:", url);
             return url;
         }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... (igual que antes) ... */
            if (!rawText) return '';
            let formatted = rawText.trim();
            formatted = formatted.replace(/\\text\{(.*?)\}/g, '$1');
            formatted = formatted.replace(/(\w)_\{?(\d+)\}?/g, '$1<sub>$2</sub>');
            formatted = formatted.replace(/(\w)\^\{?([\d+\-−]+)\}?/g, (match, base, exponent) => { const cleanExponent = exponent.replace('−', '-'); return `${base}<sup>${cleanExponent}</sup>`; });
            formatted = formatted.replace(/\\rightarrow/g, '&rarr;');
            formatted = formatted.replace(/\\\[\s*(.*?)\s*\\\]/g, '<p class="formula">$1</p>');
            formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            formatted = blocks.map(block => {
                if (block.startsWith('<h') || block.startsWith('<p class="formula">')) return block;
                let content = block.replace(/\n/g, ' ');
                return `<p>${content}</p>`;
            }).join('');
            return formatted;
        }

        // ========== MODAL FUNCTIONS ========== (Sin cambios estructurales)
        function showModal() { storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() {
            storyModal.classList.remove('active');
            if (!imageFullscreenOverlay.classList.contains('active')) {
                document.body.style.overflow = '';
            }
            modalTextArea.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() {
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = '';
             modalErrorMessage.textContent = '';
             chatHistory.innerHTML = '';
             chatInput.value = '';
             chatLoadingIndicator.style.display = 'none';
             chatSendBtn.disabled = false;
             currentContextTitle = null;
             if(chatContextTitleSpan) chatContextTitleSpan.textContent = 'este patrón'; // Reset context title in UI
             hideFullscreenImage();
        }

        // ========== FULLSCREEN IMAGE FUNCTIONS ========== (Sin cambios)
        function showFullscreenImage(imgSrc) { if(!imageFullscreenOverlay||!fullscreenImage) return; fullscreenImage.src=imgSrc; imageFullscreenOverlay.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideFullscreenImage() { if(!imageFullscreenOverlay) return; imageFullscreenOverlay.classList.remove('active'); if (!storyModal.classList.contains('active')) { document.body.style.overflow = ''; } fullscreenImage.src=''; }

        // ========== CHAT FUNCTIONS ========== (Sin cambios estructurales)
        function addChatMessage(message, sender) { const msgDiv=document.createElement('div'); msgDiv.classList.add('chat-message', sender==='user'?'user-message':'ai-message'); message=message.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>'); message=message.replace(/\*(.*?)\*/g,'<em>$1</em>'); msgDiv.innerHTML=message; chatHistory.appendChild(msgDiv); chatHistory.scrollTop=chatHistory.scrollHeight; }
        function addChatError(message) { const errDiv=document.createElement('div'); errDiv.classList.add('chat-error'); errDiv.textContent=message; chatHistory.appendChild(errDiv); chatHistory.scrollTop=chatHistory.scrollHeight; }
        async function handleSendMessage() {
            const userQuery = chatInput.value.trim();
            if (!userQuery || chatSendBtn.disabled) return;
            addChatMessage(userQuery, 'user');
            chatInput.value = '';
            chatSendBtn.disabled = true;
            chatLoadingIndicator.style.display = 'block';
            try {
                const aiResponse = await fetchChatResponse(userQuery);
                addChatMessage(aiResponse, 'ai');
            } catch (error) {
                console.error("Chat Error:", error);
                addChatError(`Error IA: ${error.message}`);
            } finally {
                chatLoadingIndicator.style.display = 'none';
                chatSendBtn.disabled = false;
                chatInput.focus();
            }
        }

        // ========== UI & EVENT HANDLERS ========== (Sin cambios estructurales)
        function getRandomElement(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
        function shuffleArray(array){let ci=array.length,ri;while(ci>0){ri=Math.floor(Math.random()*ci);ci--;[array[ci],array[ri]]=[array[ri],array[ci]];}return array;}
        function createTitleItem(title){const div=document.createElement('div');div.className='title-item';div.textContent=title;div.setAttribute('data-title',title);div.addEventListener('click',()=>handleTitleClick(title));return div;}
        function displayTitles(titles){
             if(!titleListContainer||!titlesLoading)return;
             const sortedTitles = titles.sort((a, b) => a.localeCompare(b));
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if(sortedTitles.length === 0){titleListContainer.innerHTML='<p class="text-gray-500 col-span-full text-center font-sans">No hay patrones disponibles por ahora.</p>';return;}
             sortedTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
        }
        function appendTitles(newTitles){
             if(!titleListContainer||!newTitles||newTitles.length===0)return;
             const existingTitles = new Set(Array.from(titleListContainer.querySelectorAll('.title-item')).map(item => item.dataset.title));
             let addedCount = 0;
             newTitles.forEach(title => { if (!existingTitles.has(title)) { titleListContainer.appendChild(createTitleItem(title)); addedCount++; } });
             console.log(`Added ${addedCount} new unique titles.`);
             filterTitles(searchInput.value);
        }

        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            currentContextTitle = title; // Set chat context
            if(chatContextTitleSpan) chatContextTitleSpan.textContent = title; // Update context title in UI
            modalContent.innerHTML = '';
            chatHistory.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                modalTextArea.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-lightbulb placeholder-icon"></i>
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Creando inspiración visual...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Representación visual de ${title}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => { console.log("Image loaded."); placeholderDiv.remove(); imgElement.style.display='block'; imgElement.addEventListener('click', () => showFullscreenImage(imgElement.src)); };
                imgElement.onerror = () => { console.error("Err img:", title); placeholderDiv.innerHTML = `<i class="fas fa-image placeholder-icon" style="color: var(--color-error-text);"></i><p style="font-size:0.8em;margin-top:0.5rem;">No se pudo cargar la imagen.</p>`; };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) { imgElement.src = imageUrl; modalContent.appendChild(imgElement); }
                else { console.error("No img URL:", title); placeholderDiv.innerHTML = `<i class="fas fa-exclamation-circle placeholder-icon"></i><p style="font-size:0.8em;margin-top:0.5rem;">Error URL imagen.</p>`; }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = error.message || "Hubo un problema al cargar la información.";
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
                chatSection.classList.add('content-hidden');
            }
        }

        async function handleGenerateMoreTitles() { // Pide 40
             if(!generateMoreBtn||!generateMoreSpinner)return;
             generateMoreBtn.disabled = true;
             generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Buscando más inspiración...';
             try {
                 // ** Llama a la función que pide 40 **
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) { appendTitles(newTitles); }
                 else { alert("No pudimos encontrar más patrones en este momento. ¡Intenta más tarde!"); }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al buscar patrones: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 // ** Actualiza texto del botón **
                 generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin hidden"></i> Explorar Más Patrones (40)';
             }
         }

         // Search Filter Function (con normalización para tildes)
         function filterTitles(searchTerm) {
             const term = searchTerm.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
             const titleItems = titleListContainer.querySelectorAll('.title-item');
             let visibleCount = 0;
             titleItems.forEach(item => {
                 const titleText = item.dataset.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                 const isVisible = titleText.includes(term);
                 item.classList.toggle('hidden', !isVisible);
                 if(isVisible) visibleCount++;
             });
             noResultsMsg.classList.toggle('hidden', visibleCount > 0);
         }

        // ========== INITIALIZATION ========== (Sin cambios estructurales)
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput || !noResultsMsg || !chatInput || !chatSendBtn || !imageFullscreenOverlay || !fullscreenCloseBtn || !chatContextTitleSpan) {
                console.error("Initialization failed: Missing essential elements.");
                document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">Error: Faltan componentes esenciales de la página. Recarga o contacta soporte.</p>';
                return;
             }
            modalCloseBtn.addEventListener('click', hideModal);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            searchInput.addEventListener('input', (event) => filterTitles(event.target.value));
            searchInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') event.preventDefault(); });
            chatSendBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') handleSendMessage(); });
            imageFullscreenOverlay.addEventListener('click', hideFullscreenImage);
            fullscreenCloseBtn.addEventListener('click', (event) => { event.stopPropagation(); hideFullscreenImage(); });
            displayTitles(predefinedTitles);
            noResultsMsg.classList.add('hidden');
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>