<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetario Premium: Alta Cocina en Casa</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fonts: Playfair Display para títulos, Lato para cuerpo -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Recetas Premium --- */
        :root {
            --color-primary: #b8860b; /* Dorado Oscuro / Ocre */
            --color-secondary: #8fbc8f; /* Verde Salvia Suave */
            --color-background: #fdfbf6; /* Blanco Crema */
            --color-text: #4a4a4a; /* Gris Oscuro Cálido */
            --color-text-muted: #888888; /* Gris Medio */
            --color-modal-bg: #ffffff; /* Blanco Puro Modal */
            --color-border: #e0e0e0; /* Gris Muy Claro Borde */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.08);
            --border-radius: 8px; /* Bordes más suaves */
            --transition-normal: all 0.25s ease-in-out;
            --font-title: 'Playfair Display', serif;
            --font-body: 'Lato', sans-serif;
        }
        body { font-family: var(--font-body); background-color: var(--color-background); color: var(--color-text); line-height: 1.75; }
        h1, h2, h3, h4, .logo { font-family: var(--font-title); font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.6rem; display: inline-block; letter-spacing: 0.5px; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2.5rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.9rem 1.2rem 0.9rem 3rem; /* Más padding */
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1.05rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
            background-color: #fff;
        }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.15);
        }
        #search-container .fa-search {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .title-item {
            background-color: var(--color-modal-bg);
            padding: 1.5rem 1.2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition-normal);
            text-align: center;
            font-weight: 600; /* Lato bold */
            color: var(--color-text);
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            font-family: var(--font-body);
        }
        .title-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
            color: var(--color-primary);
            background-color: #fffaf0; /* Ivory hover */
        }
        #generate-more-btn {
            grid-column: 1 / -1; /* Span full width */
            background-color: var(--color-primary);
            color: white;
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: var(--font-body);
            font-weight: bold;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition-normal);
            margin-top: 2rem;
            letter-spacing: 0.5px;
        }
        #generate-more-btn:hover:not(:disabled) {
            background-color: #a0740a; /* Darker gold */
            box-shadow: var(--shadow-sm);
        }
        #generate-more-btn:disabled { background-color: #cccccc; color: #888888; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(74, 74, 74, 0.88); /* Darker overlay */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2.5rem 3rem; /* More padding */
            max-width: 1000px; /* Wider modal */
            width: 95%;
            max-height: 90vh;
            min-height: 400px; /* Ensure space for loading */
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--color-border);
        }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #f1f1f1; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.8rem; color: var(--color-text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: #e0e0e0; color: var(--color-primary); }
        #modal-title { font-size: 2.2rem; text-align: center; margin-bottom: 2rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }
        #modal-content { /* Scrollable content area */
            line-height: 1.8;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 10px 2rem 10px; /* Padding bottom for image */
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 10px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 2px solid var(--color-border); }
        /* Recipe specific formatting */
        #modal-content p:not(:last-child) { margin-bottom: 1.5em; }
        #modal-content strong, #modal-content b { color: var(--color-primary); font-weight: bold; }
        #modal-content em, #modal-content i { color: #6b705c; /* Earthy green emphasis */ font-style: italic; }
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: var(--font-title); margin-top: 2.5em; margin-bottom: 1.2em; color: var(--color-primary); border-bottom: 1px solid #e0e0e0; padding-bottom: 0.5em; font-weight: bold; }
        #modal-content h1 { font-size: 1.7em; } /* Slightly larger subheadings */
        #modal-content h2 { font-size: 1.55em; }
        #modal-content h3 { font-size: 1.4em; color: #8fbc8f; } /* Secondary color */
        #modal-content h4 { font-size: 1.2em; color: var(--color-text-muted); border-bottom: none; }
        /* Style lists if AI generates them (basic) */
        #modal-content ul, #modal-content ol { margin-left: 1.5em; margin-bottom: 1.5em; }
        #modal-content li { margin-bottom: 0.7em; }

        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 80%; height: auto; margin: 3rem auto 1.5rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-md); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 180px; margin: 3rem auto 1.5rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 40px; height: 40px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.8rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3.5rem; }

        #modal-loading { text-align: center; padding: 4rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 70px; height: 70px; border: 7px solid #e0e0e0; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 2rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.3rem; font-family: var(--font-body); letter-spacing: 0.5px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #fff5f5; color: #c53030; padding: 1.5rem; border-radius: var(--border-radius); border: 1px solid #fc8181; margin-top: 2rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.8rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2.5rem; grid-column: 1 / -1; font-style: italic; font-size: 1.1rem; }
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-5 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-3xl sm:text-4xl">
                     <i class="fas fa-concierge-bell mr-4 text-gray-600"></i> <!-- Icono Premium -->
                     Recetario Premium
                     <i class="fas fa-utensils ml-4 text-gray-600"></i> <!-- Icono Cubiertos -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-20">
         <!-- Hero section -->
         <section class="mb-12 text-center">
             <h1 class="page-title text-5xl sm:text-6xl mb-5">Alta Cocina a tu Alcance</h1>
             <p class="text-xl text-gray-700 mb-8 max-w-4xl mx-auto">Descubre recetas exclusivas, técnicas sofisticadas y presentaciones de restaurante. Busca tu próxima obra maestra culinaria o explora nuestras sugerencias.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-3xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar por plato, ingrediente, técnica...">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-12">
             <h2 class="section-title text-3xl sm:text-4xl mb-8 text-center mx-auto">
                 <i class="fas fa-pepper-hot text-red-600 mr-2"></i> <!-- Icono Chile -->
                 Creaciones Culinarias
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Afilando cuchillos...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-10">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Descubrir Más Recetas
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Consultando al Chef...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-3xl md:text-4xl font-bold mb-6 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Recipe text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-100 text-gray-600 py-8 mt-16 border-t border-gray-300">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Recetas generadas por IA inspiradas en técnicas de alta cocina. ¡Experimenta y adapta a tu gusto!</p>
              <p class="mt-1">Los resultados pueden variar. Cocina siempre con precaución y disfruta del proceso creativo.</p>
              <p class="mt-3">© 2025 Recetario Premium</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
             // Aperitivos / Entrantes
            "Vieiras Selladas con Puré de Coliflor Trufado y Praliné de Avellanas", "Tartar de Atún Rojo con Emulsión de Aguacate y Wasabi", "Foie Gras Mi-Cuit con Chutney de Higos y Pan Brioche Tostado", "Carpaccio de Res Black Angus con Rúcula, Parmesano Reggiano y Reducción Balsámica Añeja", "Sopa Fría de Pepino y Yogur Griego con Menta y Camarones Marinados", "Terrina de Verduras de Temporada con Gelatina de Tomate Consomé", "Ostras Frescas con Mignonette Clásica y Espuma Cítrica", "Blinis Caseros con Salmón Ahumado, Crema Agria y Caviar Osetra", "Pulpo a la Parrilla con Puré de Patata Violeta y Pimentón de la Vera Ahumado", "Ensalada de Langosta Tibia con Vinagreta de Fruta de la Pasión y Espárragos Verdes", "Croquetas Líquidas de Jamón Ibérico de Bellota", "Gazpacho de Remolacha con Queso de Cabra y Pistachos", "Ceviche Clásico Peruano con Leche de Tigre Aromatizada", "Brandada de Bacalao Gratinada con Alioli Suave", "Mini Quiches Lorraine con Masa Quebrada Casera", "Volovanes Rellenos de Ragú de Champiñones Silvestres y Tomillo", "Buñuelos de Viento con Relleno de Queso Azul y Pera Confitada", "Chupito de Crema de Bogavante con Toque de Brandy", "Brochetas de Pollo Yakitori con Salsa Teriyaki Glaseada", "Rollitos Vietnamitas Frescos (Gỏi cuốn) con Salsa de Cacahuete", "Tempura Fina de Vegetales y Langostinos con Salsa Tentsuyu", "Alcachofas Confitadas con Virutas de Jamón Serrano y Aceite de Oliva Virgen Extra", "Huevo a Baja Temperatura (65°C) con Parmentier de Patata y Trufa Negra Rallada", "Tosta de Pan de Cristal con Tomate, Anchoas del Cantábrico y Aceite de Arbequina", "Ensaladilla Rusa 'Premium' con Ventresca de Atún y Guisantes Lágrima", "Sashimi Variado (Atún, Salmón, Hamachi) con Jengibre Encurtido y Wasabi Fresco", "Gyozas Artesanales de Cerdo y Verduras al Vapor con Salsa Ponzu", "Hummus de Garbanzo con Tahini, Pimentón Dulce y Pan de Pita Caliente", "Baba Ganoush Ahumado con Granada y Hierbabuena", "Mejillones al Vapor con Vino Blanco, Ajo y Perejil",
            // Sopas / Cremas
            "Sopa de Cebolla Francesa Gratinada con Queso Gruyère", "Bisque de Langosta Cremoso con Croutons al Ajo", "Consomé Doble de Ave con Juliana de Verduras y Huevo Hilado", "Crema Vichyssoise Clásica (Fría o Caliente)", "Sopa Bouillabaisse Marsellesa con Rouille y Pan Tostado", "Crema de Calabaza Asada con Jengibre, Leche de Coco y Semillas Tostadas", "Sopa Minestrone Italiana con Vegetales de Estación y Pasta Pequeña", "Ajoblanco Malagueño con Uvas y Almendras Laminadas", "Sopa de Lentejas Pardinas Estofadas con Chorizo y Verduras", "Crema de Espárragos Blancos de Navarra con Yema Curada", "Sopa Tom Yum Goong Tailandesa (Picante y Ácida con Langostinos)", "Sopa de Miso Tradicional Japonesa con Tofu Sedoso y Alga Wakame", "Harira Marroquí (Sopa de Legumbres y Carne Especiada)", "Sopa de Tortilla Mexicana con Aguacate, Queso Fresco y Chile Pasilla", "Caldo Gallego con Grelos, Patatas y Judías Blancas", "Crema Dubarry (Crema de Coliflor Clásica Francesa)", "Potage Saint-Germain (Crema de Guisantes Frescos)", "Sopa de Pescado Donostiarra con Almejas y Merluza", "Sancocho Colombiano (Variedad Premium)", "Zuppa Toscana con Kale, Patata y Salchicha Italiana",
            // Ensaladas Gourmet
            "Ensalada Niçoise Auténtica con Atún Fresco Sellado", "Ensalada César Clásica con Pollo a la Parrilla y Anchoas (Opcional)", "Ensalada Caprese con Mozzarella de Búfala, Tomate Raf y Albahaca Genovesa Fresca", "Ensalada Griega (Horiatiki) con Queso Feta de Calidad y Aceitunas Kalamata", "Ensalada Waldorf Moderna con Manzana Verde, Apio, Nueces Caramelizadas y Aderezo Ligero", "Ensalada de Quinoa Tricolor con Aguacate, Mango, Pimiento Rojo y Vinagreta de Lima-Cilantro", "Ensalada de Espinacas Baby con Fresas, Queso de Cabra Templado, Piñones y Vinagreta Balsámica de Miel", "Ensalada de Lentejas Beluga con Verduras Asadas y Aderezo de Mostaza Dijon", "Ensalada Tailandesa de Ternera (Yam Neua) Picante y Refrescante", "Tabulé Libanés Auténtico con Mucho Perejil y Menta Fresca", "Ensalada Cobb Americana Completa", "Ensalada de Rúcula con Peras Conferencia, Queso Gorgonzola, Nueces Pecanas y Reducción de Pedro Ximénez", "Ensalada de Endivias Rojas con Roquefort, Manzana y Nueces", "Ensalada Tibia de Patatas Nuevas con Salmón Ahumado y Eneldo", "Poke Bowl Hawaiano de Salmón o Atún con Edamame, Algas y Arroz de Sushi",
            // Pescados / Mariscos
            "Lubina a la Sal con Patatas Panadera y Verduras al Vapor", "Rodaballo Salvaje al Horno con Bilbaína (Ajo, Guindilla, Vinagre)", "Merluza en Salsa Verde con Almejas y Espárragos", "Bacalao Confitado a Baja Temperatura sobre Puré de Pimientos del Piquillo", "Salmón a la Plancha con Costra de Hierbas y Risotto de Limón", "Lenguado Meunière Clásico con Mantequilla Tostada, Limón y Perejil", "Atún Rojo Sellado (Tataki) con Sésamo y Salsa Ponzu Cítrica", "Mero al Horno con Patatas a lo Pobre y Cebolla Caramelizada", "Dorada a la Espalda con Ajo y Perejil", "Rape alangostado con Salsa Americana", "Calamares Rellenos en su Tinta con Arroz Blanco", "Arroz Negro con Sepia y Alioli Suave", "Paella Valenciana Tradicional (Versión Gourmet con Ingredientes Selectos)", "Arroz Caldoso de Bogavante", "Fideuá de Mariscos con Fideos Finos Tostados", "Zarzuela de Pescado y Marisco Catalana", "Langostinos al Pil Pil (Ajo, Guindilla, Aceite)", "Gambas Rojas de Denia a la Plancha con Sal Maldon", "Centollo Cocido Estilo 'Txangurro a la Donostiarra'", "Almejas a la Marinera Clásicas", "Navajas a la Plancha con Aceite de Ajo y Perejil", "Calamar de Potera a la Andaluza (Frito)", "Pescado Blanco al Vapor Estilo Cantonés con Jengibre y Cebolleta", "Curry Verde Tailandés de Pescado Blanco y Leche de Coco", "Sushi y Sashimi Variado de Alta Calidad", "Miso Glazed Black Cod (Bacalao Negro con Miso Glaseado - Estilo Nobu)", "Causa Limeña de Atún o Cangrejo", "Tiradito Peruano con Salsa de Ají Amarillo", "Fish and Chips Gourmet con Puré de Guisantes a la Menta", "Brandade de Morue (Brandada de Bacalao Francesa)",
            // Aves
            "Pollo de Corral Asado al Limón y Hierbas Aromáticas con Patatas Rústicas", "Coq au Vin (Pollo al Vino Tinto) Clásico Francés", "Magret de Pato con Salsa de Naranja y Puré de Boniato", "Confit de Pato Casero con Patatas Sarladaises (Salteadas en Grasa de Pato)", "Pechuga de Pollo Rellena de Espinacas y Queso Ricotta envuelta en Prosciutto", "Supremas de Pollo Villeroy (Empanadas con Bechamel)", "Fricassée de Pollo Tradicional con Champiñones y Nata", "Pollo Tikka Masala Auténtico (Marinado y Cocinado en Tandoor si es posible)", "Curry Rojo Tailandés de Pollo con Leche de Coco y Bambú", "Pollo Kung Pao Chino (Estilo Sichuan con Cacahuetes y Chiles)", "Arroz con Pollo Estilo Peruano (con Culantro y Ají Amarillo)", "Mole Poblano con Pechuga de Pavo o Pollo", "Codornices Escabechadas Caseras", "Pichón Asado con su Jugo y Compota de Manzana Reineta", "Pavo Relleno Navideño (Versión sofisticada)", "Capón Asado con Frutos Secos y Salsa de Castañas", "Pollo Kiev (Pechuga Rellena de Mantequilla de Ajo y Hierbas)", "Gallina en Pepitoria Tradicional Española", "Tajine de Pollo Marroquí con Limones Encurtidos y Aceitunas", "Satay de Pollo Indonesio con Salsa de Cacahuete Especiada",
            // Carnes (Res, Ternera, Cerdo, Cordero)
            "Solomillo de Ternera Wellington con Duxelles de Champiñones y Paté", "Entrecot de Vaca Madurada a la Parrilla con Mantequilla Café de París", "Steak Tartar Preparado al Momento con Ingredientes Frescos", "Tournedó Rossini (Solomillo con Foie Gras y Salsa Perigourdine)", "Osso Buco alla Milanese con Risotto al Azafrán", "Carrilleras de Ternera Estofadas al Vino Tinto sobre Parmentier Trufado", "Rabo de Toro Guisado a la Cordobesa", "Roast Beef Clásico Inglés con Yorkshire Pudding y Gravy", "Costillar de Cerdo Ibérico Asado a Baja Temperatura con Salsa Barbacoa Casera Ahumada", "Secreto Ibérico a la Plancha con Chimichurri Argentino", "Cochinillo Asado Estilo Segoviano (Piel Crujiente)", "Solomillo de Cerdo en Costra de Mostaza Antigua y Hierbas", "Pierna de Cordero Lechal Asada al Romero y Ajo", "Paletilla de Cordero Confitada con Puré de Garbanzos", "Chuletas de Cordero a la Villaroy", "Tajine de Cordero Marroquí con Ciruelas Pasas y Almendras", "Moussaka Griega Auténtica con Carne Picada de Cordero", "Goulash Húngaro de Ternera Especiado", "Chili con Carne Tex-Mex (Versión Premium)", "Albóndigas Suecas (Köttbullar) con Salsa de Nata y Arándanos Rojos", "Lomo Alto de Wagyu Japonés a la Plancha (Teppanyaki)", "Carpaccio de Solomillo de Buey con Alcaparras Fritas y Lascas de Idiazábal", "Fricandó de Ternera con Setas Catalán", "Estofado Irlandés de Cordero con Patatas y Verduras (Irish Stew)", "Vitel Toné Piamontés (Ternera Fría con Salsa de Atún y Anchoas)",
            // Vegetariano / Vegano Gourmet
            "Risotto de Setas Silvestres de Temporada (Boletus, Cantarelas)", "Risotto alla Zucca (Calabaza Asada y Amaretti)", "Lasaña Vegetariana con Berenjena, Calabacín, Ricotta y Bechamel de Nuez Moscada", "Curry de Lentejas Rojas (Masoor Dal) Indio Cremoso", "Curry Massaman Tailandés de Vegetales y Tofu Firme", "Berenjenas a la Parmesana Italianas Gratinadas", "Pimientos del Piquillo Rellenos de Brandada Vegetal (Coliflor y Almendra)", "Hamburguesa Vegana Gourmet con Pan Brioche, Queso Vegano Fundido y Cebolla Caramelizada", "Pastel de Pastor Vegetariano con Lentejas y Puré de Patata Gratinado", "Ratatouille Clásico Francés Estilo Confit Byaldi", "Tarta Tatín de Tomates Cherry y Cebolla Roja Caramelizada", "Galette Rústica de Hojaldre con Espárragos, Queso de Cabra y Limón", "Alcachofas a la Romana (Carciofi alla Romana)", "Gnocchi de Patata Caseros con Salsa de Tomate San Marzano y Albahaca Fresca", "Gnocchi de Ricotta y Espinacas (Gnudi) con Mantequilla de Salvia", "Pasta Fresca (Tagliatelle) con Pesto Genovés Auténtico", "Pasta alla Norma Siciliana (Berenjena, Tomate, Ricotta Salata)", "Raviolis Caseros Rellenos de Calabaza y Salvia con Mantequilla Avellana", "Falafel Crujiente con Ensalada Israelí y Salsa Tahini", "Moussaka Vegana con Lentejas, Berenjena y Bechamel de Leche Vegetal", "Tofu Sedoso Mapo Tofu (Versión Vegana Adaptada)", "Pad Thai Vegetariano/Vegano con Tofu o Tempeh", "Enchiladas Veganas con Relleno de Frijoles Negros y Batata", "Quinotto (Risotto de Quinoa) con Champiñones Portobello y Espárragos", "Coliflor Asada Entera con Especias Ras el Hanout y Yogur de Tahini", "Tacos Veganos de Jackfruit Desmechado estilo 'Carnitas'", "Sopa Pho Vietnamita Vegana con Caldo de Champiñones y Especias", "Wellington Vegetariano de Lentejas y Nueces con Duxelles", "Terrina de Verduras Asadas y Queso Feta", "Tian Provenzal de Verduras Laminadas",
            // Guarniciones / Acompañamientos
            "Gratén Delfinés (Gratin Dauphinois) Clásico", "Puré de Patatas Robuchon (Muy Cremoso con Mantequilla)", "Patatas Panadera Finas al Horno", "Patatas Fritas Caseras en Doble Cocción (Pont Neuf)", "Patatas Anna Clásicas Laminadas", "Arroz Pilaf Aromático con Frutos Secos", "Cuscús Marroquí Esponjoso con Siete Verduras", "Polenta Cremosa Italiana con Parmesano", "Tian de Verduras Provenzal", "Espárragos Verdes a la Plancha con Sal Maldon y Aceite de Oliva", "Judías Verdes Finas Salteadas con Almendras Laminadas", "Pisto Manchego Tradicional", "Caponata Siciliana Agridulce", "Champiñones al Ajillo Clásicos", "Cebollitas Francesas Glaseadas al Oporto", "Puré de Manzana Casero (para Carnes)", "Chutney de Mango Especiado", "Salsa Bearnesa Clásica", "Salsa Holandesa Perfecta", "Salsa de Pimienta Verde para Solomillo", "Reducción de Vino Tinto y Chalotas", "Vinagreta Clásica Francesa", "Alioli Casero Auténtico",
            // Postres
            "Crème Brûlée Clásica con Vainilla de Tahití", "Mousse de Chocolate Negro Intenso (70% Cacao)", "Tarta Tatin de Manzana Caramelizada con Helado de Vainilla Bourbon", "Profiteroles Rellenos de Crema Pastelera con Salsa de Chocolate Caliente", "Tiramisú Italiano Auténtico con Mascarpone y Savoiardi", "Panna Cotta Sedosa con Coulis de Frutos Rojos", "Soufflé de Chocolate Esponjoso (Servido al Momento)", "Soufflé Grand Marnier Clásico", "Tarta de Limón y Merengue Italiana Flambeada", "Tarta Sacher Vienesa con Mermelada de Albaricoque", "Selva Negra (Schwarzwälder Kirschtorte) Alemana Auténtica", "Milhojas de Crema Pastelera y Hojaldre Caramelizado", "Coulant de Chocolate con Corazón Líquido", "Cheesecake Estilo Nueva York Horneado", "Cheesecake Japonés Esponjoso", "Pavlova Australiana con Fruta Fresca y Nata Montada", "Baba au Rhum con Nata Chantilly", "Canelés Bordeleses (Exterior Crujiente, Interior Tierno)", "Macarons Parisinos de Diversos Sabores", "Île Flottante (Isla Flotante) con Crema Inglesa", "Arroz con Leche Cremoso Asturiano con Azúcar Quemado", "Torrija Caramelizada sobre Crema Inglesa de Canela", "Leche Frita Tradicional con Azúcar y Canela", "Crema Catalana Quemada", "Pastel Vasco (Gâteau Basque) con Crema o Cereza Negra", "Tarta de Santiago (Almendra)", "Flan de Huevo Casero Tradicional", "Helado Artesanal de Pistacho de Bronte", "Sorbete Refrescante de Limón al Cava", "Frutas de Temporada Laminadas con Sopa Fría de Menta y Lima", "Peras al Vino Tinto Especiadas", "Clafoutis de Cerezas Francés", "Financiers de Almendra y Mantequilla Tostada", "Madeleines (Magdalenas Francesas) Clásicas", "Tarta Ópera Parisina (Capas de Bizcocho, Café, Chocolate)",
            // Panes Artesanales
            "Baguette Francesa Tradicional con Masa Madre", "Pan de Campaña Rústico (Pain de Campagne)", "Pan de Centeno Integral con Semillas", "Focaccia Italiana con Romero, Sal Gruesa y Aceite de Oliva", "Pan Brioche Trenzado y Esponjoso", "Pan de Masa Madre (Sourdough) con Corteza Crujiente", "Chapata Italiana (Ciabatta) con Grandes Alveolos", "Pan de Molde Japonés (Shokupan) Extra Suave", "Pan Integral Multicereales Casero", "Pão de Queijo Brasileño (Panecillos de Queso)", "Grissini Italianos Crujientes", "Pan de Pita Casero Inflado", "Naan Indio Hecho en Sartén con Ajo y Cilantro", "Pan Pretzel Alemán con Sal Gruesa", "Panettone Italiano Clásico Navideño (Larga Fermentación)",
            // Conceptos / Técnicas
            "El Arte del Sous-Vide: Cocción a Baja Temperatura", "Técnicas de Confitado: Pato, Ajo, Verduras", "Cómo Hacer Emulsiones Estables: Holandesa, Bearnesa, Mahonesa", "Reducciones y Glaseados: Concentrando Sabores", "El Braseado Perfecto: Cocción Lenta y Húmeda", "Dominando el Sellado de Carnes y Pescados", "Secretos de un Buen Caldo o Fondo Casero", "Masas Fermentadas: El Mundo de la Panadería y Bollería", "Introducción a la Esferificación (Cocina Molecular Básica)", "Ahumado en Frío y en Caliente en Casa", "El Temperado del Chocolate para Postres Perfectos", "Maridaje de Vinos y Comida: Principios Básicos", "Presentación y Emplatado: El Toque Final del Chef", "Uso de Hierbas Aromáticas Frescas en la Cocina Gourmet", "Las Especias Clave en la Alta Cocina Mundial"
        ];
        const recipeThemes = [ // Temas para generar más recetas
            "recetas clásicas francesas", "alta cocina italiana", "tapas gourmet españolas", "recetas sofisticadas de pescado",
            "platos de carne elaborados", "cocina asiática premium (Japón, Tailandia, China)", "postres de restaurante",
            "panadería artesanal avanzada", "recetas vegetarianas gourmet", "cocina molecular para principiantes",
            "recetas con marisco fresco", "técnicas de cocción avanzadas (sous-vide, confit)", "aperitivos elegantes",
            "sopas y cremas refinadas", "ensaladas creativas", "recetas con ingredientes de lujo (trufa, caviar, foie)",
            "guarniciones elevadas", "recetas de caza (pichón, codorniz)", "brunch premium", "cócteles clásicos y modernos",
            "recetas de la abuela 'versionadas'", "cocina fusión de autor", "platos para ocasiones especiales"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un chef ejecutivo y escritor culinario de renombre, especializado en alta cocina y técnicas sofisticadas. Tu tarea es redactar recetas 'premium' de forma extremadamente detallada, precisa y elocuente para cocineros aficionados avanzados o profesionales. Incluye: Título completo, introducción evocadora, nivel de dificultad (medio, avanzado, experto), tiempo de preparación y cocción estimado, lista de ingredientes exacta (con unidades métricas y/o imperiales claras, especificando calidad si es relevante, ej. 'Aceite de Oliva Virgen Extra Picual'), equipamiento especial necesario, instrucciones paso a paso MUY detalladas (explicando el porqué de cada paso y técnica clave: mise en place, tipos de corte, temperaturas, puntos de cocción, emulsiones, reducciones, etc.), consejos del chef (trucos, variaciones, posibles errores), sugerencias de emplatado profesional y opciones de maridaje (vino, cerveza u otra bebida). El objetivo es una receta completa y lujosa de aproximadamente 1200-1300 palabras. Basa tu receta únicamente en el siguiente nombre de plato:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para un recetario de alta cocina. Genera exactamente 15 nombres de platos que suenen gourmet, sofisticados o 'premium', adecuados para ser detallados en una receta completa. Incluye variedad (aperitivos, principales de carne/pescado/vegetariano, postres). Devuelve *solo* la lista de nombres, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ==========
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content'); // Container for text AND image
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null; // Will be created if needed

        // ========== API FUNCTIONS ==========
        async function fetchTextFromApi(prompt, config) { /* ... Sin cambios ... */
             const encodedPrompt = encodeURIComponent(prompt);
             const encodedSystem = encodeURIComponent(config.systemPrompt);
             const params = new URLSearchParams({ model: config.model, system: encodedSystem });
             if (config.seed) params.append('seed', config.seed);
             const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
             console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
             const controller = new AbortController();
             const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
             try {
                 const response = await fetch(url, { signal: controller.signal });
                 clearTimeout(timeoutId);
                 if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                 const text = await response.text();
                 if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                 console.log(`API Response received (${text.length} chars)`);
                 return text;
             } catch (error) {
                 clearTimeout(timeoutId);
                 console.error("API Fetch Error:", error);
                 if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                 throw new Error(`Error de comunicación con la API: ${error.message}`);
             }
        }
        async function fetchExplanationText(recipeTitle) { /* ... Sin cambios (nombre función) ... */
             const text = await fetchTextFromApi(recipeTitle, textApiConfig);
              // Stricter check for recipe content
              if (text.trim().length < 1000 || !text.toLowerCase().includes("ingredientes") || !text.toLowerCase().includes("instrucciones") || !text.toLowerCase().includes("paso") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de crear esta receta")) {
                   throw new Error("La IA no pudo generar una receta detallada o completa para este plato.");
               }
             return text;
        }
        async function fetchGeneratedTitles() { /* ... Sin cambios (usa config actualizada)... */
            const randomTheme = getRandomElement(recipeThemes) || "platos insignia gourmet";
            const specificPrompt = `Genera 15 nombres de platos sofisticados o premium sobre ${randomTheme}`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 10 && line.length < 150);
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de recetas.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a RECETAS PREMIUM
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText : "gourmet food plating abstract";
            // Prompt ENFOCADO en arte culinario, abstracto
            const enhancedPrompt = `Abstract culinary art inspired by '${safePromptText}'. Focus on textures, colors, elegant plating composition, gourmet ingredients. Style of high-end food photography, warm or dramatic lighting. Conceptual, non-realistic.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, menu, logo, signature, people, hands, restaurant background, messy food, ugly plate, simple snapshot, cartoon, illustration, drawing, sketch, diagram";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ==========
        function formatExplanationText(rawText) {
            // Basic formatting, assuming AI provides reasonable structure.
            // Focus on paragraphs and basic markdown.
            if (!rawText) return '';
            let formatted = rawText.trim();
            // Basic Markdown
            formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            // Paragraphs (split by double newline, preserve single newlines as <br>)
            const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            formatted = blocks.map(block => {
                if (block.startsWith('<h')) return block; // Keep existing headers
                // Very basic list detection (line starts with * or - or number.) - wrap in simple <ul>
                if (block.match(/^[\*\-\d+\.]+\s+/m)) {
                    let listItems = block.split('\n').map(line => {
                         const itemContent = line.replace(/^[\*\-\d+\.]+\s+/, '').trim();
                         return itemContent ? `<li>${itemContent}</li>` : '';
                    }).filter(li => li).join('');
                     // Determine list type (crude check)
                     if (block.match(/^\d+\./m)) {
                        return `<ol>${listItems}</ol>`;
                     } else {
                        return `<ul>${listItems}</ul>`;
                     }
                } else {
                    // Regular paragraph, convert internal newlines to <br>
                    let content = block.replace(/\n/g, '<br>');
                    return `<p>${content}</p>`;
                }
            }).join('');
            return formatted;
        }


        // ========== MODAL FUNCTIONS ========== (Igual que versión anterior)
        function showModal() { /* ... Sin cambios ... */ if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { /* ... Sin cambios ... */
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() { /* ... Sin cambios ... */
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = '';
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ========== (Search logic sin cambios)
        function getRandomElement(arr) { /* ... Sin cambios ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... Sin cambios ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... Sin cambios ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... Sin cambios ... */
             if (!titleListContainer || !titlesLoading) return;
             const shuffledTitles = shuffleArray([...titles]);
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if (shuffledTitles.length === 0) {
                 showNoResultsMessage("No hay recetas iniciales disponibles.");
                 return;
             }
             shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
             filterTitles();
         }
        function appendTitles(newTitles) { /* ... Sin cambios ... */
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            newTitles.forEach(title => {
                const item = createTitleItem(title);
                if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
                titleListContainer.appendChild(item);
            });
            checkIfAnyResultsVisible();
        }
        function filterTitles() { /* ... Sin cambios ... */
            if (!searchInput || !titleListContainer) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            const titleItems = titleListContainer.querySelectorAll('.title-item');
            let visibleCount = 0;
            titleItems.forEach(item => {
                const title = item.textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    item.style.display = 'flex';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            updateNoResultsMessage(visibleCount);
        }
        function updateNoResultsMessage(visibleCount) { /* ... Sin cambios ... */
             if (!titleListContainer) return;
             if (noResultsMessageElement) {
                 noResultsMessageElement.remove();
                 noResultsMessageElement = null;
             }
             if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') {
                 showNoResultsMessage(`No se encontraron recetas para "${searchInput.value}"`);
             }
        }
        function showNoResultsMessage(message) { /* ... Sin cambios ... */
             if (noResultsMessageElement || !titleListContainer) return;
             noResultsMessageElement = document.createElement('p');
             noResultsMessageElement.id = 'no-results-message';
             noResultsMessageElement.textContent = message;
             titleListContainer.appendChild(noResultsMessageElement);
        }
        function checkIfAnyResultsVisible() { /* ... Sin cambios ... */
             const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])');
             updateNoResultsMessage(visibleItems.length);
         }

        // *** MODIFIED: handleTitleClick (Image logic same as previous) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                // 1. Fetch and format text
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                // 2. Stop loading indicator, display text FIRST
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation;
                modalStoryContentArea.classList.remove('content-hidden');

                 // 3. RESET SCROLL after text content is in and visible
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                // 4. Prepare and append image placeholder WITHIN #modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-palette placeholder-icon"></i> <!-- Themed icon -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Pintando el plato...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // 5. Create and append the actual image element
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Representación artística de ${title}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove();
                    imgElement.style.display = 'block';
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-utensil-spoon placeholder-icon" style="opacity: 0.5;"></i> <!-- Error icon -->
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo visualizar el plato.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement);
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = ''; // Clear partial content
            }
        }

        async function handleGenerateMoreTitles() { /* ... Sin cambios (logic), update text */
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i');
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden');
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Buscando inspiración...";

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer);
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se encontraron más ideas de recetas en este momento.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error buscando inspiración: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden');
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Descubrir Más Recetas";
                 checkIfAnyResultsVisible();
             }
         }


        // ========== INITIALIZATION ==========
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: #c53030; font-size: 1.8em; text-align: center; padding-top: 4em; font-family: var(--font-title);">Error Fatal: La cocina está cerrada.</p>'; return; } // Thematic error
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            searchInput.addEventListener('input', filterTitles); // Add listener
            displayTitles(predefinedTitles); // Initial display
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>