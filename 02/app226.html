<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplos Prácticos de CSS</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fonts: UI font + Code font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Ejemplos CSS --- */
        :root {
            --color-primary: #3b82f6; /* Azul Vibrante (CSS, Links) */
            --color-secondary: #a78bfa; /* Violeta Claro (Complementario) */
            --color-tertiary: #fbbf24; /* Ámbar (Énfasis) */
            --color-background: #1e293b; /* Azul Grisáceo Oscuro (Fondo) */
            --color-surface: #334155; /* Azul Grisáceo Medio (Superficies) */
            --color-text: #f1f5f9; /* Gris Muy Claro (Texto Principal) */
            --color-text-muted: #94a3b8; /* Gris Claro (Texto Secundario) */
            --color-border: #475569; /* Azul Grisáceo (Bordes) */
            --color-error-bg: #450a0a;
            --color-error-text: #fca5a5;
            --color-error-border: #ef4444;
            --font-ui: 'Inter', sans-serif; /* Fuente UI más moderna */
            --font-code: 'Source Code Pro', monospace;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.15);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.25), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
            --border-radius: 4px;
            --transition-normal: all 0.2s ease-in-out;
        }
        html { background-color: var(--color-background); }
        body { font-family: var(--font-ui); background-color: var(--color-background); color: var(--color-text); line-height: 1.65; font-weight: 400; }
        h1, h2, h3, h4, .logo { font-family: var(--font-ui); font-weight: 700; }
        .logo { color: var(--color-primary); font-weight: 600; letter-spacing: 0.5px; }
        h1.page-title { color: var(--color-primary); font-weight: 700; }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.6rem; display: inline-block; font-weight: 600; font-size: 1.6rem; }
        #modal-title { color: var(--color-primary); font-weight: 600; }
        .navbar { background-color: var(--color-surface); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }
        /* Search Bar */
        #search-input { width: 100%; padding: 0.8rem 1rem 0.8rem 2.8rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1rem; background-color: var(--color-background); color: var(--color-text); box-shadow: var(--shadow-sm); transition: var(--transition-normal); font-family: var(--font-ui); }
        #search-input::placeholder { color: var(--color-text-muted); }
        #search-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); outline: none; background-color: var(--color-surface); }
        #search-container .fa-search { position: absolute; left: 0.9rem; top: 50%; transform: translateY(-50%); color: var(--color-text-muted); transition: color 0.2s ease; }
        #search-input:focus + .fa-search { color: var(--color-primary); }

        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 1rem; }
        .title-item { background-color: var(--color-surface); padding: 1.1rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 400; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 65px; font-family: var(--font-ui); font-size: 0.95rem; }
        .title-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: var(--color-primary); color: var(--color-primary); background-color: #475569; }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-primary); color: white; padding: 0.7rem 1.4rem; border: none; border-radius: var(--border-radius); font-family: var(--font-ui); font-weight: 500; cursor: pointer; transition: var(--transition-normal); margin-top: 1.5rem; }
        #generate-more-btn:hover:not(:disabled) { background-color: #2563eb; box-shadow: var(--shadow-md); }
        #generate-more-btn:disabled { background-color: var(--color-text-muted); color: var(--color-surface); cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }

        /* Modal */
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(30, 41, 59, 0.92); display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 1.5rem 2rem;
            max-width: 1100px;
            width: 95%;
            max-height: 90vh;
            min-height: 500px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }
        .modal-close-btn { position: absolute; top: 10px; right: 12px; background: var(--color-border); border: none; border-radius: 50%; width: 36px; height: 36px; font-size: 1.6rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 60; }
        .modal-close-btn:hover { background-color: var(--color-primary); color: white; transform: rotate(90deg); }
        #modal-title { font-size: 1.7rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }

        /* Contenido del Modal: Código + Preview */
        #modal-output-area { flex-grow: 1; min-height: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; overflow: hidden; }
        .code-panel, .preview-panel { display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: var(--color-background); }
        .panel-header { font-family: var(--font-ui); font-weight: 500; padding: 0.6rem 1rem; background-color: var(--color-border); color: var(--color-text); flex-shrink: 0; border-bottom: 1px solid var(--color-surface); font-size: 0.9rem; }
        .panel-header i { margin-right: 0.5rem; color: var(--color-primary); }
        #code-display-container, #preview-container { flex-grow: 1; overflow: auto; padding: 1rem; scrollbar-width: thin; scrollbar-color: var(--color-primary) var(--color-surface); }
        #code-display-container::-webkit-scrollbar, #preview-container::-webkit-scrollbar { width: 8px; }
        #code-display-container::-webkit-scrollbar-track, #preview-container::-webkit-scrollbar-track { background: var(--color-surface); border-radius: var(--border-radius); }
        #code-display-container::-webkit-scrollbar-thumb, #preview-container::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 1px solid var(--color-surface); }

        /* Estilos para PrismJS (ajustados para encajar con el tema) */
        #code-output { font-family: var(--font-code); font-size: 0.9em; line-height: 1.5; white-space: pre; word-wrap: normal; color: #cbd5e1; /* Texto código */ background: none; text-shadow: none;}
        #code-output .token.comment,
        #code-output .token.prolog,
        #code-output .token.doctype,
        #code-output .token.cdata { color: #64748b; font-style: italic;} /* Comentarios */
        #code-output .token.punctuation { color: #94a3b8; } /* Puntuación */
        #code-output .token.namespace { opacity: .7; }
        #code-output .token.property,
        #code-output .token.tag, /* Tags principales */
        #code-output .token.boolean,
        #code-output .token.number,
        #code-output .token.constant,
        #code-output .token.symbol,
        #code-output .token.deleted { color: #60a5fa; } /* Azul claro */
        #code-output .token.selector, /* Selectores CSS */
        #code-output .token.attr-name,
        #code-output .token.string,
        #code-output .token.char,
        #code-output .token.builtin,
        #code-output .token.inserted { color: #a78bfa; } /* Violeta */
        #code-output .token.operator,
        #code-output .token.entity,
        #code-output .token.url,
        .language-css .token.string,
        .style .token.string { color: #f1f5f9; background: none;} /* Blanco */
        #code-output .token.atrule, /* @ rules */
        #code-output .token.attr-value,
        #code-output .token.keyword { color: #fb923c; } /* Naranja */
        #code-output .token.function,
        #code-output .token.class-name { color: #facc15; } /* Amarillo */
        #code-output .token.regex,
        #code-output .token.important,
        #code-output .token.variable { color: #4ade80; } /* Verde */
        #code-output .token.important,
        #code-output .token.bold { font-weight: bold; }
        #code-output .token.italic { font-style: italic; }
        #code-output .token.entity { cursor: help; }

        #preview-iframe { width: 100%; height: 100%; border: none; background-color: #f8fafc; /* Fondo preview claro */ }

        /* Loading Overlay & Minigame */
        #modal-loading { text-align: center; padding: 2rem; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(30, 41, 59, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 55; border-radius: var(--border-radius); }
        #modal-loading.active { display: flex; }
        .loading-spinner-modal { width: 50px; height: 50px; border: 5px solid var(--color-border); border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin-bottom: 1rem; }
        #modal-loading p { font-weight: 400; color: var(--color-text); font-size: 1.2rem; margin-bottom: 1.5rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Minigame Styles (Pong Example) --- */
        #minigame-container { width: 80%; max-width: 300px; height: 150px; background-color: #0f172a; /* Azul muy oscuro */ position: relative; border: 2px solid var(--color-primary); margin-top: 1rem; overflow: hidden; cursor: none; }
        .paddle { position: absolute; width: 10px; height: 40px; background-color: var(--color-primary); }
        #player-paddle { left: 10px; top: 55px; }
        .ball { position: absolute; width: 10px; height: 10px; background-color: var(--color-secondary); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        #minigame-instructions { font-size: 0.8rem; color: var(--color-text-muted); margin-top: 0.5rem; }
        /* --- End Minigame Styles --- */

        .error-msg { background-color: var(--color-error-bg); color: var(--color-error-text); padding: 1rem; border-radius: var(--border-radius); border: 1px solid var(--color-error-border); margin-top: 1rem; text-align: center; flex-shrink: 0; font-weight: 400; font-size: 0.95rem; }
        .error-msg i { margin-right: 0.5rem; color: var(--color-error-border); }
        .content-hidden { display: none !important; }
        .title-item.hidden { display: none; }
    </style>
    <!-- Prism JS CSS (No theme needed, we use custom styles) -->
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-3 flex flex-col sm:flex-row justify-between items-center">
             <div class="flex items-center text-center mb-2 sm:mb-0">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fab fa-css3-alt mr-2"></i> <!-- Icono CSS -->
                     CSS<span class="text-gray-400">Lab</span>
                 </h1>
             </div>
             <span class="text-xs text-gray-400 font-light tracking-wide">Ejemplos Prácticos de CSS</span>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Domina CSS con Ejemplos</h1>
             <p class="text-lg text-gray-300 mb-8 max-w-3xl mx-auto font-light">Explora ejemplos prácticos de CSS, desde layouts hasta efectos visuales. Selecciona uno y ve el código y resultado.</p>
         </section>

         <!-- Search Bar -->
         <section id="search-container" class="mb-10 max-w-2xl mx-auto relative">
             <input type="text" id="search-input" placeholder="Buscar ejemplo CSS (ej: 'flexbox', 'gradient', 'hover'...)">
             <i class="fas fa-search text-gray-500 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-8 text-center mx-auto">
                 <i class="fas fa-palette text-purple-400 mr-2"></i> <!-- Icono paleta -->
                 Galería de Ejemplos
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-400 col-span-full text-center text-lg">Cargando ejemplos de CSS...</p>
                  <!-- .title-item will be added here -->
             </div>
             <p id="no-results" class="text-gray-400 col-span-full text-center text-lg mt-4 hidden">No se encontraron ejemplos para tu búsqueda.</p>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Generar Más Ejemplos (40)
                  </button>
             </div>
         </section>

     </main>

     <!-- Code Snippet Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator with Minigame -->
             <div id="modal-loading"> <!-- NOT active by default -->
                 <div class="loading-spinner-modal"></div>
                 <p>Generando ejemplo CSS...</p>
                 <div id="minigame-container">
                     <div id="player-paddle" class="paddle"></div>
                     <div class="ball"></div>
                 </div>
                 <p id="minigame-instructions">Mueve el ratón para jugar mientras esperas</p>
             </div>

             <!-- Content Area (Code + Preview) -->
             <div id="modal-story-content-area" class="flex flex-col flex-grow min-h-0 content-hidden"> <!-- Hidden by default -->
                <h2 id="modal-title" class="text-xl md:text-2xl font-bold mb-4 text-center flex-shrink-0"></h2>
                <div id="modal-output-area">
                    <!-- Code Panel -->
                    <div class="code-panel">
                         <div class="panel-header"><i class="fas fa-file-code"></i>Código (HTML + CSS)</div>
                         <div id="code-display-container">
                             <pre><code id="code-output" class="language-html"></code></pre> <!-- Keep language-html for Prism -->
                         </div>
                    </div>
                    <!-- Preview Panel -->
                    <div class="preview-panel">
                         <div class="panel-header"><i class="fas fa-eye"></i>Vista Previa</div>
                         <div id="preview-container">
                             <iframe id="preview-iframe" title="Vista Previa del Código CSS" srcdoc="<html><head><title>Preview</title><style>body{display:flex;justify-content:center;align-items:center;height:100%;margin:0;font-family:sans-serif;color:#64748b;background:#e2e8f0;font-size:0.9em;}</style></head><body><div>Esperando generación de código...</div></body></html>"></iframe>
                         </div>
                    </div>
                </div>
                 <div id="modal-error" class="error-msg content-hidden mt-4 flex-shrink-0">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-800 text-gray-500 py-6 mt-12 border-t border-gray-700">
          <div class="container mx-auto px-4 text-center text-xs font-light">
              <p>Ejemplos de CSS generados por IA con fines educativos.</p>
              <p class="mt-1">El código puede requerir ajustes para casos de uso específicos.</p>
              <p class="mt-2">© 2025 CSSLab</p>
          </div>
      </footer>

      <!-- Prism JS (Core + Autoloader for languages) -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // Selectors & Basic Styling
            "Estilo por etiqueta (ej: todos los <p>)", "Estilo por clase (.mi-clase)", "Estilo por ID (#unico)", "Selector universal (*)", "Agrupar selectores (h1, h2, .titulo)", "Selector descendente (div p)", "Selector hijo directo (ul > li)", "Selector hermano adyacente (h1 + p)", "Selector hermano general (h1 ~ p)", "Selector de atributo ([target])", "Selector de atributo con valor ([type='text'])", "Selector de atributo que contiene palabra ([class~='importante'])", "Selector de atributo que empieza con ([href^='https'])", "Selector de atributo que termina con ([src$='.png'])", "Selector de atributo que contiene subcadena ([alt*='foto'])", "Pseudo-clase :hover", "Pseudo-clase :active", "Pseudo-clase :focus", "Pseudo-clase :visited para enlaces", "Pseudo-clase :link para enlaces no visitados", "Pseudo-clase :first-child", "Pseudo-clase :last-child", "Pseudo-clase :nth-child(odd)", "Pseudo-clase :nth-child(even)", "Pseudo-clase :nth-child(3)", "Pseudo-clase :nth-child(2n+1)", "Pseudo-clase :not(.excluir)", "Pseudo-clase :empty", "Pseudo-clase :checked (checkbox/radio)", "Pseudo-clase :disabled (inputs)", "Pseudo-clase :required (inputs)", "Pseudo-clase :optional (inputs)", "Pseudo-elemento ::before (añadir contenido)", "Pseudo-elemento ::after (añadir contenido)", "Pseudo-elemento ::first-letter (letra capital)", "Pseudo-elemento ::first-line (primera línea)", "Pseudo-elemento ::marker (viñetas de lista)", "Pseudo-elemento ::selection (texto seleccionado)", "Pseudo-elemento ::placeholder (input placeholder)", "Comentarios en CSS", "Especificidad CSS (ejemplo simple ID vs Clase)", "Herencia CSS (ejemplo simple fuente)", "La cascada CSS (ejemplo orden reglas)", "!important (uso y advertencia)",
             // Text Styling
            "Cambiar fuente (font-family)", "Cambiar tamaño de fuente (font-size)", "Cambiar grosor de fuente (font-weight)", "Estilo de fuente (font-style: italic)", "Alineación de texto (text-align)", "Decoración de texto (text-decoration: underline)", "Transformación de texto (text-transform: uppercase)", "Altura de línea (line-height)", "Espaciado entre letras (letter-spacing)", "Espaciado entre palabras (word-spacing)", "Sombra de texto (text-shadow)", "Color de texto (color)", "Sangría de primera línea (text-indent)",
             // Backgrounds & Borders
            "Color de fondo (background-color)", "Imagen de fondo (background-image url)", "Repetir imagen de fondo (background-repeat)", "Posición de imagen de fondo (background-position)", "Tamaño de imagen de fondo (background-size: cover/contain)", "Fijar imagen de fondo (background-attachment: fixed)", "Atajo de fondo (background property)", "Fondo degradado lineal (linear-gradient)", "Fondo degradado radial (radial-gradient)", "Borde simple (border: 1px solid black)", "Estilo de borde (border-style: dashed)", "Ancho de borde (border-width)", "Color de borde (border-color)", "Borde individual (border-top, border-left)", "Redondear esquinas (border-radius)", "Redondear esquina individual", "Sombra de caja (box-shadow)", "Sombra de caja interior (inset box-shadow)",
             // Box Model & Sizing
            "Padding (relleno interior)", "Padding individual (padding-top)", "Margin (margen exterior)", "Margin individual (margin-left)", "Centrar bloque con margin auto", "Ancho fijo (width)", "Altura fija (height)", "Ancho máximo (max-width)", "Altura mínima (min-height)", "Desbordamiento (overflow: hidden/scroll/auto)", "Modelo de caja (box-sizing: border-box vs content-box)",
             // Display & Visibility
            "Display block", "Display inline", "Display inline-block", "Display none (ocultar y quitar espacio)", "Visibilidad (visibility: hidden vs collapse)", "Opacidad (opacity)",
             // Positioning
            "Posición estática (position: static - default)", "Posición relativa (position: relative)", "Posición absoluta (position: absolute)", "Posición absoluta respecto a ancestro posicionado", "Posición fija (position: fixed - ej: header)", "Posición pegajosa (position: sticky - ej: sidebar)", "Control de apilamiento (z-index)",
             // Flexbox Layout
            "Contenedor Flex (display: flex)", "Dirección Flex (flex-direction: row/column)", "Alinear items en eje principal (justify-content: center/space-between/etc)", "Alinear items en eje transversal (align-items: center/stretch/etc)", "Alinear contenido multilínea (align-content)", "Envolver items (flex-wrap: wrap)", "Atajo Flex Flow (flex-flow)", "Espaciado entre items Flex (gap)", "Orden de item Flex (order)", "Crecimiento de item Flex (flex-grow)", "Encogimiento de item Flex (flex-shrink)", "Base de item Flex (flex-basis)", "Atajo Flex Item (flex property)", "Centrar un item perfectamente con Flexbox", "Layout de cabecera simple con Flexbox", "Layout de tarjetas con Flexbox", "Layout de pie de página simple con Flexbox",
             // Grid Layout
            "Contenedor Grid (display: grid)", "Definir columnas Grid (grid-template-columns: fr, px, auto)", "Definir filas Grid (grid-template-rows)", "Espaciado Grid (gap, row-gap, column-gap)", "Colocar item por línea (grid-column-start/end, grid-row-start/end)", "Atajo colocar item (grid-column, grid-row)", "Colocar item por área (grid-template-areas, grid-area)", "Alinear items en celdas (justify-items, align-items)", "Alinear contenido Grid (justify-content, align-content)", "Colocar items individualmente (justify-self, align-self)", "Layout de página básico con Grid", "Galería de imágenes simple con Grid", "Superponer elementos con Grid",
             // Transitions & Animations
            "Transición suave de color al hacer hover", "Transición de tamaño al hacer hover", "Transición de múltiples propiedades", "Retardo de transición (transition-delay)", "Función de tiempo de transición (transition-timing-function: ease-in-out)", "Atajo de transición (transition property)", "Animación simple con @keyframes", "Aplicar animación (animation-name, animation-duration)", "Repetir animación (animation-iteration-count: infinite)", "Dirección de animación (animation-direction: alternate)", "Retardo de animación (animation-delay)", "Estado de animación (animation-play-state: paused)", "Función de tiempo de animación (animation-timing-function)", "Modo de relleno de animación (animation-fill-mode: forwards)", "Atajo de animación (animation property)", "Efecto de pulsación con animación", "Efecto de deslizamiento simple con animación",
             // Responsive Design
            "Media Query simple (cambiar color fondo en móvil)", "Media Query (ajustar columnas layout)", "Media Query (cambiar tamaño de fuente)", "Imágenes fluidas (max-width: 100%)", "Tipografía responsive básica (viewport units)",
             // Miscellaneous
            "Estilos de lista (list-style-type: none/disc/etc)", "Estilos de tabla (border-collapse)", "Cursor del ratón (cursor: pointer/wait/etc)", "Filtros CSS (filter: grayscale/blur/sepia)", "Modos de mezcla (mix-blend-mode)", "Variables CSS (Custom Properties :root, var())", "Función calc() para cálculos", "Función clamp() para valores responsivos", "Scroll suave (scroll-behavior: smooth)", "Estilizar barra de scroll (::-webkit-scrollbar - no estándar)", "Recorte de elemento (clip-path)", "Formas fuera de flujo (shape-outside)", "Columnas de texto (column-count, column-gap)", "Contadores CSS (counter-reset, counter-increment, content)"
            // ... (Continuar añadiendo ejemplos prácticos)
        ];
        const cssExampleThemes = [ // Temas para generar más títulos CSS
            "selectores CSS avanzados", "estilos de texto CSS", "fondos CSS", "bordes y sombras CSS", "modelo de caja CSS", "unidades CSS", "posicionamiento CSS", "layout flexbox", "layout grid", "transiciones CSS", "animaciones CSS", "diseño responsive CSS", "media queries", "variables CSS", "filtros CSS", "pseudo-clases CSS", "pseudo-elementos CSS", "estilos de formulario CSS", "estilos de tabla CSS", "estilos de lista CSS", "funciones CSS calc() clamp()", "clip-path CSS", "mix-blend-mode CSS", "especificidad y cascada CSS"
        ];
        const textApiConfig = { // Para generación de código HTML + CSS
            model: "mistral",
            systemPrompt: `Eres un desarrollador frontend experto especializado en CSS. Tu tarea es generar un ejemplo de código HTML completo y autocontenido que demuestre de forma clara y concisa la técnica o concepto CSS especificado en el título.
- El HTML debe ser semántico pero mínimo, solo lo necesario para mostrar el efecto CSS.
- TODO el CSS debe ir dentro de etiquetas <style> en el <head> del documento HTML.
- Comenta el CSS para explicar las partes clave relacionadas con el título.
- El resultado debe ser visualmente claro en la vista previa.
- **Genera únicamente el código HTML completo.** No incluyas explicaciones adicionales antes o después del bloque de código.`,
            timeoutSeconds: 120
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: `Actúa como un generador de ideas conciso para ejemplos de CSS prácticos. Genera exactamente **40** títulos cortos y descriptivos para snippets que demuestren una técnica específica de CSS. Los títulos deben ser claros sobre el objetivo (ej: 'Centrar verticalmente con Flexbox', 'Efecto de botón presionado con sombra interior', 'Layout de 3 columnas con Grid', 'Transición de opacidad al hacer hover', 'Variable CSS para tema de color'). Devuelve *solo* la lista de títulos, uno por línea. Sin números, guiones, introducciones ni despedidas.`,
            timeoutSeconds: 60
        };

        // ========== DOM ELEMENTS (Sin cambios) ==========
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const noResultsMsg = document.getElementById('no-results');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const generateMoreSpinner = generateMoreBtn.querySelector('i');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const codeOutputElement = document.getElementById('code-output');
        const previewIframe = document.getElementById('preview-iframe');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        const minigameContainer = document.getElementById('minigame-container');
        const playerPaddle = document.getElementById('player-paddle');
        const ball = document.querySelector('.ball');

        // ========== Minigame State & Logic (Sin cambios) ==========
        let gameLoopId = null;
        let ballX = 150, ballY = 75;
        let ballSpeedX = 1.5, ballSpeedY = 1.5;
        let paddleY = 55;
        const paddleHeight = 40;
        const containerHeight = 150;
        const containerWidth = 300;

        function startGame() { /* ... (sin cambios) ... */
            if (!minigameContainer || !playerPaddle || !ball) return;
            console.log("Starting minigame...");
            ballX = containerWidth / 2; ballY = containerHeight / 2;
            paddleY = (containerHeight - paddleHeight) / 2;
            ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * 1.5;
            ballSpeedY = (Math.random() > 0.5 ? 1 : -1) * 1.5;
            playerPaddle.style.top = `${paddleY}px`;
            ball.style.left = `${ballX}px`; ball.style.top = `${ballY}px`;
            minigameContainer.addEventListener('mousemove', movePaddle);
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        function stopGame() { /* ... (sin cambios) ... */
            console.log("Stopping minigame...");
            if (gameLoopId) { cancelAnimationFrame(gameLoopId); gameLoopId = null; }
            minigameContainer.removeEventListener('mousemove', movePaddle);
        }
        function movePaddle(event) { /* ... (sin cambios) ... */
            if (!minigameContainer || !playerPaddle) return;
            const rect = minigameContainer.getBoundingClientRect();
            const mouseY = event.clientY - rect.top;
            paddleY = mouseY - paddleHeight / 2;
            if (paddleY < 0) paddleY = 0;
            if (paddleY > containerHeight - paddleHeight) paddleY = containerHeight - paddleHeight;
            playerPaddle.style.top = `${paddleY}px`;
        }
         function gameLoop() { /* ... (sin cambios, usando la versión mejorada anterior) ... */
             if (!ball || !playerPaddle) { stopGame(); return; }
             ballX += ballSpeedX; ballY += ballSpeedY;
             if (ballY <= 0 || ballY >= containerHeight - 10) { ballSpeedY *= -1; ballY = ballY <= 0 ? 0 : containerHeight - 10; }
             const paddleRect = playerPaddle.getBoundingClientRect(); const ballRect = ball.getBoundingClientRect();
             if (ballX <= 20 && ballX > 10 && ballY + 10 > paddleY && ballY < paddleY + paddleHeight) {
                  ballSpeedX *= -1.05; ballX = 20;
                  let deltaY = ballY + 5 - (paddleY + paddleHeight / 2); ballSpeedY += deltaY * 0.08;
                  ballSpeedY = Math.max(-3, Math.min(3, ballSpeedY)); console.log("Paddle Hit!");
             }
             if (ballX >= containerWidth - 10) { ballSpeedX *= -1; ballX = containerWidth - 10; }
             if (ballX <= 0) {
                 ballX = containerWidth / 2; ballY = containerHeight / 2;
                 ballSpeedX = 1.5; ballSpeedY = (Math.random() > 0.5 ? 1 : -1) * 1.5; console.log("Ball Reset");
             }
             ball.style.left = `${ballX}px`; ball.style.top = `${ballY}px`;
             gameLoopId = requestAnimationFrame(gameLoop);
         }

        // ========== API FUNCTIONS (Sin cambios en la lógica interna) ==========
        async function fetchApiData(prompt, config) { /* ... (sin cambios) ... */
            const encodedPrompt = encodeURIComponent(prompt); const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal }); clearTimeout(timeoutId);
                if (!response.ok) { throw new Error(`(Error ${response.status}) Nuestros servidores tienen mucho tráfico en este momento. Por favor, intenta en unos segundos.`); }
                const data = await response.text(); if (!data || data.trim().length === 0) { throw new Error("La respuesta de la API llegó vacía. Intenta de nuevo."); }
                console.log(`API Response received (${data.length} chars)`); return data;
            } catch (error) {
                clearTimeout(timeoutId); console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') { throw new Error(`La solicitud tardó demasiado (>${config.timeoutSeconds}s). Revisa tu conexión o intenta más tarde.`); }
                throw new Error(error.message || "Ocurrió un error inesperado al contactar la IA.");
            }
        }
        async function fetchCssExampleCode(conceptTitle) { // Renombrado para claridad
            return fetchApiData(conceptTitle, textApiConfig);
        }
        async function fetchGeneratedTitles() { /* ... (Usa titleGenerationConfig actualizada) ... */
            const randomTheme = getRandomElement(cssExampleThemes) || "ejemplos prácticos CSS";
            const specificPrompt = `Genera 40 títulos de ejemplos CSS sobre ${randomTheme}`;
            const text = await fetchApiData(specificPrompt, titleGenerationConfig);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 5 && line.length < 150);
            if (titles.length < 10) throw new Error("No se pudieron generar suficientes ideas (se esperaban 40).");
            return titles.slice(0, 40);
        }

        // ========== Utility Functions (cleanAiCodeOutput sin cambios) ==========
        function getRandomElement(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { let ci=array.length,ri;while(ci>0){ri=Math.floor(Math.random()*ci);ci--;[array[ci],array[ri]]=[array[ri],array[ci]];} return array; }
        function cleanAiCodeOutput(rawCode) { /* ... (la función de limpieza anterior es correcta) ... */
            if (!rawCode) return ''; let cleanedCode = rawCode.trim();
            const codeBlockRegex = /^```(?:\w*\s*)?\r?\n?([\s\S]*?)\r?\n?```$/;
            const match = cleanedCode.match(codeBlockRegex);
            if (match && match[1]) { cleanedCode = match[1].trim(); console.log("Cleaned code using regex match.");
            } else {
                 const startFenceRegex = /^```(?:\w*\s*)?\r?\n?/; if (startFenceRegex.test(cleanedCode)) { cleanedCode = cleanedCode.replace(startFenceRegex, ''); console.log("Cleaned code removing start fence."); }
                 const endFenceRegex = /\r?\n?```$/; if (endFenceRegex.test(cleanedCode)) { cleanedCode = cleanedCode.replace(endFenceRegex, ''); console.log("Cleaned code removing end fence."); }
            }
             if (cleanedCode.startsWith('html') && cleanedCode.includes('<!DOCTYPE html>')) { cleanedCode = cleanedCode.substring(cleanedCode.indexOf('<!DOCTYPE html>')); console.log("Cleaned code removing initial 'html' tag line."); }
            return cleanedCode.trim();
        }


        // ========== MODAL FUNCTIONS (Sin cambios) ==========
        function showModal() { storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { storyModal.classList.remove('active'); document.body.style.overflow = ''; stopGame(); resetModalState(); }
        function resetModalState() { /* ... (sin cambios) ... */
             modalLoadingIndicator.classList.remove('active');
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = ''; codeOutputElement.textContent = '';
             previewIframe.srcdoc = `<html><head><title>Preview</title><style>body{display:flex;justify-content:center;align-items:center;height:100%;margin:0;font-family:sans-serif;color:#94a3b8;background:#334155;font-size:0.9em;}</style></head><body><div>Esperando generación de código...</div></body></html>`;
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS (Lógica sin cambios, excepto llamada a fetchCssExampleCode) ==========
        function createTitleItem(title) { const div=document.createElement('div'); div.className='title-item'; div.textContent=title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... (sin cambios) ... */
             if (!titleListContainer || !titlesLoading) return;
             const sortedTitles = titles.sort((a, b) => a.localeCompare(b)); titleListContainer.innerHTML = ''; titlesLoading.style.display = 'none';
             if (sortedTitles.length === 0) { titleListContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">No hay ejemplos disponibles.</p>'; return; }
             sortedTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
        }
        function appendTitles(newTitles) { /* ... (sin cambios) ... */
             if (!titleListContainer || !newTitles || newTitles.length === 0) return;
             const existingTitles = new Set(Array.from(titleListContainer.querySelectorAll('.title-item')).map(item => item.dataset.title)); let addedCount = 0;
             newTitles.forEach(title => { if (!existingTitles.has(title)) { titleListContainer.appendChild(createTitleItem(title)); addedCount++; } });
             console.log(`Added ${addedCount} new titles.`); filterTitles(searchInput.value);
        }

        async function handleTitleClick(title) { // Llama a fetchCssExampleCode
            resetModalState(); showModal(); modalTitle.textContent = title;
            modalLoadingIndicator.classList.add('active'); modalStoryContentArea.classList.add('content-hidden');
            startGame();

            try {
                const generatedHtmlRaw = await fetchCssExampleCode(title); // <--- Cambio aquí
                console.log("Raw API Output:\n", generatedHtmlRaw.substring(0, 500) + "...");
                const generatedHtml = cleanAiCodeOutput(generatedHtmlRaw);
                console.log("Cleaned HTML Output:\n", generatedHtml.substring(0, 500) + "...");

                stopGame(); modalLoadingIndicator.classList.remove('active');
                codeOutputElement.textContent = generatedHtml;
                if (window.Prism) { Prism.highlightElement(codeOutputElement); } else { console.warn("Prism not loaded."); }
                previewIframe.srcdoc = generatedHtml;
                modalStoryContentArea.classList.remove('content-hidden');
                modalError.classList.add('content-hidden');
            } catch (error) {
                console.error("Failed display:", error); stopGame();
                modalLoadingIndicator.classList.remove('active');
                modalErrorMessage.textContent = error.message || "Error desconocido al generar el ejemplo CSS.";
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.add('content-hidden');
            }
        }

        async function handleGenerateMoreTitles() { /* ... (sin cambios) ... */
             if (!generateMoreBtn || !generateMoreSpinner) return;
             generateMoreBtn.disabled = true; generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Generando...';
             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) { appendTitles(newTitles); } else { alert("No se pudieron generar más ideas."); }
             } catch (error) { console.error("Failed title generation:", error); alert(`Error al generar ideas: ${error.message}`); }
             finally { generateMoreBtn.disabled = false; generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin hidden"></i> Generar Más Ejemplos (40)'; }
         }

         function filterTitles(searchTerm) { /* ... (sin cambios) ... */
             const term = searchTerm.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
             const titleItems = titleListContainer.querySelectorAll('.title-item'); let visibleCount = 0;
             titleItems.forEach(item => {
                 const titleText = item.dataset && item.dataset.title ? item.dataset.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") : "";
                 const isVisible = titleText.includes(term); item.classList.toggle('hidden', !isVisible); if (isVisible) visibleCount++;
             });
             const hasItems = titleListContainer.querySelectorAll('.title-item:not(.hidden)').length > 0 || titleListContainer.querySelectorAll('.title-item.hidden').length > 0;
             noResultsMsg.classList.toggle('hidden', visibleCount > 0 || !hasItems);
         }

        // ========== INITIALIZATION (Sin cambios) ==========
        function initApp() { /* ... (sin cambios) ... */
             const essentialElements = [ titleListContainer, storyModal, modalCloseBtn, generateMoreBtn, titlesLoading, searchInput, noResultsMsg, codeOutputElement, previewIframe, modalLoadingIndicator, minigameContainer, playerPaddle, ball ];
             if (essentialElements.some(el => !el)) { console.error("Initialization failed: Missing one or more essential DOM elements."); document.body.innerHTML = '<p style="color: #f87171; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Crítico: Faltan componentes de la interfaz.</p>'; return; }
             console.log("All essential elements found. Initializing CSS Lab...");
             modalCloseBtn.addEventListener('click', hideModal); storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
             generateMoreBtn.addEventListener('click', handleGenerateMoreTitles); searchInput.addEventListener('input', (event) => filterTitles(event.target.value));
             searchInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') event.preventDefault(); });
             displayTitles(predefinedTitles); noResultsMsg.classList.add('hidden');
             console.log("CSS Lab Initialized successfully.");
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>