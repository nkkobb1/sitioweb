<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetario Vegano Interactivo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fuentes amigables para comida -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Recetas Veganas --- */
        :root {
            --color-primary: #4ade80; /* Verde Lima Fresco */
            --color-secondary: #f59e0b; /* Ámbar/Naranja Cálido */
            --color-tertiary: #22c55e; /* Verde Esmeralda */
            --color-background: #f7fee7; /* Verde muy pálido/casi blanco */
            --color-text: #3f3f46; /* Gris Zinc Oscuro */
            --color-text-muted: #71717a; /* Gris Zinc Medio */
            --color-modal-bg: #ffffff; /* Blanco puro modal */
            --color-border: #e4e4e7; /* Borde Zinc Claro */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.04);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.08), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.06);
            --border-radius: 8px; /* Bordes más suaves */
            --transition-normal: all 0.25s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Poppins', sans-serif; font-weight: 700; }
        .logo { color: var(--color-tertiary); }
        h1.page-title { color: var(--color-tertiary); font-weight: 700; }
        h2.section-title { color: var(--color-text); border-bottom: 3px solid var(--color-primary); padding-bottom: 0.6rem; display: inline-block; font-weight: 700;}
        #modal-title { color: var(--color-tertiary); font-weight: 700; }
        .navbar { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }
        /* Estilos Buscador */
        #search-container { margin-bottom: 2.5rem; position: relative; }
        #search-input { width: 100%; padding: 0.9rem 1.2rem 0.9rem 2.8rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1.05rem; box-shadow: var(--shadow-sm); transition: var(--transition-normal); }
        #search-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(77, 222, 128, 0.3); outline: none; }
        #search-container .fa-search { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--color-text-muted); font-size: 1.1rem; }

        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.25rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.3rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 500; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 70px; font-family: 'Poppins', sans-serif; font-size: 1rem; }
        .title-item:hover { transform: translateY(-4px) scale(1.01); box-shadow: var(--shadow-md); border-color: var(--color-secondary); color: var(--color-secondary); background-color: #fffbeb; /* Amarillo muy pálido hover */ }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-tertiary); color: white; padding: 0.8rem 1.6rem; border: none; border-radius: var(--border-radius); font-family: 'Poppins', sans-serif; font-weight: 500; cursor: pointer; transition: var(--transition-normal); margin-top: 2rem; }
        #generate-more-btn:hover:not(:disabled) { background-color: #16a34a; box-shadow: var(--shadow-sm); }
        #generate-more-btn:disabled { background-color: #a1a1aa; color: #e4e4e7; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(63, 63, 70, 0.88); /* Overlay Zinc */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 950px; /* Ligeramente más ancho para recetas */
            width: 95%;
            max-height: 90vh;
            min-height: 350px; /* Altura mínima carga */
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #f4f4f5; border: none; border-radius: 50%; width: 38px; height: 38px; font-size: 1.6rem; color: var(--color-text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: var(--color-secondary); color: #ffffff; }
        #modal-title { font-size: 1.9rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1.5rem; line-height: 1.35; }
        #modal-content {
            line-height: 1.75;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px;
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 9px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: var(--border-radius); }
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.4em; }
        #modal-content strong { color: var(--color-tertiary); font-weight: 600; } /* Peso 600 para Poppins */
        #modal-content em { color: var(--color-secondary); font-style: italic; }
        /* Estilos específicos para recetas */
        #modal-content ul, #modal-content ol { margin-left: 1.8em; margin-bottom: 1.4em; }
        #modal-content li { margin-bottom: 0.7em; }
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Poppins', sans-serif; margin-top: 2.2em; margin-bottom: 1.2em; color: var(--color-tertiary); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.5em; font-weight: 600; }
        #modal-content h1 { font-size: 1.5em; }
        #modal-content h2 { font-size: 1.35em; }
        #modal-content h3 { font-size: 1.2em; color: var(--color-secondary); border-bottom: 1px dashed var(--color-secondary); }
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none;}
        /* Imagen y placeholder */
        #modal-content .final-image { display: block; max-width: 80%; height: auto; margin: 2.5rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-md); }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2.5rem auto 1rem auto; color: var(--color-text-muted); }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 40px; height: 40px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.8rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 55px; height: 55px; border: 6px solid #e4e4e7; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 500; color: var(--color-text); font-size: 1.3rem; font-family: 'Poppins'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #fff1f2; color: #be123c; padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid #fecdd3; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: 500; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        .title-item.hidden { display: none; } /* Para buscador */
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center">
             <div class="flex items-center text-center mb-3 sm:mb-0">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fas fa-seedling mr-2 text-green-500"></i> <!-- Icono planta -->
                     Recetario Vegano
                 </h1>
             </div>
             <span class="text-sm text-gray-600 font-medium">🌱 Cocina Basada en Plantas</span>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-12 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Deliciosas Recetas Veganas para Todos</h1>
             <p class="text-lg text-gray-700 mb-8 max-w-3xl mx-auto">Encuentra inspiración para tus desayunos, almuerzos, cenas, postres y más. ¡Todo 100% vegano! Busca o selecciona una receta.</p>
         </section>

         <!-- Search Bar -->
         <section id="search-container" class="mb-10 max-w-2xl mx-auto">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Buscar receta (ej: lentejas, tarta, curry)...">
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-8 text-center mx-auto">
                 <i class="fas fa-utensils text-amber-500 mr-2"></i> <!-- Icono cubiertos -->
                 Explora las Recetas
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Mezclando ingredientes...</p>
                  <!-- Los .title-item se añadirán aquí -->
             </div>
             <p id="no-results" class="text-gray-500 col-span-full text-center text-lg mt-4 hidden">No encontramos recetas para tu búsqueda. ¡Intenta con otros términos!</p>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Generar Más Ideas de Recetas
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Cocinando la receta...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-xl md:text-2xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - La imagen se añadirá aquí al final -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Recipe text (HTML) goes here -->
                     <!-- La imagen y su placeholder/spinner se añadirán aquí vía JS -->
                 </div>
                  <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-green-50 text-green-800 py-6 mt-12 border-t border-green-200">
          <div class="container mx-auto px-4 text-center text-sm font-medium">
              <p>Recetas generadas por IA como inspiración culinaria vegana.</p>
              <p class="mt-1">Ajusta cantidades y condimentos a tu gusto. ¡Buen provecho!</p>
              <p class="mt-2">© 2025 Recetario Vegano Interactivo</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
            // Desayunos
            "Tostadas Francesas Veganas Clásicas", "Avena Nocturna (Overnight Oats) con Chía y Frutas", "Pancakes Veganos Esponjosos", "Batido Verde Energizante con Espinaca y Plátano", "Revuelto de Tofu estilo Huevo", "Granola Casera Vegana con Frutos Secos y Semillas", "Waffles Veganos Crujientes", "Muffins Veganos de Arándanos", "Parfait de Yogur Vegano con Granola y Frutos Rojos", "Arepas Veganas Rellenas de Aguacate y Frijoles Negros", "Porridge de Quinoa con Leche Vegetal y Canela", "Crepes Veganos Rellenos de Chocolate y Plátano", "Burrito de Desayuno Vegano con Tofu y Patatas", "Pan de Plátano Vegano Húmedo", "Smoothie Bowl de Acai con Toppings", "Tostadas con Aguacate y Tomate Cherry", "Galletas Veganas de Avena y Pasas para el Desayuno", "Barritas Energéticas Veganas Caseras", "Chia Pudding con Mango y Coco", "Café Dalgona Vegano", "Chocolate Caliente Vegano Espeso", "Leche Dorada Vegana (Golden Milk)", "Magdalenas Veganas de Zanahoria", "Tofu Scramble Ranchero", "Frittata Vegana de Verduras", "Bagels Veganos con Queso Crema de Anacardos", "Scones Veganos de Naranja y Arándanos", "Gachas de Avena Veganas al Horno", "Tostada con Hummus y Pepino", "Yogur de Coco Casero",

            // Almuerzos y Cenas (Platos Principales)
            "Lasaña Vegana de Lentejas Rojas y Espinacas", "Curry Vegano de Garbanzos y Leche de Coco", "Hamburguesas Veganas de Frijoles Negros y Maíz", "Chili Vegano Clásico con Tres Tipos de Frijoles", "Tacos Veganos de Carnitas de Jackfruit (Yaca)", "Pasta Vegana cremosa con Salsa de Anacardos y Champiñones", "Albóndigas Veganas en Salsa de Tomate Casera", "Pizza Vegana con Verduras Asadas y Queso Vegano", "Estofado Vegano de Lentejas Pardinas con Verduras", "Risotto Vegano de Champiñones y Vino Blanco", "Berenjenas Rellenas Veganas de Quinoa y Verduras", "Shepherd's Pie Vegano con Puré de Patatas Dulces", "Curry Tailandés Verde Vegano con Tofu y Verduras", "Wraps Veganos de Falafel con Salsa Tahini", "Enchiladas Veganas de Frijoles Negros y Patata", "Pastel de 'Carne' Vegano (Lentejas y Nueces)", "Pad Thai Vegano con Tofu y Cacahuetes", "Guiso Vegano de Garbanzos con Espinacas estilo Hindú (Chana Saag)", "Quiche Vegana sin Corteza de Tofu y Brócoli", "Ramen Vegano Cremoso con Leche de Soja y Setas", "Fajitas Veganas de Tiras de Soja Texturizada y Pimientos", "Canelones Veganos Rellenos de Espinacas y Ricotta de Tofu", "Musaka Vegana con Capas de Berenjena y Lentejas", "Sopa de Lentejas Rojas Turca Vegana (Mercimek Çorbasi)", "Paella Vegana de Verduras de Temporada", "Macarrones con Queso Veganos Cremosos (Mac and Cheese)", "Bolognesa Vegana de Lentejas para Pasta", "Coliflor Asada Entera estilo 'Steak' Vegano", "Curry Japonés Vegano con Patatas y Zanahorias", "Albóndigas Suecas Veganas con Salsa Cremosa", "Stroganoff Vegano de Champiñones", "Tofu General Tso Vegano", "Empanadas Veganas de 'Carne' de Lentejas", "Gnocchi Veganos de Patata con Pesto de Albahaca", "Sloppy Joes Veganos de Lentejas", "Polenta Cremosa Vegana con Champiñones Salteados", "Tarta Salada Vegana de Puerros y Champiñones", "Arroz Frito Vegano con Tofu y Verduras", "Lentejas a la Jardinera Veganas", "Sopa Minestrone Vegana Abundante", "Buddha Bowl Vegano con Quinoa, Verduras Asadas y Aderezo", "Alambre Vegano con Seitán y Verduras", "Tofu Tikka Masala Vegano", "Pimientos Rellenos Veganos de Arroz y Verduras", "Cazuela Vegana de Frijoles Blancos y Col Rizada", "Sopa de Tortilla Vegana", "Potaje de Vigilia Vegano (Garbanzos y Espinacas)", "Curry de Patata Dulce y Cacahuete Africano Vegano", "Fabada Vegana con 'Chorizo' y 'Morcilla' Vegetal", "Pozole Vegano Rojo con Setas", "Pastel Azteca Vegano", "Cochinita Pibil Vegana (con Setas Ostra)", "Mole Vegano Poblano", "Sancocho Vegano Colombiano", "Arroz con Gandules Vegano (Estilo Puertorriqueño)", "Feijoada Vegana Brasileña", "Bobotie Vegano Sudafricano",

            // Sopas
            "Sopa Vegana de Tomate Asado y Albahaca", "Crema Vegana de Calabaza y Jengibre", "Sopa Vegana de Lentejas Rojas con Limón y Menta", "Sopa Vegana de Brócoli y 'Queso' Cheddar", "Sopa Vegana de Fideos con 'Pollo' de Tofu", "Crema Vegana de Champiñones Silvestres", "Sopa Vegana de Maíz Dulce (Corn Chowder)", "Gazpacho Andaluz Vegano Clásico", "Salmorejo Cordobés Vegano", "Ajoblanco Malagueño Vegano", "Sopa de Cebolla Francesa Vegana Gratinada", "Sopa Pho Vegana Vietnamita", "Sopa Tom Yum Vegana Tailandesa", "Sopa Tom Kha Vegana Tailandesa (Leche de Coco)", "Sopa Vegana de Guisantes Partidos (Split Pea)", "Sopa Vegana de Frijoles Negros y Comino", "Sopa Vegana de Patata y Puerro (Vichyssoise Vegana)", "Sopa Vegana Detox de Verduras", "Sopa Fría Vegana de Pepino y Aguacate", "Caldo de Verduras Vegano Casero", "Sopa Miso Vegana con Tofu y Algas Wakame", "Crema Vegana de Zanahoria y Naranja", "Sopa Vegana de Remolacha (Borscht Vegano)", "Sopa Italiana de Boda Vegana (con Albóndigas Veganas)", "Crema Vegana de Espárragos Trigueros",

            // Ensaladas
            "Ensalada César Vegana con Picatostes y 'Parmesano' de Anacardos", "Ensalada Griega Vegana con Tofu 'Feta'", "Ensalada de Quinoa Vegana con Verduras y Vinagreta de Limón", "Ensalada Cobb Vegana con 'Bacon' de Coco y Aguacate", "Ensalada de Lentejas Vegana estilo Mediterráneo", "Ensalada de Pasta Vegana Fría con Pesto", "Ensalada Waldorf Vegana con Manzana y Nueces", "Ensalada de Patata Vegana Cremosa con Eneldo", "Tabulé Vegano (Ensalada de Perejil y Bulgur/Quinoa)", "Ensalada Nicoise Vegana con Garbanzos en lugar de Atún", "Ensalada de Garbanzos Vegana estilo 'Atún'", "Ensalada Caprese Vegana con Tomate, Albahaca y 'Mozzarella' Vegana", "Ensalada Templada Vegana de Espinacas con Champiñones y 'Bacon' Vegano", "Ensalada Arcoíris Vegana con Aderezo de Cacahuete", "Ensalada de Col Vegana (Coleslaw) Cremosa", "Ensalada de Brócoli Vegana con Pasas y Semillas", "Ensalada de Pepino y Aguacate con Lima y Cilantro", "Ensalada de Remolacha Asada Vegana con Naranja y Pistachos", "Ensalada de Kale Masajeado con Limón y Aguacate", "Ensalada de Alubias Blancas Vegana con Tomate Seco y Rúcula", "Poke Bowl Vegano con Tofu Marinado o Edamame", "Ensalada Tailandesa de Fideos de Arroz Vegana", "Ensalada Mexicana de Maíz y Frijoles Negros (Esquites Salad)", "Ensalada Vietnamita de Fideos Vermicelli Vegana (Bun Chay)", "Ensalada Rusa Vegana",

            // Acompañamientos y Guarniciones
            "Puré de Patatas Vegano Cremoso", "Patatas Asadas al Romero Veganas", "Verduras Asadas Mixtas Veganas", "Arroz Integral Vegano Perfecto", "Quinoa Cocida Básica", "Cuscús Vegano con Verduras y Pasas", "Brócoli al Vapor con Limón y Ajo", "Judías Verdes Salteadas con Almendras Veganas", "Coles de Bruselas Asadas con Sirope de Arce y Balsámico", "Espárragos a la Parrilla con Aceite de Oliva y Limón", "Pan de Ajo Vegano Casero", "Hummus Clásico Cremoso", "Baba Ganoush (Puré de Berenjenas Ahumado)", "Guacamole Casero Fresco", "Salsa de Tomate Casera para Pasta", "Pesto Vegano de Albahaca y Nueces (o Piñones)", "Salsa Bechamel Vegana", "Salsa de 'Queso' Vegano para Nachos", "Champiñones al Ajillo Veganos", "Patatas Bravas Veganas con Salsa Brava y Alioli Vegano", "Tostones (Plátano Frito) Veganos", "Yuca Frita Vegana con Mojo", "Frijoles Refritos Veganos", "Arroz con Coco Vegano (Acompañamiento)", "Pico de Gallo Fresco", "Ensaladilla de Pimientos Asados Vegana", "Setas a la Plancha con Ajo y Perejil", "Calabacín a la Plancha o Asado", "Berenjena a la Parrilla con Hierbas", "Cebolla Caramelizada Vegana Lenta", "Chucrut Casero (Sauerkraut)", "Kimchi Vegano Casero",

            // Aperitivos y Snacks
            "Rollitos de Primavera Veganos Fritos u Horneados", "Nachos Veganos Cargados con 'Queso', Frijoles y Pico de Gallo", "Alitas de Coliflor Búfalo Veganas", "Dip de Espinacas y Alcachofas Vegano Caliente", "Palitos de 'Mozzarella' Veganos Empanados", "Croquetas Veganas de Champiñones", "Croquetas Veganas de 'Jamón' (con proteína vegetal)", "Mini Quiches Veganas", "Brochetas Veganas de Verduras y Tofu a la Parrilla", "Tostadas con Paté Vegetal Casero", "Edamame al Vapor con Sal Marina", "Garbanzos Especiados Asados Crujientes", "Palomitas de Maíz Caseras con Levadura Nutricional", "Chips de Kale Horneados", "Chips de Boniato Horneados", "Frutos Secos Tostados con Especias", "Aceitunas Marinadas", "Dátiles Rellenos de Mantequilla de Almendras", "Bolitas Energéticas Veganas (Energy Balls)", "Rodajas de Manzana con Mantequilla de Cacahuete", "Bastones de Zanahoria y Apio con Hummus", "Galletas Saladas Veganas (Crackers)", "Dip de Frijoles Blancos y Romero", "Muhammara (Dip Sirio de Pimientos y Nueces)", "Tzatziki Vegano (con Yogur de Soja o Anacardos)",

            // Postres
            "Tarta de Queso Vegana (Cheesecake) estilo Nueva York", "Brownies Veganos de Chocolate Fundido", "Mousse de Chocolate Vegana con Aguacate o Tofu Sedoso", "Galletas Veganas con Chispas de Chocolate (Chocolate Chip Cookies)", "Tarta de Manzana Vegana Clásica", "Helado Vegano Cremoso de Vainilla (Base Anacardos o Coco)", "Pastel de Zanahoria Vegano con Frosting de 'Queso Crema'", "Tiramisú Vegano", "Natillas Veganas de Vainilla", "Arroz con Leche Vegano Cremoso", "Pudín de Chía Vegano con Vainilla y Frutas", "Tarta de Chocolate Vegana Intensa", "Crumble Vegano de Manzana y Avena", "Bizcocho Vegano de Limón y Semillas de Amapola", "Cupcakes Veganos de Vainilla con Buttercream Vegano", "Donuts Veganos Horneados con Glaseado", "Tarta Sacher Vegana", "Selva Negra Vegana (Pastel)", "Tarta de Santiago Vegana", "Leche Frita Vegana", "Torrijas Veganas", "Panellets Veganos (Cataluña)", "Polvorones Veganos", "Mantecados Veganos", "Trufas Veganas de Chocolate y Dátiles", "Nice Cream (Helado de Plátano Congelado)", "Sorbetes de Frutas Naturales", "Manzanas Asadas Veganas con Canela y Nueces", "Peras al Vino Vegano", "Brochetas de Fruta Fresca con Salsa de Chocolate Vegano", "Tarta Crudivegana (Raw) de Anacardos y Frutos Rojos", "Blondies Veganos", "Galletas Veganas de Jengibre", "Pastel Red Velvet Vegano", "Buñuelos Veganos", "Crema Catalana Vegana", "Flan Vegano (con Agar-Agar)",

            // Bebidas
            "Leche de Almendras Casera", "Leche de Avena Casera", "Leche de Soja Casera", "Leche de Anacardos Casera", "Batido de Proteínas Vegano Post-Entrenamiento", "Smoothie de Frutos Rojos y Leche Vegetal", "Limonada Casera Fresca", "Té Helado Casero (Negro, Verde, Frutas)", "Agua Fresca de Jamaica (Hibisco)", "Agua Fresca de Horchata Vegana (de Arroz o Chufa)", "Zumo Verde Detox Casero", "Zumo de Naranja y Zanahoria Fresco", "Kombucha Casera (Proceso)", "Kefir de Agua Casero", "Sidra Caliente Especiada Vegana (sin alcohol o con)", "Ponche de Huevo Vegano (Eggnog)", "Sangría Vegana", "Mojito Virgen (sin alcohol)", "Piña Colada Vegana", "Matcha Latte Vegano (Frío o Caliente)", "Chai Latte Vegano",

            // Conceptos y Técnicas
            "Cómo hacer Tofu Casero", "Cómo hacer Seitán Casero", "Cómo hacer Yogur Vegano Casero (Soja, Coco)", "Cómo hacer Queso Vegano Básico (Anacardos)", "Sustitutos Veganos del Huevo en Repostería", "Tipos de Leches Vegetales y sus Usos", "Levadura Nutricional: Qué es y Cómo Usarla", "Aquafaba: El 'Milagro' Vegano (Agua de Garbanzos)", "Beneficios de una Dieta Vegana Equilibrada", "Fuentes Veganas de Proteína Completa", "Fuentes Veganas de Hierro", "Fuentes Veganas de Calcio", "Fuentes Veganas de Omega-3", "Vitamina B12 en Dietas Veganas", "Cocina Vegana para Principiantes: Consejos", "Planificación de Comidas Veganas Semanal (Meal Prep)", "Leer Etiquetas: Identificar Productos Veganos", "Cocina Vegana sin Gluten: Fundamentos", "Cocina Vegana sin Aceite: Técnicas", "Cómo Cocinar Lentejas Correctamente", "Cómo Cocinar Garbanzos Secos", "Cómo Cocinar Quinoa Perfecta", "Diferencias entre Tofu, Tempeh y Seitán", "Marinados Veganos para Tofu o Seitán", "Aderezos para Ensaladas Veganas: Ideas Base", "Salsas Veganas Básicas (Tomate, Bechamel, Queso)", "Despensa Vegana Esencial: ¿Qué comprar?", "Utensilios Útiles en la Cocina Vegana", "Transición a una Dieta Vegana: Pasos Prácticos", "Comer Vegano Fuera de Casa: Consejos", "Mitos Comunes sobre el Veganismo"
        ];
        const veganThemes = [
            "recetas veganas fáciles", "cenas veganas rápidas", "postres veganos sin horno", "recetas veganas con tofu", "recetas veganas con lentejas", "comida mexicana vegana", "comida italiana vegana", "currys veganos", "hamburguesas veganas", "repostería vegana", "desayunos veganos energéticos", "ensaladas veganas completas", "sopas veganas reconfortantes", "recetas veganas sin gluten", "cocina vegana económica", "recetas crudiveganas", "quesos veganos caseros", "leches vegetales caseras", "sustitutos del huevo veganos", "cocina india vegana", "cocina tailandesa vegana", "recetas veganas para niños", "snacks veganos saludables", "meal prep vegano"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un chef vegano experimentado y un apasionado desarrollador de recetas. Tu tarea es proporcionar una receta vegana completa y detallada para el plato solicitado. Incluye: un título claro, una breve descripción apetitosa, tiempo estimado de preparación y cocción, rendimiento (porciones), una lista de ingredientes precisa con medidas (en sistema métrico e imperial si es posible), instrucciones paso a paso claras y concisas, y opcionalmente, consejos útiles, notas sobre ingredientes, posibles sustituciones o ideas para servir. Usa un tono inspirador y práctico. El objetivo es una receta bien estructurada y fácil de seguir, de aproximadamente 1200-1300 palabras (sé detallado en las explicaciones o añade contexto). Basa tu receta únicamente en el siguiente título o idea:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para un recetario vegano. Genera exactamente 15 títulos de recetas veganas variadas (platos principales, postres, desayunos, etc.) o conceptos clave de cocina vegana. Devuelve *solo* la lista de ítems, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ========== (Sin cambios estructurales)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const noResultsMsg = document.getElementById('no-results');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const generateMoreSpinner = generateMoreBtn.querySelector('i');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content'); // Contenedor texto e imagen
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');

        // ========== API FUNCTIONS ========== (Sin cambios funcionales)
        async function fetchTextFromApi(prompt, config) { /* ... */
            const encodedPrompt = encodeURIComponent(prompt);
             const encodedSystem = encodeURIComponent(config.systemPrompt);
             const params = new URLSearchParams({ model: config.model, system: encodedSystem });
             if (config.seed) params.append('seed', config.seed);
             const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
             console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
             const controller = new AbortController();
             const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
             try {
                 const response = await fetch(url, { signal: controller.signal });
                 clearTimeout(timeoutId);
                 if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                 const text = await response.text();
                 if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                 console.log(`API Response received (${text.length} chars)`);
                 return text;
             } catch (error) {
                 clearTimeout(timeoutId);
                 console.error("API Fetch Error:", error);
                 if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                 throw new Error(`Error de comunicación con la API: ${error.message}`);
             }
        }
        async function fetchExplanationText(conceptTitle) { /* ... */
            const text = await fetchTextFromApi(conceptTitle, textApiConfig);
               // Ajustar validación mínima si 1200 es mucho para una receta simple
               if (text.trim().length < 300 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                   throw new Error("La IA no pudo generar una receta adecuada o suficientemente detallada para este título.");
               }
             return text;
        }
        async function fetchGeneratedTitles() { /* ... */
             const randomTheme = getRandomElement(veganThemes) || "recetas veganas variadas";
             const specificPrompt = `Genera 15 títulos de recetas veganas sobre ${randomTheme}`;
             console.log("Generating titles with prompt:", specificPrompt);
             const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
             const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
             const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 5 && line.length < 150);
             if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de recetas.");
             return titles.slice(0, 15);
         }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a RECETAS
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText : "delicious vegan food";
            // Prompt ENFOCADO en foto de comida apetitosa
            const enhancedPrompt = `Delicious looking vegan food photography style image representing '${safePromptText}'. Vibrant colors, appetizing presentation, good lighting, shallow depth of field maybe. Focus on the food.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, letters, titles, captions, writing, numbers, logo, watermark, signature, ugly food, messy, unappetizing, blurry, low quality, person eating, hands, illustration, drawing, cartoon, diagram";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (Potencialmente ajustar para listas si es necesario)
        function formatExplanationText(rawText) {
            if (!rawText) return '';
            let formatted = rawText.trim();
            // Mantener correcciones básicas por si acaso
            formatted = formatted.replace(/\\text\{(.*?)\}/g, '$1');
            formatted = formatted.replace(/(\w)_\{?(\d+)\}?/g, '$1<sub>$2</sub>');
            formatted = formatted.replace(/(\w)\^\{?([\d+\-−]+)\}?/g, (match, base, exponent) => { const cleanExponent = exponent.replace('−', '-'); return `${base}<sup>${cleanExponent}</sup>`; });
            formatted = formatted.replace(/\\rightarrow/g, '&rarr;');
            formatted = formatted.replace(/\\\[\s*(.*?)\s*\\\]/g, '<p class="formula">$1</p>');
            // Encabezados Markdown
            formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
            // Negrita y Cursiva
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');

            // Manejo de Listas (Simplificado - asume que la IA usa guiones/asteriscos o números)
            // Convertir líneas que empiezan con * o - en <li> dentro de <ul>
            formatted = formatted.replace(/^[\*\-]\s+(.*)$/gm, '<li>$1</li>');
            formatted = formatted.replace(/(<li>.*<\/li>\s*)+/g, '<ul>$&</ul>'); // Agrupar <li> en <ul>

            // Convertir líneas que empiezan con número. en <li> dentro de <ol>
            formatted = formatted.replace(/^\d+\.\s+(.*)$/gm, '<li>$1</li>');
            formatted = formatted.replace(/(<li>.*<\/li>\s*)+/g, (match) => {
                 // Evitar re-envolver si ya está en ul (solución imperfecta, pero ayuda)
                 if (match.includes('<ul>')) return match;
                 // Comprobar si el primer elemento sugiere lista ordenada
                 const firstLiContent = match.match(/<li>(.*?)<\/li>/);
                 // Esta heurística es débil, mejor confiar en que la IA formatee bien o hacer post-proceso más complejo.
                 // Por ahora, envolvemos tentativamente en <ol> si no estaba en <ul>
                 return `<ol>${match}</ol>`;
            });
             // Limpieza final de posibles listas vacías o mal formadas
            formatted = formatted.replace(/<ul>\s*<\/ul>/g, '');
            formatted = formatted.replace(/<ol>\s*<\/ol>/g, '');

            // Párrafos (Todo lo que no sea encabezado o lista)
            const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            formatted = blocks.map(block => {
                if (block.startsWith('<h') || block.startsWith('<ul>') || block.startsWith('<ol>') || block.startsWith('<p class="formula">')) {
                    return block;
                }
                // Convertir saltos de línea internos en <br> puede ser útil para instrucciones
                let content = block.replace(/\n/g, '<br>');
                return `<p>${content}</p>`;
            }).join('');

            // Asegurar que no haya <br> justo antes o después de etiquetas de bloque
            formatted = formatted.replace(/<br>\s*(<\/?(p|ul|ol|li|h[1-4]))/g, '$1');
            formatted = formatted.replace(/(<\/(p|ul|ol|li|h[1-4])>)\s*<br>/g, '$1');


            return formatted;
        }

        // ========== MODAL FUNCTIONS ========== (Sin cambios funcionales)
        function showModal() { if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() {
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }
        function resetModalState() {
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = ''; // Limpia texto e imagen anterior
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ========== (Sin cambios funcionales, solo textos temáticos)
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) {
             if (!titleListContainer || !titlesLoading) return;
             const shuffledTitles = shuffleArray([...titles]); // Mezclar para variedad inicial
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if (shuffledTitles.length === 0) { titleListContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">No hay recetas disponibles por ahora.</p>'; return; }
             shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
         }
        function appendTitles(newTitles) { /* ... */
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
             const existingTitles = new Set(Array.from(titleListContainer.querySelectorAll('.title-item')).map(item => item.dataset.title));
             newTitles.forEach(title => {
                 if (!existingTitles.has(title)) {
                     titleListContainer.appendChild(createTitleItem(title));
                 }
             });
             filterTitles(searchInput.value); // Re-aplicar filtro
        }

        // *** MODIFIED: handleTitleClick (sin cambios funcionales mayores, solo textos/iconos) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation; // Poner texto primero
                modalStoryContentArea.classList.remove('content-hidden');

                modalContent.scrollTop = 0; // Resetear scroll DESPUÉS de que el contenido es visible
                console.log("Scroll set to 0 after content visible");

                // Preparar y añadir placeholder de imagen DENTRO de modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-camera placeholder-icon"></i> <!-- Icono placeholder cámara -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Cargando foto de la receta...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // Crear y añadir elemento imagen (empieza a cargar)
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Foto de ${title}`;
                imgElement.style.display = 'none'; // Oculta hasta cargar

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove(); // Quitar placeholder
                    imgElement.style.display = 'block'; // Mostrar imagen
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-image-slash placeholder-icon"></i> <!-- Icono error -->
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la foto.</p>
                    `;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement); // Añadir img al final del contenido
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error al obtener la receta: ${error.message}`; // Mensaje error
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = ''; // Limpiar en caso de error
            }
        }

        async function handleGenerateMoreTitles() { /* ... */
             if (!generateMoreBtn || !generateMoreSpinner || !generateMoreContainer) return;
             generateMoreBtn.disabled = true;
             generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Buscando más ideas...';
             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     appendTitles(newTitles);
                 } else {
                     alert("No pudimos encontrar más ideas de recetas ahora mismo.");
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error buscando ideas: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin hidden"></i> Generar Más Ideas de Recetas';
             }
         }

         // *** NEW: Search Filter Function (Sin cambios funcionales) ***
         function filterTitles(searchTerm) {
             const term = searchTerm.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim(); // Normalizar para quitar acentos
             const titleItems = titleListContainer.querySelectorAll('.title-item');
             let visibleCount = 0;

             titleItems.forEach(item => {
                 const titleText = item.dataset.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                 const isVisible = titleText.includes(term);
                 item.classList.toggle('hidden', !isVisible);
                 if (isVisible) {
                     visibleCount++;
                 }
             });

             noResultsMsg.classList.toggle('hidden', visibleCount > 0);
         }

        // ========== INITIALIZATION ========== (Sin cambios funcionales)
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput || !noResultsMsg) {
                console.error("Initialization failed: Missing essential elements.");
                document.body.innerHTML = '<p style="color: red; font-size: 1.5em; text-align: center; padding-top: 3em;">¡Ups! Algo se quemó al cargar la página. Faltan ingredientes esenciales.</p>';
                return;
             }
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });

            searchInput.addEventListener('input', (event) => {
                filterTitles(event.target.value);
            });

            displayTitles(predefinedTitles);
             noResultsMsg.classList.add('hidden'); // Ocultar al inicio
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>