<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ Generador de Preguntas Increíble ✨</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Iconos (ejemplo con Font Awesome - puedes usar SVGs u otra librería) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
      :root {
        /* Paleta de Colores (Modo Claro y Oscuro) */
        --bg-light: #f7f9fc;
        --bg-dark: #1a1d24;
        --surface-light: #ffffff;
        --surface-dark: #252a33;
        --text-primary-light: #1a1d24;
        --text-primary-dark: #e8eaed;
        --text-secondary-light: #5f6368;
        --text-secondary-dark: #bdc1c6;
        --accent-light: #6366f1; /* Indigo */
        --accent-dark: #818cf8;
        --accent-hover-light: #4f46e5;
        --accent-hover-dark: #a5b4fc;
        --border-light: #e0e4e8;
        --border-dark: #3c4043;
        --error-light: #ef4444; /* Red */
        --error-dark: #f87171;
        --success-light: #22c55e; /* Green */
        --success-dark: #4ade80;
        --shadow-color-light: rgba(99, 102, 241, 0.15);
        --shadow-color-dark: rgba(0, 0, 0, 0.3);
        --gradient-start-light: #e0e7ff;
        --gradient-end-light: #ffffff;
        --gradient-start-dark: #1e293b;
        --gradient-end-dark: #111827;

        /* Tamaños y Transiciones */
        --border-radius-lg: 16px;
        --border-radius-md: 12px;
        --border-radius-sm: 8px;
        --transition-speed: 0.3s;
        --transition-ease: ease-in-out;
      }

      /* Reset Básico y Configuración Global */
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: light-dark(
          linear-gradient(135deg, var(--gradient-start-light), var(--gradient-end-light)),
          linear-gradient(135deg, var(--gradient-start-dark), var(--gradient-end-dark))
        );
        color: light-dark(var(--text-primary-light), var(--text-primary-dark));
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Alinea arriba para ver el efecto de scroll */
        padding: 40px 20px;
        overflow-x: hidden; /* Evitar scroll horizontal */
      }

      /* Contenedor Principal */
      .container {
        background-color: light-dark(var(--surface-light), var(--surface-dark));
        padding: 40px 50px;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 10px 30px -10px light-dark(var(--shadow-color-light), var(--shadow-color-dark));
        width: 100%;
        max-width: 800px;
        text-align: center;
        transition: background-color var(--transition-speed) var(--transition-ease);
        border: 1px solid light-dark(var(--border-light), var(--border-dark));
      }

      /* Título y Descripción */
      h1 {
        font-size: 2.5em;
        font-weight: 700;
        margin-bottom: 15px;
        background: linear-gradient(90deg, var(--accent-light), #a855f7); /* Example gradient */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        /* Dark mode gradient adaptation if needed */
        filter: light-dark(none, brightness(1.3));
      }

      p.description {
        margin-bottom: 35px;
        color: light-dark(var(--text-secondary-light), var(--text-secondary-dark));
        line-height: 1.7;
        font-size: 1.1em;
      }

      /* Área de Texto Mejorada */
      .input-area {
        margin-bottom: 30px;
        position: relative;
      }

      textarea {
        width: 100%;
        min-height: 180px;
        padding: 20px 25px;
        border: 1px solid light-dark(var(--border-light), var(--border-dark));
        border-radius: var(--border-radius-md);
        font-size: 16px;
        font-family: inherit;
        background-color: light-dark(var(--bg-light), #2c313a); /* Fondo ligeramente diferente */
        color: light-dark(var(--text-primary-light), var(--text-primary-dark));
        resize: vertical;
        transition: all var(--transition-speed) var(--transition-ease);
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
      }

      textarea::placeholder {
        color: light-dark(var(--text-secondary-light), #888);
        opacity: 0.8;
      }

      textarea:focus {
        outline: none;
        border-color: light-dark(var(--accent-light), var(--accent-dark));
        box-shadow: 0 0 0 3px light-dark(rgba(99, 102, 241, 0.2), rgba(129, 140, 248, 0.3)),
                    inset 0 1px 3px rgba(0,0,0,0.05);
        background-color: light-dark(var(--surface-light), #313742); /* Ligeramente más claro al enfocar */
      }

      /* Botón Principal Dinámico */
      .generate-button {
        background: linear-gradient(90deg, var(--accent-light), #a855f7); /* Matching title gradient */
        color: white;
        padding: 15px 35px;
        border: none;
        border-radius: var(--border-radius-md);
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 600;
        transition: all var(--transition-speed) var(--transition-ease);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 15px -5px light-dark(var(--shadow-color-light), var(--shadow-color-dark));
        display: inline-flex; /* Para alinear icono y texto */
        align-items: center;
        gap: 10px; /* Espacio entre texto e icono */
      }

      .generate-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px -5px light-dark(var(--shadow-color-light), var(--shadow-color-dark));
        filter: brightness(1.1);
      }

      .generate-button:active:not(:disabled) {
        transform: translateY(0);
        box-shadow: 0 2px 10px -5px light-dark(var(--shadow-color-light), var(--shadow-color-dark));
      }

      .generate-button:disabled {
        background: light-dark(#e0e0e0, #4a4d55);
        color: light-dark(#a0a0a0, #888);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      /* Estado de Carga del Botón */
      .generate-button .button-text {
        transition: opacity var(--transition-speed) var(--transition-ease);
      }
      .generate-button .spinner {
        display: none; /* Oculto por defecto */
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      .generate-button.loading .button-text {
        opacity: 0; /* Ocultar texto */
        position: absolute; /* Sacarlo del flujo */
      }
      .generate-button.loading .spinner {
        display: block; /* Mostrar spinner */
        margin: 0 auto; /* Centrar si el texto desaparece */
      }

      /* Mensaje de Error Estilizado */
      .error-message {
        color: light-dark(var(--error-light), var(--error-dark));
        margin-top: 25px;
        font-weight: 500;
        min-height: 1.5em;
        padding: 10px 15px;
        background-color: light-dark(rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));
        border-radius: var(--border-radius-sm);
        border: 1px solid light-dark(rgba(239, 68, 68, 0.2), rgba(248, 113, 113, 0.2));
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 0; /* Oculto inicialmente */
        transform: translateY(-10px);
        transition: opacity var(--transition-speed) var(--transition-ease), transform var(--transition-speed) var(--transition-ease);
        visibility: hidden; /* Para accesibilidad */
      }
      .error-message.visible {
          opacity: 1;
          transform: translateY(0);
          visibility: visible;
      }

      /* Contenedor de Preguntas */
      .questions-container {
        margin-top: 40px;
        position: relative;
        min-height: 100px; /* Espacio para el loader */
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Layout responsivo */
        gap: 25px;
      }

      /* Indicador de Carga Central */
      .loader-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: light-dark(rgba(255, 255, 255, 0.7), rgba(37, 42, 51, 0.7)); /* Overlay semi-transparente */
        border-radius: var(--border-radius-md);
        z-index: 10;
        opacity: 0;
        visibility: hidden;
        transition: opacity var(--transition-speed) var(--transition-ease), visibility var(--transition-speed) var(--transition-ease);
        pointer-events: none; /* No interferir con clicks */
      }
      .loader-container.visible {
          opacity: 1;
          visibility: visible;
      }
      .loader { /* Un loader diferente */
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: inline-block;
        border-top: 4px solid light-dark(var(--accent-light), var(--accent-dark));
        border-right: 4px solid transparent;
        box-sizing: border-box;
        animation: spin 1s linear infinite;
      }

      /* Tarjeta de Pregunta Individual */
      .question-card {
        background-color: light-dark(rgba(255, 255, 255, 0.7), rgba(44, 49, 58, 0.7));
        backdrop-filter: blur(10px); /* Efecto Glassmorphism */
        -webkit-backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: var(--border-radius-md);
        border: 1px solid light-dark(rgba(224, 228, 232, 0.5), rgba(60, 64, 67, 0.5));
        box-shadow: 0 4px 15px -5px rgba(0,0,0,0.08);
        text-align: left;
        position: relative; /* Para el botón de copiar */
        opacity: 0; /* Inicialmente invisible */
        transform: translateY(20px) scale(0.98); /* Posición inicial para animación */
        animation: fadeInSlideUp 0.5s var(--transition-ease) forwards;
      }
      /* Animación escalonada */
      .question-card:nth-child(1) { animation-delay: 0.1s; }
      .question-card:nth-child(2) { animation-delay: 0.2s; }
      .question-card:nth-child(3) { animation-delay: 0.3s; }
      .question-card:nth-child(4) { animation-delay: 0.4s; }
      .question-card:nth-child(5) { animation-delay: 0.5s; }
      /* Añade más si esperas muchas preguntas */

      .question-text {
        font-size: 1.1em;
        line-height: 1.6;
        margin-bottom: 15px; /* Espacio antes del botón */
        color: light-dark(var(--text-primary-light), var(--text-primary-dark));
        padding-right: 30px; /* Espacio para el botón de copiar */
      }

      /* Botón de Copiar */
      .copy-button {
        position: absolute;
        top: 15px;
        right: 15px;
        background: light-dark(rgba(99, 102, 241, 0.1), rgba(129, 140, 248, 0.2));
        color: light-dark(var(--accent-light), var(--accent-dark));
        border: none;
        border-radius: 50%; /* Circular */
        width: 32px;
        height: 32px;
        cursor: pointer;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        transition: all 0.2s ease-in-out;
      }
      .copy-button i { /* El icono */
        font-size: 14px;
        transition: transform 0.2s ease-in-out;
      }
      .copy-button:hover {
        background: light-dark(rgba(99, 102, 241, 0.2), rgba(129, 140, 248, 0.3));
        transform: scale(1.1);
      }
      .copy-button.copied {
          background-color: light-dark(rgba(34, 197, 94, 0.15), rgba(74, 222, 128, 0.2));
          color: light-dark(var(--success-light), var(--success-dark));
      }
       .copy-button.copied i::before {
           content: "\f00c"; /* Icono de check (Font Awesome) */
       }


      /* Animaciones */
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @keyframes fadeInSlideUp {
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* Footer */
      footer {
        margin-top: 60px;
        padding-top: 25px;
        border-top: 1px solid light-dark(var(--border-light), var(--border-dark));
        color: light-dark(var(--text-secondary-light), var(--text-secondary-dark));
        font-size: 0.9em;
        opacity: 0.7;
      }
      footer a {
        color: light-dark(var(--accent-light), var(--accent-dark));
        text-decoration: none;
        transition: color var(--transition-speed) var(--transition-ease);
      }
      footer a:hover {
        text-decoration: underline;
        color: light-dark(var(--accent-hover-light), var(--accent-hover-dark));
      }

       /* Responsive adjustments */
       @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }
            h1 {
                font-size: 2em;
            }
            .description {
                font-size: 1em;
            }
            textarea {
                min-height: 150px;
            }
            .generate-button {
                padding: 12px 25px;
                font-size: 1em;
            }
            .questions-container {
                 grid-template-columns: 1fr; /* Una columna en móviles */
                 gap: 15px;
            }
            .question-card {
                padding: 20px;
            }
       }

    </style>
</head>
<body>

  <div class="container">
    <h1><i class="fas fa-brain" style="margin-right: 10px;"></i>Generador de Preguntas</h1>
    <p class="description">
      Pega cualquier texto aquí abajo y la IA generará preguntas de comprensión para ayudarte a estudiar o analizarlo. ¡Mágico! ✨
    </p>

    <div class="input-area">
      <textarea
        id="textInput"
        placeholder="Pega tu texto aquí... Cuanto más largo y detallado, mejores serán las preguntas."
      ></textarea>
    </div>

    <button id="generateButton" class="generate-button">
      <span class="button-text">Generar Preguntas</span>
      <div class="spinner"></div> <!-- Spinner para estado de carga -->
    </button>

    <div id="errorMessage" class="error-message">
        <i class="fas fa-exclamation-triangle"></i> <!-- Icono de error -->
        <span id="errorText"></span>
    </div>

    <div id="questionsOutput" class="questions-container">
      <!-- Indicador de carga centralizado -->
      <div id="loaderContainer" class="loader-container">
          <div class="loader"></div>
      </div>
      <!-- Las preguntas generadas aparecerán aquí como tarjetas -->
    </div>

     <footer>
       Potenciado por IA de <a href="https://pollinations.ai/" target="_blank" rel="noopener noreferrer">Pollinations.ai</a>. Diseño mejorado.
    </footer>
  </div>

  <script type="module">
    const textInput = document.getElementById('textInput');
    const generateButton = document.getElementById('generateButton');
    const buttonText = generateButton.querySelector('.button-text');
    const questionsOutput = document.getElementById('questionsOutput');
    const errorMessageContainer = document.getElementById('errorMessage');
    const errorTextElement = document.getElementById('errorText');
    const loaderContainer = document.getElementById('loaderContainer'); // Loader central

    const POLLINATIONS_TEXT_URL_BASE = "https://text.pollinations.ai/";

    function showLoader() {
        generateButton.disabled = true;
        generateButton.classList.add('loading'); // Activa el spinner en el botón
        loaderContainer.classList.add('visible'); // Muestra el loader central
        questionsOutput.innerHTML = ''; // Limpiar preguntas anteriores (excepto el loader)
        // Re-append loader in case innerHTML cleared it (shouldn't if it's outside the loop)
        if (!questionsOutput.contains(loaderContainer)) {
             questionsOutput.appendChild(loaderContainer);
        }
        hideError(); // Ocultar errores previos
    }

    function hideLoader() {
        generateButton.disabled = false;
        generateButton.classList.remove('loading'); // Desactiva spinner en botón
        loaderContainer.classList.remove('visible'); // Oculta loader central
    }

    function showError(message) {
        errorTextElement.textContent = message;
        errorMessageContainer.classList.add('visible');
    }

     function hideError() {
        errorMessageContainer.classList.remove('visible');
        errorTextElement.textContent = ''; // Limpiar texto por si acaso
    }

    function displayQuestions(questions) {
        questionsOutput.innerHTML = ''; // Limpiar (ahora sí, incluye el loader si aún estaba)
        if (questions.length === 0) {
             showError("La IA respondió, pero no se pudieron generar preguntas válidas con el texto proporcionado.");
             return;
        }

        questions.forEach(question => {
            const card = document.createElement('div');
            card.classList.add('question-card');

            const textElement = document.createElement('p');
            textElement.classList.add('question-text');
            textElement.textContent = question; // Asumimos que cada item es una pregunta string

            const copyBtn = document.createElement('button');
            copyBtn.classList.add('copy-button');
            copyBtn.title = "Copiar pregunta";
            copyBtn.innerHTML = '<i class="far fa-copy"></i>'; // Icono de copiar (Font Awesome)

            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(question)
                    .then(() => {
                        copyBtn.classList.add('copied');
                        copyBtn.innerHTML = '<i class="fas fa-check"></i>'; // Icono de check
                        copyBtn.title = "¡Copiado!";
                        setTimeout(() => {
                            copyBtn.classList.remove('copied');
                            copyBtn.innerHTML = '<i class="far fa-copy"></i>'; // Volver al icono original
                            copyBtn.title = "Copiar pregunta";
                        }, 1500); // Resetear después de 1.5 segundos
                    })
                    .catch(err => {
                        console.error('Error al copiar texto: ', err);
                        showError("No se pudo copiar la pregunta al portapapeles.");
                    });
            });

            card.appendChild(textElement);
            card.appendChild(copyBtn);
            questionsOutput.appendChild(card);
        });
    }


    if (generateButton && textInput && questionsOutput && errorMessageContainer && loaderContainer) {
        generateButton.addEventListener('click', async () => {
            const inputText = textInput.value.trim();
            if (!inputText) {
                showError('Por favor, pega algo de texto en el área designada.');
                questionsOutput.innerHTML = ''; // Limpiar si había algo
                return;
            }

            showLoader(); // Mostrar indicadores de carga

            try {
                // Prompt específico para preguntas de comprensión
                const prompt = `Basándote en el siguiente texto, genera una lista de 5 a 7 preguntas de comprensión significativas. Las preguntas deben ayudar a verificar que alguien ha entendido los puntos clave, las ideas principales o los detalles importantes del texto. Formatea cada pregunta en una nueva línea, sin numeración ni viñetas.

Texto:
---
${inputText}
---

Preguntas:`; // La IA debería continuar desde aquí

                const encodedPrompt = encodeURIComponent(prompt);
                const requestUrl = POLLINATIONS_TEXT_URL_BASE + encodedPrompt;

                console.log("Requesting URL:", requestUrl); // Debug

                const response = await fetch(requestUrl);

                if (!response.ok) {
                    let errorDetails = `Error HTTP ${response.status}`;
                    try {
                       const errorText = await response.text();
                       // Limitar longitud del detalle de error para no saturar
                       errorDetails += `: ${errorText.substring(0, 100)}${errorText.length > 100 ? '...' : ''}`;
                    } catch (e) { /* Ignorar */ }
                    throw new Error(errorDetails);
                }

                const responseText = await response.text();
                console.log("Raw response text:", responseText); // Debug

                if (responseText) {
                    // Procesamiento simple: dividir por líneas y filtrar vacías/cortas
                    const generatedQuestions = responseText
                        .split('\n')
                        .map(line => line.trim().replace(/^[-*]?\s*/, '')) // Limpiar y quitar viñetas iniciales
                        .filter(line => line.length > 10 && line.includes('?')); // Filtrar líneas vacías/muy cortas o sin ?

                    displayQuestions(generatedQuestions);

                } else {
                    showError('La API devolvió una respuesta vacía. Inténtalo de nuevo o con otro texto.');
                    questionsOutput.innerHTML = ''; // Limpiar por si acaso
                }

            } catch (error) {
                console.error('Error al generar preguntas:', error);
                showError(`Ocurrió un error: ${error.message}`);
                questionsOutput.innerHTML = ''; // Limpiar en caso de error
            } finally {
                hideLoader(); // Ocultar indicadores de carga, independientemente del resultado
            }
        });
    } else {
         console.error("Error crítico: No se encontraron uno o más elementos esenciales del DOM.");
         // Podrías mostrar un error más visible aquí si es necesario
         if (errorMessageContainer) {
             showError("Error de inicialización. Faltan elementos en la página.");
         }
    }

  </script>

</body>
</html>