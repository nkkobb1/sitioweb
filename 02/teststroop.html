<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Stroop Clásico Interactivo</title>
    <!-- Bibliotecas CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --accent-color: #ff7b54;
            --text-color: #333;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: var(--light-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Fondo animado */
        .area {
            width: 100%;
            height: 100vh;
            position: absolute;
            z-index: -1;
        }

        .circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            animation: animate 25s linear infinite;
            bottom: -150px;
            border-radius: 50%;
        }

        .circles li:nth-child(1) {
            left: 25%;
            width: 80px;
            height: 80px;
            animation-delay: 0s;
        }

        .circles li:nth-child(2) {
            left: 10%;
            width: 20px;
            height: 20px;
            animation-delay: 2s;
            animation-duration: 12s;
        }

        .circles li:nth-child(3) {
            left: 70%;
            width: 20px;
            height: 20px;
            animation-delay: 4s;
        }

        .circles li:nth-child(4) {
            left: 40%;
            width: 60px;
            height: 60px;
            animation-delay: 0s;
            animation-duration: 18s;
        }

        .circles li:nth-child(5) {
            left: 65%;
            width: 20px;
            height: 20px;
            animation-delay: 0s;
        }

        .circles li:nth-child(6) {
            left: 75%;
            width: 110px;
            height: 110px;
            animation-delay: 3s;
        }

        .circles li:nth-child(7) {
            left: 35%;
            width: 150px;
            height: 150px;
            animation-delay: 7s;
        }

        .circles li:nth-child(8) {
            left: 50%;
            width: 25px;
            height: 25px;
            animation-delay: 15s;
            animation-duration: 45s;
        }

        .circles li:nth-child(9) {
            left: 20%;
            width: 15px;
            height: 15px;
            animation-delay: 2s;
            animation-duration: 35s;
        }

        .circles li:nth-child(10) {
            left: 85%;
            width: 150px;
            height: 150px;
            animation-delay: 0s;
            animation-duration: 11s;
        }

        @keyframes animate {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 0;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

        .container {
            position: relative;
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: all var(--transition-speed);
            overflow: hidden;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px 0 rgba(31, 38, 135, 0.5);
        }

        .card-header {
            background-color: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            padding: 15px;
        }

        .card-body {
            padding: 20px;
        }

        .btn-custom {
            background: linear-gradient(to right, var(--accent-color), #ffb347);
            border: none;
            color: white;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all var(--transition-speed);
            box-shadow: 0 4px 15px rgba(255, 123, 84, 0.4);
        }

        .btn-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 123, 84, 0.6);
        }

        .btn-custom:active {
            transform: translateY(1px);
        }

        .btn-outline-custom {
            background: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            border-radius: 30px;
            padding: 8px 25px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all var(--transition-speed);
        }

        .btn-outline-custom:hover {
            background-color: var(--accent-color);
            color: white;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            margin-bottom: 20px;
        }

        .title-stroop {
            font-size: 3.5rem;
            background: linear-gradient(to right, #ffffff, #ffe259);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            text-align: center;
        }

        #game-area {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #word-display {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 50px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
        }

        .color-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            font-size: 0;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .color-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 150px;
            margin: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .progress {
            height: 10px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .progress-bar {
            background-color: var(--accent-color);
            border-radius: 5px;
            transition: width 0.5s;
        }

        .tab-content {
            padding: 20px 0;
        }

        .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tabs .nav-link {
            color: var(--light-color);
            border: none;
            border-bottom: 2px solid transparent;
            border-radius: 0;
            padding: 10px 20px;
            font-weight: 600;
            transition: all var(--transition-speed);
        }

        .nav-tabs .nav-link:hover {
            border-color: rgba(255, 255, 255, 0.5);
        }

        .nav-tabs .nav-link.active {
            color: white;
            background-color: transparent;
            border-color: var(--accent-color);
        }

        .modal-content {
            background-color: rgba(41, 41, 97, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            color: var(--light-color);
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-control, .form-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 10px;
            padding: 12px 15px;
        }

        .form-control:focus, .form-select:focus {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-color);
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(255, 123, 84, 0.25);
        }

        .achievement {
            text-align: center;
            padding: 15px;
            transition: all var(--transition-speed);
        }

        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #ffe259, #ffa751);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .achievement-locked .achievement-icon {
            background: linear-gradient(to right, #bdc3c7, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0.5;
        }

        .achievement-locked {
            opacity: 0.7;
        }

        .achievement-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 5s ease-out forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        #results-chart {
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .title-stroop {
                font-size: 2.5rem;
            }
            
            #word-display {
                font-size: 3rem;
            }
            
            .color-buttons {
                gap: 10px;
            }
            
            .color-btn {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo animado -->
    <div class="area">
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>

    <div class="container">
        <h1 class="title-stroop animate__animated animate__fadeIn">Test de Stroop Clásico</h1>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <p class="text-center">
                            El Test de Stroop evalúa tu capacidad para procesar información conflictiva. En este test clásico, 
                            deberás nombrar el color en que está escrita una palabra, ignorando su significado.
                            Por ejemplo, si ves la palabra "ROJO" escrita en color azul, deberás seleccionar AZUL.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="test-tab" data-bs-toggle="tab" data-bs-target="#test" type="button" role="tab" aria-controls="test" aria-selected="true">
                            <i class="fas fa-brain"></i> Test
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="false">
                            <i class="fas fa-chart-line"></i> Estadísticas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">
                            <i class="fas fa-cog"></i> Configuración
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="achievements-tab" data-bs-toggle="tab" data-bs-target="#achievements" type="button" role="tab" aria-controls="achievements" aria-selected="false">
                            <i class="fas fa-trophy"></i> Logros
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="minigames-tab" data-bs-toggle="tab" data-bs-target="#minigames" type="button" role="tab" aria-controls="minigames" aria-selected="false">
                            <i class="fas fa-gamepad"></i> Minijuegos
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="test" role="tabpanel" aria-labelledby="test-tab">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="text-center mb-4">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <span id="time-remaining" class="badge bg-primary px-3 py-2">
                                                    <i class="fas fa-clock me-1"></i> Tiempo: 60s
                                                </span>
                                                <span id="current-level" class="badge bg-success px-3 py-2">
                                                    <i class="fas fa-layer-group me-1"></i> Nivel: 1
                                                </span>
                                                <span id="current-score" class="badge bg-info px-3 py-2">
                                                    <i class="fas fa-star me-1"></i> Puntos: 0
                                                </span>
                                            </div>
                                            
                                            <div class="progress mb-3">
                                                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        
                                        <div id="game-area" class="text-center">
                                            <div id="word-display" class="animate__animated animate__pulse">ROJO</div>
                                            
                                            <div class="color-buttons mb-4">
                                                <button class="color-btn" style="background-color: red;" data-color="rojo">Rojo</button>
                                                <button class="color-btn" style="background-color: green;" data-color="verde">Verde</button>
                                                <button class="color-btn" style="background-color: blue;" data-color="azul">Azul</button>
                                                <button class="color-btn" style="background-color: yellow;" data-color="amarillo">Amarillo</button>
                                                <button class="color-btn" style="background-color: black;" data-color="negro">Negro</button>
                                                <button class="color-btn" style="background-color: purple;" data-color="morado">Morado</button>
                                            </div>
                                            
                                            <button id="start-button" class="btn btn-custom px-4 py-2">
                                                <i class="fas fa-play me-2"></i> Iniciar Test
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="stats-container">
                                            <div class="stat-box">
                                                <div class="stat-value" id="stat-tests">0</div>
                                                <div class="stat-label">Tests Completados</div>
                                            </div>
                                            <div class="stat-box">
                                                <div class="stat-value" id="stat-correct">0</div>
                                                <div class="stat-label">Respuestas Correctas</div>
                                            </div>
                                            <div class="stat-box">
                                                <div class="stat-value" id="stat-accuracy">0%</div>
                                                <div class="stat-label">Precisión</div>
                                            </div>
                                            <div class="stat-box">
                                                <div class="stat-value" id="stat-best-time">0.00s</div>
                                                <div class="stat-label">Mejor Tiempo</div>
                                            </div>
                                        </div>
                                        
                                        <h4 class="mt-4">Resultados Recientes</h4>
                                        <div id="results-chart"></div>
                                        
                                        <h4 class="mt-4">Historial Detallado</h4>
                                        <div class="table-responsive">
                                            <table class="table table-dark table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Nivel</th>
                                                        <th>Correctas</th>
                                                        <th>Incorrectas</th>
                                                        <th>Precisión</th>
                                                        <th>Tiempo Promedio</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="history-table-body">
                                                    <!-- Se llenará dinámicamente -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-sliders me-2"></i> Personalización del Test</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="settings-form">
                                            <div class="mb-3">
                                                <label for="difficulty" class="form-label">Dificultad</label>
                                                <select class="form-select" id="difficulty">
                                                    <option value="easy">Fácil</option>
                                                    <option value="medium" selected>Media</option>
                                                    <option value="hard">Difícil</option>
                                                    <option value="expert">Experto</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="test-duration" class="form-label">Duración del Test (segundos)</label>
                                                <input type="range" class="form-range" min="30" max="120" step="10" id="test-duration" value="60">
                                                <div class="text-center" id="duration-value">60 segundos</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="word-size" class="form-label">Tamaño de Palabra</label>
                                                <input type="range" class="form-range" min="2" max="6" step="0.5" id="word-size" value="4">
                                                <div class="text-center" id="word-size-value">4 rem</div>
                                            </div>
                                            <div class="mb-3 form-check">
                                                <input type="checkbox" class="form-check-input" id="sound-enabled" checked>
                                                <label class="form-check-label" for="sound-enabled">Habilitar Sonidos</label>
                                            </div>
                                            <div class="mb-3 form-check">
                                                <input type="checkbox" class="form-check-input" id="animation-enabled" checked>
                                                <label class="form-check-label" for="animation-enabled">Habilitar Animaciones</label>
                                            </div>
                                            <button type="submit" class="btn btn-custom w-100">Guardar Configuración</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-palette me-2"></i> Tema y Apariencia</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="theme-selection" class="form-label">Tema</label>
                                            <select class="form-select" id="theme-selection">
                                                <option value="default" selected>Púrpura Espacial (Default)</option>
                                                <option value="dark">Oscuro Profundo</option>
                                                <option value="ocean">Océano Azul</option>
                                                <option value="sunset">Atardecer</option>
                                                <option value="forest">Bosque Verde</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Previsualización</label>
                                            <div class="theme-preview p-3" id="theme-preview" style="border-radius: 10px; height: 100px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color));">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="background-animation" class="form-label">Animación de Fondo</label>
                                            <select class="form-select" id="background-animation">
                                                <option value="bubbles" selected>Burbujas</option>
                                                <option value="particles">Partículas</option>
                                                <option value="waves">Ondas</option>
                                                <option value="none">Ninguna</option>
                                            </select>
                                        </div>
                                        <button type="button" class="btn btn-custom w-100" id="apply-theme">
                                            Aplicar Tema
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="achievements" role="tabpanel" aria-labelledby="achievements-tab">
                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-trophy me-2"></i> Tus Logros</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement" id="achievement-1">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-award"></i>
                                                        </div>
                                                        <h5>Principiante</h5>
                                                        <p class="small">Completa tu primer test</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement achievement-locked" id="achievement-2">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-bolt"></i>
                                                        </div>
                                                        <h5>Velocista</h5>
                                                        <p class="small">Responde 10 palabras en menos de 20 segundos</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement achievement-locked" id="achievement-3">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-bullseye"></i>
                                                        </div>
                                                        <h5>Precisión Perfecta</h5>
                                                        <p class="small">Completa un test con 100% de precisión</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement achievement-locked" id="achievement-4">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-fire"></i>
                                                        </div>
                                                        <h5>En Racha</h5>
                                                        <p class="small">Responde correctamente 20 veces seguidas</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement achievement-locked" id="achievement-5">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-brain"></i>
                                                        </div>
                                                        <h5>Maestro Cognitivo</h5>
                                                        <p class="small">Alcanza el nivel 5 de dificultad</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6 mb-4">
                                                <div class="card achievement achievement-locked" id="achievement-6">
                                                    <div class="card-body">
                                                        <div class="achievement-icon">
                                                            <i class="fas fa-calendar-check"></i>
                                                        </div>
                                                        <h5>Constancia</h5>
                                                        <p class="small">Completa tests durante 5 días consecutivos</p>
                                                        <div class="progress mt-2">
                                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-medal me-2"></i> Niveles de Dominio</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row justify-content-center">
                                            <div class="col-md-8">
                                                <div class="progress-track">
                                                    <div class="progress mb-5" style="height: 10px;">
                                                        <div class="progress-bar" role="progressbar" style="width: 10%;" id="mastery-progress"></div>
                                                    </div>
                                                    <div class="d-flex justify-content-between">
                                                        <div class="milestone active">
                                                            <div class="milestone-icon"><i class="fas fa-seedling"></i></div>
                                                            <div class="milestone-label">Novato</div>
                                                        </div>
                                                        <div class="milestone">
                                                            <div class="milestone-icon"><i class="fas fa-user"></i></div>
                                                            <div class="milestone-label">Aprendiz</div>
                                                        </div>
                                                        <div class="milestone">
                                                            <div class="milestone-icon"><i class="fas fa-user-graduate"></i></div>
                                                            <div class="milestone-label">Estudiante</div>
                                                        </div>
                                                        <div class="milestone">
                                                            <div class="milestone-icon"><i class="fas fa-user-tie"></i></div>
                                                            <div class="milestone-label">Profesional</div>
                                                        </div>
                                                        <div class="milestone">
                                                            <div class="milestone-icon"><i class="fas fa-crown"></i></div>
                                                            <div class="milestone-label">Maestro</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center mt-4">
                                                    <h4 id="current-mastery-level">Nivel actual: Novato</h4>
                                                    <p id="mastery-description">Has dado tus primeros pasos en el Test de Stroop. Sigue practicando para mejorar tu capacidad de control cognitivo.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="minigames" role="tabpanel" aria-labelledby="minigames-tab">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-puzzle-piece me-2"></i> Rompecabezas de Colores</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Arrastra y suelta las piezas para formar un patrón de colores basado en las palabras de Stroop.</p>
                                        <div class="text-center mb-3">
                                            <img src="https://via.placeholder.com/300x200?text=Rompecabezas+de+Colores" alt="Rompecabezas de Colores" class="img-fluid rounded">
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-custom" id="start-puzzle">
                                                <i class="fas fa-play me-2"></i> Jugar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-sort-amount-up me-2"></i> Clasificación Rápida</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Clasifica las palabras según el color de la tinta o el significado en el menor tiempo posible.</p>
                                        <div class="text-center mb-3">
                                            <img src="https://via.placeholder.com/300x200?text=Clasificación+Rápida" alt="Clasificación Rápida" class="img-fluid rounded">
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-custom" id="start-sorting">
                                                <i class="fas fa-play me-2"></i> Jugar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-memory me-2"></i> Memoria de Colores</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Memoriza secuencias de palabras coloreadas y repite el patrón correctamente.</p>
                                        <div class="text-center mb-3">
                                            <img src="https://via.placeholder.com/300x200?text=Memoria+de+Colores" alt="Memoria de Colores" class="img-fluid rounded">
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-custom" id="start-memory">
                                                <i class="fas fa-play me-2"></i> Jugar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-stopwatch me-2"></i> Contrarreloj</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Responde correctamente a tantas palabras como puedas en 60 segundos. ¡El tiempo se reduce con cada respuesta correcta!</p>
                                        <div class="text-center mb-3">
                                            <img src="https://via.placeholder.com/300x200?text=Contrarreloj" alt="Contrarreloj" class="img-fluid rounded">
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-custom" id="start-countdown">
                                                <i class="fas fa-play me-2"></i> Jugar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultsModalLabel">Resultados del Test</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div id="results-icon" class="display-1 mb-3">
                            <i class="fas fa-star text-warning"></i>
                        </div>
                        <h4 id="results-message">¡Buen trabajo!</h4>
                    </div>
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="result-stat">
                                <h5>Correctas</h5>
                                <div class="display-6" id="result-correct">0</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="result-stat">
                                <h5>Precisión</h5>
                                <div class="display-6" id="result-accuracy">0%</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="result-stat">
                                <h5>Tiempo Promedio</h5>
                                <div class="display-6" id="result-avg-time">0.0s</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="result-stat">
                                <h5>Puntuación</h5>
                                <div class="display-6" id="result-score">0</div>
                            </div>
                        </div>
                    </div>
                    <div id="achievement-unlocked" class="alert alert-success text-center mt-3" style="display: none;">
                        <i class="fas fa-unlock-alt me-2"></i> ¡Has desbloqueado un nuevo logro!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-custom" id="play-again-btn">Jugar de Nuevo</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="levelUpModal" tabindex="-1" aria-labelledby="levelUpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="levelUpModalLabel">¡Subiste de Nivel!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="display-1 mb-4 text-warning">
                        <i class="fas fa-level-up-alt"></i>
                    </div>
                    <h4>¡Felicidades! Has avanzado al Nivel <span id="new-level">2</span></h4>
                    <p id="level-description">La dificultad ha aumentado. Ahora enfrentarás palabras con menor tiempo de respuesta.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom" data-bs-dismiss="modal">¡Vamos!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sonidos -->
    <audio id="sound-correct" preload="auto">
        <source src="https://cdn.freesound.org/previews/320/320654_5260872-lq.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-incorrect" preload="auto">
        <source src="https://cdn.freesound.org/previews/142/142608_1840739-lq.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-level-up" preload="auto">
        <source src="https://cdn.freesound.org/previews/402/402567_5121236-lq.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-achievement" preload="auto">
        <source src="https://cdn.freesound.org/previews/270/270404_5123851-lq.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-game-over" preload="auto">
        <source src="https://cdn.freesound.org/previews/362/362204_6142149-lq.mp3" type="audio/mpeg">
    </audio>

    <!-- Bibliotecas JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script>
        // Configuración y variables globales
        const colors = {
            rojo: 'red',
            verde: 'green',
            azul: 'blue',
            amarillo: 'yellow',
            negro: 'black',
            morado: 'purple'
        };
        
        const colorWords = ['ROJO', 'VERDE', 'AZUL', 'AMARILLO', 'NEGRO', 'MORADO'];
        
        let gameConfig = {
            duration: 60,
            difficulty: 'medium',
            wordSize: 4,
            soundEnabled: true,
            animationEnabled: true
        };
        
        let gameState = {
            isRunning: false,
            score: 0,
            level: 1,
            currentWord: '',
            currentColor: '',
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAnswers: 0,
            startTime: null,
            endTime: null,
            timeRemaining: 60,
            responseTimes: [],
            streak: 0,
            maxStreak: 0,
            timer: null
        };
        
        let userStats = {
            testsCompleted: 0,
            totalCorrect: 0,
            totalIncorrect: 0,
            bestAccuracy: 0,
            bestTime: 9999,
            sessionStarted: new Date(),
            history: [],
            consecutiveDays: 1
        };
        
        let achievementsUnlocked = {
            beginner: false,
            sprinter: false,
            perfectAccuracy: false,
            onStreak: false,
            cognitiveMaster: false,
            consistency: false
        };
        
        // Elementos DOM
        const wordDisplay = document.getElementById('word-display');
        const startButton = document.getElementById('start-button');
        const colorButtons = document.querySelectorAll('.color-btn');
        const timeRemaining = document.getElementById('time-remaining');
        const currentLevel = document.getElementById('current-level');
        const currentScore = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        
        // Sonidos
        const soundCorrect = document.getElementById('sound-correct');
        const soundIncorrect = document.getElementById('sound-incorrect');
        const soundLevelUp = document.getElementById('sound-level-up');
        const soundAchievement = document.getElementById('sound-achievement');
        const soundGameOver = document.getElementById('sound-game-over');
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado completamente');
            
            // Cargar configuración y estadísticas guardadas
            loadUserData();
            
            // Inicializar eventos
            initializeEvents();
            
            // Preparar juego
            setupGame();
        });
        
        // Inicializa todos los eventos
        function initializeEvents() {
            console.log('Inicializando eventos');
            
            // Evento del botón de inicio
            startButton.addEventListener('click', function() {
                console.log('Botón iniciar presionado');
                startGame();
            });
            
            // Eventos de los botones de colores
            colorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (!gameState.isRunning) return;
                    
                    const selectedColor = this.dataset.color;
                    checkAnswer(selectedColor);
                });
            });
            
            // Eventos de configuración
            document.getElementById('test-duration').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('duration-value').textContent = value + ' segundos';
                gameConfig.duration = parseInt(value);
            });
            
            document.getElementById('word-size').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('word-size-value').textContent = value + ' rem';
                gameConfig.wordSize = parseFloat(value);
                wordDisplay.style.fontSize = value + 'rem';
            });
            
            document.getElementById('difficulty').addEventListener('change', function() {
                gameConfig.difficulty = this.value;
            });
            
            document.getElementById('sound-enabled').addEventListener('change', function() {
                gameConfig.soundEnabled = this.checked;
            });
            
            document.getElementById('animation-enabled').addEventListener('change', function() {
                gameConfig.animationEnabled = this.checked;
            });
            
            // Evento para guardar configuración
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserData();
                
                // Mostrar notificación de guardado
                const alert = document.createElement('div');
                alert.className = 'alert alert-success mt-3';
                alert.textContent = 'Configuración guardada correctamente';
                this.appendChild(alert);
                
                setTimeout(() => {
                    alert.remove();
                }, 3000);
            });
            
            // Eventos para cambio de tema
            document.getElementById('theme-selection').addEventListener('change', updateThemePreview);
            document.getElementById('apply-theme').addEventListener('click', applyTheme);
            
            // Eventos para los minijuegos
            document.getElementById('start-puzzle').addEventListener('click', startPuzzleGame);
            document.getElementById('start-sorting').addEventListener('click', startSortingGame);
            document.getElementById('start-memory').addEventListener('click', startMemoryGame);
            document.getElementById('start-countdown').addEventListener('click', startCountdownGame);
            
            // Evento para jugar de nuevo
            document.getElementById('play-again-btn').addEventListener('click', function() {
                const resultsModal = bootstrap.Modal.getInstance(document.getElementById('resultsModal'));
                resultsModal.hide();
                startGame();
            });
            
            console.log('Eventos inicializados correctamente');
        }
        
        // Configuración inicial del juego
        function setupGame() {
            console.log('Configurando juego');
            
            // Actualizar estadísticas
            updateStats();
            
            // Crear gráfico vacío
            createResultsChart();
            
            // Actualizar tabla de historial
            updateHistoryTable();
            
            // Inicializar logros
            updateAchievements();
            
            // Ocultar botones de colores
            colorButtons.forEach(button => {
                button.style.display = 'none';
            });
            
            // Mostrar palabra de ejemplo
            wordDisplay.textContent = 'ROJO';
            wordDisplay.style.color = 'blue';
            
            console.log('Juego configurado correctamente');
        }
        
        // Resto del código JavaScript
        // Inicio del juego
        function startGame() {
            // Reiniciar estado
            gameState = {
                isRunning: true,
                score: 0,
                level: 1,
                currentWord: '',
                currentColor: '',
                correctAnswers: 0,
                incorrectAnswers: 0,
                totalAnswers: 0,
                startTime: new Date(),
                endTime: null,
                timeRemaining: gameConfig.duration,
                responseTimes: [],
                streak: 0,
                maxStreak: 0,
                timer: null
            };
            
            // Actualizar UI
            updateGameUI();
            
            // Mostrar botones de colores
            colorButtons.forEach(button => {
                button.style.display = 'inline-block';
            });
            
            // Ocultar botón de inicio
            startButton.style.display = 'none';
            
            // Mostrar primera palabra
            showNextWord();
            
            // Iniciar temporizador
            gameState.timer = setInterval(updateTimer, 1000);
        }
        
        // Mostrar siguiente palabra
        function showNextWord() {
            // Seleccionar palabra y color aleatorios
            const wordIndex = Math.floor(Math.random() * colorWords.length);
            const colorIndex = Math.floor(Math.random() * colorWords.length);
            
            // Determinar congruencia basada en nivel de dificultad
            let shouldBeCongruent = false;
            
            if (gameConfig.difficulty === 'easy') {
                // 60% congruente, 40% incongruente
                shouldBeCongruent = Math.random() < 0.6;
            } else if (gameConfig.difficulty === 'medium') {
                // 40% congruente, 60% incongruente
                shouldBeCongruent = Math.random() < 0.4;
            } else if (gameConfig.difficulty === 'hard') {
                // 20% congruente, 80% incongruente
                shouldBeCongruent = Math.random() < 0.2;
            } else if (gameConfig.difficulty === 'expert') {
                // 10% congruente, 90% incongruente
                shouldBeCongruent = Math.random() < 0.1;
            }
            
            let finalColorIndex;
            if (shouldBeCongruent) {
                finalColorIndex = wordIndex;
            } else {
                // Asegurarse de que no sean congruentes
                do {
                    finalColorIndex = Math.floor(Math.random() * colorWords.length);
                } while (finalColorIndex === wordIndex);
            }
            
            const word = colorWords[wordIndex];
            const colorName = Object.keys(colors)[finalColorIndex];
            const colorValue = colors[colorName];
            
            // Guardar palabra y color actuales
            gameState.currentWord = word;
            gameState.currentColor = colorName;
            
            // Aplicar efectos según nivel
            applyLevelEffects(word, colorValue);
        }
        
        // Aplicar efectos basados en nivel
        function applyLevelEffects(word, colorValue) {
            // Limpiar clases de animación
            wordDisplay.className = '';
            if (gameConfig.animationEnabled) {
                wordDisplay.classList.add('animate__animated');
            }
            
            // Asignar palabra y color
            wordDisplay.textContent = word;
            wordDisplay.style.color = colorValue;
            
            // Efectos adicionales según nivel
            switch (gameState.level) {
                case 1:
                    // Nivel 1 - Normal
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__pulse');
                    }
                    break;
                case 2:
                    // Nivel 2 - Movimiento
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__swing');
                    }
                    break;
                case 3:
                    // Nivel 3 - Desvanecer
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__fadeIn');
                        setTimeout(() => {
                            if (gameState.isRunning) {
                                wordDisplay.style.opacity = '0.8';
                            }
                        }, 1000);
                    }
                    break;
                case 4:
                    // Nivel 4 - Rotación
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__tada');
                        wordDisplay.style.transform = 'rotate(' + (Math.random() * 20 - 10) + 'deg)';
                    }
                    break;
                case 5:
                    // Nivel 5 - Cambio continuo
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__heartBeat');
                        // Programar cambio de color cada 1.5 segundos
                        setTimeout(() => {
                            if (gameState.isRunning) {
                                const randomColor = Object.values(colors)[Math.floor(Math.random() * Object.values(colors).length)];
                                wordDisplay.style.textShadow = '0 0 10px ' + randomColor;
                            }
                        }, 1500);
                    }
                    break;
                default:
                    if (gameConfig.animationEnabled) {
                        wordDisplay.classList.add('animate__pulse');
                    }
            }
        }
        
        // Verificar respuesta
        function checkAnswer(selectedColor) {
            // Registrar tiempo de respuesta
            const responseTime = new Date() - gameState.startTime;
            gameState.responseTimes.push(responseTime / 1000); // en segundos
            
            // Verificar respuesta
            const isCorrect = selectedColor === gameState.currentColor;
            
            // Actualizar estadísticas
            gameState.totalAnswers++;
            
            if (isCorrect) {
                gameState.correctAnswers++;
                gameState.streak++;
                gameState.maxStreak = Math.max(gameState.maxStreak, gameState.streak);
                gameState.score += calculateScore(responseTime);
                
                // Reproducir sonido
                if (gameConfig.soundEnabled) {
                    soundCorrect.currentTime = 0;
                    soundCorrect.play();
                }
                
                // Efecto visual de acierto
                if (gameConfig.animationEnabled) {
                    wordDisplay.classList.add('animate__animated', 'animate__fadeOutUp');
                    setTimeout(() => {
                        wordDisplay.classList.remove('animate__fadeOutUp');
                    }, 500);
                }
                
                // Crear confeti para respuestas correctas
                if (gameConfig.animationEnabled && gameState.streak > 2) {
                    createConfetti(5);
                }
            } else {
                gameState.incorrectAnswers++;
                gameState.streak = 0;
                
                // Reproducir sonido
                if (gameConfig.soundEnabled) {
                    soundIncorrect.currentTime = 0;
                    soundIncorrect.play();
                }
                
                // Efecto visual de error
                if (gameConfig.animationEnabled) {
                    wordDisplay.classList.add('animate__animated', 'animate__shakeX');
                    setTimeout(() => {
                        wordDisplay.classList.remove('animate__shakeX');
                    }, 500);
                }
            }
            
            // Actualizar UI
            updateGameUI();
            
            // Comprobar si se debe subir de nivel
            checkLevelUp();
            
            // Mostrar siguiente palabra
            showNextWord();
        }
        
        // Calcular puntuación basada en tiempo de respuesta y nivel
        function calculateScore(responseTime) {
            // Base de puntuación
            let baseScore = 10;
            
            // Bonus por respuesta rápida
            let timeBonus = Math.max(0, 5000 - responseTime) / 1000;
            
            // Multiplicador por nivel
            let levelMultiplier = gameState.level;
            
            // Calcular puntuación total
            let score = Math.round((baseScore + timeBonus) * levelMultiplier);
            
            return score;
        }
        
        // Actualizar temporizador
        function updateTimer() {
            if (gameState.timeRemaining <= 0) {
                endGame();
                return;
            }
            
            gameState.timeRemaining--;
            timeRemaining.innerHTML = `<i class="fas fa-clock me-1"></i> Tiempo: ${gameState.timeRemaining}s`;
            
            // Actualizar barra de progreso
            const progress = (gameState.timeRemaining / gameConfig.duration) * 100;
            progressBar.style.width = progress + '%';
            
            // Cambiar color cuando queda poco tiempo
            if (gameState.timeRemaining <= 10) {
                progressBar.classList.remove('bg-success', 'bg-warning');
                progressBar.classList.add('bg-danger');
                
                // Añadir animación parpadeante
                if (gameConfig.animationEnabled && gameState.timeRemaining <= 5) {
                    timeRemaining.classList.add('animate__animated', 'animate__flash', 'animate__infinite');
                }
            } else if (gameState.timeRemaining <= 30) {
                progressBar.classList.remove('bg-success', 'bg-danger');
                progressBar.classList.add('bg-warning');
            } else {
                progressBar.classList.remove('bg-warning', 'bg-danger');
                progressBar.classList.add('bg-success');
            }
        }
        
        // Actualizar UI del juego
        function updateGameUI() {
            // Actualizar puntuación
            currentScore.innerHTML = `<i class="fas fa-star me-1"></i> Puntos: ${gameState.score}`;
            
            // Actualizar nivel
            currentLevel.innerHTML = `<i class="fas fa-layer-group me-1"></i> Nivel: ${gameState.level}`;
        }
        
        // Comprobar si se debe subir de nivel
        function checkLevelUp() {
            // Criterios para subir de nivel (basado en puntuación)
            const levelThresholds = [0, 200, 500, 1000, 2000];
            
            if (gameState.level < 5 && gameState.score >= levelThresholds[gameState.level]) {
                gameState.level++;
                
                // Reproducir sonido
                if (gameConfig.soundEnabled) {
                    soundLevelUp.currentTime = 0;
                    soundLevelUp.play();
                }
                
                // Actualizar UI
                updateGameUI();
                
                // Mostrar modal de nivel
                document.getElementById('new-level').textContent = gameState.level;
                
                // Ajustar descripción según nivel
                const descriptions = [
                    "",
                    "La dificultad ha aumentado. Las palabras comenzarán a moverse ligeramente.",
                    "Las palabras empezarán a desvanecerse. ¡Presta atención!",
                    "Ahora las palabras rotarán. Mantén la concentración.",
                    "¡Nivel máximo! Los colores pueden cambiar después de aparecer."
                ];
                
                document.getElementById('level-description').textContent = descriptions[gameState.level - 1];
                
                // Mostrar modal
                const levelModal = new bootstrap.Modal(document.getElementById('levelUpModal'));
                levelModal.show();
                
                // Crear confeti para celebrar
                if (gameConfig.animationEnabled) {
                    createConfetti(20);
                }
                
                // Comprobar logro de maestro cognitivo
                if (gameState.level === 5 && !achievementsUnlocked.cognitiveMaster) {
                    unlockAchievement('cognitiveMaster');
                }
            }
        }
        
        // Finalizar juego
        function endGame() {
            // Detener temporizador
            clearInterval(gameState.timer);
            
            // Actualizar estado
            gameState.isRunning = false;
            gameState.endTime = new Date();
            
            // Reproducir sonido
            if (gameConfig.soundEnabled) {
                soundGameOver.currentTime = 0;
                soundGameOver.play();
            }
            
            // Restaurar UI
            colorButtons.forEach(button => {
                button.style.display = 'none';
            });
            startButton.style.display = 'inline-block';
            startButton.textContent = 'Jugar de Nuevo';
            
            // Reiniciar animaciones
            timeRemaining.classList.remove('animate__animated', 'animate__flash', 'animate__infinite');
            
            // Procesar resultados
            processResults();
        }
        
        // Procesar resultados del juego
        function processResults() {
            // Calcular estadísticas
            const accuracy = gameState.totalAnswers > 0 
                ? Math.round((gameState.correctAnswers / gameState.totalAnswers) * 100) 
                : 0;
            
            const avgTime = gameState.responseTimes.length > 0 
                ? (gameState.responseTimes.reduce((a, b) => a + b, 0) / gameState.responseTimes.length).toFixed(2) 
                : 0;
            
            // Actualizar estadísticas del usuario
            userStats.testsCompleted++;
            userStats.totalCorrect += gameState.correctAnswers;
            userStats.totalIncorrect += gameState.incorrectAnswers;
            
            if (accuracy > userStats.bestAccuracy) {
                userStats.bestAccuracy = accuracy;
            }
            
            if (gameState.responseTimes.length > 0) {
                const bestResponse = Math.min(...gameState.responseTimes);
                if (bestResponse < userStats.bestTime || userStats.bestTime === 9999) {
                    userStats.bestTime = bestResponse;
                }
            }
            
            // Guardar en historial
            userStats.history.push({
                date: new Date(),
                level: gameState.level,
                correct: gameState.correctAnswers,
                incorrect: gameState.incorrectAnswers,
                accuracy: accuracy,
                avgTime: avgTime,
                score: gameState.score
            });
            
            // Guardar datos
            saveUserData();
            
            // Actualizar UI de estadísticas
            updateStats();
            updateHistoryTable();
            updateResultsChart();
            
            // Verificar logros
            checkAchievements(accuracy);
            
            // Mostrar modal de resultados
            showResultsModal(accuracy, avgTime);
        }
        
        // Mostrar modal con resultados
        function showResultsModal(accuracy, avgTime) {
            // Actualizar contenido del modal
            document.getElementById('result-correct').textContent = gameState.correctAnswers;
            document.getElementById('result-accuracy').textContent = accuracy + '%';
            document.getElementById('result-avg-time').textContent = avgTime + 's';
            document.getElementById('result-score').textContent = gameState.score;
            
            // Determinar mensaje según desempeño
            let message = '';
            let icon = '';
            
            if (accuracy >= 90) {
                message = '¡Excelente trabajo! Tu control cognitivo es superior';
                icon = '<i class="fas fa-trophy text-warning"></i>';
            } else if (accuracy >= 70) {
                message = '¡Muy bien! Estás mostrando buen control cognitivo';
                icon = '<i class="fas fa-star text-warning"></i>';
            } else if (accuracy >= 50) {
                message = 'Buen intento. Sigue practicando para mejorar';
                icon = '<i class="fas fa-thumbs-up text-info"></i>';
            } else {
                message = 'El efecto Stroop es desafiante. ¡No te rindas!';
                icon = '<i class="fas fa-redo text-primary"></i>';
            }
            
            document.getElementById('results-message').textContent = message;
            document.getElementById('results-icon').innerHTML = icon;
            
            // Comprobar si se desbloqueó un logro
            const achievementUnlocked = document.getElementById('achievement-unlocked');
            achievementUnlocked.style.display = 'none';
            
            // Mostrar modal
            const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
            resultsModal.show();
        }
        
        // Verificar logros desbloqueados
        function checkAchievements(accuracy) {
            // Principiante
            if (!achievementsUnlocked.beginner) {
                unlockAchievement('beginner');
            }
            
            // Velocista
            if (!achievementsUnlocked.sprinter && 
                gameState.responseTimes.filter(time => time < 2).length >= 10) {
                unlockAchievement('sprinter');
            }
            
            // Precisión perfecta
            if (!achievementsUnlocked.perfectAccuracy && 
                gameState.totalAnswers >= 10 && accuracy === 100) {
                unlockAchievement('perfectAccuracy');
            }
            
            // En racha
            if (!achievementsUnlocked.onStreak && gameState.maxStreak >= 20) {
                unlockAchievement('onStreak');
            }
            
            // Verificación de constancia se hace en loadUserData
        }
        
        // Desbloquear logro
        function unlockAchievement(achievementName) {
            // Marcar como desbloqueado
            achievementsUnlocked[achievementName] = true;
            
            // Mostrar notificación
            const achievementUnlocked = document.getElementById('achievement-unlocked');
            achievementUnlocked.style.display = 'block';
            
            // Reproducir sonido
            if (gameConfig.soundEnabled) {
                soundAchievement.currentTime = 0;
                soundAchievement.play();
            }
            
            // Actualizar UI de logros
            updateAchievements();
            
            // Guardar datos
            saveUserData();
            
            // Crear confeti para celebrar
            if (gameConfig.animationEnabled) {
                createConfetti(15);
            }
        }
        
        // Actualizar UI de estadísticas
        function updateStats() {
            document.getElementById('stat-tests').textContent = userStats.testsCompleted;
            document.getElementById('stat-correct').textContent = userStats.totalCorrect;
            
            const totalResponses = userStats.totalCorrect + userStats.totalIncorrect;
            const overallAccuracy = totalResponses > 0 
                ? Math.round((userStats.totalCorrect / totalResponses) * 100) 
                : 0;
            
            document.getElementById('stat-accuracy').textContent = overallAccuracy + '%';
            document.getElementById('stat-best-time').textContent = 
                (userStats.bestTime === 9999 ? '0.00' : userStats.bestTime.toFixed(2)) + 's';
        }
        
        // Actualizar tabla de historial
        function updateHistoryTable() {
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';
            
            // Mostrar sólo los últimos 10 resultados
            const recentHistory = userStats.history.slice(-10).reverse();
            
            recentHistory.forEach(entry => {
                const row = document.createElement('tr');
                
                // Formatear fecha
                const date = new Date(entry.date);
                const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${entry.level}</td>
                    <td>${entry.correct}</td>
                    <td>${entry.incorrect}</td>
                    <td>${entry.accuracy}%</td>
                    <td>${entry.avgTime}s</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Crear gráfico de resultados
        function createResultsChart() {
            const ctx = document.createElement('canvas');
            ctx.id = 'results-chart-canvas';
            document.getElementById('results-chart').appendChild(ctx);
            
            window.resultsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Precisión (%)',
                        data: [],
                        backgroundColor: 'rgba(255, 123, 84, 0.2)',
                        borderColor: 'rgba(255, 123, 84, 1)',
                        borderWidth: 2,
                        tension: 0.1
                    }, {
                        label: 'Tiempo Promedio (s)',
                        data: [],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        // Actualizar gráfico de resultados
        function updateResultsChart() {
            // Obtener datos de los últimos 10 tests
            const recentHistory = userStats.history.slice(-10);
            
            // Preparar datos para el gráfico
            const labels = recentHistory.map((_, index) => `Test ${index + 1}`);
            const accuracyData = recentHistory.map(entry => entry.accuracy);
            const timeData = recentHistory.map(entry => parseFloat(entry.avgTime));
            
            // Actualizar gráfico
            window.resultsChart.data.labels = labels;
            window.resultsChart.data.datasets[0].data = accuracyData;
            window.resultsChart.data.datasets[1].data = timeData;
            window.resultsChart.update();
        }
        
        // Actualizar UI de logros
        function updateAchievements() {
            // Actualizar visualización de logros
            document.getElementById('achievement-1').classList.toggle('achievement-locked', !achievementsUnlocked.beginner);
            document.getElementById('achievement-2').classList.toggle('achievement-locked', !achievementsUnlocked.sprinter);
            document.getElementById('achievement-3').classList.toggle('achievement-locked', !achievementsUnlocked.perfectAccuracy);
            document.getElementById('achievement-4').classList.toggle('achievement-locked', !achievementsUnlocked.onStreak);
            document.getElementById('achievement-5').classList.toggle('achievement-locked', !achievementsUnlocked.cognitiveMaster);
            document.getElementById('achievement-6').classList.toggle('achievement-locked', !achievementsUnlocked.consistency);
            
            // Actualizar barras de progreso
            if (!achievementsUnlocked.beginner) {
                document.querySelector('#achievement-1 .progress-bar').style.width = '0%';
            } else {
                document.querySelector('#achievement-1 .progress-bar').style.width = '100%';
            }
            
            if (!achievementsUnlocked.sprinter) {
                const fastResponses = gameState.responseTimes.filter(time => time < 2).length;
                const progress = Math.min(100, (fastResponses / 10) * 100);
                document.querySelector('#achievement-2 .progress-bar').style.width = progress + '%';
            } else {
                document.querySelector('#achievement-2 .progress-bar').style.width = '100%';
            }
            
            if (!achievementsUnlocked.perfectAccuracy) {
                const accuracy = gameState.totalAnswers > 0 
                    ? (gameState.correctAnswers / gameState.totalAnswers) * 100 
                    : 0;
                document.querySelector('#achievement-3 .progress-bar').style.width = accuracy + '%';
            } else {
                document.querySelector('#achievement-3 .progress-bar').style.width = '100%';
            }
            
            if (!achievementsUnlocked.onStreak) {
                const progress = Math.min(100, (gameState.maxStreak / 20) * 100);
                document.querySelector('#achievement-4 .progress-bar').style.width = progress + '%';
            } else {
                document.querySelector('#achievement-4 .progress-bar').style.width = '100%';
            }
            
            if (!achievementsUnlocked.cognitiveMaster) {
                const progress = Math.min(100, ((gameState.level - 1) / 4) * 100);
                document.querySelector('#achievement-5 .progress-bar').style.width = progress + '%';
            } else {
                document.querySelector('#achievement-5 .progress-bar').style.width = '100%';
            }
            
            // El progreso de la consistencia se actualiza al cargar datos
        }
        
        // Guardar datos del usuario
        function saveUserData() {
            const data = {
                config: gameConfig,
                stats: userStats,
                achievements: achievementsUnlocked,
                lastVisit: new Date()
            };
            
            localStorage.setItem('stroopTestData', JSON.stringify(data));
        }
        
        // Cargar datos del usuario
        function loadUserData() {
            const savedData = localStorage.getItem('stroopTestData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Cargar configuración
                if (data.config) {
                    gameConfig = data.config;
                    
                    // Actualizar UI de configuración
                    document.getElementById('difficulty').value = gameConfig.difficulty;
                    document.getElementById('test-duration').value = gameConfig.duration;
                    document.getElementById('duration-value').textContent = gameConfig.duration + ' segundos';
                    document.getElementById('word-size').value = gameConfig.wordSize;
                    document.getElementById('word-size-value').textContent = gameConfig.wordSize + ' rem';
                    document.getElementById('sound-enabled').checked = gameConfig.soundEnabled;
                    document.getElementById('animation-enabled').checked = gameConfig.animationEnabled;
                    
                    // Aplicar tamaño de palabra
                    wordDisplay.style.fontSize = gameConfig.wordSize + 'rem';
                }
                
                // Cargar estadísticas
                if (data.stats) {
                    userStats = data.stats;
                    
                    // Convertir fechas de string a Date
                    userStats.sessionStarted = new Date(userStats.sessionStarted);
                    userStats.history.forEach(entry => {
                        entry.date = new Date(entry.date);
                    });
                }
                
                // Cargar logros
                if (data.achievements) {
                    achievementsUnlocked = data.achievements;
                }
                
                // Verificar logro de constancia
                if (data.lastVisit && !achievementsUnlocked.consistency) {
                    const lastVisit = new Date(data.lastVisit);
                    const today = new Date();
                    
                    // Comprobar si la fecha es del día anterior
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    const isConsecutiveDay = 
                        lastVisit.getDate() === yesterday.getDate() && 
                        lastVisit.getMonth() === yesterday.getMonth() && 
                        lastVisit.getFullYear() === yesterday.getFullYear();
                    
                    if (isConsecutiveDay) {
                        // Incrementar contador de días consecutivos
                        if (!userStats.consecutiveDays) {
                            userStats.consecutiveDays = 1;
                        }
                        
                        userStats.consecutiveDays++;
                        
                        // Comprobar si se alcanzaron 5 días
                        if (userStats.consecutiveDays >= 5) {
                            unlockAchievement('consistency');
                        }
                    } else if (
                        lastVisit.getDate() !== today.getDate() || 
                        lastVisit.getMonth() !== today.getMonth() || 
                        lastVisit.getFullYear() !== today.getFullYear()
                    ) {
                        // Si no es consecutivo y no es hoy, reiniciar contador
                        userStats.consecutiveDays = 1;
                    }
                    
                    // Actualizar barra de progreso de constancia
                    if (!achievementsUnlocked.consistency) {
                        const progress = Math.min(100, (userStats.consecutiveDays / 5) * 100);
                        document.querySelector('#achievement-6 .progress-bar').style.width = progress + '%';
                    }
                } else {
                    // Inicializar contador de días
                    if (!userStats.consecutiveDays) {
                        userStats.consecutiveDays = 1;
                    }
                }
            }
        }
        
        // Crear confeti para celebraciones
        function createConfetti(count) {
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confetti.style.backgroundColor = 
                    ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'][Math.floor(Math.random() * 6)];
                
                document.body.appendChild(confetti);
                
                // Eliminar después de la animación
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Funciones de minijuegos (implementaciones básicas para demostración)
        
        function startPuzzleGame() {
            alert('¡Rompecabezas de Colores próximamente!');
        }
        
        function startSortingGame() {
            alert('¡Clasificación Rápida próximamente!');
        }
        
        function startMemoryGame() {
            alert('¡Memoria de Colores próximamente!');
        }
        
        function startCountdownGame() {
            alert('¡Contrarreloj próximamente!');
        }
        
        // Previsualización de temas
        function updateThemePreview() {
            const theme = document.getElementById('theme-selection').value;
            const preview = document.getElementById('theme-preview');
            
            switch (theme) {
                case 'default':
                    preview.style.background = 'linear-gradient(to right, #4e54c8, #8f94fb)';
                    break;
                case 'dark':
                    preview.style.background = 'linear-gradient(to right, #232526, #414345)';
                    break;
                case 'ocean':
                    preview.style.background = 'linear-gradient(to right, #1cb5e0, #000046)';
                    break;
                case 'sunset':
                    preview.style.background = 'linear-gradient(to right, #ff512f, #dd2476)';
                    break;
                case 'forest':
                    preview.style.background = 'linear-gradient(to right, #134e5e, #71b280)';
                    break;
            }
        }
        
        // Aplicar tema seleccionado
        function applyTheme() {
            const theme = document.getElementById('theme-selection').value;
            const root = document.documentElement;
            
            switch (theme) {
                case 'default':
                    root.style.setProperty('--primary-color', '#4e54c8');
                    root.style.setProperty('--secondary-color', '#8f94fb');
                    root.style.setProperty('--accent-color', '#ff7b54');
                    break;
                case 'dark':
                    root.style.setProperty('--primary-color', '#232526');
                    root.style.setProperty('--secondary-color', '#414345');
                    root.style.setProperty('--accent-color', '#bb86fc');
                    break;
                case 'ocean':
                    root.style.setProperty('--primary-color', '#1cb5e0');
                    root.style.setProperty('--secondary-color', '#000046');
                    root.style.setProperty('--accent-color', '#00ff9d');
                    break;
                case 'sunset':
                    root.style.setProperty('--primary-color', '#ff512f');
                    root.style.setProperty('--secondary-color', '#dd2476');
                    root.style.setProperty('--accent-color', '#ffdc00');
                    break;
                case 'forest':
                    root.style.setProperty('--primary-color', '#134e5e');
                    root.style.setProperty('--secondary-color', '#71b280');
                    root.style.setProperty('--accent-color', '#f9dc5c');
                    break;
            }
            
            // Guardar configuración
            saveUserData();
            
            // Mostrar notificación
            alert('Tema aplicado correctamente');
        }
    </script>
</body>
</html>
