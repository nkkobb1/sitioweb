<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Voyager - Multilingual</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
      /* --- Estilos CSS (SIN CAMBIOS respecto a la versi√≥n anterior) --- */
      :root {
        --bg-color: #0f0c29;
        --bg-gradient: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
        --primary-glow: #00d4ff;
        --secondary-glow: #ff00f7;
        --text-color: #e0e0e0;
        --text-muted: #a0a0a0;
        --card-bg: rgba(40, 40, 70, 0.7);
        --border-color: rgba(0, 212, 255, 0.3);
        --input-bg: rgba(0, 0, 0, 0.4);
        --button-bg: linear-gradient(90deg, var(--primary-glow), var(--secondary-glow));
        --button-hover-bg: linear-gradient(90deg, #00bfff, #e000e0); /* Slightly desaturated */
        --error-color: #ff4d4d;
        --font-primary: 'Orbitron', sans-serif;
        --font-secondary: 'Poppins', sans-serif;
        --star-twinkle-duration: 1.5s;
      }

      @keyframes stars {
        0% { background-position: 0 0; }
        100% { background-position: -10000px 5000px; }
      }

      @keyframes pulse {
        0% { box-shadow: 0 0 8px var(--primary-glow), inset 0 0 5px rgba(0, 212, 255, 0.5); }
        50% { box-shadow: 0 0 15px var(--primary-glow), inset 0 0 8px rgba(0, 212, 255, 0.7); }
        100% { box-shadow: 0 0 8px var(--primary-glow), inset 0 0 5px rgba(0, 212, 255, 0.5); }
      }

       @keyframes fadeInSlideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
      }

       @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }


      body {
        font-family: var(--font-secondary);
        margin: 0;
        background-color: var(--bg-color);
        background-image: var(--bg-gradient),
                          radial-gradient(ellipse at top left, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 60%),
                          url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="10" cy="10" r="0.5" fill="%23aaa" fill-opacity="0.3"/><circle cx="30" cy="70" r="0.7" fill="%23fff" fill-opacity="0.4"/><circle cx="70" cy="30" r="0.6" fill="%23ccc" fill-opacity="0.3"/><circle cx="90" cy="90" r="0.5" fill="%23bbb" fill-opacity="0.2"/><circle cx="50" cy="50" r="0.8" fill="%23fff" fill-opacity="0.5"/><circle cx="15" cy="85" r="0.6" fill="%23ddd" fill-opacity="0.3"/><circle cx="80" cy="15" r="0.7" fill="%23eee" fill-opacity="0.4"/></svg>');
        background-attachment: fixed;
        color: var(--text-color);
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Align top */
        min-height: 100vh;
        padding: 40px 20px;
        box-sizing: border-box;
        overflow-x: hidden;
        animation: stars 200s linear infinite; /* Slow star movement */
      }

      .voyager-container {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        padding: 30px 40px;
        border-radius: 15px;
        border: 1px solid var(--border-color);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.1), 0 0 50px rgba(255, 0, 247, 0.1);
        width: 90%;
        max-width: 700px;
        text-align: center;
        margin-top: 20px;
      }

      h1 {
        font-family: var(--font-primary);
        color: var(--primary-glow);
        margin-bottom: 10px;
        font-size: 2.5em;
        text-shadow: 0 0 10px var(--primary-glow);
        letter-spacing: 2px;
      }

      .voyager-container p.subtitle {
        color: var(--text-muted);
        margin-bottom: 30px;
        font-size: 1.1em;
        line-height: 1.6;
      }

      .search-panel {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        align-items: center;
      }

      #wordInput {
        flex-grow: 1;
        padding: 15px 20px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1.1em;
        font-family: var(--font-secondary);
        background-color: var(--input-bg);
        color: var(--text-color);
        outline: none;
        transition: all 0.3s ease;
        box-shadow: inset 0 0 8px rgba(0, 212, 255, 0.1);
      }

      #wordInput:focus {
        border-color: var(--primary-glow);
        box-shadow: 0 0 10px var(--primary-glow), inset 0 0 8px rgba(0, 212, 255, 0.3);
      }

      #searchButton {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        background: var(--button-bg);
        color: #ffffff;
        font-family: var(--font-primary);
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3), 0 0 10px rgba(255, 0, 247, 0.2);
        letter-spacing: 1px;
      }

      #searchButton:hover:not(:disabled) {
        background: var(--button-hover-bg);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), 0 0 15px rgba(255, 0, 247, 0.3);
        transform: translateY(-2px);
      }

      #searchButton:disabled {
        cursor: not-allowed;
        opacity: 0.6;
        background: grey;
        box-shadow: none;
      }

      .loading-indicator {
        display: none; /* Hidden by default */
        margin: 30px auto;
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.2);
        border-top-color: var(--primary-glow);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        box-shadow: 0 0 10px var(--primary-glow);
      }

      .loading-indicator.visible {
        display: block;
      }


      #errorMessage {
        color: var(--error-color);
        margin-top: 20px;
        font-weight: 600;
        min-height: 1.5em;
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      #errorMessage.visible {
        opacity: 1;
      }

      .results-grid {
        margin-top: 40px;
        display: grid;
        grid-template-columns: 1fr; /* Single column on small screens */
        gap: 30px;
        text-align: left;
        opacity: 0; /* Initially hidden for fade-in */
        transition: opacity 0.8s ease-in-out;
      }

      .results-grid.visible {
         opacity: 1;
      }

      /* Make two columns on wider screens */
      @media (min-width: 600px) {
        .results-grid {
          grid-template-columns: 1fr 1fr;
        }
        /* Make example sentence span both columns */
        .result-section.example-sentence {
          grid-column: 1 / -1; /* Span full width */
        }
      }


      .result-section {
        background: rgba(0, 0, 0, 0.2);
        padding: 25px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        box-shadow: inset 0 0 15px rgba(0, 212, 255, 0.1);
        /* Staggered animation entry */
        opacity: 0;
        animation: fadeInSlideUp 0.6s ease-out forwards;
      }

      .result-section:nth-child(1) { animation-delay: 0.2s; }
      .result-section:nth-child(2) { animation-delay: 0.4s; }
      .result-section:nth-child(3) { animation-delay: 0.6s; }


      .result-section h2 {
        font-family: var(--font-primary);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.4em;
        letter-spacing: 1px;
        /* Using generic English titles for consistency */
        color: #eee; /* Slightly brighter white for titles */
      }

      /* Specific glows still apply */
      .result-section.synonyms h2::before { content: "SYN "; color: var(--primary-glow); text-shadow: 0 0 5px var(--primary-glow); margin-right: 5px;}
      .result-section.antonyms h2::before { content: "ANT "; color: var(--secondary-glow); text-shadow: 0 0 5px var(--secondary-glow); margin-right: 5px;}
      .result-section.example-sentence h2::before { content: "EX "; color: #ccc; margin-right: 5px;}


      .word-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .word-list li {
        background-color: var(--input-bg);
        padding: 5px 12px;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.95em;
        transition: all 0.2s ease;
        cursor: default; /* Indicate non-clickable */
        color: var(--text-color); /* Ensure list items use main text color */
      }

      .result-section.synonyms .word-list li { border-left: 3px solid var(--primary-glow); }
      .result-section.antonyms .word-list li { border-left: 3px solid var(--secondary-glow); }

      .word-list li:hover {
         transform: scale(1.05);
         background-color: rgba(0, 0, 0, 0.6);
         border-color: rgba(255, 255, 255, 0.3);
      }

      .example-sentence p {
        font-size: 1.1em;
        line-height: 1.7;
        color: var(--text-color); /* Example text color */
        font-style: italic;
        margin: 0;
        padding-left: 10px;
        border-left: 3px solid #ccc;
      }

      footer {
        margin-top: 50px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        color: var(--text-muted);
        font-size: 0.9em;
        opacity: 0.7;
      }
       footer a {
          color: var(--primary-glow);
          text-decoration: none;
          transition: color 0.3s;
       }
       footer a:hover {
          color: var(--secondary-glow);
          text-shadow: 0 0 5px var(--secondary-glow);
       }
    </style>
</head>
<body>

  <div class="voyager-container">
    <h1>Vocabulary Voyager</h1>
    <p class="subtitle">Explora las profundidades del lenguaje. Introduce una palabra en cualquier idioma para descubrir sus sin√≥nimos, ant√≥nimos y un ejemplo de uso en ese mismo idioma.</p>

    <div class="search-panel">
      <input type="text" id="wordInput" placeholder="Introduce una palabra (ej. happy, feliz, heureux)...">
      <button id="searchButton">Explorar</button>
    </div>

    <div id="loadingIndicator" class="loading-indicator"></div>
    <div id="errorMessage"></div>

    <div id="resultsGrid" class="results-grid">
      <!-- Results will be dynamically injected here -->
    </div>

    <footer>
      Impulsado por la API de texto de <a href="https://pollinations.ai/" target="_blank" rel="noopener noreferrer">Pollinations.ai</a>. El formato y la precisi√≥n del idioma pueden variar.
    </footer>
  </div>

  <script type="module">
    const wordInput = document.getElementById('wordInput');
    const searchButton = document.getElementById('searchButton');
    const resultsGrid = document.getElementById('resultsGrid');
    const errorMessage = document.getElementById('errorMessage');
    const loadingIndicator = document.getElementById('loadingIndicator');

    const POLLINATIONS_TEXT_URL_BASE = "https://text.pollinations.ai/";

    // --- Helper functions (displayError, clearError, showLoading - NO CHANGES) ---
    function displayError(message) {
        resultsGrid.innerHTML = '';
        resultsGrid.classList.remove('visible');
        errorMessage.textContent = message;
        errorMessage.classList.add('visible');
    }

    function clearError() {
        errorMessage.textContent = '';
        errorMessage.classList.remove('visible');
    }

    function showLoading(isLoading) {
        if (isLoading) {
            loadingIndicator.classList.add('visible');
            searchButton.disabled = true;
            resultsGrid.classList.remove('visible');
            resultsGrid.innerHTML = '';
            clearError();
        } else {
            loadingIndicator.classList.remove('visible');
            searchButton.disabled = false;
        }
    }

    /**
     * Parses the response text looking for specific markers (SYN:, ANT:, EX:)
     * regardless of the content language.
     */
    function parsePollinationsResponse(text) {
        const lines = text.split('\n').map(line => line.trim()).filter(line => line);
        let synonyms = [];
        let antonyms = [];
        let example = '';

        for (const line of lines) {
            if (line.startsWith('SYN:')) {
                const content = line.substring(4).trim(); // Get text after "SYN:"
                if (content.toLowerCase() !== 'none') {
                   synonyms = content.split(/, |,|;| - /).map(s => s.trim()).filter(s => s);
                }
            } else if (line.startsWith('ANT:')) {
                 const content = line.substring(4).trim(); // Get text after "ANT:"
                 if (content.toLowerCase() !== 'none') {
                    antonyms = content.split(/, |,|;| - /).map(a => a.trim()).filter(a => a);
                 }
            } else if (line.startsWith('EX:')) {
                 example = line.substring(3).trim(); // Get text after "EX:"
            }
            // Ignore lines that don't start with the expected markers
        }

        // Basic validation: Did we find anything useful?
        if (synonyms.length === 0 && antonyms.length === 0 && !example) {
           console.warn("Could not parse specific sections using SYN:/ANT:/EX: markers. Raw response:", text);
           return null; // Indicate parsing failure
        }

        return { synonyms, antonyms, example };
    }

    /**
     * Displays the parsed results in the grid.
     * Titles are kept generic (Synonyms, Antonyms, Example Usage)
     * but the content (list items, sentence) will be in the target language.
     */
    function displayResults({ synonyms, antonyms, example }) {
        resultsGrid.innerHTML = ''; // Clear previous content
        resultsGrid.classList.remove('visible'); // Prepare for fade-in

        let contentAdded = false;

        // --- Synonyms Section ---
        if (synonyms && synonyms.length > 0) {
            const section = document.createElement('div');
            section.className = 'result-section synonyms';
            const title = document.createElement('h2');
            title.textContent = 'SYNONYMS'; // Generic Title
            const list = document.createElement('ul');
            list.className = 'word-list';
            synonyms.forEach(word => {
                const li = document.createElement('li');
                li.textContent = word; // Content in target language
                list.appendChild(li);
            });
            section.appendChild(title);
            section.appendChild(list);
            resultsGrid.appendChild(section);
            contentAdded = true;
        }

        // --- Antonyms Section ---
        if (antonyms && antonyms.length > 0) {
            const section = document.createElement('div');
            section.className = 'result-section antonyms';
            const title = document.createElement('h2');
            title.textContent = 'ANTONYMS'; // Generic Title
            const list = document.createElement('ul');
            list.className = 'word-list';
            antonyms.forEach(word => {
                const li = document.createElement('li');
                li.textContent = word; // Content in target language
                list.appendChild(li);
            });
            section.appendChild(title);
            section.appendChild(list);
            resultsGrid.appendChild(section);
            contentAdded = true;
        }

        // --- Example Sentence Section ---
        if (example) {
            const section = document.createElement('div');
            section.className = 'result-section example-sentence';
            const title = document.createElement('h2');
            title.textContent = 'EXAMPLE USAGE'; // Generic Title
            const p = document.createElement('p');
            p.textContent = example; // Content in target language
            section.appendChild(title);
            section.appendChild(p);
            resultsGrid.appendChild(section);
            contentAdded = true;
        }

        // Trigger the fade-in animation only if content was added
        if (contentAdded) {
           setTimeout(() => { resultsGrid.classList.add('visible'); }, 50);
        } else {
            // If we parsed the response but all sections were empty or "None"
            if (synonyms.length === 0 && antonyms.length === 0 && !example) {
                 displayError(`No se encontr√≥ informaci√≥n adicional (sin√≥nimos, ant√≥nimos o ejemplos) para la palabra introducida.`);
            } else {
                // Should not happen if parsing logic is correct, but just in case
                displayError("Error al mostrar los resultados. Verifica la consola.");
            }
        }
    }

    /**
     * Fetches data, instructing the API to respond in the input word's language
     * and use specific markers (SYN:, ANT:, EX:).
     */
    async function fetchVocabularyData(word) {
        showLoading(true);

        // ** MODIFIED PROMPT **
        const prompt = `For the word "${word}":
1.  Detect the language of the word "${word}".
2.  Provide synonyms, antonyms, and one example sentence for "${word}".
3.  **IMPORTANT: Generate the entire response (synonyms, antonyms, example sentence) in the SAME language as the detected language of "${word}".**
4.  **CRITICAL FORMATTING:** Present the output ONLY as follows, each on a NEW line, using these EXACT English markers:
    SYN: [comma-separated synonyms in the detected language]
    ANT: [comma-separated antonyms in the detected language]
    EX: [example sentence in the detected language using the word "${word}"]
5.  If no common synonyms are found, write exactly "SYN: None".
6.  If no common antonyms are found, write exactly "ANT: None".
7.  Do not add any extra text, explanations, or greetings before or after these lines.`;

        const encodedPrompt = encodeURIComponent(prompt);
        const requestUrl = POLLINATIONS_TEXT_URL_BASE + encodedPrompt;
        console.log("Requesting URL:", requestUrl); // Log for debugging

        try {
            const response = await fetch(requestUrl);
            if (!response.ok) {
                 // Try to get more error details
                let errorDetails = `Error de red: ${response.status} ${response.statusText}`;
                try {
                    const errorText = await response.text();
                    // Avoid showing generic HTML error pages directly to the user
                    if (!errorText.includes('<html') && errorText.length < 200) {
                        errorDetails += ` - ${errorText}`;
                    }
                } catch (e) { /* Ignore if body cannot be read */ }
                throw new Error(errorDetails);
            }
            const text = await response.text();
            console.log("Raw API Response:", text); // Log for debugging

            if (!text) {
                 throw new Error("La API devolvi√≥ una respuesta vac√≠a.");
            }

            const parsedData = parsePollinationsResponse(text);

            if (parsedData) {
                 displayResults(parsedData);
            } else {
                 console.error("Failed to parse the response structure using markers.");
                 displayError("No se pudo procesar la respuesta de la API. Es posible que el formato no sea el esperado.");
            }

        } catch (error) {
            console.error("Error fetching or processing data:", error);
            // Avoid showing overly technical errors like failed fetch directly
            const userFriendlyError = error.message.includes("Failed to fetch")
                ? "No se pudo conectar con la API. Verifica tu conexi√≥n."
                : error.message;
            displayError(`Error: ${userFriendlyError}`);
        } finally {
            showLoading(false);
        }
    }

    // --- Event Listeners (NO CHANGES) ---
    searchButton.addEventListener('click', () => {
        const word = wordInput.value.trim();
        if (word) {
            fetchVocabularyData(word);
        } else {
            displayError("Por favor, introduce una palabra para explorar.");
        }
    });

    wordInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            searchButton.click();
        }
    });

    // Initial state setup
    showLoading(false);
    clearError();

  </script>

</body>
</html>