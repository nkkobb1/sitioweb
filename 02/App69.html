<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enciclopedia del Cine de Terror</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fuentes temáticas (Ejemplo: Creepster para títulos, Lato/Merriweather para cuerpo) -->
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Cine de Terror --- */
        :root {
            --color-primary: #dc2626; /* Rojo Sangre Intenso */
            --color-secondary: #4b5563; /* Gris Oscuro Frío */
            --color-background: #111827; /* Negro/Gris Muy Oscuro */
            --color-text: #e5e7eb; /* Gris Claro/Blanco Apagado */
            --color-text-muted: #9ca3af; /* Gris Medio */
            --color-modal-bg: #1f2937; /* Gris Oscuro Azulado para Modal */
            --color-border: #4b5563; /* Borde Gris Oscuro */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.2); /* Sombras adaptadas a fondo oscuro */
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.2);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.3);
            --border-radius: 4px; /* Bordes más afilados */
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.65; /* Mayor interlineado para lectura en oscuro */ }
        /* Usar fuente temática para el logo/título principal */
        h1.logo, h1.page-title { font-family: 'Creepster', cursive; font-weight: normal; color: var(--color-primary); letter-spacing: 2px; }
        h2.section-title, #modal-title { font-family: 'Merriweather', serif; font-weight: 700; }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: rgba(17, 24, 39, 0.8); /* Fondo de navbar semi-transparente */ backdrop-filter: blur(5px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; /* Mayor espacio */ }
        .title-item { background-color: var(--color-modal-bg); padding: 1.5rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 600; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 70px; font-family: 'Lato', sans-serif; }
        .title-item:hover { transform: translateY(-4px) scale(1.02); /* Efecto hover más pronunciado */ box-shadow: 0 0 15px rgba(220, 38, 38, 0.5); border-color: var(--color-primary); color: var(--color-primary); background-color: #374151; }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-primary); color: #ffffff; padding: 0.8rem 1.6rem; border: none; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: bold; cursor: pointer; transition: var(--transition-normal); margin-top: 2rem; text-transform: uppercase; letter-spacing: 1px; }
        #generate-more-btn:hover:not(:disabled) { background-color: #b91c1c; box-shadow: 0 0 10px rgba(220, 38, 38, 0.7); }
        #generate-more-btn:disabled { background-color: #4b5563; color: var(--color-text-muted); cursor: not-allowed; opacity: 0.7; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); /* Overlay más oscuro */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem; /* Más padding */
            max-width: 950px; /* Un poco más ancho */
            width: 95%;
            max-height: 90vh;
            min-height: 350px; /* Altura mínima para pantalla de carga */
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #4b5563; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.6rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: var(--color-primary); color: #ffffff; transform: rotate(90deg); }
        #modal-title { font-size: 2rem; /* Título más grande */ text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1rem; line-height: 1.3; }
        #modal-content {
            line-height: 1.8; /* Aún más interlineado */
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            /* margin-bottom: 1.5rem; <-- Removido, el margen lo dará el último elemento (imagen) */
            padding: 0 10px 1.5rem 10px; /* Padding inferior para espacio después de imagen */
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) #374151; /* Scrollbar temático */
        }
        #modal-content::-webkit-scrollbar { width: 10px; }
        #modal-content::-webkit-scrollbar-track { background: #374151; border-radius: var(--border-radius); }
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: var(--border-radius); border: 2px solid #374151; }
        #modal-content p:not(:last-child) { margin-bottom: 1.4em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { color: #d1d5db; font-style: italic; } /* Énfasis más sutil */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Merriweather', serif; margin-top: 2.2em; margin-bottom: 1.1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.5em; font-weight: bold; }
        #modal-content h1 { font-size: 1.6em; }
        #modal-content h2 { font-size: 1.45em; }
        #modal-content h3 { font-size: 1.3em; color: var(--color-text); }
        #modal-content h4 { font-size: 1.15em; color: var(--color-text-muted); border-bottom: none; }
        /* Estilo para la imagen insertada al final del contenido */
        #modal-content .final-image { display: block; max-width: 80%; /* O el tamaño que prefieras */ height: auto; margin: 2.5rem auto 1rem auto; /* Margen superior/inferior y centrado */ border: 1px solid var(--color-border); border-radius: var(--border-radius); }
        /* Estilo para el placeholder/spinner de la imagen final */
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; /* Espacio para spinner/icono */ margin: 2.5rem auto 1rem auto; color: var(--color-text-muted); }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(255, 255, 255, 0.1); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(17, 24, 39, 0.97); /* Fondo de carga oscuro */ display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #4b5563; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.3rem; font-family: 'Lato'; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #450a0a; /* Fondo error rojo oscuro */ color: #fecaca; /* Texto claro */ padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid var(--color-primary); margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
    </style>
</head>
<body class="bg-gray-900">
     <!-- Header/Navbar -->
     <nav class="navbar mb-10">
         <div class="container mx-auto px-4 py-4 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-3xl sm:text-4xl">
                     <i class="fas fa-film mr-3 transform -rotate-12"></i> <!-- Icono película -->
                     Enciclopedia del Terror
                     <i class="fas fa-skull-crossbones ml-3 transform rotate-12"></i> <!-- Icono terror -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-12 text-center">
             <h1 class="page-title text-5xl sm:text-6xl mb-5">Explora tus Pesadillas Cinematográficas</h1>
             <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">Descubre análisis profundos, historia e impacto de las películas de terror más icónicas (y ocultas). Selecciona un título para invocar su análisis...</p>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-3xl sm:text-4xl mb-8 text-center mx-auto">
                 <i class="fas fa-scroll text-red-600 mr-2"></i> <!-- Icono pergamino -->
                 Elige tu Veneno...
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-400 col-span-full text-center text-lg">Desenterrando archivos fílmicos...</p>
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Convocar Más Películas
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Invocando análisis...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - La imagen se añadirá aquí al final -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- La imagen y su placeholder/spinner se añadirán aquí vía JS -->
                 </div>
                 <!-- NO HAY CONTENEDOR DE IMAGEN SEPARADO AQUÍ -->
                  <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                 </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-900 text-gray-500 py-6 mt-12 border-t border-gray-700">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Análisis generados por IA con fines de entretenimiento y crítica cinematográfica. Las interpretaciones pueden variar.</p>
              <p class="mt-1">¡Disfruta explorando el lado oscuro del celuloide!</p>
              <p class="mt-2">© 2025 Enciclopedia del Terror</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
             // Clásicos Universales / Monstruos Clásicos
            "Nosferatu (1922)", "Drácula (1931)", "Frankenstein (1931)", "La Momia (1932)", "El Hombre Invisible (1933)", "La Novia de Frankenstein (1935)", "El Hombre Lobo (1941)", "Cat People (1942)", "I Walked with a Zombie (1943)", "Creature from the Black Lagoon (1954)", "Godzilla (Gojira) (1954)", "Invasion of the Body Snatchers (1956)", "The Curse of Frankenstein (1957)", "Horror of Dracula (1958)", "The Fly (1958)", "Plan 9 from Outer Space (1959)",
            // Era Dorada / Hammer / Gótico / Psicologico 50s-60s
            "Psycho (Psicosis) (1960)", "Peeping Tom (1960)", "The Innocents (1961)", "Carnival of Souls (1962)", "What Ever Happened to Baby Jane? (1962)", "The Haunting (1963)", "Black Sabbath (1963)", "Blood Feast (1963)", "The Birds (Los Pájaros) (1963)", "Onibaba (1964)", "Repulsion (1965)", "Faster, Pussycat! Kill! Kill! (1965)", // (Culto, no estrictamente terror pero influyente)
            "Seconds (1966)", "Kwaidan (1965)", "Eyes Without a Face (Les yeux sans visage) (1960)", "Village of the Damned (1960)", "House of Usher (1960)", "The Pit and the Pendulum (1961)", "Masque of the Red Death (1964)", "Witchfinder General (1968)", "Night of the Living Dead (La Noche de los Muertos Vivientes) (1968)", "Rosemary's Baby (El Bebé de Rosemary / La Semilla del Diablo) (1968)",
            // Años 70: El Nuevo Hollywood, Exploitation, Slashers, Sobrenatural
            "The Last House on the Left (1972)", "The Exorcist (El Exorcista) (1973)", "The Wicker Man (1973)", "Don't Look Now (1973)", "The Texas Chain Saw Massacre (La Matanza de Texas) (1974)", "Black Christmas (1974)", "It's Alive (1974)", "Jaws (Tiburón) (1975)", "Deep Red (Profondo Rosso) (1975)", "The Omen (La Profecía) (1976)", "Carrie (1976)", "The Hills Have Eyes (1977)", "Suspiria (1977)", "Eraserhead (1977)", "Rabid (1977)", "Halloween (La Noche de Halloween) (1978)", "Dawn of the Dead (Zombi / El Amanecer de los Muertos) (1978)", "Invasion of the Body Snatchers (1978)", "Magic (1978)", "Alien (Alien, el Octavo Pasajero) (1979)", "The Amityville Horror (1979)", "Phantasm (1979)", "Nosferatu the Vampyre (1979)", "Zombie 2 (Nueva York bajo el terror de los Zombi) (1979)",
            // Años 80: Slashers, Body Horror, Comedia de Terror, Criaturas
            "The Shining (El Resplandor) (1980)", "Friday the 13th (Viernes 13) (1980)", "The Fog (La Niebla) (1980)", "Cannibal Holocaust (1980)", "Maniac (1980)", "Altered States (1980)", "Scanners (1981)", "An American Werewolf in London (Un Hombre Lobo Americano en Londres) (1981)", "The Howling (Aullidos) (1981)", "The Evil Dead (Posesión Infernal / El Despertar del Diablo) (1981)", "My Bloody Valentine (1981)", "Poltergeist (1982)", "The Thing (La Cosa) (1982)", "Creepshow (1982)", "Tenebrae (1982)", "Videodrome (1983)", "Sleepaway Camp (1983)", "Christine (1983)", "Cujo (1983)", "A Nightmare on Elm Street (Pesadilla en Elm Street) (1984)", "Gremlins (1984)", "Ghostbusters (Los Cazafantasmas) (1984)", // (Más comedia, pero icónica)
            "Silent Night, Deadly Night (1984)", "The Terminator (1984)", // (Sci-Fi/Acción con elementos de slasher)
            "Re-Animator (1985)", "Day of the Dead (El Día de los Muertos) (1985)", "Fright Night (Noche de Miedo) (1985)", "Return of the Living Dead (El Regreso de los Muertos Vivientes) (1985)", "Demons (1985)", "The Texas Chainsaw Massacre 2 (1986)", "The Fly (La Mosca) (1986)", "Aliens (Aliens: El Regreso) (1986)", "Henry: Portrait of a Serial Killer (1986)", "From Beyond (1986)", "Evil Dead II (Terroríficamente Muertos / El Despertar del Diablo 2) (1987)", "Hellraiser (1987)", "Predator (Depredador) (1987)", "The Lost Boys (Jóvenes Ocultos) (1987)", "Near Dark (Los Viajeros de la Noche) (1987)", "Prince of Darkness (El Príncipe de las Tinieblas) (1987)", "RoboCop (1987)", // (Sci-Fi/Acción con body horror)
            "Child's Play (Muñeco Diabólico) (1988)", "They Live (Están Vivos) (1988)", "Dead Ringers (Inseparables) (1988)", "The Blob (1988)", "Killer Klowns from Outer Space (1988)", "Pet Sematary (Cementerio de Animales) (1989)", "Society (1989)", "Tetsuo: The Iron Man (1989)", "Santa Sangre (1989)",
            // Años 90: Thrillers Psicológicos, Slasher Revival, Found Footage temprano
            "Jacob's Ladder (La Escalera de Jacob) (1990)", "Misery (1990)", "Arachnophobia (1990)", "Tremors (Temblores) (1990)", "The Silence of the Lambs (El Silencio de los Corderos) (1991)", "Cape Fear (El Cabo del Miedo) (1991)", "Candyman (1992)", "Braindead (Tu Madre se ha Comido a mi Perro) (1992)", "Army of Darkness (El Ejército de las Tinieblas) (1992)", "Basic Instinct (Instinto Básico) (1992)", // (Thriller erótico influyente)
            "Reservoir Dogs (1992)", // (Crimen violento, no terror puro)
            "Jurassic Park (Parque Jurásico) (1993)", // (Aventura con terror de criaturas)
            "Cronos (1993)", "Needful Things (1993)", "In the Mouth of Madness (En la Boca del Miedo) (1994)", "Natural Born Killers (Asesinos Natos) (1994)", // (Crimen satírico)
            "Wes Craven's New Nightmare (La Nueva Pesadilla de Wes Craven) (1994)", "Interview with the Vampire (Entrevista con el Vampiro) (1994)", "Se7en (Seven) (1995)", "From Dusk Till Dawn (Abierto hasta el Amanecer) (1996)", "Scream (1996)", "The Craft (Jóvenes y Brujas) (1996)", "Fargo (1996)", // (Thriller/Crimen)
            "Event Horizon (Horizonte Final) (1997)", "I Know What You Did Last Summer (Sé lo que Hicisteis el Último Verano) (1997)", "Funny Games (1997)", "Lost Highway (Carretera Perdida) (1997)", "Cube (1997)", "Mimic (1997)", "Starship Troopers (1997)", // (Sci-Fi/Acción satírica con gore)
            "Perfect Blue (1997)", "Ringu (The Ring) (1998)", "The Faculty (1998)", "Urban Legend (Leyenda Urbana) (1998)", "Blade (1998)", // (Acción/Horror)
            "The Blair Witch Project (El Proyecto de la Bruja de Blair) (1999)", "The Sixth Sense (El Sexto Sentido) (1999)", "Audition (Ôdishon) (1999)", "Sleepy Hollow (1999)", "Ravenous (1999)", "Stir of Echoes (El Último Escalón) (1999)", "Existenz (1999)", "Deep Blue Sea (1999)",
            // Siglo XXI: Remakes, Torture Porn, J-Horror, Found Footage Boom, Indie Horror, "Elevated Horror"
            "American Psycho (2000)", "Final Destination (Destino Final) (2000)", "Battle Royale (2000)", "Requiem for a Dream (Réquiem por un Sueño) (2000)", // (Drama psicológico intenso)
            "Ginger Snaps (2000)", "Shadow of the Vampire (La Sombra del Vampiro) (2000)", "Memento (2000)", // (Thriller psicológico)
            "The Others (Los Otros) (2001)", "Jeepers Creepers (2001)", "Mulholland Drive (2001)", // (Neo-noir/Surrealista)
            "Donnie Darko (2001)", "Frailty (Escalofrío) (2001)", "Session 9 (2001)", "Pulse (Kairo) (2001)", "Ichi the Killer (2001)", "The Devil's Backbone (El Espinazo del Diablo) (2001)", "28 Days Later (28 Días Después) (2002)", "The Ring (La Señal) (2002)", "Signs (Señales) (2002)", "Cabin Fever (2002)", "Dog Soldiers (2002)", "May (2002)", "Ju-On: The Grudge (La Maldición) (2002)", "Irreversible (2002)", // (Drama/Crimen extremadamente gráfico)
            "Identity (Identidad) (2003)", "Wrong Turn (Km. 666: Desvío al Infierno) (2003)", "High Tension (Alta Tensión) (2003)", "A Tale of Two Sisters (Janghwa, Hongryeon) (2003)", "Oldboy (2003)", // (Thriller/Acción/Venganza)
            "Underworld (2003)", "Freddy vs. Jason (2003)", "Saw (2004)", "Shaun of the Dead (Zombies Party / El Desesperar de los Muertos) (2004)", "Dawn of the Dead (Remake) (Amanecer de los Muertos) (2004)", "The Grudge (El Grito - Remake) (2004)", "Creep (2004)", "Primer (2004)", // (Sci-Fi complejo)
            "The Descent (2005)", "Hostel (2005)", "Wolf Creek (2005)", "The Exorcism of Emily Rose (El Exorcismo de Emily Rose) (2005)", "Constantine (2005)", // (Acción/Fantasía/Horror)
            "Silent Hill (2006)", "The Hills Have Eyes (Remake) (Las Colinas Tienen Ojos) (2006)", "Pan's Labyrinth (El Laberinto del Fauno) (2006)", "The Host (Gwoemul) (2006)", "Slither (La Plaga) (2006)", "Behind the Mask: The Rise of Leslie Vernon (2006)", "The Children (2008)", // (No, The Children es de 2008)
            "REC (2007)", "[•REC] (2007)", "Paranormal Activity (2007)", "The Mist (La Niebla de Stephen King) (2007)", "30 Days of Night (30 Días de Oscuridad) (2007)", "Zodiac (2007)", // (Thriller/Crimen)
            "Trick 'r Treat (Truco o Trato) (2007)", "Inside (À l'intérieur) (2007)", "Funny Games (Remake USA) (2007)", "1408 (2007)", "The Orphanage (El Orfanato) (2007)", "Cloverfield (Monstruoso) (2008)", "The Strangers (Los Extraños) (2008)", "Let the Right One In (Déjame Entrar - Lat den rätte komma in) (2008)", "Martyrs (2008)", "Lake Mungo (2008)", "Pontypool (2008)", "Splinter (2008)", "Eden Lake (2008)", "Quarantine (Cuarentena - Remake REC) (2008)", "The Ruins (Las Ruinas) (2008)", "Drag Me to Hell (Arrástrame al Infierno) (2009)", "Orphan (La Huérfana) (2009)", "Zombieland (Bienvenidos a Zombieland) (2009)", "Antichrist (Anticristo) (2009)", "The House of the Devil (2009)", "Jennifer's Body (2009)", "Triangle (2009)", "Thirst (Bakjwi) (2009)", "The Loved Ones (2009)", "Moon (2009)", // (Sci-Fi psicológico)
            "Insidious (2010)", "Black Swan (Cisne Negro) (2010)", "Tucker & Dale vs. Evil (Tucker y Dale contra el Mal) (2010)", "Let Me In (Déjame Entrar - Remake) (2010)", "I Saw the Devil (Akmareul boatda) (2010)", "A Serbian Film (2010)", // (Extremadamente controvertida)
            "Stake Land (2010)", "Rare Exports: A Christmas Tale (2010)", "The Cabin in the Woods (La Cabaña en el Bosque) (2011)", "You're Next (Tú Eres el Siguiente) (2011)", "The Woman (2011)", "Kill List (2011)", "Attack the Block (2011)", "Contagion (Contagio) (2011)", // (Thriller pandémico)
            "Drive (2011)", // (Neo-noir/Thriller)
            "The Innkeepers (2011)", "Trollhunter (Trolljegeren) (2010)", // (Error, es 2010)
            "Sinister (2012)", "Prometheus (2012)", "The Conjuring (Expediente Warren: The Conjuring) (2013)", "Evil Dead (Remake) (Posesión Infernal) (2013)", "Oculus (2013)", "Under the Skin (Bajo la Piel) (2013)", "Prisoners (Prisioneros) (2013)", // (Thriller oscuro)
            "Enemy (2013)", // (Thriller psicológico)
            "Only Lovers Left Alive (Sólo los Amantes Sobreviven) (2013)", "We Are What We Are (2013)", "Stoker (2013)", "World War Z (Guerra Mundial Z) (2013)", "The Babadook (2014)", "It Follows (2014)", "A Girl Walks Home Alone at Night (Una Chica Vuelve a Casa Sola de Noche) (2014)", "Goodnight Mommy (Ich seh, Ich seh) (2014)", "As Above, So Below (Así en la Tierra como en el Infierno) (2014)", "Starry Eyes (2014)", "Creep (2014)", "What We Do in the Shadows (Lo que Hacemos en las Sombras) (2014)", "Housebound (2014)", "The Guest (2014)", "The Witch (La Bruja) (2015)", "Green Room (2015)", "Bone Tomahawk (2015)", "The Invitation (La Invitación) (2015)", "Krampus (2015)", "The Visit (La Visita) (2015)", "Maggie (2015)", "Turbo Kid (2015)", // (Post-apocalíptico/Gore/Comedia)
            "Train to Busan (Estación Zombie: Tren a Busan) (2016)", "Don't Breathe (No Respires) (2016)", "10 Cloverfield Lane (Calle Cloverfield 10) (2016)", "The Conjuring 2 (Expediente Warren: El Caso Enfield) (2016)", "Ouija: Origin of Evil (Ouija: El Origen del Mal) (2016)", "Lights Out (Nunca Apagues la Luz) (2016)", "The Autopsy of Jane Doe (La Autopsia de Jane Doe) (2016)", "The Wailing (Gokseong) (El Extraño) (2016)", "Raw (Crudo / Voraz) (2016)", "Hush (Silencio) (2016)", "The Neon Demon (2016)", "Blair Witch (2016)", "Shin Godzilla (2016)",
            "Get Out (Déjame Salir) (2017)", "It (Eso) (2017)", "mother! (¡Madre!) (2017)", "Gerald's Game (El Juego de Gerald) (2017)", "Split (Múltiple) (2016)", // (Error, es 2016, lanzado en 2017 en algunos sitios)
            "It Comes at Night (Llega de Noche) (2017)", "Annabelle: Creation (2017)", "Happy Death Day (Feliz Día de tu Muerte) (2017)", "The Shape of Water (La Forma del Agua) (2017)", // (Fantasía oscura/Romance)
            "A Dark Song (2016)", // (Error, es 2016)
            "The Killing of a Sacred Deer (El Sacrificio de un Ciervo Sagrado) (2017)", "Super Dark Times (2017)", " Verónica (2017)", "Better Watch Out (Cuidado con los Extraños) (2016)", // (Error, es 2016)
            "Hereditary (El Legado del Diablo) (2018)", "A Quiet Place (Un Lugar Tranquilo) (2018)", "Mandy (2018)", "Suspiria (Remake) (2018)", "Halloween (La Noche de Halloween - Secuela/Reboot) (2018)", "Annihilation (Aniquilación) (2018)", "Upgrade (2018)", "Overlord (2018)", "Terrified (Aterrados) (2017)", // (Error, es 2017)
            "Bird Box (A Ciegas) (2018)", "Cam (2018)", "Searching (2018)", // (Screenlife Thriller)
            "Climax (2018)", "Revenge (2017)", // (Error, es 2017)
            "Us (Nosotros) (2019)", "Midsommar (2019)", "The Lighthouse (El Faro) (2019)", "Parasite (Parásitos) (2019)", // (Thriller Social/Comedia Negra)
            "It Chapter Two (It: Capítulo Dos) (2019)", "Doctor Sleep (Doctor Sueño) (2019)", "Ready or Not (Noche de Bodas) (2019)", "Crawl (Infierno Bajo el Agua) (2019)", "The Platform (El Hoyo) (2019)", "Color Out of Space (2019)", "Scary Stories to Tell in the Dark (Historias de Miedo para Contar en la Oscuridad) (2019)", "Brightburn (El Hijo) (2019)", "Daniel Isn't Real (2019)", "1BR (2019)", "Little Monsters (2019)",
            // Años 2020s
            "The Invisible Man (El Hombre Invisible - Remake) (2020)", "Host (2020)", "Possessor (2020)", "His House (Casa Ajena) (2020)", "Relic (2020)", "Underwater (2020)", "The Lodge (La Cabaña Siniestra) (2019)", // (Error, es 2019)
            "Saint Maud (2019)", // (Error, 2019 festival, 2020/21 estreno amplio)
            "Hunter Hunter (2020)", "Freaky (Este Cuerpo me Sienta de Muerte) (2020)", "Run (Mamá te Quiere) (2020)", "Sputnik (2020)", "She Dies Tomorrow (2020)", "Anything for Jackson (2020)",
            "A Quiet Place Part II (Un Lugar Tranquilo 2) (2020)", // (Error, retrasada a 2021)
            "Candyman (Remake/Secuela) (2021)", "Malignant (Maligno) (2021)", "Titane (2021)", "Last Night in Soho (Última Noche en el Soho) (2021)", "The Night House (La Casa Oscura) (2020)", // (Error, 2020 festival, 2021 estreno)
            "Lamb (2021)", "Fear Street Trilogy (La Calle del Terror - Trilogía) (2021)", "Antlers (Espíritus Oscuros) (2021)", "Censor (2021)", "The Medium (2021)", "Werewolves Within (Un Lobo entre Nosotros) (2021)", "Psycho Goreman (2020)", // (Error, 2020 festival, 2021 estreno)
            "X (2022)", "Scream (Scream 5) (2022)", "Barbarian (2022)", "Nope (¡Nop!) (2022)", "Pearl (2022)", "Smile (2022)", "Terrifier 2 (2022)", "Speak No Evil (2022)", "Men (2022)", "The Black Phone (2021)", // (Error, 2021 festival, 2022 estreno)
            "Watcher (2022)", "Bones and All (Hasta los Huesos) (2022)", "Significant Other (2022)", "Resurrection (2022)", "Deadstream (2022)", "Sissy (2022)",
            "Talk to Me (Háblame) (2022)", // (Error, 2022 festival, 2023 estreno)
            "Infinity Pool (2023)", "Evil Dead Rise (Posesión Infernal: El Despertar) (2023)", "Saw X (2023)", "Beau Is Afraid (2023)", // (Comedia/Drama/Horror surrealista)
            "When Evil Lurks (Cuando Acecha la Maldad) (2023)", "No One Will Save You (Nadie te Salvará) (2023)", "Skinamarink (2022)", // (Error, 2022 festival, 2023 estreno)
            "Cobweb (No Tengas Miedo) (2023)", "The Pope's Exorcist (El Exorcista del Papa) (2023)", "Thanksgiving (2023)", "Totally Killer (2023)",
            // Conceptos / Subgéneros / Directores
            "¿Qué define al género Slasher?", "La evolución del cine de Zombis", "Found Footage: Pros y Contras", "El Giallo Italiano y su influencia", "El Body Horror: Cronenberg y más allá", "Terror Cósmico Lovecraftiano en el cine", "Maestros del Terror: Alfred Hitchcock", "Maestros del Terror: John Carpenter", "Maestros del Terror: Wes Craven", "Maestros del Terror: George A. Romero", "Maestros del Terror: Dario Argento", "Maestros del Terror: David Cronenberg", "Maestros del Terror: Tobe Hooper", "El Nuevo Extremismo Francés (Cine)", "El impacto del J-Horror (Terror Japonés)", "Terror Folk y sus raíces", "Cine de Casas Encantadas: Clichés y Clásicos", "La figura del Vampiro en el cine", "El Hombre Lobo: Mito y Metáfora", "Posesiones Demoníacas: Del Exorcista a hoy", "El papel de la música en el cine de terror", "Comedia de Terror: El equilibrio perfecto", "Terror Psicológico vs Terror Sobrenatural", "¿Qué es el 'Elevated Horror'?", "Remakes en el cine de terror: ¿Necesarios?", "El Final Girl: Arquetipo del Slasher", "Monstruos Clásicos vs Monstruos Modernos", "El uso del Gore y la Violencia Gráfica", "Terror Tecnológico y Miedo a la IA", "El 'Jump Scare': ¿Recurso fácil o efectivo?"
        ];
        const horrorThemes = [
            "películas slasher", "cine de zombis", "terror sobrenatural", "found footage", "body horror", "terror psicológico", "casas encantadas", "monstruos clásicos", "vampiros en el cine", "hombres lobo", "posesiones y exorcismos", "J-Horror (terror japonés)", "Giallo italiano", "terror folk", "comedia de terror", "terror de los 70", "terror de los 80", "terror de los 90", "terror del siglo XXI", "directores icónicos de terror", "criaturas y monstruos", "thrillers con elementos de terror", "terror cósmico", "terror gótico", "cine de explotación", "elevated horror", "remakes de terror"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un apasionado crítico de cine y historiador especializado en el género de terror. Tu tarea es analizar películas de terror (o conceptos relacionados) de forma profunda, elocuente y detallada para cinéfilos y aficionados. Describe brevemente la trama (sin spoilers mayores si es posible), pero enfócate en analizar sus temas, atmósfera, dirección, actuaciones destacadas, uso de sustos (jump scares, tensión, gore, etc.), cinematografía, música, recepción crítica, impacto cultural y legado dentro del género. Si es un concepto, explícalo con ejemplos fílmicos. Usa un lenguaje vívido y crítico, pero accesible. El objetivo es un ensayo corto de aproximadamente 1200-1300 palabras. Basa tu análisis únicamente en la siguiente película o concepto:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para una enciclopedia de cine. Genera exactamente 15 títulos de películas de terror (clásicas, de culto, modernas) o conceptos clave del género de terror, adecuados para ser analizados en detalle. Devuelve *solo* la lista de títulos/conceptos, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ==========
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const generateMoreSpinner = generateMoreBtn.querySelector('i');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        // ** NO HAY modalImageContainer, modalImage, etc., como elementos separados **
        const modalContent = document.getElementById('modal-content'); // El contenedor del texto donde irá la imagen
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');

        // ========== API FUNCTIONS ==========
        async function fetchTextFromApi(prompt, config) { /* ... Sin cambios ... */
            const encodedPrompt = encodeURIComponent(prompt);
            const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                const text = await response.text();
                if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                throw new Error(`Error de comunicación con la API: ${error.message}`);
            }
        }
        async function fetchExplanationText(conceptTitle) { /* ... Sin cambios ... */
            const text = await fetchTextFromApi(conceptTitle, textApiConfig);
             if (text.trim().length < 800 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                  throw new Error("La IA no pudo generar un análisis adecuado o suficientemente detallado para este título.");
              }
            return text;
        }
        async function fetchGeneratedTitles() { /* ... Sin cambios ... */
            const randomTheme = getRandomElement(horrorThemes) || "películas de terror esenciales";
            const specificPrompt = `Genera 15 títulos de películas de terror o conceptos clave sobre ${randomTheme}`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 5 && line.length < 150);
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas de títulos.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a CINE DE TERROR
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            const safePromptText = typeof promptText === 'string' && promptText.trim() !== '' ? promptText : "classic horror movie scene";
            // Prompt ENFOCADO en atmósfera, no texto, no diagramas.
            const enhancedPrompt = `Atmospheric concept art inspired by the horror movie '${safePromptText}'. Focus on mood, lighting, suspense, dread, eerie landscape or unsettling imagery. Cinematic, dark tones, high contrast. Avoid text or UI elements.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            // NEGATIVE PROMPT: Evitar texto, logos, caras muy definidas si no se piden, etc.
            const negativePrompt = "text, words, title card, movie poster text, labels, letters, captions, writing, numbers, diagrams, charts, graphs, UI, interface, menu, buttons, watermark, signature, multiple panels, collage, very clear faces, screenshot, photograph, bright daylight happy scene";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... */
            if (!rawText) return '';
            let formatted = rawText.trim();
            formatted = formatted.replace(/\\text\{(.*?)\}/g, '$1');
            formatted = formatted.replace(/(\w)_\{?(\d+)\}?/g, '$1<sub>$2</sub>');
            formatted = formatted.replace(/(\w)\^\{?([\d+\-−]+)\}?/g, (match, base, exponent) => { const cleanExponent = exponent.replace('−', '-'); return `${base}<sup>${cleanExponent}</sup>`; });
            formatted = formatted.replace(/\\rightarrow/g, '&rarr;');
            formatted = formatted.replace(/\\\[\s*(.*?)\s*\\\]/g, '<p class="formula">$1</p>'); // Keep just in case
            formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            formatted = blocks.map(block => {
                if (block.startsWith('<h') || block.startsWith('<p class="formula">')) return block;
                let content = block.replace(/\n/g, '<br>');
                return `<p>${content}</p>`;
            }).join('');
            return formatted;
         }

        // ========== MODAL FUNCTIONS ==========
        function showModal() { if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }

        function hideModal() {
            if(!storyModal || !modalContent) return;
            storyModal.classList.remove('active');
            document.body.style.overflow = '';
            // ** YA NO hay listener de scroll que quitar **
            // Reset scroll of the content area itself
            modalContent.scrollTop = 0;
            console.log("Scroll set to 0 on hideModal");
            resetModalState();
        }

        function resetModalState() {
             // Note: No longer resetting separate image container elements
             if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
             modalLoadingIndicator.style.display = 'flex';
             modalStoryContentArea.classList.add('content-hidden');
             modalError.classList.add('content-hidden');
             modalTitle.textContent = '';
             modalContent.innerHTML = ''; // Clear previous text and image
             modalErrorMessage.textContent = '';
        }

        // ========== UI & EVENT HANDLERS ==========
        function getRandomElement(arr) { /* ... Sin cambios ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... Sin cambios ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... Sin cambios ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... Sin cambios ... */
             if (!titleListContainer || !titlesLoading) return;
             const shuffledTitles = shuffleArray([...titles]);
             titleListContainer.innerHTML = '';
             titlesLoading.style.display = 'none';
             if (shuffledTitles.length === 0) { titleListContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">No hay títulos disponibles.</p>'; return; }
             shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
         }
        function appendTitles(newTitles) { /* ... Sin cambios ... */ if (!titleListContainer || !newTitles || newTitles.length === 0) return; newTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title))); }

        // *** MODIFIED: handleTitleClick to append image inside #modal-content ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = ''; // Clear previous content
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';
            // ** NO scroll listener setup needed anymore for the image **

            try {
                // 1. Fetch and format text
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText);

                // 2. Stop loading indicator, display text FIRST
                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation; // Inject text content
                modalStoryContentArea.classList.remove('content-hidden');

                 // 3. *** RESET SCROLL *** after text content is in and visible
                modalContent.scrollTop = 0;
                console.log("Scroll set to 0 after content visible");

                // 4. Prepare and append image placeholder/spinner WITHIN #modal-content
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder'; // Class for styling
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-image placeholder-icon"></i>
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Cargando imagen conceptual...</p>
                `;
                modalContent.appendChild(placeholderDiv); // Add placeholder at the end

                // 5. Create and append the actual image element (starts loading)
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image'; // Class for styling
                imgElement.alt = `Visualización conceptual de ${title}`;
                imgElement.style.display = 'none'; // Hide until loaded

                imgElement.onload = () => {
                    console.log("Image loaded successfully.");
                    placeholderDiv.remove(); // Remove the placeholder
                    imgElement.style.display = 'block'; // Show the image
                };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `
                        <i class="fas fa-eye-slash placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo cargar la imagen.</p>
                    `; // Update placeholder on error
                };

                // Get URL and set src AFTER attaching handlers
                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) {
                    imgElement.src = imageUrl;
                    modalContent.appendChild(imgElement); // Append the image element to the content
                } else {
                     console.error("Could not create image URL for:", title);
                     placeholderDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle placeholder-icon"></i>
                        <p style="font-size: 0.8em; margin-top: 0.5rem;">Error al generar URL de imagen.</p>
                    `;
                }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden'); // Show area to display error
                modalContent.innerHTML = ''; // Clear partial content on error
                // ** NO scroll listener to remove **
            }
        }

        async function handleGenerateMoreTitles() { /* ... Sin cambios ... */
             if (!generateMoreBtn || !generateMoreSpinner || !generateMoreContainer) return;
             generateMoreBtn.disabled = true;
             generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Convocando...'; // Thematic text
             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) {
                         titleListContainer.parentNode.appendChild(generateMoreContainer);
                     }
                     generateMoreContainer.style.display = 'block';
                 } else {
                     alert("No se pudieron convocar más títulos en este momento."); // Thematic text
                 }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al convocar títulos: ${error.message}`); // Thematic text
             } finally {
                 generateMoreBtn.disabled = false;
                 generateMoreBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin hidden"></i> Convocar Más Películas'; // Thematic text
             }
         }


        // ========== INITIALIZATION ==========
        function initApp() {
            if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading) { console.error("Init fail."); document.body.innerHTML = '<p style="color: red; font-size: 2em; text-align: center; padding-top: 5em;">¡HORROR! Fallo crítico al iniciar la cripta digital.</p>'; return; } // Thematic error
            modalCloseBtn.addEventListener('click', hideModal);
            generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
            storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
            displayTitles(predefinedTitles);
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>