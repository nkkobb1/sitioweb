<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivo de la Extinción: Animales Perdidos</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Estilos Adaptados para Animales Extintos --- */
        :root {
            --color-primary: #8b5e3c; /* Marrón Fósil/Tierra */
            --color-secondary: #7f8c8d; /* Gris Piedra */
            --color-background: #f5f5f0; /* Beige Muy Claro / Hueso */
            --color-text: #3e2723; /* Marrón Oscuro (Casi Negro) */
            --color-text-muted: #5f4c3a; /* Marrón medio */
            --color-modal-bg: #e8e6d9; /* Beige ligeramente más oscuro */
            --color-border: #d1ccc0; /* Borde Beige/Gris claro */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.08); /* Sombras sutiles */
            --shadow-md: 0 3px 5px -1px rgb(0 0 0 / 0.1), 0 2px 3px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 8px 12px -3px rgb(0 0 0 / 0.15), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 5px;
            --transition-normal: all 0.2s ease-in-out;
        }
        body { font-family: 'Lato', sans-serif; background-color: var(--color-background); color: var(--color-text); line-height: 1.7; }
        h1, h2, h3, h4, .logo { font-family: 'Merriweather', serif; font-weight: 700; }
        .logo { color: var(--color-primary); }
        h1.page-title { color: var(--color-primary); }
        h2.section-title { color: var(--color-text); border-bottom: 2px solid var(--color-primary); padding-bottom: 0.5rem; display: inline-block; }
        #modal-title { color: var(--color-primary); }
        .navbar { background-color: rgba(245, 245, 240, 0.9); /* Fondo navbar semi-transparente */ backdrop-filter: blur(4px); box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 20; border-bottom: 1px solid var(--color-border); }

        /* --- Search Input Styling --- */
        #search-container { margin-bottom: 2rem; position: relative; }
        #search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
            background-color: #fff; /* Fondo blanco para contraste */
        }
        #search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(139, 94, 60, 0.2);
        }
        #search-container .fa-search {
            position: absolute;
            left: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        /* --- Title List Styling --- */
        #title-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.25rem; }
        .title-item { background-color: var(--color-modal-bg); padding: 1.25rem 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); cursor: pointer; transition: var(--transition-normal); text-align: center; font-weight: 600; color: var(--color-text); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; min-height: 75px; font-family: 'Lato', sans-serif; }
        .title-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: var(--color-primary); color: var(--color-primary); background-color: #dcd9c8; /* Beige más oscuro hover */ }
        #generate-more-btn { grid-column: 1 / -1; background-color: var(--color-primary); color: white; padding: 0.7rem 1.4rem; border: none; border-radius: var(--border-radius); font-family: 'Lato', sans-serif; font-weight: bold; cursor: pointer; transition: var(--transition-normal); margin-top: 1.5rem; }
        #generate-more-btn:hover:not(:disabled) { background-color: #6d4c41; box-shadow: var(--shadow-sm); }
        #generate-more-btn:disabled { background-color: #a1887f; cursor: not-allowed; opacity: 0.8; }
        #generate-more-btn .fa-sync-alt { color: white; }
        #story-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(62, 39, 35, 0.85); /* Overlay marrón oscuro */ display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #story-modal.active { display: flex; }
        .modal-content-wrapper {
            background-color: var(--color-modal-bg);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            max-width: 950px;
            width: 95%;
            max-height: 90vh;
            min-height: 350px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--color-border);
        }
        .modal-close-btn { position: absolute; top: 12px; right: 12px; background: #c8c3b8; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.5rem; color: var(--color-text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-normal); z-index: 10; }
        .modal-close-btn:hover { background-color: #b0a99a; color: #000; }
        #modal-title { font-size: 1.8rem; text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; padding: 0 1.5rem; line-height: 1.3; }
        #modal-content { /* Scrollable content area */
            line-height: 1.75;
            color: var(--color-text);
            white-space: normal;
            overflow-y: auto;
            padding: 0 15px 1.5rem 15px;
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--color-primary) var(--color-border);
        }
        #modal-content::-webkit-scrollbar { width: 9px; }
        #modal-content::-webkit-scrollbar-track { background: var(--color-border); border-radius: 4px;}
        #modal-content::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: 4px; border: 2px solid var(--color-border); }
        #modal-content p:not(:last-child) { margin-bottom: 1.3em; }
        #modal-content strong { color: var(--color-primary); font-weight: bold; }
        #modal-content em { font-style: italic; color: #5d4037; } /* Marrón un poco más oscuro para énfasis */
        #modal-content h1, #modal-content h2, #modal-content h3, #modal-content h4 { font-family: 'Merriweather', serif; margin-top: 2em; margin-bottom: 1em; color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.4em; font-weight: bold; }
        #modal-content h1 { font-size: 1.5em; }
        #modal-content h2 { font-size: 1.4em; }
        #modal-content h3 { font-size: 1.25em; color: #5d4037; }
        #modal-content h4 { font-size: 1.1em; color: var(--color-text-muted); border-bottom: none;}
        /* --- Image within Content Styling --- */
        #modal-content .final-image { display: block; max-width: 85%; height: auto; margin: 2rem auto 1rem auto; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: #fff; /* Fondo blanco por si la imagen tiene transparencia */ }
        #modal-content .image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; margin: 2rem auto 1rem auto; color: var(--color-text-muted); text-align: center; }
        #modal-content .image-placeholder .spinner { border: 4px solid rgba(0, 0, 0, 0.05); width: 35px; height: 35px; border-radius: 50%; border-left-color: var(--color-primary); animation: spin 1s linear infinite; margin-bottom: 0.5rem; }
        #modal-content .image-placeholder .placeholder-icon { font-size: 3rem; }

        #modal-loading { text-align: center; padding: 3rem 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(232, 230, 217, 0.97); /* Fondo de carga del modal */ display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: var(--border-radius); }
        .loading-spinner-modal { width: 60px; height: 60px; border: 6px solid #c8c3b8; border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1.2s linear infinite; margin: 0 auto 1.5rem auto; }
        #modal-loading p { font-weight: 700; color: var(--color-text); font-size: 1.2rem; font-family: 'Lato'; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background-color: #fcebe9; color: #c62828; padding: 1.2rem; border-radius: var(--border-radius); border: 1px solid #f7cac9; margin-top: 1.5rem; text-align: center; flex-shrink: 0; font-weight: bold; }
        .error-msg i { margin-right: 0.7rem; }
        .content-hidden { display: none; }
        #no-results-message { text-align: center; color: var(--color-text-muted); padding: 2rem; grid-column: 1 / -1; font-style: italic; }
    </style>
</head>
<body>
     <!-- Header/Navbar -->
     <nav class="navbar mb-8">
         <div class="container mx-auto px-4 py-4 flex justify-center items-center">
             <div class="flex items-center text-center">
                 <h1 class="logo text-2xl sm:text-3xl">
                     <i class="fas fa-bone mr-3 transform rotate-[-15deg]"></i> <!-- Icono hueso -->
                     Archivo de la Extinción
                     <i class="fas fa-dna ml-3 transform rotate-[15deg]"></i> <!-- Icono ADN -->
                 </h1>
             </div>
         </div>
     </nav>

     <!-- Main content -->
     <main class="container mx-auto px-4 pb-16">
         <!-- Hero section -->
         <section class="mb-10 text-center">
             <h1 class="page-title text-4xl sm:text-5xl mb-4">Ecos de un Mundo Perdido</h1>
             <p class="text-xl text-gray-700 mb-6 max-w-3xl mx-auto">Explora la historia de criaturas que ya no caminan, nadan o vuelan sobre la Tierra. Busca por nombre o selecciona de la lista para descubrir su legado.</p>
             <!-- Search Input -->
             <div id="search-container" class="max-w-2xl mx-auto">
                 <i class="fas fa-search"></i>
                 <input type="text" id="search-input" placeholder="Buscar animal extinto...">
             </div>
         </section>

         <!-- Title List Container -->
         <section class="mb-10">
             <h2 class="section-title text-2xl sm:text-3xl mb-6 text-center mx-auto">
                 <i class="fas fa-book-dead text-gray-600 mr-2"></i> <!-- Icono libro temático -->
                 Especies Registradas
             </h2>
             <div id="title-list">
                  <p id="titles-loading" class="text-gray-500 col-span-full text-center text-lg">Consultando los anales...</p>
                  <!-- No results message will be injected here by JS -->
             </div>
             <div id="generate-more-container" class="text-center mt-8">
                 <button id="generate-more-btn">
                      <i class="fas fa-sync-alt mr-2 animate-spin hidden"></i>
                     Descubrir Más Especies
                  </button>
             </div>
         </section>

     </main>

     <!-- Explanation Modal -->
     <div id="story-modal">
         <div class="modal-content-wrapper">
             <button class="modal-close-btn" id="modal-close" aria-label="Cerrar">&times;</button>

             <!-- Loading Indicator -->
             <div id="modal-loading">
                 <div class="loading-spinner-modal"></div>
                 <p>Reconstruyendo información...</p>
             </div>

             <!-- Content Area -->
             <div id="modal-story-content-area" class="content-hidden flex flex-col flex-grow min-h-0">
                 <h2 id="modal-title" class="text-2xl md:text-3xl font-bold mb-4 text-center flex-shrink-0"></h2>
                 <!-- Text Content (Scrollable) - Image appended here -->
                 <div id="modal-content" class="text-base md:text-lg">
                     <!-- Explanation text (HTML) goes here -->
                     <!-- Image and placeholder will be appended here by JS -->
                 </div>
                 <!-- Error Display Area -->
                 <div id="modal-error" class="error-msg content-hidden">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span id="modal-error-message"></span>
                  </div>
             </div>
          </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-200 text-gray-700 py-6 mt-12 border-t border-gray-300">
          <div class="container mx-auto px-4 text-center text-sm">
              <p>Descripciones generadas por IA basadas en conocimiento científico sobre especies extintas.</p>
              <p class="mt-1">La paleontología es una ciencia en constante evolución; la información puede actualizarse.</p>
              <p class="mt-2">© 2025 Archivo de la Extinción</p>
          </div>
      </footer>


    <script>
        // ========== CONFIG & DATA ==========
        const predefinedTitles = [
             // Paleozoico (Antes de Dinosaurios)
            "Trilobites (Clase Trilobita)", "Anomalocaris", "Opabinia", "Hallucigenia", "Wiwaxia", "Pikaia", "Haikouichthys", "Dunkleosteus", "Tiktaalik", "Ichthyostega", "Acanthostega", "Diplocaulus", "Eryops", "Dimetrodon", "Edaphosaurus", "Estemmenosuchus", "Inostrancevia", "Gorgonops", "Moschops", "Scutosaurus", "Meganeura (Libélula gigante)", "Arthropleura (Milpiés gigante)", "Pulmonoscorpius (Escorpión gigante)", "Eurypteridos (Escorpiones marinos)", "Ammonites (Clase Cephalopoda, subclase Ammonoidea)", "Orthoceras", "Cooksonia (Planta terrestre temprana)", "Lepidodendron (Árbol escamoso)", "Calamites (Cola de caballo gigante)", "Glossopteris (Helecho con semilla)",
            // Mesozoico - Dinosaurios (Selección Amplia)
            "Eoraptor", "Herrerasaurus", "Coelophysis", "Plateosaurus", "Massospondylus", "Dilophosaurus", "Cryolophosaurus", "Anchisaurus", "Scelidosaurus", "Megalosaurus", "Eustreptospondylus", "Ceratosaurus", "Allosaurus", "Torvosaurus", "Saurophaganax", "Yangchuanosaurus", "Sinraptor", "Monolophosaurus", "Guanlong", "Dilong", "Compsognathus", "Sinosauropteryx", "Caudipteryx", "Protarchaeopteryx", "Archaeopteryx", "Ornitholestes", "Deinonychus", "Velociraptor", "Utahraptor", "Dromaeosaurus", "Troodon", "Oviraptor", "Citipati", "Gigantoraptor", "Therizinosaurus", "Nothronychus", "Segnosaurus", "Gallimimus", "Ornithomimus", "Struthiomimus", "Deinocheirus", "Tyrannosaurus rex (T-Rex)", "Tarbosaurus", "Albertosaurus", "Gorgosaurus (dinosaurio)", "Daspletosaurus", "Alioramus", "Nanotyrannus (posiblemente juvenil de T-Rex)", "Spinosaurus", "Baryonyx", "Suchomimus", "Irritator", "Carnotaurus", "Majungasaurus", "Abelisaurus", "Rajasaurus", "Giganotosaurus", "Mapusaurus", "Carcharodontosaurus", "Acrocanthosaurus", "Argentinosaurus", "Patagotitan", "Saltasaurus", "Titanosaurus", "Alamosaurus", "Diplodocus", "Apatosaurus (Brontosaurus)", "Brachiosaurus", "Giraffatitan", "Camarasaurus", "Supersaurus", "Seismosaurus (probablemente Diplodocus)", "Amargasaurus", "Stegosaurus", "Kentrosaurus", "Miragaia", "Ankylosaurus", "Euoplocephalus", "Edmontonia", "Nodosaurus", "Triceratops", "Styracosaurus", "Centrosaurus", "Pachyrhinosaurus", "Chasmosaurus", "Torosaurus", "Protoceratops", "Psittacosaurus", "Pachycephalosaurus", "Stegoceras", "Dracorex (posiblemente juvenil Pachycephalosaurus)", "Stygimoloch (posiblemente juvenil Pachycephalosaurus)", "Iguanodon", "Ouranosaurus", "Maiasaura", "Edmontosaurus", "Parasaurolophus", "Corythosaurus", "Lambeosaurus", "Shantungosaurus", "Hypsilophodon", "Dryosaurus", "Camptosaurus", "Leaellynasaura", "Minmi", "Heterodontosaurus", "Lesothosaurus",
            // Mesozoico - Reptiles Marinos
            "Ichthyosaurus", "Stenopterygius", "Ophthalmosaurus", "Shonisaurus", "Temnodontosaurus", "Nothosaurus", "Cymbospondylus", "Plesiosaurus", "Elasmosaurus", "Liopleurodon", "Pliosaurus", "Kronosaurus", "Mosasaurus", "Tylosaurus", "Platecarpus", "Hainosaurus", "Prognathodon", "Archelon (Tortuga marina gigante)", "Protostega (Tortuga marina gigante)", "Hesperornis (Ave marina dentada)", "Ichthyornis (Ave marina dentada)",
            // Mesozoico - Pterosaurios (Reptiles Voladores)
            "Eudimorphodon", "Peteinosaurus", "Dimorphodon", "Rhamphorhynchus", "Scaphognathus", "Pterodactylus", "Germanodactylus", "Pteranodon", "Nyctosaurus", "Quetzalcoatlus", "Hatzegopteryx", "Arambourgiania", "Tapejara", "Tupuxuara", "Anhanguera", "Ornithocheirus", "Istiodactylus", "Dsungaripterus",
            // Cenozoico - Mamíferos (Megafauna y otros)
            "Mamut Lanudo (Mammuthus primigenius)", "Mastodonte Americano (Mammut americanum)", "Mamut Colombino (Mammuthus columbi)", "Mamut Pigmeo (Mammuthus exilis)", "Gomphotherium", "Platybelodon", "Deinotherium", "Palaeomastodon", "Moeritherium", "Arsinoitherium", "Andrewsarchus", "Mesonyx", "Hyaenodon", "Sarkastodon", "Entelodon (Cerdo del infierno)", "Archaeotherium", "Uintatherium", "Coryphodon", "Indricotherium / Paraceratherium (Rinoceronte gigante sin cuernos)", "Brontotherium / Megacerops", "Embolotherium", "Chalicotherium", "Moropus", "Hyracodon", "Metamynodon", "Elasmotherium (Rinoceronte siberiano)", "Coelodonta (Rinoceronte lanudo)", "Macrauchenia", "Toxodon", "Megatherium (Perezoso terrestre gigante)", "Eremotherium (Perezoso terrestre gigante)", "Mylodon (Perezoso terrestre)", "Glossotherium (Perezoso terrestre)", "Glyptodon (Armadillo gigante)", "Doedicurus (Armadillo gigante con cola de maza)", "Pampatherium (Armadillo gigante)", "Smilodon (Tigre dientes de sable)", "Homotherium (Gato cimitarra)", "Megantereon", "Machairodus", "Barbourofelis", "Thylacosmilus (Marsupial dientes de sable)", "Dinofelis", "Panthera atrox (León americano)", "Panthera spelaea (León de las cavernas)", "Ursus spelaeus (Oso de las cavernas)", "Arctodus simus (Oso de cara corta)", "Arctotherium (Oso de cara corta sudamericano)", "Canis dirus (Lobo gigante / Lobo terrible)", "Epicyon (Perro triturador de huesos)", "Borophagus", "Aelurodon", "Megaceros / Megaloceros (Ciervo gigante / Alce irlandés)", "Eucladoceros (Ciervo de cornamenta arbustiva)", "Synthetoceras", "Sivatherium (Jirafa de cuernos cortos)", "Bison antiquus (Bisonte antiguo)", "Bison latifrons (Bisonte de cuernos largos)", "Bos primigenius (Uro)", "Equus giganteus (Caballo gigante)", "Hippidion (Caballo sudamericano)", "Castoroides (Castor gigante)", "Josephoartigasia monesi (Roedor gigante)", "Phoberomys pattersoni (Roedor gigante)", "Aepycamelus (Camello de cuello largo)", "Titanotylopus (Camello gigante)", "Diprotodon (Marsupial gigante australiano)", "Zygomaturus", "Procoptodon (Canguro gigante de cara corta)", "Palorchestes (Tapir marsupial)", "Thylacinus cynocephalus (Tilacino / Lobo de Tasmania)", "Thylacoleo carnifex (León marsupial)", "Basilosaurus (Ballena primitiva)", "Dorudon", "Livyatan melvillei (Cachalote depredador gigante)", "Pakicetus", "Ambulocetus", "Kutchicetus", "Rodhocetus", "Aegyptopithecus", "Proconsul", "Dryopithecus", "Sivapithecus", "Gigantopithecus", "Australopithecus afarensis (Lucy)", "Australopithecus africanus", "Paranthropus boisei", "Paranthropus robustus", "Homo habilis", "Homo erectus", "Homo heidelbergensis", "Homo neanderthalensis (Neandertal)", "Homo floresiensis (Hobbit de Flores)", "Hombre de Denisova", "Desmostylus", "Paleoparadoxia", "Kolponomos (Oso marino)", "Plesiadapis", "Notharctus", "Darwinius masillae (Ida)", "Leptictidium",
            // Cenozoico - Aves (y relacionados)
            "Gastornis / Diatryma (Ave del terror)", "Phorusrhacos (Ave del terror)", "Kelenken (Ave del terror)", "Titanis walleri (Ave del terror)", "Andalgalornis", "Aepyornis (Ave elefante)", "Dinornis (Moa gigante)", "Emeus (Moa)", "Pachyornis (Moa)", "Harpagornis moorei (Águila de Haast)", "Teratornis merriami (Teratornio)", "Argentavis magnificens (Ave voladora más grande)", "Pelagornis sandersi (Ave con 'dientes' óseos)", "Osteodontornis", "Dodo (Raphus cucullatus)", "Solitario de Rodrigues (Pezophaps solitaria)", "Solitario de Reunión (Threskiornis solitarius - ibis)", "Alca gigante (Pinguinus impennis)", "Paloma pasajera (Ectopistes migratorius)", "Periquito de Carolina (Conuropsis carolinensis)", "Pato de cabeza rosa (Rhodonessa caryophyllacea)", "Eider de anteojos de Steller (Polysticta stelleri - posiblemente no extinto, pero crítico)", "Caracara de Guadalupe (Caracara lutosa)", "Codorniz de Nueva Zelanda (Coturnix novaezelandiae)", "Chochín de Stephens Island (Traversia lyalli)", "Cuervo de las Chatham (Corvus moriorum)", "Moho de Oahu (Moho apicalis)", "Especie tipo del ʻōʻū (Psittirostra psittacea)", "Cormorán de Pallas (Phalacrocorax perspicillatus)", "Mérgulo de anteojos (Synthliboramphus wumizusume - crítico/posiblemente extinto)",
            // Extinciones Recientes (Post-1500, algunas ya listadas)
            "Vaca marina de Steller (Hydrodamalis gigas)", "Quagga (Subespecie de cebra)", "Baiji (Delfín del río Yangtze - funcionalmente extinto)", "Rinoceronte negro occidental (Diceros bicornis longipes - subespecie)", "Íbice de los Pirineos / Bucardo (Capra pyrenaica pyrenaica - subespecie)", "Tigre de Bali (Panthera tigris balica - subespecie)", "Tigre de Java (Panthera tigris sondaica - subespecie)", "Tigre del Caspio (Panthera tigris virgata - subespecie)", "León del Atlas / León de Berbería (Panthera leo leo - extinto en estado salvaje)", "Macao cubano (Ara tricolor)", "Sapo dorado (Incilius periglenes)", "Rana incubadora gástrica (Rheobatrachus silus)",
            // Conceptos / Eventos
            "Extinción masiva del Pérmico-Triásico ('La Gran Mortandad')", "Extinción masiva del Cretácico-Paleógeno (K-Pg, extinción de los dinosaurios)", "Extinción masiva del Ordovícico-Silúrico", "Extinción masiva del Devónico Tardío", "Extinción masiva del Triásico-Jurásico", "Evento de Azolla", "Evento Anóxico Oceánico (OAE)", "Hipótesis del impacto de Chicxulub", "Las Traps del Decán (Vulcanismo)", "Las Traps Siberianas (Vulcanismo)", "Glaciación del Cuaternario y Extinciones de Megafauna", "Hipótesis de la Caza Excesiva (Overkill hypothesis)", "La Sexta Extinción (Antropoceno)", "Fósiles vivientes (ej. Celacanto, Ginkgo Biloba)", "Taxón Lázaro", "Registro fósil", "Tafonomía (Estudio de la fosilización)", "Paleontología", "Paleoarte", "Yacimiento de Fósiles de Burgess Shale (Canadá)", "Yacimiento de Fósiles de Chengjiang (China)", "Yacimientos de Fósiles de Solnhofen (Alemania)", "Formación Morrison (EE. UU.)", "Formación Hell Creek (EE. UU.)", "Pozos de Brea de La Brea (EE. UU.)", "Sitio fosilífero de Riversleigh (Australia)", "Sitio fosilífero de Messel (Alemania)"
        ];
        const extinctAnimalThemes = [ // Temas para generar más títulos
            "dinosaurios terópodos", "dinosaurios saurópodos", "dinosaurios ornitisquios", "reptiles marinos del Mesozoico",
            "pterosaurios", "mamíferos de la Edad de Hielo", "megafauna del Pleistoceno", "aves extintas recientemente",
            "animales del Paleozoico", "fósiles del Cámbrico", "criaturas de Burgess Shale", "primeros tetrápodos",
            "sinápsidos no mamíferos", "aves del terror sudamericanas", "marsupiales extintos de Australia",
            "fauna extinta de Nueva Zelanda", "primates fósiles", "homínidos extintos", "grandes eventos de extinción masiva",
            "causas de extinción (impactos, volcanes, clima)", "extinciones causadas por humanos", "yacimientos fósiles famosos",
            "trilobites", "ammonites", "mamuts y mastodontes", "tigres dientes de sable"
        ];
        const textApiConfig = {
            model: "mistral",
            systemPrompt: "Eres un paleontólogo y divulgador científico. Tu tarea es describir animales extintos o conceptos relacionados con la paleontología de forma rigurosa, detallada y accesible para el público general interesado. Describe la especie (clasificación, tamaño, apariencia basada en fósiles), la época y lugar donde vivió (período geológico, ambiente), su posible dieta y comportamiento (inferido), las posibles causas de su extinción y su importancia en la historia de la vida o en la ciencia. Si es un concepto, explícalo claramente con ejemplos. Usa un lenguaje preciso pero evita la jerga excesiva. El objetivo es un texto informativo y fascinante de aproximadamente 1200-1300 palabras. Basa tu descripción únicamente en la siguiente especie o concepto:",
            timeoutSeconds: 150
        };
        const titleGenerationConfig = {
            model: "mistral",
            systemPrompt: "Actúa como un generador de ideas conciso para una enciclopedia de paleontología. Genera exactamente 15 nombres de animales extintos específicos (ej. *Tyrannosaurus rex*, Dodo, Mamut Lanudo) o conceptos paleontológicos clave (ej. Extinción K-Pg, Burgess Shale), adecuados para ser descritos en detalle. Devuelve *solo* la lista de nombres, uno por línea. No incluyas números, guiones, introducciones ni despedidas.",
            timeoutSeconds: 40
        };

        // ========== DOM ELEMENTS ========== (Igual que versión Colombia)
        const searchInput = document.getElementById('search-input');
        const titleListContainer = document.getElementById('title-list');
        const titlesLoading = document.getElementById('titles-loading');
        const generateMoreContainer = document.getElementById('generate-more-container');
        const generateMoreBtn = document.getElementById('generate-more-btn');
        const storyModal = document.getElementById('story-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalLoadingIndicator = document.getElementById('modal-loading');
        const modalStoryContentArea = document.getElementById('modal-story-content-area');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        let noResultsMessageElement = null;

        // ========== API FUNCTIONS ========== (Igual que versión Colombia)
        async function fetchTextFromApi(prompt, config) { /* ... */
            const encodedPrompt = encodeURIComponent(prompt);
            const encodedSystem = encodeURIComponent(config.systemPrompt);
            const params = new URLSearchParams({ model: config.model, system: encodedSystem });
            if (config.seed) params.append('seed', config.seed);
            const url = `https://text.pollinations.ai/${encodedPrompt}?${params.toString()}`;
            console.log(`Fetching text from API (${config.model}): ${url.substring(0, 200)}...`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeoutSeconds * 1000);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`Error HTTP ${response.status}.`);
                const text = await response.text();
                if (!text || text.trim().length === 0) throw new Error("La respuesta de la API estaba vacía.");
                console.log(`API Response received (${text.length} chars)`);
                return text;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error("API Fetch Error:", error);
                if (error.name === 'AbortError') throw new Error(`La solicitud a la API tardó demasiado (>${config.timeoutSeconds}s). Intente de nuevo.`);
                throw new Error(`Error de comunicación con la API: ${error.message}`);
            }
        }
        async function fetchExplanationText(conceptTitle) { /* ... */
             const text = await fetchTextFromApi(conceptTitle, textApiConfig);
              if (text.trim().length < 800 || text.toLowerCase().includes("cannot fulfill") || text.toLowerCase().includes("no puedo generar") || text.toLowerCase().includes("incapaz de")) {
                   throw new Error("La IA no pudo generar una descripción adecuada o suficientemente detallada para esta especie/concepto.");
               }
             return text;
         }
        async function fetchGeneratedTitles() { /* ... */
            const randomTheme = getRandomElement(extinctAnimalThemes) || "criaturas prehistóricas fascinantes";
            const specificPrompt = `Genera 15 nombres de animales extintos o conceptos paleontológicos sobre ${randomTheme}`;
            console.log("Generating titles with prompt:", specificPrompt);
            const configForThisRequest = { ...titleGenerationConfig, seed: Math.floor(Math.random() * 1000000) };
            const text = await fetchTextFromApi(specificPrompt, configForThisRequest);
            const titles = text.split('\n').map(line => line.replace(/^[-\d.\s*]+/, '').trim()).filter(line => line.length > 3 && line.length < 100);
            if (titles.length < 5) throw new Error("No se pudieron generar suficientes ideas.");
            return titles.slice(0, 15);
        }
        function createPollinationsImageUrl(promptText, options = {}) { // Prompt adaptado a EXTINCIÓN
            const defaults = { seed: Math.floor(Math.random() * 10000000), width: 800, height: 600, nologo: true };
            const settings = { ...defaults, ...options };
            // Limpiar el prompt (quitar info entre paréntesis, etc.)
            const cleanPromptText = typeof promptText === 'string' && promptText.trim() !== ''
                ? promptText.split('(')[0].trim().replace(/Clase|Subclase|Subespecie/gi, '')
                : "extinct creature scientific reconstruction";
            // Prompt ENFOCADO en paleoarte, reconstrucción científica
            const enhancedPrompt = `Paleoart scientific reconstruction of ${cleanPromptText}. Show the animal in its likely natural habitat (forest, plains, ocean, swamp, tundra). Accurate anatomy based on fossil evidence. Dynamic or natural pose. Detailed texture. Avoid anthropomorphism.`;
            const escapedPrompt = encodeURIComponent(enhancedPrompt);
            if (!escapedPrompt) return '';
            const negativePrompt = "text, words, labels, diagram, chart, skeleton only, fossil only, museum display, cartoon, drawing, simple illustration, monster, fantasy creature, human figure, modern objects, multiple animals unless specified, isolated on white background";
            const escapedNegative = encodeURIComponent(negativePrompt);
            let url = `https://image.pollinations.ai/prompt/${escapedPrompt}?seed=${settings.seed}&width=${settings.width}&height=${settings.height}&negative=${escapedNegative}`;
            if (settings.nologo) url += '&nologo=true';
            console.log("Image URL:", url);
            return url;
        }

        // ========== Text Formatting Function ========== (sin cambios)
        function formatExplanationText(rawText) { /* ... */
            if (!rawText) return '';
            let formatted = rawText.trim();
            formatted = formatted.replace(/^####\s+(.*)$/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^#\s+(.*)$/gm, '<h1>$1</h1>');
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            const blocks = formatted.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            formatted = blocks.map(block => {
                if (block.startsWith('<h')) return block;
                let content = block.replace(/\n/g, '<br>');
                return `<p>${content}</p>`;
            }).join('');
            // Específico: Italizar nombres científicos (simple heurística: palabra capitalizada seguida de minúscula entre <em> o *)
            formatted = formatted.replace(/<em>([A-Z][a-z]+ [a-z]+)<\/em>/g, '<em>$1</em>'); // Keep if already italic
            formatted = formatted.replace(/([^A-Za-z]|^)([A-Z][a-z]+ [a-z]+)([^A-Za-z]|$)/g, '$1<em>$2</em>$3');
            return formatted;
         }

        // ========== MODAL FUNCTIONS ========== (Igual que versión Colombia)
        function showModal() { /* ... */ if(!storyModal) return; storyModal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal() { /* ... */
             if(!storyModal || !modalContent) return;
             storyModal.classList.remove('active');
             document.body.style.overflow = '';
             modalContent.scrollTop = 0; // Reset scroll
             console.log("Scroll set to 0 on hideModal");
             resetModalState();
         }
        function resetModalState() { /* ... */
              if (!modalLoadingIndicator || !modalStoryContentArea || !modalError || !modalTitle || !modalContent) return;
              modalLoadingIndicator.style.display = 'flex';
              modalStoryContentArea.classList.add('content-hidden');
              modalError.classList.add('content-hidden');
              modalTitle.textContent = '';
              modalContent.innerHTML = ''; // Clears text and appended image/placeholder
              modalErrorMessage.textContent = '';
         }

        // ========== UI & EVENT HANDLERS ========== (Igual que versión Colombia, con textos temáticos)
        function getRandomElement(arr) { /* ... */ if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffleArray(array) { /* ... */ let ci = array.length, ri; while (ci > 0) { ri = Math.floor(Math.random() * ci); ci--; [array[ci], array[ri]] = [array[ri], array[ci]]; } return array; }
        function createTitleItem(title) { /* ... */ const div = document.createElement('div'); div.className = 'title-item'; div.textContent = title; div.setAttribute('data-title', title); div.addEventListener('click', () => handleTitleClick(title)); return div; }
        function displayTitles(titles) { /* ... */
             if (!titleListContainer || !titlesLoading) return;
             const shuffledTitles = shuffleArray([...titles]);
             titleListContainer.innerHTML = ''; // Clear previous, including "no results"
             titlesLoading.style.display = 'none';
             if (shuffledTitles.length === 0) {
                 showNoResultsMessage("No hay registros iniciales disponibles.");
                 return;
             }
             shuffledTitles.forEach(title => titleListContainer.appendChild(createTitleItem(title)));
             filterTitles(); // Apply current search filter immediately
        }
        function appendTitles(newTitles) { /* ... */
            if (!titleListContainer || !newTitles || newTitles.length === 0) return;
            const searchTerm = searchInput.value.toLowerCase().trim();
            newTitles.forEach(title => {
                const item = createTitleItem(title);
                if (searchTerm === '' || title.toLowerCase().includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
                titleListContainer.appendChild(item);
            });
            checkIfAnyResultsVisible();
         }
        function filterTitles() { /* ... */
             if (!searchInput || !titleListContainer) return;
             const searchTerm = searchInput.value.toLowerCase().trim();
             const titleItems = titleListContainer.querySelectorAll('.title-item');
             let visibleCount = 0;
             titleItems.forEach(item => {
                 const title = item.textContent.toLowerCase();
                 if (title.includes(searchTerm)) {
                     item.style.display = 'flex';
                     visibleCount++;
                 } else {
                     item.style.display = 'none';
                 }
             });
             updateNoResultsMessage(visibleCount);
         }
        function updateNoResultsMessage(visibleCount) { /* ... */
              if (!titleListContainer) return;
              if (noResultsMessageElement) {
                  noResultsMessageElement.remove();
                  noResultsMessageElement = null;
              }
              if (visibleCount === 0 && titleListContainer.children.length > 0 && !titlesLoading.style.display || titlesLoading.style.display === 'none') {
                  showNoResultsMessage(`No se encontraron registros para "${searchInput.value}"`);
              }
         }
        function showNoResultsMessage(message) { /* ... */
              if (noResultsMessageElement || !titleListContainer) return;
              noResultsMessageElement = document.createElement('p');
              noResultsMessageElement.id = 'no-results-message';
              noResultsMessageElement.textContent = message;
              titleListContainer.appendChild(noResultsMessageElement);
         }
        function checkIfAnyResultsVisible() { /* ... */
              const visibleItems = titleListContainer.querySelectorAll('.title-item[style*="display: flex"], .title-item:not([style*="display: none"])');
              updateNoResultsMessage(visibleItems.length);
          }

        // *** MODIFIED: handleTitleClick (Image logic same, icon updated) ***
        async function handleTitleClick(title) {
            resetModalState();
            showModal();
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            modalError.classList.add('content-hidden');
            modalLoadingIndicator.style.display = 'flex';

            try {
                const rawExplanationText = await fetchExplanationText(title);
                const formattedExplanation = formatExplanationText(rawExplanationText); // Apply formatting

                modalLoadingIndicator.style.display = 'none';
                modalContent.innerHTML = formattedExplanation; // Display text
                modalStoryContentArea.classList.remove('content-hidden');

                modalContent.scrollTop = 0; // RESET SCROLL!
                console.log("Scroll set to 0 after content visible");

                // Append image placeholder
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'image-placeholder';
                placeholderDiv.innerHTML = `
                    <div class="spinner"></div>
                    <i class="fas fa-feather-alt placeholder-icon"></i> <!-- Themed icon: feather -->
                    <p style="font-size: 0.8em; margin-top: 0.5rem;">Reconstruyendo imagen...</p>
                `;
                modalContent.appendChild(placeholderDiv);

                // Create and append image element
                const imgElement = document.createElement('img');
                imgElement.className = 'final-image';
                imgElement.alt = `Reconstrucción artística de ${title.split('(')[0].trim()}`;
                imgElement.style.display = 'none';

                imgElement.onload = () => { placeholderDiv.remove(); imgElement.style.display = 'block'; };
                imgElement.onerror = () => {
                    console.error("Error loading image for:", title);
                    placeholderDiv.innerHTML = `<i class="fas fa-eye-slash placeholder-icon"></i><p style="font-size: 0.8em; margin-top: 0.5rem;">No se pudo reconstruir la imagen.</p>`;
                };

                const imageUrl = createPollinationsImageUrl(title);
                if (imageUrl) { imgElement.src = imageUrl; modalContent.appendChild(imgElement); }
                else { console.error("Could not create image URL for:", title); placeholderDiv.innerHTML = `<i class="fas fa-exclamation-circle placeholder-icon"></i><p style="font-size: 0.8em; margin-top: 0.5rem;">Error generando URL.</p>`; }

            } catch (error) {
                console.error("Failed display:", error);
                modalLoadingIndicator.style.display = 'none';
                modalErrorMessage.textContent = `Error: ${error.message}`;
                modalError.classList.remove('content-hidden');
                modalStoryContentArea.classList.remove('content-hidden');
                modalContent.innerHTML = '';
            }
        }

        async function handleGenerateMoreTitles() { /* ... (Textos temáticos) */
             if (!generateMoreBtn || !generateMoreContainer) return;
             const spinner = generateMoreBtn.querySelector('i');
             generateMoreBtn.disabled = true;
             if(spinner) spinner.classList.remove('hidden');
             generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Descubriendo...";

             try {
                 const newTitles = await fetchGeneratedTitles();
                 if (newTitles && newTitles.length > 0) {
                     generateMoreContainer.style.display = 'none';
                     appendTitles(newTitles);
                     if (titleListContainer.parentNode) { titleListContainer.parentNode.appendChild(generateMoreContainer); }
                     generateMoreContainer.style.display = 'block';
                 } else { alert("No se pudieron descubrir más especies en este momento."); }
             } catch (error) {
                 console.error("Failed title generation:", error);
                 alert(`Error al descubrir especies: ${error.message}`);
             } finally {
                 generateMoreBtn.disabled = false;
                 if(spinner) spinner.classList.add('hidden');
                 generateMoreBtn.childNodes[generateMoreBtn.childNodes.length - 1].nodeValue = " Descubrir Más Especies";
                 checkIfAnyResultsVisible();
             }
         }

        // ========== INITIALIZATION ========== (Igual que versión Colombia)
        function initApp() {
             if (!titleListContainer || !storyModal || !modalCloseBtn || !generateMoreBtn || !titlesLoading || !searchInput) { console.error("Init fail."); document.body.innerHTML = '<p style="color: #c62828; font-size: 1.5em; text-align: center; padding-top: 3em;">Error Catastrófico: El archivo de la extinción no pudo ser cargado.</p>'; return; } // Error temático
             modalCloseBtn.addEventListener('click', hideModal);
             generateMoreBtn.addEventListener('click', handleGenerateMoreTitles);
             storyModal.addEventListener('click', (event) => { if (event.target === storyModal) hideModal(); });
             searchInput.addEventListener('input', filterTitles); // Add search listener
             displayTitles(predefinedTitles); // Display initial titles
         }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

</body>
</html>